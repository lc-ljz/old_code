import{g as At,c as Ot,a as Ct}from"./common/_commonjsHelpers-4f955397.js";import{e as Lt}from"./common/index-be334ef0.js";var $=Ot(function(Pt,sa){(function(F,R){Pt.exports=R(Lt)})(Ct,function(Tt){return function(F){var R={};function g(E){if(R[E])return R[E].exports;var c=R[E]={i:E,l:!1,exports:{}};return F[E].call(c.exports,c,c.exports,g),c.l=!0,c.exports}return g.m=F,g.c=R,g.d=function(E,c,t){g.o(E,c)||Object.defineProperty(E,c,{configurable:!1,enumerable:!0,get:t})},g.n=function(E){var c=E&&E.__esModule?function(){return E.default}:function(){return E};return g.d(c,"a",c),c},g.o=function(E,c){return Object.prototype.hasOwnProperty.call(E,c)},g.p="",g(g.s=105)}([function(F,R){F.exports=Tt},function(F,R,g){var E=g(41),c=g(52),t=g(5),a=g(4),o=g(9),i=g(19),s=g(35),h=g(14),r=g(0),e=g.n(r),n=g(36),l=g(74),u=g.n(l),_=g(60),f=g(123),d=g(124),v=g(128),m=g(129),p=g(2),y=g(131),x=g(43),M=g(76),P=g(132),T=g(133),O=g(134),D=g(135),A=g(37),C=g(38),S=g(26),L=g(3),I=g(136),w=g(56),b=g(137),B=g(138),U=g(139),W=g(7),z=g(73),G=g(54),H=g(18),X=g(59),Q=g(140),j=g(145),J=g(70),Y=g(146),at=g(147),ot=g(148),ut=g(149),et=g(150),ht=g(151);e.a.util.extend(s.a.prototype,Q.a),o.a.import(j.a),o.a.import(J.a),o.a.import(Y.a),o.a.import(at.a),o.a.import(ot.a),o.a.import(ut.a),o.a.import(et.a),o.a.import(ht.a);function ft(q){return!q||q==="none"}function it(q){return q instanceof HTMLCanvasElement||q instanceof HTMLImageElement||q instanceof Image}function N(q){return q.getZr&&q.setOption}var K=n.a.prototype.addToScene,Z=n.a.prototype.removeFromScene;n.a.prototype.addToScene=function(q){if(K.call(this,q),this.__zr){var tt=this.__zr;q.traverse(function(st){st.__zr=tt,st.addAnimatorsToZr&&st.addAnimatorsToZr(tt)})}},n.a.prototype.removeFromScene=function(q){Z.call(this,q),q.traverse(function(tt){var st=tt.__zr;tt.__zr=null,st&&tt.removeAnimatorsFromZr&&tt.removeAnimatorsFromZr(st)})},i.a.prototype.setTextureImage=function(q,tt,st,lt){if(!!this.shader){var _t=st.getZr(),vt=this,ct;return vt.autoUpdateTextureStatus=!1,vt.disableTexture(q),ft(tt)||(ct=V.loadTexture(tt,st,lt,function(mt){vt.enableTexture(q),_t&&_t.refresh()}),vt.set(q,ct)),ct}};var V={};V.Renderer=c.a,V.Node=s.a,V.Mesh=E.a,V.Shader=o.a,V.Material=i.a,V.Texture=a.a,V.Texture2D=t.a,V.Geometry=h.a,V.SphereGeometry=y.a,V.PlaneGeometry=x.a,V.CubeGeometry=M.a,V.AmbientLight=P.a,V.DirectionalLight=T.a,V.PointLight=O.a,V.SpotLight=D.a,V.PerspectiveCamera=A.a,V.OrthographicCamera=C.a,V.Vector2=S.a,V.Vector3=L.a,V.Vector4=I.a,V.Quaternion=w.a,V.Matrix2=b.a,V.Matrix2d=B.a,V.Matrix3=U.a,V.Matrix4=W.a,V.Plane=z.a,V.Ray=G.a,V.BoundingBox=H.a,V.Frustum=X.a;var k=_.a.createBlank("rgba(255,255,255,0)").image;function rt(q){return Math.pow(2,Math.round(Math.log(q)/Math.LN2))}function nt(q){if((q.wrapS===a.a.REPEAT||q.wrapT===a.a.REPEAT)&&q.image){var tt=rt(q.width),st=rt(q.height);if(tt!==q.width||st!==q.height){var lt=document.createElement("canvas");lt.width=tt,lt.height=st;var _t=lt.getContext("2d");_t.drawImage(q.image,0,0,tt,st),q.image=lt}}}V.loadTexture=function(q,tt,st,lt){typeof st=="function"&&(lt=st,st={}),st=st||{};for(var _t=Object.keys(st).sort(),vt="",ct=0;ct<_t.length;ct++)vt+=_t[ct]+"_"+st[_t[ct]]+"_";var mt=tt.__textureCache=tt.__textureCache||new u.a(20);if(N(q)){var gt=q.__textureid__,dt=mt.get(vt+gt);if(dt)dt.texture.surface.setECharts(q),lt&&lt(dt.texture);else{var Et=new f.a(q);Et.onupdate=function(){tt.getZr().refresh()},dt={texture:Et.getTexture()};for(var ct=0;ct<_t.length;ct++)dt.texture[_t[ct]]=st[_t[ct]];gt=q.__textureid__||"__ecgl_ec__"+dt.texture.__uid__,q.__textureid__=gt,mt.put(vt+gt,dt),lt&&lt(dt.texture)}return dt.texture}else if(it(q)){var gt=q.__textureid__,dt=mt.get(vt+gt);if(!dt){dt={texture:new V.Texture2D({image:q})};for(var ct=0;ct<_t.length;ct++)dt.texture[_t[ct]]=st[_t[ct]];gt=q.__textureid__||"__ecgl_image__"+dt.texture.__uid__,q.__textureid__=gt,mt.put(vt+gt,dt),nt(dt.texture),lt&&lt(dt.texture)}return dt.texture}else{var dt=mt.get(vt+q);if(dt)dt.callbacks?dt.callbacks.push(lt):lt&&lt(dt.texture);else if(q.match(/.hdr$|^data:application\/octet-stream/)){dt={callbacks:[lt]};var pt=_.a.loadTexture(q,{exposure:st.exposure,fileType:"hdr"},function(){pt.dirty(),dt.callbacks.forEach(function(yt){yt&&yt(pt)}),dt.callbacks=null});dt.texture=pt,mt.put(vt+q,dt)}else{for(var pt=new V.Texture2D({image:new Image}),ct=0;ct<_t.length;ct++)pt[_t[ct]]=st[_t[ct]];dt={texture:pt,callbacks:[lt]};var xt=pt.image;xt.onload=function(){pt.image=xt,nt(pt),pt.dirty(),dt.callbacks.forEach(function(Dt){Dt&&Dt(pt)}),dt.callbacks=null},xt.src=q,pt.image=k,mt.put(vt+q,dt)}return dt.texture}},V.createAmbientCubemap=function(q,tt,st,lt){q=q||{};var _t=q.texture,vt=p.a.firstNotNull(q.exposure,1),ct=new d.a({intensity:p.a.firstNotNull(q.specularIntensity,1)}),mt=new v.a({intensity:p.a.firstNotNull(q.diffuseIntensity,1),coefficients:[.844,.712,.691,-.037,.083,.167,.343,.288,.299,-.041,-.021,-.009,-.003,-.041,-.064,-.011,-.007,-.004,-.031,.034,.081,-.06,-.049,-.06,.046,.056,.05]});return ct.cubemap=V.loadTexture(_t,st,{exposure:vt},function(){ct.cubemap.flipY=!1;var gt=Date.now();ct.prefilter(tt,32);{var dt=Date.now()-gt;console.log("Prefilter environment map: "+dt+"ms")}mt.coefficients=m.a.projectEnvironmentMap(tt,ct.cubemap,{lod:1}),lt&&lt()}),{specular:ct,diffuse:mt}},V.createBlankTexture=_.a.createBlank,V.isImage=it,V.additiveBlend=function(q){q.blendEquation(q.FUNC_ADD),q.blendFunc(q.SRC_ALPHA,q.ONE)},V.parseColor=function(q,tt){return q instanceof Array?(tt||(tt=[]),tt[0]=q[0],tt[1]=q[1],tt[2]=q[2],q.length>3?tt[3]=q[3]:tt[3]=1,tt):(tt=e.a.color.parse(q||"#000",tt)||[0,0,0,0],tt[0]/=255,tt[1]/=255,tt[2]/=255,tt)},V.directionFromAlphaBeta=function(q,tt){var st=q/180*Math.PI+Math.PI/2,lt=-tt/180*Math.PI+Math.PI/2,_t=[],vt=Math.sin(st);return _t[0]=vt*Math.cos(lt),_t[1]=-Math.cos(st),_t[2]=vt*Math.sin(lt),_t},V.getShadowResolution=function(q){var tt=1024;switch(q){case"low":tt=512;break;case"medium":break;case"high":tt=2048;break;case"ultra":tt=4096;break}return tt},V.COMMON_SHADERS=["lambert","color","realistic","hatching","shadow"],V.createShader=function(q){q==="ecgl.shadow"&&(q="ecgl.displayShadow");var tt=o.a.source(q+".vertex"),st=o.a.source(q+".fragment");tt||console.error("Vertex shader of '%s' not exits",q),st||console.error("Fragment shader of '%s' not exits",q);var lt=new o.a(tt,st);return lt.name=q,lt},V.createMaterial=function(q,tt){tt instanceof Array||(tt=[tt]);var st=V.createShader(q),lt=new i.a({shader:st});return tt.forEach(function(_t){typeof _t=="string"&&lt.define(_t)}),lt},V.setMaterialFromModel=function(q,tt,st,lt){tt.autoUpdateTextureStatus=!1;var _t=st.getModel(q+"Material"),vt=_t.get("detailTexture"),ct=p.a.firstNotNull(_t.get("textureTiling"),1),mt=p.a.firstNotNull(_t.get("textureOffset"),0);typeof ct=="number"&&(ct=[ct,ct]),typeof mt=="number"&&(mt=[mt,mt]);var gt=ct[0]>1||ct[1]>1?V.Texture.REPEAT:V.Texture.CLAMP_TO_EDGE,dt={anisotropic:8,wrapS:gt,wrapT:gt};if(q==="realistic"){var Et=_t.get("roughness"),pt=_t.get("metalness");pt!=null?isNaN(pt)&&(tt.setTextureImage("metalnessMap",pt,lt,dt),pt=p.a.firstNotNull(_t.get("metalnessAdjust"),.5)):pt=0,Et!=null?isNaN(Et)&&(tt.setTextureImage("roughnessMap",Et,lt,dt),Et=p.a.firstNotNull(_t.get("roughnessAdjust"),.5)):Et=.5;var xt=_t.get("normalTexture");tt.setTextureImage("detailMap",vt,lt,dt),tt.setTextureImage("normalMap",xt,lt,dt),tt.set({roughness:Et,metalness:pt,detailUvRepeat:ct,detailUvOffset:mt})}else if(q==="lambert")tt.setTextureImage("detailMap",vt,lt,dt),tt.set({detailUvRepeat:ct,detailUvOffset:mt});else if(q==="color")tt.setTextureImage("detailMap",vt,lt,dt),tt.set({detailUvRepeat:ct,detailUvOffset:mt});else if(q==="hatching"){var Mt=_t.get("hatchingTextures")||[];Mt.length<6&&console.error("Invalid hatchingTextures.");for(var yt=0;yt<6;yt++)tt.setTextureImage("hatch"+(yt+1),Mt[yt],lt,{anisotropic:8,wrapS:V.Texture.REPEAT,wrapT:V.Texture.REPEAT});tt.set({detailUvRepeat:ct,detailUvOffset:mt})}},V.updateVertexAnimation=function(q,tt,st,lt){var _t=lt.get("animation"),vt=lt.get("animationDurationUpdate"),ct=lt.get("animationEasingUpdate"),mt=st.shadowDepthMaterial;if(_t&&tt&&vt>0&&tt.geometry.vertexCount===st.geometry.vertexCount){st.material.define("vertex","VERTEX_ANIMATION"),st.ignorePreZ=!0,mt&&mt.define("vertex","VERTEX_ANIMATION");for(var gt=0;gt<q.length;gt++)st.geometry.attributes[q[gt][0]].value=tt.geometry.attributes[q[gt][1]].value;st.geometry.dirty(),st.__percent=0,st.material.set("percent",0),st.stopAnimation(),st.animate().when(vt,{__percent:1}).during(function(){st.material.set("percent",st.__percent),mt&&mt.set("percent",st.__percent)}).done(function(){st.ignorePreZ=!1,st.material.undefine("vertex","VERTEX_ANIMATION"),mt&&mt.undefine("vertex","VERTEX_ANIMATION")}).start(ct)}else st.material.undefine("vertex","VERTEX_ANIMATION"),mt&&mt.undefine("vertex","VERTEX_ANIMATION")},R.a=V},function(F,R,g){var E=g(0),c=g.n(E),t={firstNotNull:function(){for(var a=0,o=arguments.length;a<o;a++)if(arguments[a]!=null)return arguments[a]},queryDataIndex:function(a,o){if(o.dataIndexInside!=null)return o.dataIndexInside;if(o.dataIndex!=null)return c.a.util.isArray(o.dataIndex)?c.a.util.map(o.dataIndex,function(i){return a.indexOfRawIndex(i)}):a.indexOfRawIndex(o.dataIndex);if(o.name!=null)return c.a.util.isArray(o.name)?c.a.util.map(o.name,function(i){return a.indexOfName(i)}):a.indexOfName(o.name)}};R.a=t},function(F,R,g){var E=g(12),c=function(r,e,n){r=r||0,e=e||0,n=n||0,this.array=E.a.fromValues(r,e,n),this._dirty=!0};c.prototype={constructor:c,add:function(r){return E.a.add(this.array,this.array,r.array),this._dirty=!0,this},set:function(r,e,n){return this.array[0]=r,this.array[1]=e,this.array[2]=n,this._dirty=!0,this},setArray:function(r){return this.array[0]=r[0],this.array[1]=r[1],this.array[2]=r[2],this._dirty=!0,this},clone:function(){return new c(this.x,this.y,this.z)},copy:function(r){return E.a.copy(this.array,r.array),this._dirty=!0,this},cross:function(r,e){return E.a.cross(this.array,r.array,e.array),this._dirty=!0,this},dist:function(r){return E.a.dist(this.array,r.array)},distance:function(r){return E.a.distance(this.array,r.array)},div:function(r){return E.a.div(this.array,this.array,r.array),this._dirty=!0,this},divide:function(r){return E.a.divide(this.array,this.array,r.array),this._dirty=!0,this},dot:function(r){return E.a.dot(this.array,r.array)},len:function(){return E.a.len(this.array)},length:function(){return E.a.length(this.array)},lerp:function(r,e,n){return E.a.lerp(this.array,r.array,e.array,n),this._dirty=!0,this},min:function(r){return E.a.min(this.array,this.array,r.array),this._dirty=!0,this},max:function(r){return E.a.max(this.array,this.array,r.array),this._dirty=!0,this},mul:function(r){return E.a.mul(this.array,this.array,r.array),this._dirty=!0,this},multiply:function(r){return E.a.multiply(this.array,this.array,r.array),this._dirty=!0,this},negate:function(){return E.a.negate(this.array,this.array),this._dirty=!0,this},normalize:function(){return E.a.normalize(this.array,this.array),this._dirty=!0,this},random:function(r){return E.a.random(this.array,r),this._dirty=!0,this},scale:function(r){return E.a.scale(this.array,this.array,r),this._dirty=!0,this},scaleAndAdd:function(r,e){return E.a.scaleAndAdd(this.array,this.array,r.array,e),this._dirty=!0,this},sqrDist:function(r){return E.a.sqrDist(this.array,r.array)},squaredDistance:function(r){return E.a.squaredDistance(this.array,r.array)},sqrLen:function(){return E.a.sqrLen(this.array)},squaredLength:function(){return E.a.squaredLength(this.array)},sub:function(r){return E.a.sub(this.array,this.array,r.array),this._dirty=!0,this},subtract:function(r){return E.a.subtract(this.array,this.array,r.array),this._dirty=!0,this},transformMat3:function(r){return E.a.transformMat3(this.array,this.array,r.array),this._dirty=!0,this},transformMat4:function(r){return E.a.transformMat4(this.array,this.array,r.array),this._dirty=!0,this},transformQuat:function(r){return E.a.transformQuat(this.array,this.array,r.array),this._dirty=!0,this},applyProjection:function(r){var e=this.array;if(r=r.array,r[15]===0){var n=-1/e[2];e[0]=r[0]*e[0]*n,e[1]=r[5]*e[1]*n,e[2]=(r[10]*e[2]+r[14])*n}else e[0]=r[0]*e[0]+r[12],e[1]=r[5]*e[1]+r[13],e[2]=r[10]*e[2]+r[14];return this._dirty=!0,this},eulerFromQuat:function(r,e){c.eulerFromQuat(this,r,e)},eulerFromMat3:function(r,e){c.eulerFromMat3(this,r,e)},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};var t=Object.defineProperty;if(t){var a=c.prototype;t(a,"x",{get:function(){return this.array[0]},set:function(r){this.array[0]=r,this._dirty=!0}}),t(a,"y",{get:function(){return this.array[1]},set:function(r){this.array[1]=r,this._dirty=!0}}),t(a,"z",{get:function(){return this.array[2]},set:function(r){this.array[2]=r,this._dirty=!0}})}c.add=function(r,e,n){return E.a.add(r.array,e.array,n.array),r._dirty=!0,r},c.set=function(r,e,n,l){E.a.set(r.array,e,n,l),r._dirty=!0},c.copy=function(r,e){return E.a.copy(r.array,e.array),r._dirty=!0,r},c.cross=function(r,e,n){return E.a.cross(r.array,e.array,n.array),r._dirty=!0,r},c.dist=function(r,e){return E.a.distance(r.array,e.array)},c.distance=c.dist,c.div=function(r,e,n){return E.a.divide(r.array,e.array,n.array),r._dirty=!0,r},c.divide=c.div,c.dot=function(r,e){return E.a.dot(r.array,e.array)},c.len=function(r){return E.a.length(r.array)},c.lerp=function(r,e,n,l){return E.a.lerp(r.array,e.array,n.array,l),r._dirty=!0,r},c.min=function(r,e,n){return E.a.min(r.array,e.array,n.array),r._dirty=!0,r},c.max=function(r,e,n){return E.a.max(r.array,e.array,n.array),r._dirty=!0,r},c.mul=function(r,e,n){return E.a.multiply(r.array,e.array,n.array),r._dirty=!0,r},c.multiply=c.mul,c.negate=function(r,e){return E.a.negate(r.array,e.array),r._dirty=!0,r},c.normalize=function(r,e){return E.a.normalize(r.array,e.array),r._dirty=!0,r},c.random=function(r,e){return E.a.random(r.array,e),r._dirty=!0,r},c.scale=function(r,e,n){return E.a.scale(r.array,e.array,n),r._dirty=!0,r},c.scaleAndAdd=function(r,e,n,l){return E.a.scaleAndAdd(r.array,e.array,n.array,l),r._dirty=!0,r},c.sqrDist=function(r,e){return E.a.sqrDist(r.array,e.array)},c.squaredDistance=c.sqrDist,c.sqrLen=function(r){return E.a.sqrLen(r.array)},c.squaredLength=c.sqrLen,c.sub=function(r,e,n){return E.a.subtract(r.array,e.array,n.array),r._dirty=!0,r},c.subtract=c.sub,c.transformMat3=function(r,e,n){return E.a.transformMat3(r.array,e.array,n.array),r._dirty=!0,r},c.transformMat4=function(r,e,n){return E.a.transformMat4(r.array,e.array,n.array),r._dirty=!0,r},c.transformQuat=function(r,e,n){return E.a.transformQuat(r.array,e.array,n.array),r._dirty=!0,r};function o(r,e,n){return r<e?e:r>n?n:r}var i=Math.atan2,s=Math.asin,h=Math.abs;c.eulerFromQuat=function(r,e,n){r._dirty=!0,e=e.array;var l=r.array,u=e[0],_=e[1],f=e[2],d=e[3],v=u*u,m=_*_,p=f*f,y=d*d,n=(n||"XYZ").toUpperCase();switch(n){case"XYZ":l[0]=i(2*(u*d-_*f),y-v-m+p),l[1]=s(o(2*(u*f+_*d),-1,1)),l[2]=i(2*(f*d-u*_),y+v-m-p);break;case"YXZ":l[0]=s(o(2*(u*d-_*f),-1,1)),l[1]=i(2*(u*f+_*d),y-v-m+p),l[2]=i(2*(u*_+f*d),y-v+m-p);break;case"ZXY":l[0]=s(o(2*(u*d+_*f),-1,1)),l[1]=i(2*(_*d-f*u),y-v-m+p),l[2]=i(2*(f*d-u*_),y-v+m-p);break;case"ZYX":l[0]=i(2*(u*d+f*_),y-v-m+p),l[1]=s(o(2*(_*d-u*f),-1,1)),l[2]=i(2*(u*_+f*d),y+v-m-p);break;case"YZX":l[0]=i(2*(u*d-f*_),y-v+m-p),l[1]=i(2*(_*d-u*f),y+v-m-p),l[2]=s(o(2*(u*_+f*d),-1,1));break;case"XZY":l[0]=i(2*(u*d+_*f),y-v+m-p),l[1]=i(2*(u*f+_*d),y+v-m-p),l[2]=s(o(2*(f*d-u*_),-1,1));break;default:console.warn("Unkown order: "+n)}return r},c.eulerFromMat3=function(r,e,n){var l=e.array,u=l[0],_=l[3],f=l[6],d=l[1],v=l[4],m=l[7],p=l[2],y=l[5],x=l[8],M=r.array,n=(n||"XYZ").toUpperCase();switch(n){case"XYZ":M[1]=s(o(f,-1,1)),h(f)<.99999?(M[0]=i(-m,x),M[2]=i(-_,u)):(M[0]=i(y,v),M[2]=0);break;case"YXZ":M[0]=s(-o(m,-1,1)),h(m)<.99999?(M[1]=i(f,x),M[2]=i(d,v)):(M[1]=i(-p,u),M[2]=0);break;case"ZXY":M[0]=s(o(y,-1,1)),h(y)<.99999?(M[1]=i(-p,x),M[2]=i(-_,v)):(M[1]=0,M[2]=i(d,u));break;case"ZYX":M[1]=s(-o(p,-1,1)),h(p)<.99999?(M[0]=i(y,x),M[2]=i(d,u)):(M[0]=0,M[2]=i(-_,v));break;case"YZX":M[2]=s(o(d,-1,1)),h(d)<.99999?(M[0]=i(-m,v),M[1]=i(-p,u)):(M[0]=0,M[1]=i(f,x));break;case"XZY":M[2]=s(-o(_,-1,1)),h(_)<.99999?(M[0]=i(y,v),M[1]=i(f,u)):(M[0]=i(-m,x),M[1]=0);break;default:console.warn("Unkown order: "+n)}return r._dirty=!0,r},Object.defineProperties(c,{POSITIVE_X:{get:function(){return new c(1,0,0)}},NEGATIVE_X:{get:function(){return new c(-1,0,0)}},POSITIVE_Y:{get:function(){return new c(0,1,0)}},NEGATIVE_Y:{get:function(){return new c(0,-1,0)}},POSITIVE_Z:{get:function(){return new c(0,0,1)}},NEGATIVE_Z:{get:function(){return new c(0,0,-1)}},UP:{get:function(){return new c(0,1,0)}},ZERO:{get:function(){return new c}}}),R.a=c},function(F,R,g){var E=g(8),c=g(11),t=g(57),a=E.a.extend({width:512,height:512,type:c.a.UNSIGNED_BYTE,format:c.a.RGBA,wrapS:c.a.REPEAT,wrapT:c.a.REPEAT,minFilter:c.a.LINEAR_MIPMAP_LINEAR,magFilter:c.a.LINEAR,useMipmap:!0,anisotropic:1,flipY:!0,sRGB:!0,unpackAlignment:4,premultiplyAlpha:!1,dynamic:!1,NPOT:!1,__used:0},function(){this._cache=new t.a},{getWebGLTexture:function(o){var i=o.gl,s=this._cache;return s.use(o.__uid__),s.miss("webgl_texture")&&s.put("webgl_texture",i.createTexture()),this.dynamic?this.update(o):s.isDirty()&&(this.update(o),s.fresh()),s.get("webgl_texture")},bind:function(){},unbind:function(){},dirty:function(){this._cache&&this._cache.dirtyAll()},update:function(o){},updateCommon:function(o){var i=o.gl;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,this.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,this.unpackAlignment),this.format===c.a.DEPTH_COMPONENT&&(this.useMipmap=!1);var s=o.getGLExtension("EXT_sRGB");this.format===a.SRGB&&!s&&(this.format=a.RGB),this.format===a.SRGB_ALPHA&&!s&&(this.format=a.RGBA),this.NPOT=!this.isPowerOfTwo()},getAvailableWrapS:function(){return this.NPOT?c.a.CLAMP_TO_EDGE:this.wrapS},getAvailableWrapT:function(){return this.NPOT?c.a.CLAMP_TO_EDGE:this.wrapT},getAvailableMinFilter:function(){var o=this.minFilter;return this.NPOT||!this.useMipmap?o===c.a.NEAREST_MIPMAP_NEAREST||o===c.a.NEAREST_MIPMAP_LINEAR?c.a.NEAREST:o===c.a.LINEAR_MIPMAP_LINEAR||o===c.a.LINEAR_MIPMAP_NEAREST?c.a.LINEAR:o:o},getAvailableMagFilter:function(){return this.magFilter},nextHighestPowerOfTwo:function(o){--o;for(var i=1;i<32;i<<=1)o=o|o>>i;return o+1},dispose:function(o){var i=this._cache;i.use(o.__uid__);var s=i.get("webgl_texture");s&&o.gl.deleteTexture(s),i.deleteContext(o.__uid__)},isRenderable:function(){},isPowerOfTwo:function(){}});Object.defineProperty(a.prototype,"width",{get:function(){return this._width},set:function(o){this._width=o}}),Object.defineProperty(a.prototype,"height",{get:function(){return this._height},set:function(o){this._height=o}}),a.BYTE=c.a.BYTE,a.UNSIGNED_BYTE=c.a.UNSIGNED_BYTE,a.SHORT=c.a.SHORT,a.UNSIGNED_SHORT=c.a.UNSIGNED_SHORT,a.INT=c.a.INT,a.UNSIGNED_INT=c.a.UNSIGNED_INT,a.FLOAT=c.a.FLOAT,a.HALF_FLOAT=36193,a.UNSIGNED_INT_24_8_WEBGL=34042,a.DEPTH_COMPONENT=c.a.DEPTH_COMPONENT,a.DEPTH_STENCIL=c.a.DEPTH_STENCIL,a.ALPHA=c.a.ALPHA,a.RGB=c.a.RGB,a.RGBA=c.a.RGBA,a.LUMINANCE=c.a.LUMINANCE,a.LUMINANCE_ALPHA=c.a.LUMINANCE_ALPHA,a.SRGB=35904,a.SRGB_ALPHA=35906,a.COMPRESSED_RGB_S3TC_DXT1_EXT=33776,a.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777,a.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778,a.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779,a.COMPRESSED_RGB_ETC1_WEBGL=36196,a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840,a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842,a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841,a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843,a.COMPRESSED_RGB_ATC_WEBGL=35986,a.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987,a.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798,a.NEAREST=c.a.NEAREST,a.LINEAR=c.a.LINEAR,a.NEAREST_MIPMAP_NEAREST=c.a.NEAREST_MIPMAP_NEAREST,a.LINEAR_MIPMAP_NEAREST=c.a.LINEAR_MIPMAP_NEAREST,a.NEAREST_MIPMAP_LINEAR=c.a.NEAREST_MIPMAP_LINEAR,a.LINEAR_MIPMAP_LINEAR=c.a.LINEAR_MIPMAP_LINEAR,a.REPEAT=c.a.REPEAT,a.CLAMP_TO_EDGE=c.a.CLAMP_TO_EDGE,a.MIRRORED_REPEAT=c.a.MIRRORED_REPEAT,R.a=a},function(F,R,g){var E=g(4),c=g(11),t=g(13),a=g(72),o=a.a.isPowerOfTwo;function i(r){return Math.pow(2,Math.round(Math.log(r)/Math.LN2))}function s(r,e){var n=i(r.width),l=i(r.height);e=e||document.createElement("canvas"),e.width=n,e.height=l;var u=e.getContext("2d");return u.drawImage(r.image,0,0,n,l),e}var h=E.a.extend(function(){return{image:null,pixels:null,mipmaps:[],convertToPOT:!1}},{textureType:"texture2D",update:function(r){var e=r.gl;e.bindTexture(e.TEXTURE_2D,this._cache.get("webgl_texture")),this.updateCommon(r);var n=this.format,l=this.type,u=!!(this.convertToPOT&&!this.mipmaps.length&&this.image&&(this.wrapS===E.a.REPEAT||this.wrapT===E.a.REPEAT)&&this.NPOT);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,u?this.wrapS:this.getAvailableWrapS()),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,u?this.wrapT:this.getAvailableWrapT()),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,u?this.magFilter:this.getAvailableMagFilter()),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,u?this.minFilter:this.getAvailableMinFilter());var _=r.getGLExtension("EXT_texture_filter_anisotropic");if(_&&this.anisotropic>1&&e.texParameterf(e.TEXTURE_2D,_.TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropic),l===36193){var f=r.getGLExtension("OES_texture_half_float");f||(l=c.a.FLOAT)}if(this.mipmaps.length)for(var d=this.width,v=this.height,m=0;m<this.mipmaps.length;m++){var p=this.mipmaps[m];this._updateTextureData(e,p,m,d,v,n,l,!1),d/=2,v/=2}else this._updateTextureData(e,this,0,this.width,this.height,n,l,u),this.useMipmap&&(!this.NPOT||u)&&e.generateMipmap(e.TEXTURE_2D);e.bindTexture(e.TEXTURE_2D,null)},_updateTextureData:function(r,e,n,l,u,_,f,d){if(e.image){var v=e.image;d&&(this._potCanvas=s(this,this._potCanvas),v=this._potCanvas),r.texImage2D(r.TEXTURE_2D,n,_,_,f,v)}else _<=E.a.COMPRESSED_RGBA_S3TC_DXT5_EXT&&_>=E.a.COMPRESSED_RGB_S3TC_DXT1_EXT||_===E.a.COMPRESSED_RGB_ETC1_WEBGL||_>=E.a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG&&_<=E.a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG||_===E.a.COMPRESSED_RGB_ATC_WEBGL&&_===E.a.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL&&_===E.a.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL?r.compressedTexImage2D(r.TEXTURE_2D,n,_,l,u,0,e.pixels):r.texImage2D(r.TEXTURE_2D,n,_,l,u,0,_,f,e.pixels)},generateMipmap:function(r){var e=r.gl;this.useMipmap&&!this.NPOT&&(e.bindTexture(e.TEXTURE_2D,this._cache.get("webgl_texture")),e.generateMipmap(e.TEXTURE_2D))},isPowerOfTwo:function(){return o(this.width)&&o(this.height)},isRenderable:function(){return this.image?this.image.width>0&&this.image.height>0:!!(this.width&&this.height)},bind:function(r){r.gl.bindTexture(r.gl.TEXTURE_2D,this.getWebGLTexture(r))},unbind:function(r){r.gl.bindTexture(r.gl.TEXTURE_2D,null)},load:function(r,e){var n=t.a.createImage();e&&(n.crossOrigin=e);var l=this;return n.onload=function(){l.dirty(),l.trigger("success",l)},n.onerror=function(){l.trigger("error",l)},n.src=r,this.image=n,this}});Object.defineProperty(h.prototype,"width",{get:function(){return this.image?this.image.width:this._width},set:function(r){this.image?console.warn("Texture from image can't set width"):(this._width!==r&&this.dirty(),this._width=r)}}),Object.defineProperty(h.prototype,"height",{get:function(){return this.image?this.image.height:this._height},set:function(r){this.image?console.warn("Texture from image can't set height"):(this._height!==r&&this.dirty(),this._height=r)}}),R.a=h},function(F,R,g){var E=g(160);R.a=E.a},function(F,R,g){var E=g(21),c=g(12),t=g(55),a=g(34),o=g(3),i=function(){this._axisX=new o.a,this._axisY=new o.a,this._axisZ=new o.a,this.array=E.a.create(),this._dirty=!0};i.prototype={constructor:i,setArray:function(r){for(var e=0;e<this.array.length;e++)this.array[e]=r[e];return this._dirty=!0,this},adjoint:function(){return E.a.adjoint(this.array,this.array),this._dirty=!0,this},clone:function(){return new i().copy(this)},copy:function(r){return E.a.copy(this.array,r.array),this._dirty=!0,this},determinant:function(){return E.a.determinant(this.array)},fromQuat:function(r){return E.a.fromQuat(this.array,r.array),this._dirty=!0,this},fromRotationTranslation:function(r,e){return E.a.fromRotationTranslation(this.array,r.array,e.array),this._dirty=!0,this},fromMat2d:function(r){return i.fromMat2d(this,r),this},frustum:function(r,e,n,l,u,_){return E.a.frustum(this.array,r,e,n,l,u,_),this._dirty=!0,this},identity:function(){return E.a.identity(this.array),this._dirty=!0,this},invert:function(){return E.a.invert(this.array,this.array),this._dirty=!0,this},lookAt:function(r,e,n){return E.a.lookAt(this.array,r.array,e.array,n.array),this._dirty=!0,this},mul:function(r){return E.a.mul(this.array,this.array,r.array),this._dirty=!0,this},mulLeft:function(r){return E.a.mul(this.array,r.array,this.array),this._dirty=!0,this},multiply:function(r){return E.a.multiply(this.array,this.array,r.array),this._dirty=!0,this},multiplyLeft:function(r){return E.a.multiply(this.array,r.array,this.array),this._dirty=!0,this},ortho:function(r,e,n,l,u,_){return E.a.ortho(this.array,r,e,n,l,u,_),this._dirty=!0,this},perspective:function(r,e,n,l){return E.a.perspective(this.array,r,e,n,l),this._dirty=!0,this},rotate:function(r,e){return E.a.rotate(this.array,this.array,r,e.array),this._dirty=!0,this},rotateX:function(r){return E.a.rotateX(this.array,this.array,r),this._dirty=!0,this},rotateY:function(r){return E.a.rotateY(this.array,this.array,r),this._dirty=!0,this},rotateZ:function(r){return E.a.rotateZ(this.array,this.array,r),this._dirty=!0,this},scale:function(r){return E.a.scale(this.array,this.array,r.array),this._dirty=!0,this},translate:function(r){return E.a.translate(this.array,this.array,r.array),this._dirty=!0,this},transpose:function(){return E.a.transpose(this.array,this.array),this._dirty=!0,this},decomposeMatrix:function(){var r=c.a.create(),e=c.a.create(),n=c.a.create(),l=a.a.create();return function(u,_,f){var d=this.array;c.a.set(r,d[0],d[1],d[2]),c.a.set(e,d[4],d[5],d[6]),c.a.set(n,d[8],d[9],d[10]);var v=c.a.length(r),m=c.a.length(e),p=c.a.length(n),y=this.determinant();y<0&&(v=-v),u&&u.set(v,m,p),f.set(d[12],d[13],d[14]),a.a.fromMat4(l,d),l[0]/=v,l[1]/=v,l[2]/=v,l[3]/=m,l[4]/=m,l[5]/=m,l[6]/=p,l[7]/=p,l[8]/=p,t.a.fromMat3(_.array,l),t.a.normalize(_.array,_.array),_._dirty=!0,f._dirty=!0}}(),toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};var s=Object.defineProperty;if(s){var h=i.prototype;s(h,"z",{get:function(){var r=this.array;return this._axisZ.set(r[8],r[9],r[10]),this._axisZ},set:function(r){var e=this.array;r=r.array,e[8]=r[0],e[9]=r[1],e[10]=r[2],this._dirty=!0}}),s(h,"y",{get:function(){var r=this.array;return this._axisY.set(r[4],r[5],r[6]),this._axisY},set:function(r){var e=this.array;r=r.array,e[4]=r[0],e[5]=r[1],e[6]=r[2],this._dirty=!0}}),s(h,"x",{get:function(){var r=this.array;return this._axisX.set(r[0],r[1],r[2]),this._axisX},set:function(r){var e=this.array;r=r.array,e[0]=r[0],e[1]=r[1],e[2]=r[2],this._dirty=!0}})}i.adjoint=function(r,e){return E.a.adjoint(r.array,e.array),r._dirty=!0,r},i.copy=function(r,e){return E.a.copy(r.array,e.array),r._dirty=!0,r},i.determinant=function(r){return E.a.determinant(r.array)},i.identity=function(r){return E.a.identity(r.array),r._dirty=!0,r},i.ortho=function(r,e,n,l,u,_,f){return E.a.ortho(r.array,e,n,l,u,_,f),r._dirty=!0,r},i.perspective=function(r,e,n,l,u){return E.a.perspective(r.array,e,n,l,u),r._dirty=!0,r},i.lookAt=function(r,e,n,l){return E.a.lookAt(r.array,e.array,n.array,l.array),r._dirty=!0,r},i.invert=function(r,e){return E.a.invert(r.array,e.array),r._dirty=!0,r},i.mul=function(r,e,n){return E.a.mul(r.array,e.array,n.array),r._dirty=!0,r},i.multiply=i.mul,i.fromQuat=function(r,e){return E.a.fromQuat(r.array,e.array),r._dirty=!0,r},i.fromRotationTranslation=function(r,e,n){return E.a.fromRotationTranslation(r.array,e.array,n.array),r._dirty=!0,r},i.fromMat2d=function(r,e){r._dirty=!0;var e=e.array,r=r.array;return r[0]=e[0],r[4]=e[2],r[12]=e[4],r[1]=e[1],r[5]=e[3],r[13]=e[5],r},i.rotate=function(r,e,n,l){return E.a.rotate(r.array,e.array,n,l.array),r._dirty=!0,r},i.rotateX=function(r,e,n){return E.a.rotateX(r.array,e.array,n),r._dirty=!0,r},i.rotateY=function(r,e,n){return E.a.rotateY(r.array,e.array,n),r._dirty=!0,r},i.rotateZ=function(r,e,n){return E.a.rotateZ(r.array,e.array,n),r._dirty=!0,r},i.scale=function(r,e,n){return E.a.scale(r.array,e.array,n.array),r._dirty=!0,r},i.transpose=function(r,e){return E.a.transpose(r.array,e.array),r._dirty=!0,r},i.translate=function(r,e,n){return E.a.translate(r.array,e.array,n.array),r._dirty=!0,r},R.a=i},function(F,R,g){var E=g(109),c=g(53),t=g(23),a=function(){this.__uid__=t.a.genGUID()};a.__initializers__=[function(o){t.a.extend(this,o)}],t.a.extend(a,E.a),t.a.extend(a.prototype,c.a),R.a=a},function(F,R,g){var E=g(23),c=g(13),t=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g,a=/attribute\s+(float|int|vec2|vec3|vec4)\s+([\s\S]*?);/g,o=/#define\s+(\w+)?(\s+[\d-.]+)?\s*;?\s*\n/g,i={bool:"1i",int:"1i",sampler2D:"t",samplerCube:"t",float:"1f",vec2:"2f",vec3:"3f",vec4:"4f",ivec2:"2i",ivec3:"3i",ivec4:"4i",mat2:"m2",mat3:"m3",mat4:"m4"};function s(M){for(var P=[],T=0;T<M;T++)P[T]=0;return P}var h={bool:function(){return!0},int:function(){return 0},float:function(){return 0},sampler2D:function(){return null},samplerCube:function(){return null},vec2:function(){return s(2)},vec3:function(){return s(3)},vec4:function(){return s(4)},ivec2:function(){return s(2)},ivec3:function(){return s(3)},ivec4:function(){return s(4)},mat2:function(){return s(4)},mat3:function(){return s(9)},mat4:function(){return s(16)},array:function(){return[]}},r=["POSITION","NORMAL","BINORMAL","TANGENT","TEXCOORD","TEXCOORD_0","TEXCOORD_1","COLOR","JOINT","WEIGHT"],e=["SKIN_MATRIX","VIEWPORT_SIZE","VIEWPORT","DEVICEPIXELRATIO","WINDOW_SIZE","NEAR","FAR","TIME","LOG_DEPTH_BUFFER_FC"],n=["WORLD","VIEW","PROJECTION","WORLDVIEW","VIEWPROJECTION","WORLDVIEWPROJECTION","WORLDINVERSE","VIEWINVERSE","PROJECTIONINVERSE","WORLDVIEWINVERSE","VIEWPROJECTIONINVERSE","WORLDVIEWPROJECTIONINVERSE","WORLDTRANSPOSE","VIEWTRANSPOSE","PROJECTIONTRANSPOSE","WORLDVIEWTRANSPOSE","VIEWPROJECTIONTRANSPOSE","WORLDVIEWPROJECTIONTRANSPOSE","WORLDINVERSETRANSPOSE","VIEWINVERSETRANSPOSE","PROJECTIONINVERSETRANSPOSE","WORLDVIEWINVERSETRANSPOSE","VIEWPROJECTIONINVERSETRANSPOSE","WORLDVIEWPROJECTIONINVERSETRANSPOSE"],l={vec4:4,vec3:3,vec2:2,float:1},u={},_={};function f(M,P){var T="vertex:"+M+"fragment:"+P;if(u[T])return u[T];var O=E.a.genGUID();return u[T]=O,_[O]={vertex:M,fragment:P},O}function d(M){return M.replace(/[ \t]*\/\/.*\n/g,"").replace(/[ \t]*\/\*[\s\S]*?\*\//g,"")}function v(){console.error("Wrong uniform/attributes syntax")}function m(M,P){for(var T=/[,=\(\):]/,O=P.replace(/:\s*\[\s*(.*)\s*\]/g,"="+M+"($1)").replace(/\s+/g,"").split(/(?=[,=\(\):])/g),D=[],A=0;A<O.length;A++)O[A].match(T)?D.push(O[A].charAt(0),O[A].slice(1)):D.push(O[A]);O=D;var C=0,S=1,L=2,I=3,w=4,b=5,B=C,U={},W=null,z;G(O[0]);function G(Q){Q||v();var j=Q.match(/\[(.*?)\]/);z=Q.replace(/\[(.*?)\]/,""),U[z]={},j&&(U[z].isArray=!0,U[z].arraySize=j[1])}for(var A=1;A<O.length;A++){var H=O[A];if(!!H){if(H==="="){if(B!==C&&B!==I){v();break}B=S;continue}else if(H===":"){B=w;continue}else if(H===","){if(B===L){if(!(W instanceof Array)){v();break}W.push(+O[++A])}else B=b;continue}else if(H===")"){U[z].value=new c.a.Float32Array(W),W=null,B=b;continue}else if(H==="("){if(B!==L){v();break}if(!(W instanceof Array)){v();break}W.push(+O[++A]);continue}else if(H.indexOf("vec")>=0){if(B!==S&&B!==w){v();break}B=L,W=[];continue}else if(B===S){M==="bool"?U[z].value=H==="true":U[z].value=parseFloat(H),W=null;continue}else if(B===w){var X=H;r.indexOf(X)>=0||e.indexOf(X)>=0||n.indexOf(X)>=0?U[z].semantic=X:X==="ignore"||X==="unconfigurable"?U[z].ignore=!0:M==="bool"?U[z].value=X==="true":U[z].value=parseFloat(X);continue}G(H),B=C}}return U}function p(M,P){typeof M=="object"&&(P=M.fragment,M=M.vertex),M=d(M),P=d(P),this._shaderID=f(M,P),this._vertexCode=p.parseImport(M),this._fragmentCode=p.parseImport(P),this.attributeSemantics={},this.matrixSemantics={},this.uniformSemantics={},this.matrixSemanticKeys=[],this.uniformTemplates={},this.attributes={},this.textures={},this.vertexDefines={},this.fragmentDefines={},this._parseAttributes(),this._parseUniforms(),this._parseDefines()}p.prototype={constructor:p,createUniforms:function(){var M={};for(var P in this.uniformTemplates){var T=this.uniformTemplates[P];M[P]={type:T.type,value:T.value()}}return M},_parseImport:function(){this._vertexCode=p.parseImport(this.vertex),this._fragmentCode=p.parseImport(this.fragment)},_addSemanticUniform:function(M,P,T){if(r.indexOf(T)>=0)this.attributeSemantics[T]={symbol:M,type:P};else if(n.indexOf(T)>=0){var O=!1,D=T;T.match(/TRANSPOSE$/)&&(O=!0,D=T.slice(0,-9)),this.matrixSemantics[T]={symbol:M,type:P,isTranspose:O,semanticNoTranspose:D}}else e.indexOf(T)>=0&&(this.uniformSemantics[T]={symbol:M,type:P})},_addMaterialUniform:function(M,P,T,O,D,A){A[M]={type:T,value:D?h.array:O||h[P],semantic:null}},_parseUniforms:function(){var M={},P=this,T="vertex";this._uniformList=[],this._vertexCode=this._vertexCode.replace(t,D),T="fragment",this._fragmentCode=this._fragmentCode.replace(t,D),P.matrixSemanticKeys=Object.keys(this.matrixSemantics);function O(A){return A!=null?function(){return A}:null}function D(A,C,S){var L=m(C,S),I=[];for(var w in L){var b=L[w],B=b.semantic,U=w,W=i[C],z=O(L[w].value);L[w].isArray&&(U+="["+L[w].arraySize+"]",W+="v"),I.push(U),P._uniformList.push(w),b.ignore||((C==="sampler2D"||C==="samplerCube")&&(P.textures[w]={shaderType:T,type:C}),B?P._addSemanticUniform(w,W,B):P._addMaterialUniform(w,C,W,z,L[w].isArray,M))}return I.length>0?"uniform "+C+" "+I.join(",")+`;
`:""}this.uniformTemplates=M},_parseAttributes:function(){var M={},P=this;this._vertexCode=this._vertexCode.replace(a,T);function T(O,D,A){var C=m(D,A),S=l[D]||1,L=[];for(var I in C){var w=C[I].semantic;if(M[I]={type:"float",size:S,semantic:w||null},w){if(r.indexOf(w)<0)throw new Error('Unkown semantic "'+w+'"');P.attributeSemantics[w]={symbol:I,type:D}}L.push(I)}return"attribute "+D+" "+L.join(",")+`;
`}this.attributes=M},_parseDefines:function(){var M=this,P="vertex";this._vertexCode=this._vertexCode.replace(o,T),P="fragment",this._fragmentCode=this._fragmentCode.replace(o,T);function T(O,D,A){var C=P==="vertex"?M.vertexDefines:M.fragmentDefines;return C[D]||(A==="false"?C[D]=!1:A==="true"?C[D]=!0:C[D]=A?isNaN(parseFloat(A))?A.trim():parseFloat(A):null),""}},clone:function(){var M=_[this._shaderID],P=new p(M.vertex,M.fragment);return P}},Object.defineProperty&&(Object.defineProperty(p.prototype,"shaderID",{get:function(){return this._shaderID}}),Object.defineProperty(p.prototype,"vertex",{get:function(){return this._vertexCode}}),Object.defineProperty(p.prototype,"fragment",{get:function(){return this._fragmentCode}}),Object.defineProperty(p.prototype,"uniforms",{get:function(){return this._uniformList}}));var y=/(@import)\s*([0-9a-zA-Z_\-\.]*)/g;p.parseImport=function(M){return M=M.replace(y,function(P,T,O){var P=p.source(O);return P?p.parseImport(P):(console.error('Shader chunk "'+O+'" not existed in library'),"")}),M};var x=/(@export)\s*([0-9a-zA-Z_\-\.]*)\s*\n([\s\S]*?)@end/g;p.import=function(M){M.replace(x,function(P,T,O,D){var D=D.replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+\x24)/g,"");if(D){for(var A=O.split("."),C=p.codes,S=0,L;S<A.length-1;)L=A[S++],C[L]||(C[L]={}),C=C[L];L=A[S],C[L]=D}return D})},p.codes={},p.source=function(M){for(var P=M.split("."),T=p.codes,O=0;T&&O<P.length;){var D=P[O++];T=T[D]}return typeof T!="string"?(console.error('Shader "'+M+'" not existed in library'),""):T},R.a=p},function(F,R,g){var E=g(8),c=g(4);g(27);var t=g(11),a=g(57),o="framebuffer",i="renderbuffer",s=i+"_width",h=i+"_height",r=i+"_attached",e="depthtexture_attached",n=t.a.FRAMEBUFFER,l=t.a.RENDERBUFFER,u=t.a.DEPTH_ATTACHMENT,_=t.a.COLOR_ATTACHMENT0,f=E.a.extend({depthBuffer:!0,viewport:null,_width:0,_height:0,_textures:null,_boundRenderer:null},function(){this._cache=new a.a,this._textures={}},{getTextureWidth:function(){return this._width},getTextureHeight:function(){return this._height},bind:function(d){if(d.__currentFrameBuffer){if(d.__currentFrameBuffer===this)return;console.warn("Renderer already bound with another framebuffer. Unbind it first")}d.__currentFrameBuffer=this;var v=d.gl;v.bindFramebuffer(n,this._getFrameBufferGL(d)),this._boundRenderer=d;var m=this._cache;m.put("viewport",d.viewport);var p=!1,y,x;for(var M in this._textures){p=!0;var P=this._textures[M];P&&(y=P.texture.width,x=P.texture.height,this._doAttach(d,P.texture,M,P.target))}this._width=y,this._height=x,!p&&this.depthBuffer&&console.error("Must attach texture before bind, or renderbuffer may have incorrect width and height."),this.viewport?d.setViewport(this.viewport):d.setViewport(0,0,y,x,1);var T=m.get("attached_textures");if(T){for(var M in T)if(!this._textures[M]){var O=T[M];this._doDetach(v,M,O)}}if(!m.get(e)&&this.depthBuffer){m.miss(i)&&m.put(i,v.createRenderbuffer());var D=m.get(i);(y!==m.get(s)||x!==m.get(h))&&(v.bindRenderbuffer(l,D),v.renderbufferStorage(l,v.DEPTH_COMPONENT16,y,x),m.put(s,y),m.put(h,x),v.bindRenderbuffer(l,null)),m.get(r)||(v.framebufferRenderbuffer(n,u,l,D),m.put(r,!0))}},unbind:function(d){d.__currentFrameBuffer=null;var v=d.gl;v.bindFramebuffer(n,null),this._boundRenderer=null,this._cache.use(d.__uid__);var m=this._cache.get("viewport");m&&d.setViewport(m),this.updateMipmap(d)},updateMipmap:function(d){var v=d.gl;for(var m in this._textures){var p=this._textures[m];if(p){var y=p.texture;if(!y.NPOT&&y.useMipmap&&y.minFilter===c.a.LINEAR_MIPMAP_LINEAR){var x=y.textureType==="textureCube"?t.a.TEXTURE_CUBE_MAP:t.a.TEXTURE_2D;v.bindTexture(x,y.getWebGLTexture(d)),v.generateMipmap(x),v.bindTexture(x,null)}}}},checkStatus:function(d){return d.checkFramebufferStatus(n)},_getFrameBufferGL:function(d){var v=this._cache;return v.use(d.__uid__),v.miss(o)&&v.put(o,d.gl.createFramebuffer()),v.get(o)},attach:function(d,v,m){if(!d.width)throw new Error("The texture attached to color buffer is not a valid.");v=v||_,m=m||t.a.TEXTURE_2D;var p=this._boundRenderer,y=p&&p.gl,x;if(y){var M=this._cache;M.use(p.__uid__),x=M.get("attached_textures")}var P=this._textures[v];if(!(P&&P.target===m&&P.texture===d&&x&&x[v]!=null)){var T=!0;p&&(T=this._doAttach(p,d,v,m),this.viewport||p.setViewport(0,0,d.width,d.height,1)),T&&(this._textures[v]=this._textures[v]||{},this._textures[v].texture=d,this._textures[v].target=m)}},_doAttach:function(d,v,m,p){var y=d.gl,x=v.getWebGLTexture(d),M=this._cache.get("attached_textures");if(M&&M[m]){var P=M[m];if(P.texture===v&&P.target===p)return}m=+m;var T=!0;if(m===u||m===t.a.DEPTH_STENCIL_ATTACHMENT){var O=d.getGLExtension("WEBGL_depth_texture");if(O||console.error("Depth texture is not supported by the browser"),v.format!==t.a.DEPTH_COMPONENT&&v.format!==t.a.DEPTH_STENCIL&&(console.error("The texture attached to depth buffer is not a valid."),T=!1),T){var D=this._cache.get(i);D&&(y.framebufferRenderbuffer(n,u,l,null),y.deleteRenderbuffer(D),this._cache.put(i,!1)),this._cache.put(r,!1),this._cache.put(e,!0)}}return y.framebufferTexture2D(n,m,p,x,0),M||(M={},this._cache.put("attached_textures",M)),M[m]=M[m]||{},M[m].texture=v,M[m].target=p,T},_doDetach:function(d,v,m){d.framebufferTexture2D(n,v,m,null,0);var p=this._cache.get("attached_textures");p&&p[v]&&(p[v]=null),(v===u||v===t.a.DEPTH_STENCIL_ATTACHMENT)&&this._cache.put(e,!1)},detach:function(d,v){if(this._textures[d]=null,this._boundRenderer){var m=this._cache;m.use(this._boundRenderer.__uid__),this._doDetach(this._boundRenderer.gl,d,v)}},dispose:function(d){var v=d.gl,m=this._cache;m.use(d.__uid__);var p=m.get(i);p&&v.deleteRenderbuffer(p);var y=m.get(o);y&&v.deleteFramebuffer(y),m.deleteContext(d.__uid__),this._textures={}}});f.DEPTH_ATTACHMENT=u,f.COLOR_ATTACHMENT0=_,f.STENCIL_ATTACHMENT=t.a.STENCIL_ATTACHMENT,f.DEPTH_STENCIL_ATTACHMENT=t.a.DEPTH_STENCIL_ATTACHMENT,R.a=f},function(F,R,g){R.a={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444}},function(F,R,g){var E=g(20),c={};c.create=function(){var t=new E.a(3);return t[0]=0,t[1]=0,t[2]=0,t},c.clone=function(t){var a=new E.a(3);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a},c.fromValues=function(t,a,o){var i=new E.a(3);return i[0]=t,i[1]=a,i[2]=o,i},c.copy=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t},c.set=function(t,a,o,i){return t[0]=a,t[1]=o,t[2]=i,t},c.add=function(t,a,o){return t[0]=a[0]+o[0],t[1]=a[1]+o[1],t[2]=a[2]+o[2],t},c.subtract=function(t,a,o){return t[0]=a[0]-o[0],t[1]=a[1]-o[1],t[2]=a[2]-o[2],t},c.sub=c.subtract,c.multiply=function(t,a,o){return t[0]=a[0]*o[0],t[1]=a[1]*o[1],t[2]=a[2]*o[2],t},c.mul=c.multiply,c.divide=function(t,a,o){return t[0]=a[0]/o[0],t[1]=a[1]/o[1],t[2]=a[2]/o[2],t},c.div=c.divide,c.min=function(t,a,o){return t[0]=Math.min(a[0],o[0]),t[1]=Math.min(a[1],o[1]),t[2]=Math.min(a[2],o[2]),t},c.max=function(t,a,o){return t[0]=Math.max(a[0],o[0]),t[1]=Math.max(a[1],o[1]),t[2]=Math.max(a[2],o[2]),t},c.scale=function(t,a,o){return t[0]=a[0]*o,t[1]=a[1]*o,t[2]=a[2]*o,t},c.scaleAndAdd=function(t,a,o,i){return t[0]=a[0]+o[0]*i,t[1]=a[1]+o[1]*i,t[2]=a[2]+o[2]*i,t},c.distance=function(t,a){var o=a[0]-t[0],i=a[1]-t[1],s=a[2]-t[2];return Math.sqrt(o*o+i*i+s*s)},c.dist=c.distance,c.squaredDistance=function(t,a){var o=a[0]-t[0],i=a[1]-t[1],s=a[2]-t[2];return o*o+i*i+s*s},c.sqrDist=c.squaredDistance,c.length=function(t){var a=t[0],o=t[1],i=t[2];return Math.sqrt(a*a+o*o+i*i)},c.len=c.length,c.squaredLength=function(t){var a=t[0],o=t[1],i=t[2];return a*a+o*o+i*i},c.sqrLen=c.squaredLength,c.negate=function(t,a){return t[0]=-a[0],t[1]=-a[1],t[2]=-a[2],t},c.inverse=function(t,a){return t[0]=1/a[0],t[1]=1/a[1],t[2]=1/a[2],t},c.normalize=function(t,a){var o=a[0],i=a[1],s=a[2],h=o*o+i*i+s*s;return h>0&&(h=1/Math.sqrt(h),t[0]=a[0]*h,t[1]=a[1]*h,t[2]=a[2]*h),t},c.dot=function(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]},c.cross=function(t,a,o){var i=a[0],s=a[1],h=a[2],r=o[0],e=o[1],n=o[2];return t[0]=s*n-h*e,t[1]=h*r-i*n,t[2]=i*e-s*r,t},c.lerp=function(t,a,o,i){var s=a[0],h=a[1],r=a[2];return t[0]=s+i*(o[0]-s),t[1]=h+i*(o[1]-h),t[2]=r+i*(o[2]-r),t},c.random=function(t,a){a=a||1;var o=Object(E.c)()*2*Math.PI,i=Object(E.c)()*2-1,s=Math.sqrt(1-i*i)*a;return t[0]=Math.cos(o)*s,t[1]=Math.sin(o)*s,t[2]=i*a,t},c.transformMat4=function(t,a,o){var i=a[0],s=a[1],h=a[2],r=o[3]*i+o[7]*s+o[11]*h+o[15];return r=r||1,t[0]=(o[0]*i+o[4]*s+o[8]*h+o[12])/r,t[1]=(o[1]*i+o[5]*s+o[9]*h+o[13])/r,t[2]=(o[2]*i+o[6]*s+o[10]*h+o[14])/r,t},c.transformMat3=function(t,a,o){var i=a[0],s=a[1],h=a[2];return t[0]=i*o[0]+s*o[3]+h*o[6],t[1]=i*o[1]+s*o[4]+h*o[7],t[2]=i*o[2]+s*o[5]+h*o[8],t},c.transformQuat=function(t,a,o){var i=a[0],s=a[1],h=a[2],r=o[0],e=o[1],n=o[2],l=o[3],u=l*i+e*h-n*s,_=l*s+n*i-r*h,f=l*h+r*s-e*i,d=-r*i-e*s-n*h;return t[0]=u*l+d*-r+_*-n-f*-e,t[1]=_*l+d*-e+f*-r-u*-n,t[2]=f*l+d*-n+u*-e-_*-r,t},c.rotateX=function(t,a,o,i){var s=[],h=[];return s[0]=a[0]-o[0],s[1]=a[1]-o[1],s[2]=a[2]-o[2],h[0]=s[0],h[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),h[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),t[0]=h[0]+o[0],t[1]=h[1]+o[1],t[2]=h[2]+o[2],t},c.rotateY=function(t,a,o,i){var s=[],h=[];return s[0]=a[0]-o[0],s[1]=a[1]-o[1],s[2]=a[2]-o[2],h[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),h[1]=s[1],h[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),t[0]=h[0]+o[0],t[1]=h[1]+o[1],t[2]=h[2]+o[2],t},c.rotateZ=function(t,a,o,i){var s=[],h=[];return s[0]=a[0]-o[0],s[1]=a[1]-o[1],s[2]=a[2]-o[2],h[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),h[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),h[2]=s[2],t[0]=h[0]+o[0],t[1]=h[1]+o[1],t[2]=h[2]+o[2],t},c.forEach=function(){var t=c.create();return function(a,o,i,s,h,r){var e,n;for(o||(o=3),i||(i=0),s?n=Math.min(s*o+i,a.length):n=a.length,e=i;e<n;e+=o)t[0]=a[e],t[1]=a[e+1],t[2]=a[e+2],h(t,t,r),a[e]=t[0],a[e+1]=t[1],a[e+2]=t[2];return a}}(),c.angle=function(t,a){var o=c.fromValues(t[0],t[1],t[2]),i=c.fromValues(a[0],a[1],a[2]);c.normalize(o,o),c.normalize(i,i);var s=c.dot(o,i);return s>1?0:Math.acos(s)},R.a=c},function(F,R,g){(function(E){var c=g(111),t,a={};a.supportWebGL=function(){if(t==null)try{var i=document.createElement("canvas"),s=i.getContext("webgl")||i.getContext("experimental-webgl");if(!s)throw new Error}catch(h){t=!1}return t},a.Int8Array=typeof Int8Array=="undefined"?Array:Int8Array,a.Uint8Array=typeof Uint8Array=="undefined"?Array:Uint8Array,a.Uint16Array=typeof Uint16Array=="undefined"?Array:Uint16Array,a.Uint32Array=typeof Uint32Array=="undefined"?Array:Uint32Array,a.Int16Array=typeof Int16Array=="undefined"?Array:Int16Array,a.Float32Array=typeof Float32Array=="undefined"?Array:Float32Array,a.Float64Array=typeof Float64Array=="undefined"?Array:Float64Array;var o={};typeof window!="undefined"?o=window:typeof E!="undefined"&&(o=E),a.requestAnimationFrame=o.requestAnimationFrame||o.msRequestAnimationFrame||o.mozRequestAnimationFrame||o.webkitRequestAnimationFrame||function(i){setTimeout(i,16)},a.createCanvas=function(){return document.createElement("canvas")},a.createImage=function(){return new o.Image},a.request={get:c.a.get},a.addEventListener=function(i,s,h,r){i.addEventListener(s,h,r)},a.removeEventListener=function(i,s,h){i.removeEventListener(s,h)},R.a=a}).call(R,g(67))},function(F,R,g){var E=g(13),c=g(12),t=g(21),a=g(18),o=g(117),i=c.a.create,s=c.a.add,h=c.a.set,r=o.a.Attribute,e=o.a.extend(function(){return{attributes:{position:new r("position","float",3,"POSITION"),texcoord0:new r("texcoord0","float",2,"TEXCOORD_0"),texcoord1:new r("texcoord1","float",2,"TEXCOORD_1"),normal:new r("normal","float",3,"NORMAL"),tangent:new r("tangent","float",4,"TANGENT"),color:new r("color","float",4,"COLOR"),weight:new r("weight","float",3,"WEIGHT"),joint:new r("joint","float",4,"JOINT"),barycentric:new r("barycentric","float",3,null)},boundingBox:null}},{mainAttribute:"position",updateBoundingBox:function(){var n=this.boundingBox;n||(n=this.boundingBox=new a.a);var l=this.attributes.position.value;if(l&&l.length){var u=n.min,_=n.max,f=u.array,d=_.array;c.a.set(f,l[0],l[1],l[2]),c.a.set(d,l[0],l[1],l[2]);for(var v=3;v<l.length;){var m=l[v++],p=l[v++],y=l[v++];m<f[0]&&(f[0]=m),p<f[1]&&(f[1]=p),y<f[2]&&(f[2]=y),m>d[0]&&(d[0]=m),p>d[1]&&(d[1]=p),y>d[2]&&(d[2]=y)}u._dirty=!0,_._dirty=!0}},generateVertexNormals:function(){if(!!this.vertexCount){var n=this.indices,l=this.attributes,u=l.position.value,_=l.normal.value;if(!_||_.length!==u.length)_=l.normal.value=new E.a.Float32Array(u.length);else for(var f=0;f<_.length;f++)_[f]=0;for(var d=i(),v=i(),m=i(),p=i(),y=i(),x=i(),M=n?n.length:this.vertexCount,P,T,O,D=0;D<M;){n?(P=n[D++],T=n[D++],O=n[D++]):(P=D++,T=D++,O=D++),h(d,u[P*3],u[P*3+1],u[P*3+2]),h(v,u[T*3],u[T*3+1],u[T*3+2]),h(m,u[O*3],u[O*3+1],u[O*3+2]),c.a.sub(p,d,v),c.a.sub(y,v,m),c.a.cross(x,p,y);for(var f=0;f<3;f++)_[P*3+f]=_[P*3+f]+x[f],_[T*3+f]=_[T*3+f]+x[f],_[O*3+f]=_[O*3+f]+x[f]}for(var f=0;f<_.length;)h(x,_[f],_[f+1],_[f+2]),c.a.normalize(x,x),_[f++]=x[0],_[f++]=x[1],_[f++]=x[2];this.dirty()}},generateFaceNormals:function(){if(!!this.vertexCount){this.isUniqueVertex()||this.generateUniqueVertex();var n=this.indices,l=this.attributes,u=l.position.value,_=l.normal.value,f=i(),d=i(),v=i(),m=i(),p=i(),y=i();_||(_=l.normal.value=new Float32Array(u.length));for(var x=n?n.length:this.vertexCount,M,P,T,O=0;O<x;){n?(M=n[O++],P=n[O++],T=n[O++]):(M=O++,P=O++,T=O++),h(f,u[M*3],u[M*3+1],u[M*3+2]),h(d,u[P*3],u[P*3+1],u[P*3+2]),h(v,u[T*3],u[T*3+1],u[T*3+2]),c.a.sub(m,f,d),c.a.sub(p,d,v),c.a.cross(y,m,p),c.a.normalize(y,y);for(var D=0;D<3;D++)_[M*3+D]=y[D],_[P*3+D]=y[D],_[T*3+D]=y[D]}this.dirty()}},generateTangents:function(){if(!!this.vertexCount){var n=this.vertexCount,l=this.attributes;l.tangent.value||(l.tangent.value=new Float32Array(n*4));var u=l.texcoord0.value,_=l.position.value,f=l.tangent.value,d=l.normal.value;if(!u){console.warn("Geometry without texcoords can't generate tangents.");return}for(var v=[],m=[],p=0;p<n;p++)v[p]=[0,0,0],m[p]=[0,0,0];for(var y=[0,0,0],x=[0,0,0],M=this.indices,P=M?M.length:this.vertexCount,T,O,D,p=0;p<P;){M?(T=M[p++],O=M[p++],D=M[p++]):(T=p++,O=p++,D=p++);var A=u[T*2],C=u[O*2],S=u[D*2],L=u[T*2+1],I=u[O*2+1],w=u[D*2+1],b=_[T*3],B=_[O*3],U=_[D*3],W=_[T*3+1],z=_[O*3+1],G=_[D*3+1],H=_[T*3+2],X=_[O*3+2],Q=_[D*3+2],j=B-b,J=U-b,Y=z-W,at=G-W,ot=X-H,ut=Q-H,et=C-A,ht=S-A,ft=I-L,it=w-L,N=1/(et*it-ft*ht);y[0]=(it*j-ft*J)*N,y[1]=(it*Y-ft*at)*N,y[2]=(it*ot-ft*ut)*N,x[0]=(et*J-ht*j)*N,x[1]=(et*at-ht*Y)*N,x[2]=(et*ut-ht*ot)*N,s(v[T],v[T],y),s(v[O],v[O],y),s(v[D],v[D],y),s(m[T],m[T],x),s(m[O],m[O],x),s(m[D],m[D],x)}for(var K=i(),Z=i(),V=i(),p=0;p<n;p++){V[0]=d[p*3],V[1]=d[p*3+1],V[2]=d[p*3+2];var k=v[p];c.a.scale(K,V,c.a.dot(V,k)),c.a.sub(K,k,K),c.a.normalize(K,K),c.a.cross(Z,V,k),f[p*4]=K[0],f[p*4+1]=K[1],f[p*4+2]=K[2],f[p*4+3]=c.a.dot(Z,m[p])<0?-1:1}this.dirty()}},isUniqueVertex:function(){return this.isUseIndices()?this.vertexCount===this.indices.length:!0},generateUniqueVertex:function(){if(!(!this.vertexCount||!this.indices)){this.indices.length>65535&&(this.indices=new E.a.Uint32Array(this.indices));for(var n=this.attributes,l=this.indices,u=this.getEnabledAttributes(),_={},f=0;f<u.length;f++){var d=u[f];_[d]=n[d].value,n[d].init(this.indices.length)}for(var v=0,m=0;m<l.length;m++){for(var p=l[m],f=0;f<u.length;f++)for(var d=u[f],y=n[d].value,x=n[d].size,M=0;M<x;M++)y[v*x+M]=_[d][p*x+M];l[m]=v,v++}this.dirty()}},generateBarycentric:function(){if(!!this.vertexCount){this.isUniqueVertex()||this.generateUniqueVertex();var n=this.attributes,l=n.barycentric.value,u=this.indices;if(!(l&&l.length===u.length*3)){l=n.barycentric.value=new Float32Array(u.length*3);for(var _=0;_<(u?u.length:this.vertexCount/3);)for(var f=0;f<3;f++){var d=u?u[_++]:_*3+f;l[d*3+f]=1}this.dirty()}}},applyTransform:function(n){var l=this.attributes,u=l.position.value,_=l.normal.value,f=l.tangent.value;n=n.array;var d=t.a.create();t.a.invert(d,n),t.a.transpose(d,d);var v=c.a.transformMat4,m=c.a.forEach;m(u,3,0,null,v,n),_&&m(_,3,0,null,v,d),f&&m(f,4,0,null,v,d),this.boundingBox&&this.updateBoundingBox()},dispose:function(n){var l=this._cache;l.use(n.__uid__);var u=l.get("chunks");if(u)for(var _=0;_<u.length;_++){for(var f=u[_],d=0;d<f.attributeBuffers.length;d++){var v=f.attributeBuffers[d];n.gl.deleteBuffer(v.buffer)}f.indicesBuffer&&n.gl.deleteBuffer(f.indicesBuffer.buffer)}if(this.__vaoCache){var m=n.getGLExtension("OES_vertex_array_object");for(var p in this.__vaoCache){var y=this.__vaoCache[p].vao;y&&m.deleteVertexArrayOES(y)}}this.__vaoCache={},l.deleteContext(n.__uid__)}});e.STATIC_DRAW=o.a.STATIC_DRAW,e.DYNAMIC_DRAW=o.a.DYNAMIC_DRAW,e.STREAM_DRAW=o.a.STREAM_DRAW,e.AttributeBuffer=o.a.AttributeBuffer,e.IndicesBuffer=o.a.IndicesBuffer,e.Attribute=r,R.a=e},function(F,R,g){var E=g(8),c=g(38),t=g(43),a=g(9),o=g(19),i=g(41),s=g(11),h=g(125);a.a.import(h.a);var r=new t.a,e=new i.a({geometry:r,frustumCulling:!1}),n=new c.a,l=E.a.extend(function(){return{fragment:"",outputs:null,material:null,blendWithPrevious:!1,clearColor:!1,clearDepth:!0}},function(){var u=new a.a(a.a.source("clay.compositor.vertex"),this.fragment),_=new o.a({shader:u});_.enableTexturesAll(),this.material=_},{setUniform:function(u,_){this.material.setUniform(u,_)},getUniform:function(u){var _=this.material.uniforms[u];if(_)return _.value},attachOutput:function(u,_){this.outputs||(this.outputs={}),_=_||s.a.COLOR_ATTACHMENT0,this.outputs[_]=u},detachOutput:function(u){for(var _ in this.outputs)this.outputs[_]===u&&(this.outputs[_]=null)},bind:function(u,_){if(this.outputs)for(var f in this.outputs){var d=this.outputs[f];d&&_.attach(d,f)}_&&_.bind(u)},unbind:function(u,_){_.unbind(u)},render:function(u,_){var f=u.gl;if(_){this.bind(u,_);var d=u.getGLExtension("EXT_draw_buffers");if(d&&this.outputs){var v=[];for(var m in this.outputs)m=+m,m>=f.COLOR_ATTACHMENT0&&m<=f.COLOR_ATTACHMENT0+8&&v.push(m);d.drawBuffersEXT(v)}}this.trigger("beforerender",this,u);var p=this.clearDepth?f.DEPTH_BUFFER_BIT:0;if(f.depthMask(!0),this.clearColor){p=p|f.COLOR_BUFFER_BIT,f.colorMask(!0,!0,!0,!0);var y=this.clearColor;Array.isArray(y)&&f.clearColor(y[0],y[1],y[2],y[3])}f.clear(p),this.blendWithPrevious?(f.enable(f.BLEND),this.material.transparent=!0):(f.disable(f.BLEND),this.material.transparent=!1),this.renderQuad(u),this.trigger("afterrender",this,u),_&&this.unbind(u,_)},renderQuad:function(u){e.material=this.material,u.renderPass([e],n)},dispose:function(u){}});R.a=l},function(F,R){var g={"[object Function]":1,"[object RegExp]":1,"[object Date]":1,"[object Error]":1,"[object CanvasGradient]":1,"[object CanvasPattern]":1,"[object Image]":1,"[object Canvas]":1},E={"[object Int8Array]":1,"[object Uint8Array]":1,"[object Uint8ClampedArray]":1,"[object Int16Array]":1,"[object Uint16Array]":1,"[object Int32Array]":1,"[object Uint32Array]":1,"[object Float32Array]":1,"[object Float64Array]":1},c=Object.prototype.toString,t=Array.prototype,a=t.forEach,o=t.filter,i=t.slice,s=t.map,h=t.reduce,r={};function e(N,K){N==="createCanvas"&&(v=null),r[N]=K}function n(N){if(N==null||typeof N!="object")return N;var K=N,Z=c.call(N);if(Z==="[object Array]"){if(!ut(N)){K=[];for(var V=0,k=N.length;V<k;V++)K[V]=n(N[V])}}else if(E[Z]){if(!ut(N)){var rt=N.constructor;if(N.constructor.from)K=rt.from(N);else{K=new rt(N.length);for(var V=0,k=N.length;V<k;V++)K[V]=n(N[V])}}}else if(!g[Z]&&!ut(N)&&!W(N)){K={};for(var nt in N)N.hasOwnProperty(nt)&&(K[nt]=n(N[nt]))}return K}function l(N,K,Z){if(!b(K)||!b(N))return Z?n(K):N;for(var V in K)if(K.hasOwnProperty(V)){var k=N[V],rt=K[V];b(rt)&&b(k)&&!L(rt)&&!L(k)&&!W(rt)&&!W(k)&&!B(rt)&&!B(k)&&!ut(rt)&&!ut(k)?l(k,rt,Z):(Z||!(V in N))&&(N[V]=n(K[V]))}return N}function u(N,K){for(var Z=N[0],V=1,k=N.length;V<k;V++)Z=l(Z,N[V],K);return Z}function _(N,K){for(var Z in K)K.hasOwnProperty(Z)&&(N[Z]=K[Z]);return N}function f(N,K,Z){for(var V in K)K.hasOwnProperty(V)&&(Z?K[V]!=null:N[V]==null)&&(N[V]=K[V]);return N}var d=function(){return r.createCanvas()};r.createCanvas=function(){return document.createElement("canvas")};var v;function m(){return v||(v=d().getContext("2d")),v}function p(N,K){if(N){if(N.indexOf)return N.indexOf(K);for(var Z=0,V=N.length;Z<V;Z++)if(N[Z]===K)return Z}return-1}function y(N,K){var Z=N.prototype;function V(){}V.prototype=K.prototype,N.prototype=new V;for(var k in Z)Z.hasOwnProperty(k)&&(N.prototype[k]=Z[k]);N.prototype.constructor=N,N.superClass=K}function x(N,K,Z){N="prototype"in N?N.prototype:N,K="prototype"in K?K.prototype:K,f(N,K,Z)}function M(N){if(!!N)return typeof N=="string"?!1:typeof N.length=="number"}function P(N,K,Z){if(!!(N&&K))if(N.forEach&&N.forEach===a)N.forEach(K,Z);else if(N.length===+N.length)for(var V=0,k=N.length;V<k;V++)K.call(Z,N[V],V,N);else for(var rt in N)N.hasOwnProperty(rt)&&K.call(Z,N[rt],rt,N)}function T(N,K,Z){if(!!(N&&K)){if(N.map&&N.map===s)return N.map(K,Z);for(var V=[],k=0,rt=N.length;k<rt;k++)V.push(K.call(Z,N[k],k,N));return V}}function O(N,K,Z,V){if(!!(N&&K)){if(N.reduce&&N.reduce===h)return N.reduce(K,Z,V);for(var k=0,rt=N.length;k<rt;k++)Z=K.call(V,Z,N[k],k,N);return Z}}function D(N,K,Z){if(!!(N&&K)){if(N.filter&&N.filter===o)return N.filter(K,Z);for(var V=[],k=0,rt=N.length;k<rt;k++)K.call(Z,N[k],k,N)&&V.push(N[k]);return V}}function A(N,K,Z){if(!!(N&&K)){for(var V=0,k=N.length;V<k;V++)if(K.call(Z,N[V],V,N))return N[V]}}function C(N,K){var Z=i.call(arguments,2);return function(){return N.apply(K,Z.concat(i.call(arguments)))}}function S(N){var K=i.call(arguments,1);return function(){return N.apply(this,K.concat(i.call(arguments)))}}function L(N){return c.call(N)==="[object Array]"}function I(N){return typeof N=="function"}function w(N){return c.call(N)==="[object String]"}function b(N){var K=typeof N;return K==="function"||!!N&&K==="object"}function B(N){return!!g[c.call(N)]}function U(N){return!!E[c.call(N)]}function W(N){return typeof N=="object"&&typeof N.nodeType=="number"&&typeof N.ownerDocument=="object"}function z(N){return N!==N}function G(N){for(var K=0,Z=arguments.length;K<Z;K++)if(arguments[K]!=null)return arguments[K]}function H(N,K){return N!=null?N:K}function X(N,K,Z){return N!=null?N:K!=null?K:Z}function Q(){return Function.call.apply(i,arguments)}function j(N){if(typeof N=="number")return[N,N,N,N];var K=N.length;return K===2?[N[0],N[1],N[0],N[1]]:K===3?[N[0],N[1],N[2],N[1]]:N}function J(N,K){if(!N)throw new Error(K)}function Y(N){return N==null?null:typeof N.trim=="function"?N.trim():N.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}var at="__ec_primitive__";function ot(N){N[at]=!0}function ut(N){return N[at]}function et(N){var K=L(N);this.data={};var Z=this;N instanceof et?N.each(V):N&&P(N,V);function V(k,rt){K?Z.set(k,rt):Z.set(rt,k)}}et.prototype={constructor:et,get:function(N){return this.data.hasOwnProperty(N)?this.data[N]:null},set:function(N,K){return this.data[N]=K},each:function(N,K){K!==void 0&&(N=C(N,K));for(var Z in this.data)this.data.hasOwnProperty(Z)&&N(this.data[Z],Z)},removeKey:function(N){delete this.data[N]}};function ht(N){return new et(N)}function ft(N,K){for(var Z=new N.constructor(N.length+K.length),V=0;V<N.length;V++)Z[V]=N[V];var k=N.length;for(V=0;V<K.length;V++)Z[V+k]=K[V];return Z}function it(){}R.$override=e,R.clone=n,R.merge=l,R.mergeAll=u,R.extend=_,R.defaults=f,R.createCanvas=d,R.getContext=m,R.indexOf=p,R.inherits=y,R.mixin=x,R.isArrayLike=M,R.each=P,R.map=T,R.reduce=O,R.filter=D,R.find=A,R.bind=C,R.curry=S,R.isArray=L,R.isFunction=I,R.isString=w,R.isObject=b,R.isBuiltInObject=B,R.isTypedArray=U,R.isDom=W,R.eqNaN=z,R.retrieve=G,R.retrieve2=H,R.retrieve3=X,R.slice=Q,R.normalizeCssArray=j,R.assert=J,R.trim=Y,R.setAsPrimitive=ot,R.isPrimitive=ut,R.createHashMap=ht,R.concatArray=ft,R.noop=it},function(F,R,g){R.a=function(E,c,t){return{seriesType:E,reset:function(a,o){var i=a.getData(),s=a.visualColorAccessPath.split(".");s[s.length-1]="opacity";var h=a.get(s);i.setVisual("opacity",h==null?1:h);function r(e,n){var l=e.getItemModel(n),u=l.get(s,!0);u!=null&&e.setItemVisual(n,"opacity",u)}return{dataEach:i.hasItemOption?r:null}}}}},function(F,R,g){var E=g(3),c=g(12),t=c.a.set,a=c.a.copy,o=function(i,s){this.min=i||new E.a(Infinity,Infinity,Infinity),this.max=s||new E.a(-Infinity,-Infinity,-Infinity),this.vertices=null};o.prototype={constructor:o,updateFromVertices:function(i){if(i.length>0){var s=this.min,h=this.max,r=s.array,e=h.array;a(r,i[0]),a(e,i[0]);for(var n=1;n<i.length;n++){var l=i[n];l[0]<r[0]&&(r[0]=l[0]),l[1]<r[1]&&(r[1]=l[1]),l[2]<r[2]&&(r[2]=l[2]),l[0]>e[0]&&(e[0]=l[0]),l[1]>e[1]&&(e[1]=l[1]),l[2]>e[2]&&(e[2]=l[2])}s._dirty=!0,h._dirty=!0}},union:function(i){var s=this.min,h=this.max;return c.a.min(s.array,s.array,i.min.array),c.a.max(h.array,h.array,i.max.array),s._dirty=!0,h._dirty=!0,this},intersection:function(i){var s=this.min,h=this.max;return c.a.max(s.array,s.array,i.min.array),c.a.min(h.array,h.array,i.max.array),s._dirty=!0,h._dirty=!0,this},intersectBoundingBox:function(i){var s=this.min.array,h=this.max.array,r=i.min.array,e=i.max.array;return!(s[0]>e[0]||s[1]>e[1]||s[2]>e[2]||h[0]<r[0]||h[1]<r[1]||h[2]<r[2])},containBoundingBox:function(i){var s=this.min.array,h=this.max.array,r=i.min.array,e=i.max.array;return s[0]<=r[0]&&s[1]<=r[1]&&s[2]<=r[2]&&h[0]>=e[0]&&h[1]>=e[1]&&h[2]>=e[2]},containPoint:function(i){var s=this.min.array,h=this.max.array,r=i.array;return s[0]<=r[0]&&s[1]<=r[1]&&s[2]<=r[2]&&h[0]>=r[0]&&h[1]>=r[1]&&h[2]>=r[2]},isFinite:function(){var i=this.min.array,s=this.max.array;return isFinite(i[0])&&isFinite(i[1])&&isFinite(i[2])&&isFinite(s[0])&&isFinite(s[1])&&isFinite(s[2])},applyTransform:function(i){this.transformFrom(this,i)},transformFrom:function(){var i=c.a.create(),s=c.a.create(),h=c.a.create(),r=c.a.create(),e=c.a.create(),n=c.a.create();return function(l,u){var _=l.min.array,f=l.max.array,d=u.array;return i[0]=d[0]*_[0],i[1]=d[1]*_[0],i[2]=d[2]*_[0],s[0]=d[0]*f[0],s[1]=d[1]*f[0],s[2]=d[2]*f[0],h[0]=d[4]*_[1],h[1]=d[5]*_[1],h[2]=d[6]*_[1],r[0]=d[4]*f[1],r[1]=d[5]*f[1],r[2]=d[6]*f[1],e[0]=d[8]*_[2],e[1]=d[9]*_[2],e[2]=d[10]*_[2],n[0]=d[8]*f[2],n[1]=d[9]*f[2],n[2]=d[10]*f[2],_=this.min.array,f=this.max.array,_[0]=Math.min(i[0],s[0])+Math.min(h[0],r[0])+Math.min(e[0],n[0])+d[12],_[1]=Math.min(i[1],s[1])+Math.min(h[1],r[1])+Math.min(e[1],n[1])+d[13],_[2]=Math.min(i[2],s[2])+Math.min(h[2],r[2])+Math.min(e[2],n[2])+d[14],f[0]=Math.max(i[0],s[0])+Math.max(h[0],r[0])+Math.max(e[0],n[0])+d[12],f[1]=Math.max(i[1],s[1])+Math.max(h[1],r[1])+Math.max(e[1],n[1])+d[13],f[2]=Math.max(i[2],s[2])+Math.max(h[2],r[2])+Math.max(e[2],n[2])+d[14],this.min._dirty=!0,this.max._dirty=!0,this}}(),applyProjection:function(i){var s=this.min.array,h=this.max.array,r=i.array,e=s[0],n=s[1],l=s[2],u=h[0],_=h[1],f=s[2],d=h[0],v=h[1],m=h[2];if(r[15]===1)s[0]=r[0]*e+r[12],s[1]=r[5]*n+r[13],h[2]=r[10]*l+r[14],h[0]=r[0]*d+r[12],h[1]=r[5]*v+r[13],s[2]=r[10]*m+r[14];else{var p=-1/l;s[0]=r[0]*e*p,s[1]=r[5]*n*p,h[2]=(r[10]*l+r[14])*p,p=-1/f,h[0]=r[0]*u*p,h[1]=r[5]*_*p,p=-1/m,s[2]=(r[10]*m+r[14])*p}return this.min._dirty=!0,this.max._dirty=!0,this},updateVertices:function(){var i=this.vertices;if(!i){i=[];for(var s=0;s<8;s++)i[s]=c.a.fromValues(0,0,0);this.vertices=i}var h=this.min.array,r=this.max.array;return t(i[0],h[0],h[1],h[2]),t(i[1],h[0],r[1],h[2]),t(i[2],r[0],h[1],h[2]),t(i[3],r[0],r[1],h[2]),t(i[4],h[0],h[1],r[2]),t(i[5],h[0],r[1],r[2]),t(i[6],r[0],h[1],r[2]),t(i[7],r[0],r[1],r[2]),this},copy:function(i){var s=this.min,h=this.max;return a(s.array,i.min.array),a(h.array,i.max.array),s._dirty=!0,h._dirty=!0,this},clone:function(){var i=new o;return i.copy(this),i}},R.a=o},function(F,R,g){var E=g(8),c=g(23),t=g(112),a=t.a.parseToFloat,o={};function i(r){var e=Object.keys(r);e.sort();for(var n=[],l=0;l<e.length;l++){var u=e[l],_=r[u];_===null?n.push(u):n.push(u+" "+_.toString())}return n.join(`
`)}function s(r,e,n){n.sort();for(var l=[],u=0;u<n.length;u++){var _=n[u];l.push(_)}var f=i(r)+`
`+i(e)+`
`+l.join(`
`);if(o[f])return o[f];var d=c.a.genGUID();return o[f]=d,d}var h=E.a.extend(function(){return{name:"",depthTest:!0,depthMask:!0,transparent:!1,blend:null,autoUpdateTextureStatus:!0,uniforms:{},vertexDefines:{},fragmentDefines:{},_textureStatus:{},_enabledUniforms:null}},function(){this.name||(this.name="MATERIAL_"+this.__uid__),this.shader&&this.attachShader(this.shader,!0)},{precision:"highp",setUniform:function(r,e){e===void 0&&console.warn('Uniform value "'+r+'" is undefined');var n=this.uniforms[r];n&&(typeof e=="string"&&(e=a(e)||e),n.value=e,this.autoUpdateTextureStatus&&n.type==="t"&&(e?this.enableTexture(r):this.disableTexture(r)))},setUniforms:function(r){for(var e in r){var n=r[e];this.setUniform(e,n)}},isUniformEnabled:function(r){return this._enabledUniforms.indexOf(r)>=0},getEnabledUniforms:function(){return this._enabledUniforms},getTextureUniforms:function(){return this._textureUniforms},set:function(r,e){if(typeof r=="object")for(var n in r){var l=r[n];this.setUniform(n,l)}else this.setUniform(r,e)},get:function(r){var e=this.uniforms[r];if(e)return e.value},attachShader:function(r,e){var n=this.uniforms;this.uniforms=r.createUniforms(),this.shader=r;var l=this.uniforms;this._enabledUniforms=Object.keys(l),this._enabledUniforms.sort(),this._textureUniforms=this._enabledUniforms.filter(function(m){var p=this.uniforms[m].type;return p==="t"||p==="tv"},this);var u=this.vertexDefines,_=this.fragmentDefines;if(this.vertexDefines=c.a.clone(r.vertexDefines),this.fragmentDefines=c.a.clone(r.fragmentDefines),e){for(var f in n)l[f]&&(l[f].value=n[f].value);c.a.defaults(this.vertexDefines,u),c.a.defaults(this.fragmentDefines,_)}var d={};for(var v in r.textures)d[v]={shaderType:r.textures[v].shaderType,type:r.textures[v].type,enabled:e&&this._textureStatus[v]?this._textureStatus[v].enabled:!1};this._textureStatus=d,this._programKey=""},clone:function(){var r=new this.constructor({name:this.name,shader:this.shader});for(var e in this.uniforms)r.uniforms[e].value=this.uniforms[e].value;return r.depthTest=this.depthTest,r.depthMask=this.depthMask,r.transparent=this.transparent,r.blend=this.blend,r.vertexDefines=c.a.clone(this.vertexDefines),r.fragmentDefines=c.a.clone(this.fragmentDefines),r.enableTexture(this.getEnabledTextures()),r.precision=this.precision,r},define:function(r,e,n){var l=this.vertexDefines,u=this.fragmentDefines;r!=="vertex"&&r!=="fragment"&&r!=="both"&&arguments.length<3&&(n=e,e=r,r="both"),n=n!=null?n:null,(r==="vertex"||r==="both")&&l[e]!==n&&(l[e]=n,this._programKey=""),(r==="fragment"||r==="both")&&u[e]!==n&&(u[e]=n,r!=="both"&&(this._programKey=""))},undefine:function(r,e){r!=="vertex"&&r!=="fragment"&&r!=="both"&&arguments.length<2&&(e=r,r="both"),(r==="vertex"||r==="both")&&this.isDefined("vertex",e)&&(delete this.vertexDefines[e],this._programKey=""),(r==="fragment"||r==="both")&&this.isDefined("fragment",e)&&(delete this.fragmentDefines[e],r!=="both"&&(this._programKey=""))},isDefined:function(r,e){switch(r){case"vertex":return this.vertexDefines[e]!==void 0;case"fragment":return this.fragmentDefines[e]!==void 0}},getDefine:function(r,e){switch(r){case"vertex":return this.vertexDefines[e];case"fragment":return this.fragmentDefines[e]}},enableTexture:function(r){if(Array.isArray(r)){for(var e=0;e<r.length;e++)this.enableTexture(r[e]);return}var n=this._textureStatus[r];if(n){var l=n.enabled;l||(n.enabled=!0,this._programKey="")}},enableTexturesAll:function(){var r=this._textureStatus;for(var e in r)r[e].enabled=!0;this._programKey=""},disableTexture:function(r){if(Array.isArray(r)){for(var e=0;e<r.length;e++)this.disableTexture(r[e]);return}var n=this._textureStatus[r];if(n){var l=!n.enabled;l||(n.enabled=!1,this._programKey="")}},disableTexturesAll:function(){var r=this._textureStatus;for(var e in r)r[e].enabled=!1;this._programKey=""},isTextureEnabled:function(r){var e=this._textureStatus;return!!e[r]&&e[r].enabled},getEnabledTextures:function(){var r=[],e=this._textureStatus;for(var n in e)e[n].enabled&&r.push(n);return r},dirtyDefines:function(){this._programKey=""},getProgramKey:function(){return this._programKey||(this._programKey=s(this.vertexDefines,this.fragmentDefines,this.getEnabledTextures())),this._programKey}});R.a=h},function(F,R,g){g.d(R,"b",function(){return E}),g.d(R,"a",function(){return c}),g.d(R,"c",function(){return t});var E=1e-6,c=Array,t=Math.random},function(F,R,g){var E=g(20),c={};c.create=function(){var t=new E.a(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},c.clone=function(t){var a=new E.a(16);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},c.copy=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},c.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},c.transpose=function(t,a){if(t===a){var o=a[1],i=a[2],s=a[3],h=a[6],r=a[7],e=a[11];t[1]=a[4],t[2]=a[8],t[3]=a[12],t[4]=o,t[6]=a[9],t[7]=a[13],t[8]=i,t[9]=h,t[11]=a[14],t[12]=s,t[13]=r,t[14]=e}else t[0]=a[0],t[1]=a[4],t[2]=a[8],t[3]=a[12],t[4]=a[1],t[5]=a[5],t[6]=a[9],t[7]=a[13],t[8]=a[2],t[9]=a[6],t[10]=a[10],t[11]=a[14],t[12]=a[3],t[13]=a[7],t[14]=a[11],t[15]=a[15];return t},c.invert=function(t,a){var o=a[0],i=a[1],s=a[2],h=a[3],r=a[4],e=a[5],n=a[6],l=a[7],u=a[8],_=a[9],f=a[10],d=a[11],v=a[12],m=a[13],p=a[14],y=a[15],x=o*e-i*r,M=o*n-s*r,P=o*l-h*r,T=i*n-s*e,O=i*l-h*e,D=s*l-h*n,A=u*m-_*v,C=u*p-f*v,S=u*y-d*v,L=_*p-f*m,I=_*y-d*m,w=f*y-d*p,b=x*w-M*I+P*L+T*S-O*C+D*A;return b?(b=1/b,t[0]=(e*w-n*I+l*L)*b,t[1]=(s*I-i*w-h*L)*b,t[2]=(m*D-p*O+y*T)*b,t[3]=(f*O-_*D-d*T)*b,t[4]=(n*S-r*w-l*C)*b,t[5]=(o*w-s*S+h*C)*b,t[6]=(p*P-v*D-y*M)*b,t[7]=(u*D-f*P+d*M)*b,t[8]=(r*I-e*S+l*A)*b,t[9]=(i*S-o*I-h*A)*b,t[10]=(v*O-m*P+y*x)*b,t[11]=(_*P-u*O-d*x)*b,t[12]=(e*C-r*L-n*A)*b,t[13]=(o*L-i*C+s*A)*b,t[14]=(m*M-v*T-p*x)*b,t[15]=(u*T-_*M+f*x)*b,t):null},c.adjoint=function(t,a){var o=a[0],i=a[1],s=a[2],h=a[3],r=a[4],e=a[5],n=a[6],l=a[7],u=a[8],_=a[9],f=a[10],d=a[11],v=a[12],m=a[13],p=a[14],y=a[15];return t[0]=e*(f*y-d*p)-_*(n*y-l*p)+m*(n*d-l*f),t[1]=-(i*(f*y-d*p)-_*(s*y-h*p)+m*(s*d-h*f)),t[2]=i*(n*y-l*p)-e*(s*y-h*p)+m*(s*l-h*n),t[3]=-(i*(n*d-l*f)-e*(s*d-h*f)+_*(s*l-h*n)),t[4]=-(r*(f*y-d*p)-u*(n*y-l*p)+v*(n*d-l*f)),t[5]=o*(f*y-d*p)-u*(s*y-h*p)+v*(s*d-h*f),t[6]=-(o*(n*y-l*p)-r*(s*y-h*p)+v*(s*l-h*n)),t[7]=o*(n*d-l*f)-r*(s*d-h*f)+u*(s*l-h*n),t[8]=r*(_*y-d*m)-u*(e*y-l*m)+v*(e*d-l*_),t[9]=-(o*(_*y-d*m)-u*(i*y-h*m)+v*(i*d-h*_)),t[10]=o*(e*y-l*m)-r*(i*y-h*m)+v*(i*l-h*e),t[11]=-(o*(e*d-l*_)-r*(i*d-h*_)+u*(i*l-h*e)),t[12]=-(r*(_*p-f*m)-u*(e*p-n*m)+v*(e*f-n*_)),t[13]=o*(_*p-f*m)-u*(i*p-s*m)+v*(i*f-s*_),t[14]=-(o*(e*p-n*m)-r*(i*p-s*m)+v*(i*n-s*e)),t[15]=o*(e*f-n*_)-r*(i*f-s*_)+u*(i*n-s*e),t},c.determinant=function(t){var a=t[0],o=t[1],i=t[2],s=t[3],h=t[4],r=t[5],e=t[6],n=t[7],l=t[8],u=t[9],_=t[10],f=t[11],d=t[12],v=t[13],m=t[14],p=t[15],y=a*r-o*h,x=a*e-i*h,M=a*n-s*h,P=o*e-i*r,T=o*n-s*r,O=i*n-s*e,D=l*v-u*d,A=l*m-_*d,C=l*p-f*d,S=u*m-_*v,L=u*p-f*v,I=_*p-f*m;return y*I-x*L+M*S+P*C-T*A+O*D},c.multiply=function(t,a,o){var i=a[0],s=a[1],h=a[2],r=a[3],e=a[4],n=a[5],l=a[6],u=a[7],_=a[8],f=a[9],d=a[10],v=a[11],m=a[12],p=a[13],y=a[14],x=a[15],M=o[0],P=o[1],T=o[2],O=o[3];return t[0]=M*i+P*e+T*_+O*m,t[1]=M*s+P*n+T*f+O*p,t[2]=M*h+P*l+T*d+O*y,t[3]=M*r+P*u+T*v+O*x,M=o[4],P=o[5],T=o[6],O=o[7],t[4]=M*i+P*e+T*_+O*m,t[5]=M*s+P*n+T*f+O*p,t[6]=M*h+P*l+T*d+O*y,t[7]=M*r+P*u+T*v+O*x,M=o[8],P=o[9],T=o[10],O=o[11],t[8]=M*i+P*e+T*_+O*m,t[9]=M*s+P*n+T*f+O*p,t[10]=M*h+P*l+T*d+O*y,t[11]=M*r+P*u+T*v+O*x,M=o[12],P=o[13],T=o[14],O=o[15],t[12]=M*i+P*e+T*_+O*m,t[13]=M*s+P*n+T*f+O*p,t[14]=M*h+P*l+T*d+O*y,t[15]=M*r+P*u+T*v+O*x,t},c.multiplyAffine=function(t,a,o){var i=a[0],s=a[1],h=a[2],r=a[4],e=a[5],n=a[6],l=a[8],u=a[9],_=a[10],f=a[12],d=a[13],v=a[14],m=o[0],p=o[1],y=o[2];return t[0]=m*i+p*r+y*l,t[1]=m*s+p*e+y*u,t[2]=m*h+p*n+y*_,m=o[4],p=o[5],y=o[6],t[4]=m*i+p*r+y*l,t[5]=m*s+p*e+y*u,t[6]=m*h+p*n+y*_,m=o[8],p=o[9],y=o[10],t[8]=m*i+p*r+y*l,t[9]=m*s+p*e+y*u,t[10]=m*h+p*n+y*_,m=o[12],p=o[13],y=o[14],t[12]=m*i+p*r+y*l+f,t[13]=m*s+p*e+y*u+d,t[14]=m*h+p*n+y*_+v,t},c.mul=c.multiply,c.mulAffine=c.multiplyAffine,c.translate=function(t,a,o){var i=o[0],s=o[1],h=o[2],r,e,n,l,u,_,f,d,v,m,p,y;return a===t?(t[12]=a[0]*i+a[4]*s+a[8]*h+a[12],t[13]=a[1]*i+a[5]*s+a[9]*h+a[13],t[14]=a[2]*i+a[6]*s+a[10]*h+a[14],t[15]=a[3]*i+a[7]*s+a[11]*h+a[15]):(r=a[0],e=a[1],n=a[2],l=a[3],u=a[4],_=a[5],f=a[6],d=a[7],v=a[8],m=a[9],p=a[10],y=a[11],t[0]=r,t[1]=e,t[2]=n,t[3]=l,t[4]=u,t[5]=_,t[6]=f,t[7]=d,t[8]=v,t[9]=m,t[10]=p,t[11]=y,t[12]=r*i+u*s+v*h+a[12],t[13]=e*i+_*s+m*h+a[13],t[14]=n*i+f*s+p*h+a[14],t[15]=l*i+d*s+y*h+a[15]),t},c.scale=function(t,a,o){var i=o[0],s=o[1],h=o[2];return t[0]=a[0]*i,t[1]=a[1]*i,t[2]=a[2]*i,t[3]=a[3]*i,t[4]=a[4]*s,t[5]=a[5]*s,t[6]=a[6]*s,t[7]=a[7]*s,t[8]=a[8]*h,t[9]=a[9]*h,t[10]=a[10]*h,t[11]=a[11]*h,t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},c.rotate=function(t,a,o,i){var s=i[0],h=i[1],r=i[2],e=Math.sqrt(s*s+h*h+r*r),n,l,u,_,f,d,v,m,p,y,x,M,P,T,O,D,A,C,S,L,I,w,b,B;return Math.abs(e)<E.b?null:(e=1/e,s*=e,h*=e,r*=e,n=Math.sin(o),l=Math.cos(o),u=1-l,_=a[0],f=a[1],d=a[2],v=a[3],m=a[4],p=a[5],y=a[6],x=a[7],M=a[8],P=a[9],T=a[10],O=a[11],D=s*s*u+l,A=h*s*u+r*n,C=r*s*u-h*n,S=s*h*u-r*n,L=h*h*u+l,I=r*h*u+s*n,w=s*r*u+h*n,b=h*r*u-s*n,B=r*r*u+l,t[0]=_*D+m*A+M*C,t[1]=f*D+p*A+P*C,t[2]=d*D+y*A+T*C,t[3]=v*D+x*A+O*C,t[4]=_*S+m*L+M*I,t[5]=f*S+p*L+P*I,t[6]=d*S+y*L+T*I,t[7]=v*S+x*L+O*I,t[8]=_*w+m*b+M*B,t[9]=f*w+p*b+P*B,t[10]=d*w+y*b+T*B,t[11]=v*w+x*b+O*B,a!==t&&(t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t)},c.rotateX=function(t,a,o){var i=Math.sin(o),s=Math.cos(o),h=a[4],r=a[5],e=a[6],n=a[7],l=a[8],u=a[9],_=a[10],f=a[11];return a!==t&&(t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[4]=h*s+l*i,t[5]=r*s+u*i,t[6]=e*s+_*i,t[7]=n*s+f*i,t[8]=l*s-h*i,t[9]=u*s-r*i,t[10]=_*s-e*i,t[11]=f*s-n*i,t},c.rotateY=function(t,a,o){var i=Math.sin(o),s=Math.cos(o),h=a[0],r=a[1],e=a[2],n=a[3],l=a[8],u=a[9],_=a[10],f=a[11];return a!==t&&(t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=h*s-l*i,t[1]=r*s-u*i,t[2]=e*s-_*i,t[3]=n*s-f*i,t[8]=h*i+l*s,t[9]=r*i+u*s,t[10]=e*i+_*s,t[11]=n*i+f*s,t},c.rotateZ=function(t,a,o){var i=Math.sin(o),s=Math.cos(o),h=a[0],r=a[1],e=a[2],n=a[3],l=a[4],u=a[5],_=a[6],f=a[7];return a!==t&&(t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=h*s+l*i,t[1]=r*s+u*i,t[2]=e*s+_*i,t[3]=n*s+f*i,t[4]=l*s-h*i,t[5]=u*s-r*i,t[6]=_*s-e*i,t[7]=f*s-n*i,t},c.fromRotationTranslation=function(t,a,o){var i=a[0],s=a[1],h=a[2],r=a[3],e=i+i,n=s+s,l=h+h,u=i*e,_=i*n,f=i*l,d=s*n,v=s*l,m=h*l,p=r*e,y=r*n,x=r*l;return t[0]=1-(d+m),t[1]=_+x,t[2]=f-y,t[3]=0,t[4]=_-x,t[5]=1-(u+m),t[6]=v+p,t[7]=0,t[8]=f+y,t[9]=v-p,t[10]=1-(u+d),t[11]=0,t[12]=o[0],t[13]=o[1],t[14]=o[2],t[15]=1,t},c.fromQuat=function(t,a){var o=a[0],i=a[1],s=a[2],h=a[3],r=o+o,e=i+i,n=s+s,l=o*r,u=i*r,_=i*e,f=s*r,d=s*e,v=s*n,m=h*r,p=h*e,y=h*n;return t[0]=1-_-v,t[1]=u+y,t[2]=f-p,t[3]=0,t[4]=u-y,t[5]=1-l-v,t[6]=d+m,t[7]=0,t[8]=f+p,t[9]=d-m,t[10]=1-l-_,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},c.frustum=function(t,a,o,i,s,h,r){var e=1/(o-a),n=1/(s-i),l=1/(h-r);return t[0]=h*2*e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h*2*n,t[6]=0,t[7]=0,t[8]=(o+a)*e,t[9]=(s+i)*n,t[10]=(r+h)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=r*h*2*l,t[15]=0,t},c.perspective=function(t,a,o,i,s){var h=1/Math.tan(a/2),r=1/(i-s);return t[0]=h/o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(s+i)*r,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*s*i*r,t[15]=0,t},c.ortho=function(t,a,o,i,s,h,r){var e=1/(a-o),n=1/(i-s),l=1/(h-r);return t[0]=-2*e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(a+o)*e,t[13]=(s+i)*n,t[14]=(r+h)*l,t[15]=1,t},c.lookAt=function(t,a,o,i){var s,h,r,e,n,l,u,_,f,d,v=a[0],m=a[1],p=a[2],y=i[0],x=i[1],M=i[2],P=o[0],T=o[1],O=o[2];return Math.abs(v-P)<E.b&&Math.abs(m-T)<E.b&&Math.abs(p-O)<E.b?c.identity(t):(u=v-P,_=m-T,f=p-O,d=1/Math.sqrt(u*u+_*_+f*f),u*=d,_*=d,f*=d,s=x*f-M*_,h=M*u-y*f,r=y*_-x*u,d=Math.sqrt(s*s+h*h+r*r),d?(d=1/d,s*=d,h*=d,r*=d):(s=0,h=0,r=0),e=_*r-f*h,n=f*s-u*r,l=u*h-_*s,d=Math.sqrt(e*e+n*n+l*l),d?(d=1/d,e*=d,n*=d,l*=d):(e=0,n=0,l=0),t[0]=s,t[1]=e,t[2]=u,t[3]=0,t[4]=h,t[5]=n,t[6]=_,t[7]=0,t[8]=r,t[9]=l,t[10]=f,t[11]=0,t[12]=-(s*v+h*m+r*p),t[13]=-(e*v+n*m+l*p),t[14]=-(u*v+_*m+f*p),t[15]=1,t)},c.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},R.a=c},function(F,R,g){var E=g(0),c=g.n(E),t=g(36),a=g(176),o=g(37),i=g(38),s=g(7),h=g(3),r=g(26),e=g(53),n=g(178),l=g(202),u=g(49);function _(d){d=d||"perspective",this.layer=null,this.scene=new t.a,this.rootNode=this.scene,this.viewport={x:0,y:0,width:0,height:0},this.setProjection(d),this._compositor=new n.a,this._temporalSS=new l.a,this._shadowMapPass=new a.a;for(var v=[],m=0,p=0;p<30;p++){for(var y=[],x=0;x<6;x++)y.push(Object(u.a)(m,2)*4-2),y.push(Object(u.a)(m,3)*4-2),m++;v.push(y)}this._pcfKernels=v,this.scene.on("beforerender",function(M,P,T){this.needsTemporalSS()&&this._temporalSS.jitterProjection(M,T)},this)}_.prototype.setProjection=function(d){var v=this.camera;v&&v.update(),d==="perspective"?this.camera instanceof o.a||(this.camera=new o.a,v&&this.camera.setLocalTransform(v.localTransform)):this.camera instanceof i.a||(this.camera=new i.a,v&&this.camera.setLocalTransform(v.localTransform)),this.camera.near=.1,this.camera.far=2e3},_.prototype.setViewport=function(d,v,m,p,y){this.camera instanceof o.a&&(this.camera.aspect=m/p),y=y||1,this.viewport.x=d,this.viewport.y=v,this.viewport.width=m,this.viewport.height=p,this.viewport.devicePixelRatio=y,this._compositor.resize(m*y,p*y),this._temporalSS.resize(m*y,p*y)},_.prototype.containPoint=function(d,v){var m=this.viewport,p=this.layer.renderer.getHeight();return v=p-v,d>=m.x&&v>=m.y&&d<=m.x+m.width&&v<=m.y+m.height};var f=new r.a;_.prototype.castRay=function(d,v,m){var p=this.layer.renderer,y=p.viewport;return p.viewport=this.viewport,p.screenToNDC(d,v,f),this.camera.castRay(f,m),p.viewport=y,m},_.prototype.prepareRender=function(){this.scene.update(),this.camera.update(),this.scene.updateLights();var d=this.scene.updateRenderList(this.camera);this._needsSortProgressively=!1;for(var v=0;v<d.transparent.length;v++){var m=d.transparent[v],p=m.geometry;p.needsSortVerticesProgressively&&p.needsSortVerticesProgressively()&&(this._needsSortProgressively=!0),p.needsSortTrianglesProgressively&&p.needsSortTrianglesProgressively()&&(this._needsSortProgressively=!0)}this._frame=0,this._temporalSS.resetFrame()},_.prototype.render=function(d,v){this._doRender(d,v,this._frame),this._frame++},_.prototype.needsAccumulate=function(){return this.needsTemporalSS()||this._needsSortProgressively},_.prototype.needsTemporalSS=function(){var d=this._enableTemporalSS;return d==="auto"&&(d=this._enablePostEffect),d},_.prototype.hasDOF=function(){return this._enableDOF},_.prototype.isAccumulateFinished=function(){return this.needsTemporalSS()?this._temporalSS.isFinished():this._frame>30},_.prototype._doRender=function(d,v,m){var p=this.scene,y=this.camera;m=m||0,this._updateTransparent(d,p,y,m),v||(this._shadowMapPass.kernelPCF=this._pcfKernels[0],this._shadowMapPass.render(d,p,y,!0)),this._updateShadowPCFKernel(m);var x=d.clearColor;if(d.gl.clearColor(x[0],x[1],x[2],x[3]),this._enablePostEffect&&(this.needsTemporalSS()&&this._temporalSS.jitterProjection(d,y),this._compositor.updateNormal(d,p,y,this._temporalSS.getFrame())),this._updateSSAO(d,p,y,this._temporalSS.getFrame()),this._enablePostEffect){var M=this._compositor.getSourceFrameBuffer();M.bind(d),d.gl.clear(d.gl.DEPTH_BUFFER_BIT|d.gl.COLOR_BUFFER_BIT),d.render(p,y,!0,!0),M.unbind(d),this.needsTemporalSS()&&v?(this._compositor.composite(d,p,y,this._temporalSS.getSourceFrameBuffer(),this._temporalSS.getFrame()),d.setViewport(this.viewport),this._temporalSS.render(d)):(d.setViewport(this.viewport),this._compositor.composite(d,p,y,null,0))}else if(this.needsTemporalSS()&&v){var M=this._temporalSS.getSourceFrameBuffer();M.bind(d),d.saveClear(),d.clearBit=d.gl.DEPTH_BUFFER_BIT|d.gl.COLOR_BUFFER_BIT,d.render(p,y,!0,!0),d.restoreClear(),M.unbind(d),d.setViewport(this.viewport),this._temporalSS.render(d)}else d.setViewport(this.viewport),d.render(p,y,!0,!0)},_.prototype._updateTransparent=function(d,v,m,p){for(var y=new h.a,x=new s.a,M=m.getWorldPosition(),P=v.getRenderList(m).transparent,T=0;T<P.length;T++){var O=P[T],D=O.geometry;s.a.invert(x,O.worldTransform),h.a.transformMat4(y,M,x),D.needsSortTriangles&&D.needsSortTriangles()&&D.doSortTriangles(y,p),D.needsSortVertices&&D.needsSortVertices()&&D.doSortVertices(y,p)}},_.prototype._updateSSAO=function(d,v,m){var p=this._enableSSAO&&this._enablePostEffect;p&&this._compositor.updateSSAO(d,v,m,this._temporalSS.getFrame());for(var y=v.getRenderList(m),x=0;x<y.opaque.length;x++){var M=y.opaque[x];M.renderNormal&&M.material[p?"enableTexture":"disableTexture"]("ssaoMap"),p&&M.material.set("ssaoMap",this._compositor.getSSAOTexture())}},_.prototype._updateShadowPCFKernel=function(d){for(var v=this._pcfKernels[d%this._pcfKernels.length],m=this.scene.getRenderList(this.camera),p=m.opaque,y=0;y<p.length;y++)p[y].receiveShadow&&(p[y].material.set("pcfKernel",v),p[y].material.define("fragment","PCF_KERNEL_SIZE",v.length/2))},_.prototype.dispose=function(d){this._compositor.dispose(d.gl),this._temporalSS.dispose(d.gl),this._shadowMapPass.dispose(d)},_.prototype.setPostEffect=function(d,v){var m=this._compositor;this._enablePostEffect=d.get("enable");var p=d.getModel("bloom"),y=d.getModel("edge"),x=d.getModel("DOF",d.getModel("depthOfField")),M=d.getModel("SSAO",d.getModel("screenSpaceAmbientOcclusion")),P=d.getModel("SSR",d.getModel("screenSpaceReflection")),T=d.getModel("FXAA"),O=d.getModel("colorCorrection");p.get("enable")?m.enableBloom():m.disableBloom(),x.get("enable")?m.enableDOF():m.disableDOF(),P.get("enable")?m.enableSSR():m.disableSSR(),O.get("enable")?m.enableColorCorrection():m.disableColorCorrection(),y.get("enable")?m.enableEdge():m.disableEdge(),T.get("enable")?m.enableFXAA():m.disableFXAA(),this._enableDOF=x.get("enable"),this._enableSSAO=M.get("enable"),this._enableSSAO?m.enableSSAO():m.disableSSAO(),m.setBloomIntensity(p.get("intensity")),m.setEdgeColor(y.get("color")),m.setColorLookupTexture(O.get("lookupTexture"),v),m.setExposure(O.get("exposure")),["radius","quality","intensity"].forEach(function(D){m.setSSAOParameter(D,M.get(D))}),["quality","maxRoughness","physical"].forEach(function(D){m.setSSRParameter(D,P.get(D))}),["quality","focalDistance","focalRange","blurRadius","fstop"].forEach(function(D){m.setDOFParameter(D,x.get(D))}),["brightness","contrast","saturation"].forEach(function(D){m.setColorCorrection(D,O.get(D))})},_.prototype.setDOFFocusOnPoint=function(d){if(this._enablePostEffect)return d>this.camera.far||d<this.camera.near?void 0:(this._compositor.setDOFParameter("focalDistance",d),!0)},_.prototype.setTemporalSuperSampling=function(d){this._enableTemporalSS=d.get("enable")},_.prototype.isLinearSpace=function(){return this._enablePostEffect},_.prototype.setRootNode=function(d){if(this.rootNode!==d){for(var v=this.rootNode.children(),m=0;m<v.length;m++)d.add(v[m]);d!==this.scene&&this.scene.add(d),this.rootNode=d}},_.prototype.add=function(d){this.rootNode.add(d)},_.prototype.remove=function(d){this.rootNode.remove(d)},_.prototype.removeAll=function(d){this.rootNode.removeAll(d)},c.a.util.extend(_.prototype,e.a),R.a=_},function(F,R,g){var E=0,c=Array.prototype,t=c.forEach,a={genGUID:function(){return++E},relative2absolute:function(o,i){if(!i||o.match(/^\//))return o;for(var s=o.split("/"),h=i.split("/"),r=s[0];r==="."||r==="..";)r===".."&&h.pop(),s.shift(),r=s[0];return h.join("/")+"/"+s.join("/")},extend:function(o,i){if(i)for(var s in i)i.hasOwnProperty(s)&&(o[s]=i[s]);return o},defaults:function(o,i){if(i)for(var s in i)o[s]===void 0&&(o[s]=i[s]);return o},extendWithPropList:function(o,i,s){if(i)for(var h=0;h<s.length;h++){var r=s[h];o[r]=i[r]}return o},defaultsWithPropList:function(o,i,s){if(i)for(var h=0;h<s.length;h++){var r=s[h];o[r]==null&&(o[r]=i[r])}return o},each:function(o,i,s){if(!!(o&&i))if(o.forEach&&o.forEach===t)o.forEach(i,s);else if(o.length===+o.length)for(var h=0,r=o.length;h<r;h++)i.call(s,o[h],h,o);else for(var e in o)o.hasOwnProperty(e)&&i.call(s,o[e],e,o)},isObject:function(o){return o===Object(o)},isArray:function(o){return Array.isArray(o)},isArrayLike:function(o){return o?o.length===+o.length:!1},clone:function(o){if(a.isObject(o)){if(a.isArray(o))return o.slice();if(a.isArrayLike(o)){for(var i=new o.constructor(o.length),s=0;s<o.length;s++)i[s]=o[s];return i}else return a.extend({},o)}else return o}};R.a=a},function(F,R,g){var E=g(35),c=g(9),t=g(118);c.a.import(t.a);var a=E.a.extend(function(){return{color:[1,1,1],intensity:1,castShadow:!0,shadowResolution:512,group:0}},{type:"",clone:function(){var o=E.a.prototype.clone.call(this);return o.color=Array.prototype.slice.call(this.color),o.intensity=this.intensity,o.castShadow=this.castShadow,o.shadowResolution=this.shadowResolution,o}});R.a=a},function(F,R,g){var E=g(14),c=g(0),t=g.n(c),a=g(39),o=g(6),i=o.a.vec3,s=[[0,0],[1,1]],h=E.a.extend(function(){return{segmentScale:1,dynamic:!0,useNativeLine:!0,attributes:{position:new E.a.Attribute("position","float",3,"POSITION"),positionPrev:new E.a.Attribute("positionPrev","float",3),positionNext:new E.a.Attribute("positionNext","float",3),prevPositionPrev:new E.a.Attribute("prevPositionPrev","float",3),prevPosition:new E.a.Attribute("prevPosition","float",3),prevPositionNext:new E.a.Attribute("prevPositionNext","float",3),offset:new E.a.Attribute("offset","float",1),color:new E.a.Attribute("color","float",4,"COLOR")}}},{resetOffset:function(){this._vertexOffset=0,this._triangleOffset=0,this._itemVertexOffsets=[]},setVertexCount:function(r){var e=this.attributes;this.vertexCount!==r&&(e.position.init(r),e.color.init(r),this.useNativeLine||(e.positionPrev.init(r),e.positionNext.init(r),e.offset.init(r)),r>65535?this.indices instanceof Uint16Array&&(this.indices=new Uint32Array(this.indices)):this.indices instanceof Uint32Array&&(this.indices=new Uint16Array(this.indices)))},setTriangleCount:function(r){this.triangleCount!==r&&(r===0?this.indices=null:this.indices=this.vertexCount>65535?new Uint32Array(r*3):new Uint16Array(r*3))},_getCubicCurveApproxStep:function(r,e,n,l){var u=i.dist(r,e)+i.dist(n,e)+i.dist(l,n),_=1/(u+1)*this.segmentScale;return _},getCubicCurveVertexCount:function(r,e,n,l){var u=this._getCubicCurveApproxStep(r,e,n,l),_=Math.ceil(1/u);return this.useNativeLine?_*2:_*2+2},getCubicCurveTriangleCount:function(r,e,n,l){var u=this._getCubicCurveApproxStep(r,e,n,l),_=Math.ceil(1/u);return this.useNativeLine?0:_*2},getLineVertexCount:function(){return this.getPolylineVertexCount(s)},getLineTriangleCount:function(){return this.getPolylineTriangleCount(s)},getPolylineVertexCount:function(r){var e;if(typeof r=="number")e=r;else{var n=typeof r[0]!="number";e=n?r.length:r.length/3}return this.useNativeLine?(e-1)*2:(e-1)*2+2},getPolylineTriangleCount:function(r){var e;if(typeof r=="number")e=r;else{var n=typeof r[0]!="number";e=n?r.length:r.length/3}return this.useNativeLine?0:Math.max(e-1,0)*2},addCubicCurve:function(r,e,n,l,u,_){_==null&&(_=1);for(var f=r[0],d=r[1],v=r[2],m=e[0],p=e[1],y=e[2],x=n[0],M=n[1],P=n[2],T=l[0],O=l[1],D=l[2],A=this._getCubicCurveApproxStep(r,e,n,l),C=A*A,S=C*A,L=3*A,I=3*C,w=6*C,b=6*S,B=f-m*2+x,U=d-p*2+M,W=v-y*2+P,z=(m-x)*3-f+T,G=(p-M)*3-d+O,H=(y-P)*3-v+D,X=f,Q=d,j=v,J=(m-f)*L+B*I+z*S,Y=(p-d)*L+U*I+G*S,at=(y-v)*L+W*I+H*S,ot=B*w+z*b,ut=U*w+G*b,et=W*w+H*b,ht=z*b,ft=G*b,it=H*b,N=0,K=0,Z=Math.ceil(1/A),V=new Float32Array((Z+1)*3),V=[],k=0,K=0;K<Z+1;K++)V[k++]=X,V[k++]=Q,V[k++]=j,X+=J,Q+=Y,j+=at,J+=ot,Y+=ut,at+=et,ot+=ht,ut+=ft,et+=it,N+=A,N>1&&(X=J>0?Math.min(X,T):Math.max(X,T),Q=Y>0?Math.min(Q,O):Math.max(Q,O),j=at>0?Math.min(j,D):Math.max(j,D));return this.addPolyline(V,u,_)},addLine:function(r,e,n,l){return this.addPolyline([r,e],n,l)},addPolyline:function(r,e,n,l,u){if(!!r.length){var _=typeof r[0]!="number";if(u==null&&(u=_?r.length:r.length/3),!(u<2)){l==null&&(l=0),n==null&&(n=1),this._itemVertexOffsets.push(this._vertexOffset);var _=typeof r[0]!="number",f=_?typeof e[0]!="number":e.length/4===u,d=this.attributes.position,v=this.attributes.positionPrev,m=this.attributes.positionNext,p=this.attributes.color,y=this.attributes.offset,x=this.indices,M=this._vertexOffset,P,T;n=Math.max(n,.01);for(var O=l;O<u;O++){if(_)P=r[O],f?T=e[O]:T=e;else{var D=O*3;if(P=P||[],P[0]=r[D],P[1]=r[D+1],P[2]=r[D+2],f){var A=O*4;T=T||[],T[0]=e[A],T[1]=e[A+1],T[2]=e[A+2],T[3]=e[A+3]}else T=e}if(this.useNativeLine?O>1&&(d.copy(M,M-1),p.copy(M,M-1),M++):(O<u-1&&(v.set(M+2,P),v.set(M+3,P)),O>0&&(m.set(M-2,P),m.set(M-1,P)),d.set(M,P),d.set(M+1,P),p.set(M,T),p.set(M+1,T),y.set(M,n/2),y.set(M+1,-n/2),M+=2),this.useNativeLine)p.set(M,T),d.set(M,P),M++;else if(O>0){var C=this._triangleOffset*3,x=this.indices;x[C]=M-4,x[C+1]=M-3,x[C+2]=M-2,x[C+3]=M-3,x[C+4]=M-1,x[C+5]=M-2,this._triangleOffset+=2}}if(!this.useNativeLine){var S=this._vertexOffset,L=this._vertexOffset+u*2;v.copy(S,S+2),v.copy(S+1,S+3),m.copy(L-1,L-3),m.copy(L-2,L-4)}return this._vertexOffset=M,this._vertexOffset}}},setItemColor:function(r,e){for(var n=this._itemVertexOffsets[r],l=r<this._itemVertexOffsets.length-1?this._itemVertexOffsets[r+1]:this._vertexOffset,u=n;u<l;u++)this.attributes.color.set(u,e);this.dirty("color")},currentTriangleOffset:function(){return this._triangleOffset},currentVertexOffset:function(){return this._vertexOffset}});t.a.util.defaults(h.prototype,a.a),R.a=h},function(F,R,g){var E=g(69),c=function(a,o){a=a||0,o=o||0,this.array=E.a.fromValues(a,o),this._dirty=!0};if(c.prototype={constructor:c,add:function(a){return E.a.add(this.array,this.array,a.array),this._dirty=!0,this},set:function(a,o){return this.array[0]=a,this.array[1]=o,this._dirty=!0,this},setArray:function(a){return this.array[0]=a[0],this.array[1]=a[1],this._dirty=!0,this},clone:function(){return new c(this.x,this.y)},copy:function(a){return E.a.copy(this.array,a.array),this._dirty=!0,this},cross:function(a,o){return E.a.cross(a.array,this.array,o.array),a._dirty=!0,this},dist:function(a){return E.a.dist(this.array,a.array)},distance:function(a){return E.a.distance(this.array,a.array)},div:function(a){return E.a.div(this.array,this.array,a.array),this._dirty=!0,this},divide:function(a){return E.a.divide(this.array,this.array,a.array),this._dirty=!0,this},dot:function(a){return E.a.dot(this.array,a.array)},len:function(){return E.a.len(this.array)},length:function(){return E.a.length(this.array)},lerp:function(a,o,i){return E.a.lerp(this.array,a.array,o.array,i),this._dirty=!0,this},min:function(a){return E.a.min(this.array,this.array,a.array),this._dirty=!0,this},max:function(a){return E.a.max(this.array,this.array,a.array),this._dirty=!0,this},mul:function(a){return E.a.mul(this.array,this.array,a.array),this._dirty=!0,this},multiply:function(a){return E.a.multiply(this.array,this.array,a.array),this._dirty=!0,this},negate:function(){return E.a.negate(this.array,this.array),this._dirty=!0,this},normalize:function(){return E.a.normalize(this.array,this.array),this._dirty=!0,this},random:function(a){return E.a.random(this.array,a),this._dirty=!0,this},scale:function(a){return E.a.scale(this.array,this.array,a),this._dirty=!0,this},scaleAndAdd:function(a,o){return E.a.scaleAndAdd(this.array,this.array,a.array,o),this._dirty=!0,this},sqrDist:function(a){return E.a.sqrDist(this.array,a.array)},squaredDistance:function(a){return E.a.squaredDistance(this.array,a.array)},sqrLen:function(){return E.a.sqrLen(this.array)},squaredLength:function(){return E.a.squaredLength(this.array)},sub:function(a){return E.a.sub(this.array,this.array,a.array),this._dirty=!0,this},subtract:function(a){return E.a.subtract(this.array,this.array,a.array),this._dirty=!0,this},transformMat2:function(a){return E.a.transformMat2(this.array,this.array,a.array),this._dirty=!0,this},transformMat2d:function(a){return E.a.transformMat2d(this.array,this.array,a.array),this._dirty=!0,this},transformMat3:function(a){return E.a.transformMat3(this.array,this.array,a.array),this._dirty=!0,this},transformMat4:function(a){return E.a.transformMat4(this.array,this.array,a.array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}},Object.defineProperty){var t=c.prototype;Object.defineProperty(t,"x",{get:function(){return this.array[0]},set:function(a){this.array[0]=a,this._dirty=!0}}),Object.defineProperty(t,"y",{get:function(){return this.array[1]},set:function(a){this.array[1]=a,this._dirty=!0}})}c.add=function(a,o,i){return E.a.add(a.array,o.array,i.array),a._dirty=!0,a},c.set=function(a,o,i){return E.a.set(a.array,o,i),a._dirty=!0,a},c.copy=function(a,o){return E.a.copy(a.array,o.array),a._dirty=!0,a},c.cross=function(a,o,i){return E.a.cross(a.array,o.array,i.array),a._dirty=!0,a},c.dist=function(a,o){return E.a.distance(a.array,o.array)},c.distance=c.dist,c.div=function(a,o,i){return E.a.divide(a.array,o.array,i.array),a._dirty=!0,a},c.divide=c.div,c.dot=function(a,o){return E.a.dot(a.array,o.array)},c.len=function(a){return E.a.length(a.array)},c.lerp=function(a,o,i,s){return E.a.lerp(a.array,o.array,i.array,s),a._dirty=!0,a},c.min=function(a,o,i){return E.a.min(a.array,o.array,i.array),a._dirty=!0,a},c.max=function(a,o,i){return E.a.max(a.array,o.array,i.array),a._dirty=!0,a},c.mul=function(a,o,i){return E.a.multiply(a.array,o.array,i.array),a._dirty=!0,a},c.multiply=c.mul,c.negate=function(a,o){return E.a.negate(a.array,o.array),a._dirty=!0,a},c.normalize=function(a,o){return E.a.normalize(a.array,o.array),a._dirty=!0,a},c.random=function(a,o){return E.a.random(a.array,o),a._dirty=!0,a},c.scale=function(a,o,i){return E.a.scale(a.array,o.array,i),a._dirty=!0,a},c.scaleAndAdd=function(a,o,i,s){return E.a.scaleAndAdd(a.array,o.array,i.array,s),a._dirty=!0,a},c.sqrDist=function(a,o){return E.a.sqrDist(a.array,o.array)},c.squaredDistance=c.sqrDist,c.sqrLen=function(a){return E.a.sqrLen(a.array)},c.squaredLength=c.sqrLen,c.sub=function(a,o,i){return E.a.subtract(a.array,o.array,i.array),a._dirty=!0,a},c.subtract=c.sub,c.transformMat2=function(a,o,i){return E.a.transformMat2(a.array,o.array,i.array),a._dirty=!0,a},c.transformMat2d=function(a,o,i){return E.a.transformMat2d(a.array,o.array,i.array),a._dirty=!0,a},c.transformMat3=function(a,o,i){return E.a.transformMat3(a.array,o.array,i.array),a._dirty=!0,a},c.transformMat4=function(a,o,i){return E.a.transformMat4(a.array,o.array,i.array),a._dirty=!0,a},R.a=c},function(F,R,g){var E=g(4),c=g(11),t=g(23),a=g(72),o=g(13),i=a.a.isPowerOfTwo,s=["px","nx","py","ny","pz","nz"],h=E.a.extend(function(){return{image:{px:null,nx:null,py:null,ny:null,pz:null,nz:null},pixels:{px:null,nx:null,py:null,ny:null,pz:null,nz:null},mipmaps:[]}},{textureType:"textureCube",update:function(e){var n=e.gl;n.bindTexture(n.TEXTURE_CUBE_MAP,this._cache.get("webgl_texture")),this.updateCommon(e);var l=this.format,u=this.type;n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_S,this.getAvailableWrapS()),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_T,this.getAvailableWrapT()),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,this.getAvailableMagFilter()),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,this.getAvailableMinFilter());var _=e.getGLExtension("EXT_texture_filter_anisotropic");if(_&&this.anisotropic>1&&n.texParameterf(n.TEXTURE_CUBE_MAP,_.TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropic),u===36193){var f=e.getGLExtension("OES_texture_half_float");f||(u=c.a.FLOAT)}if(this.mipmaps.length)for(var d=this.width,v=this.height,m=0;m<this.mipmaps.length;m++){var p=this.mipmaps[m];this._updateTextureData(n,p,m,d,v,l,u),d/=2,v/=2}else this._updateTextureData(n,this,0,this.width,this.height,l,u),!this.NPOT&&this.useMipmap&&n.generateMipmap(n.TEXTURE_CUBE_MAP);n.bindTexture(n.TEXTURE_CUBE_MAP,null)},_updateTextureData:function(e,n,l,u,_,f,d){for(var v=0;v<6;v++){var m=s[v],p=n.image&&n.image[m];p?e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+v,l,f,f,d,p):e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+v,l,f,u,_,0,f,d,n.pixels&&n.pixels[m])}},generateMipmap:function(e){var n=e.gl;this.useMipmap&&!this.NPOT&&(n.bindTexture(n.TEXTURE_CUBE_MAP,this._cache.get("webgl_texture")),n.generateMipmap(n.TEXTURE_CUBE_MAP))},bind:function(e){e.gl.bindTexture(e.gl.TEXTURE_CUBE_MAP,this.getWebGLTexture(e))},unbind:function(e){e.gl.bindTexture(e.gl.TEXTURE_CUBE_MAP,null)},isPowerOfTwo:function(){return this.image.px?i(this.image.px.width)&&i(this.image.px.height):i(this.width)&&i(this.height)},isRenderable:function(){return this.image.px?r(this.image.px)&&r(this.image.nx)&&r(this.image.py)&&r(this.image.ny)&&r(this.image.pz)&&r(this.image.nz):!!(this.width&&this.height)},load:function(e,n){var l=0,u=this;return t.a.each(e,function(_,f){var d=o.a.createImage();n&&(d.crossOrigin=n),d.onload=function(){l--,l===0&&(u.dirty(),u.trigger("success",u))},d.onerror=function(){l--},l++,d.src=_,u.image[f]=d}),this}});Object.defineProperty(h.prototype,"width",{get:function(){return this.image&&this.image.px?this.image.px.width:this._width},set:function(e){this.image&&this.image.px?console.warn("Texture from image can't set width"):(this._width!==e&&this.dirty(),this._width=e)}}),Object.defineProperty(h.prototype,"height",{get:function(){return this.image&&this.image.px?this.image.px.height:this._height},set:function(e){this.image&&this.image.px?console.warn("Texture from image can't set height"):(this._height!==e&&this.dirty(),this._height=e)}});function r(e){return e.width>0&&e.height>0}R.a=h},function(F,R,g){R.a={defaultOption:{postEffect:{enable:!1,bloom:{enable:!0,intensity:.1},depthOfField:{enable:!1,focalRange:20,focalDistance:50,blurRadius:10,fstop:2.8,quality:"medium"},screenSpaceAmbientOcclusion:{enable:!1,radius:2,quality:"medium",intensity:1},screenSpaceReflection:{enable:!1,quality:"medium",maxRoughness:.8},colorCorrection:{enable:!0,exposure:0,brightness:0,contrast:1,saturation:1,lookupTexture:""},edge:{enable:!1},FXAA:{enable:!1}},temporalSuperSampling:{enable:"auto"}}}},function(F,R,g){R.a={defaultOption:{light:{main:{shadow:!1,shadowQuality:"high",color:"#fff",intensity:1,alpha:0,beta:0},ambient:{color:"#fff",intensity:.2},ambientCubemap:{texture:null,exposure:1,diffuseIntensity:.5,specularIntensity:.5}}}}},function(F,R,g){var E=g(1),c=g(42),t=g(0),a=g.n(t);function o(){}o.prototype={constructor:o,setScene:function(i){this._scene=i,this._skybox&&this._skybox.attachScene(this._scene)},initLight:function(i){this._lightRoot=i,this.mainLight=new E.a.DirectionalLight({shadowBias:.005}),this.ambientLight=new E.a.AmbientLight,i.add(this.mainLight),i.add(this.ambientLight)},dispose:function(){this._lightRoot&&(this._lightRoot.remove(this.mainLight),this._lightRoot.remove(this.ambientLight))},updateLight:function(i){var s=this.mainLight,h=this.ambientLight,r=i.getModel("light"),e=r.getModel("main"),n=r.getModel("ambient");s.intensity=e.get("intensity"),h.intensity=n.get("intensity"),s.color=E.a.parseColor(e.get("color")).slice(0,3),h.color=E.a.parseColor(n.get("color")).slice(0,3);var l=e.get("alpha")||0,u=e.get("beta")||0;s.position.setArray(E.a.directionFromAlphaBeta(l,u)),s.lookAt(E.a.Vector3.ZERO),s.castShadow=e.get("shadow"),s.shadowResolution=E.a.getShadowResolution(e.get("shadowQuality"))},updateAmbientCubemap:function(i,s,h){var r=s.getModel("light.ambientCubemap"),e=r.get("texture");if(e){this._cubemapLightsCache=this._cubemapLightsCache||{};var n=this._cubemapLightsCache[e];if(!n){var l=this;n=this._cubemapLightsCache[e]=E.a.createAmbientCubemap(r.option,i,h,function(){l._isSkyboxFromAmbientCubemap&&l._skybox.setEnvironmentMap(n.specular.cubemap),h.getZr().refresh()})}this._lightRoot.add(n.diffuse),this._lightRoot.add(n.specular),this._currentCubemapLights=n}else this._currentCubemapLights&&(this._lightRoot.remove(this._currentCubemapLights.diffuse),this._lightRoot.remove(this._currentCubemapLights.specular),this._currentCubemapLights=null)},updateSkybox:function(i,s,h){var r=s.get("environment"),e=this;function n(){return e._skybox=e._skybox||new c.a,e._skybox}var l=n();if(r&&r!=="none")if(r==="auto")if(this._isSkyboxFromAmbientCubemap=!0,this._currentCubemapLights){var u=this._currentCubemapLights.specular.cubemap;l.setEnvironmentMap(u),this._scene&&l.attachScene(this._scene),l.material.set("lod",3)}else this._skybox&&this._skybox.detachScene();else if(typeof r=="object"&&r.colorStops||typeof r=="string"&&a.a.color.parse(r)){this._isSkyboxFromAmbientCubemap=!1;var _=new E.a.Texture2D({anisotropic:8,flipY:!1});l.setEnvironmentMap(_);var f=_.image=document.createElement("canvas");f.width=f.height=16;var d=f.getContext("2d"),v=new a.a.graphic.Rect({shape:{x:0,y:0,width:16,height:16},style:{fill:r}});v.brush(d),l.attachScene(this._scene)}else{this._isSkyboxFromAmbientCubemap=!1;var _=E.a.loadTexture(r,h,{anisotropic:8,flipY:!1});l.setEnvironmentMap(_),l.attachScene(this._scene)}else this._skybox&&this._skybox.detachScene(this._scene),this._skybox=null;var m=s.coordinateSystem;if(this._skybox)if(m&&m.viewGL&&r!=="auto"&&!(r.match&&r.match(/.hdr$/))){var p=m.viewGL.isLinearSpace()?"define":"undefine";this._skybox.material[p]("fragment","SRGB_DECODE")}else this._skybox.material.undefine("fragment","SRGB_DECODE")}},R.a=o},function(F,R,g){R.a={defaultOption:{shading:null,realisticMaterial:{textureTiling:1,textureOffset:0,detailTexture:null},lambertMaterial:{textureTiling:1,textureOffset:0,detailTexture:null},colorMaterial:{textureTiling:1,textureOffset:0,detailTexture:null},hatchingMaterial:{textureTiling:1,textureOffset:0,paperColor:"#fff"}}}},function(F,R,g){var E=g(0),c=g.n(E),t={};t.getFormattedLabel=function(a,o,i,s,h){i=i||"normal";var r=a.getData(s),e=r.getItemModel(o),n=a.getDataParams(o,s);h!=null&&n.value instanceof Array&&(n.value=n.value[h]);var l=e.get(i==="normal"?["label","formatter"]:["emphasis","label","formatter"]);l==null&&(l=e.get(["label","formatter"]));var u;return typeof l=="function"?(n.status=i,u=l(n)):typeof l=="string"&&(u=c.a.format.formatTpl(l,n)),u},t.normalizeToArray=function(a){return a instanceof Array?a:a==null?[]:[a]},R.a=t},function(F,R,g){var E=g(20),c={};c.create=function(){var t=new E.a(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},c.clone=function(t){var a=new E.a(4);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a},c.fromValues=function(t,a,o,i){var s=new E.a(4);return s[0]=t,s[1]=a,s[2]=o,s[3]=i,s},c.copy=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t},c.set=function(t,a,o,i,s){return t[0]=a,t[1]=o,t[2]=i,t[3]=s,t},c.add=function(t,a,o){return t[0]=a[0]+o[0],t[1]=a[1]+o[1],t[2]=a[2]+o[2],t[3]=a[3]+o[3],t},c.subtract=function(t,a,o){return t[0]=a[0]-o[0],t[1]=a[1]-o[1],t[2]=a[2]-o[2],t[3]=a[3]-o[3],t},c.sub=c.subtract,c.multiply=function(t,a,o){return t[0]=a[0]*o[0],t[1]=a[1]*o[1],t[2]=a[2]*o[2],t[3]=a[3]*o[3],t},c.mul=c.multiply,c.divide=function(t,a,o){return t[0]=a[0]/o[0],t[1]=a[1]/o[1],t[2]=a[2]/o[2],t[3]=a[3]/o[3],t},c.div=c.divide,c.min=function(t,a,o){return t[0]=Math.min(a[0],o[0]),t[1]=Math.min(a[1],o[1]),t[2]=Math.min(a[2],o[2]),t[3]=Math.min(a[3],o[3]),t},c.max=function(t,a,o){return t[0]=Math.max(a[0],o[0]),t[1]=Math.max(a[1],o[1]),t[2]=Math.max(a[2],o[2]),t[3]=Math.max(a[3],o[3]),t},c.scale=function(t,a,o){return t[0]=a[0]*o,t[1]=a[1]*o,t[2]=a[2]*o,t[3]=a[3]*o,t},c.scaleAndAdd=function(t,a,o,i){return t[0]=a[0]+o[0]*i,t[1]=a[1]+o[1]*i,t[2]=a[2]+o[2]*i,t[3]=a[3]+o[3]*i,t},c.distance=function(t,a){var o=a[0]-t[0],i=a[1]-t[1],s=a[2]-t[2],h=a[3]-t[3];return Math.sqrt(o*o+i*i+s*s+h*h)},c.dist=c.distance,c.squaredDistance=function(t,a){var o=a[0]-t[0],i=a[1]-t[1],s=a[2]-t[2],h=a[3]-t[3];return o*o+i*i+s*s+h*h},c.sqrDist=c.squaredDistance,c.length=function(t){var a=t[0],o=t[1],i=t[2],s=t[3];return Math.sqrt(a*a+o*o+i*i+s*s)},c.len=c.length,c.squaredLength=function(t){var a=t[0],o=t[1],i=t[2],s=t[3];return a*a+o*o+i*i+s*s},c.sqrLen=c.squaredLength,c.negate=function(t,a){return t[0]=-a[0],t[1]=-a[1],t[2]=-a[2],t[3]=-a[3],t},c.inverse=function(t,a){return t[0]=1/a[0],t[1]=1/a[1],t[2]=1/a[2],t[3]=1/a[3],t},c.normalize=function(t,a){var o=a[0],i=a[1],s=a[2],h=a[3],r=o*o+i*i+s*s+h*h;return r>0&&(r=1/Math.sqrt(r),t[0]=a[0]*r,t[1]=a[1]*r,t[2]=a[2]*r,t[3]=a[3]*r),t},c.dot=function(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]+t[3]*a[3]},c.lerp=function(t,a,o,i){var s=a[0],h=a[1],r=a[2],e=a[3];return t[0]=s+i*(o[0]-s),t[1]=h+i*(o[1]-h),t[2]=r+i*(o[2]-r),t[3]=e+i*(o[3]-e),t},c.random=function(t,a){return a=a||1,t[0]=Object(E.c)(),t[1]=Object(E.c)(),t[2]=Object(E.c)(),t[3]=Object(E.c)(),c.normalize(t,t),c.scale(t,t,a),t},c.transformMat4=function(t,a,o){var i=a[0],s=a[1],h=a[2],r=a[3];return t[0]=o[0]*i+o[4]*s+o[8]*h+o[12]*r,t[1]=o[1]*i+o[5]*s+o[9]*h+o[13]*r,t[2]=o[2]*i+o[6]*s+o[10]*h+o[14]*r,t[3]=o[3]*i+o[7]*s+o[11]*h+o[15]*r,t},c.transformQuat=function(t,a,o){var i=a[0],s=a[1],h=a[2],r=o[0],e=o[1],n=o[2],l=o[3],u=l*i+e*h-n*s,_=l*s+n*i-r*h,f=l*h+r*s-e*i,d=-r*i-e*s-n*h;return t[0]=u*l+d*-r+_*-n-f*-e,t[1]=_*l+d*-e+f*-r-u*-n,t[2]=f*l+d*-n+u*-e-_*-r,t},c.forEach=function(){var t=c.create();return function(a,o,i,s,h,r){var e,n;for(o||(o=4),i||(i=0),s?n=Math.min(s*o+i,a.length):n=a.length,e=i;e<n;e+=o)t[0]=a[e],t[1]=a[e+1],t[2]=a[e+2],t[3]=a[e+3],h(t,t,r),a[e]=t[0],a[e+1]=t[1],a[e+2]=t[2],a[e+3]=t[3];return a}}(),R.a=c},function(F,R,g){var E=g(20),c={};c.create=function(){var t=new E.a(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},c.fromMat4=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[4],t[4]=a[5],t[5]=a[6],t[6]=a[8],t[7]=a[9],t[8]=a[10],t},c.clone=function(t){var a=new E.a(9);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a},c.copy=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t},c.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},c.transpose=function(t,a){if(t===a){var o=a[1],i=a[2],s=a[5];t[1]=a[3],t[2]=a[6],t[3]=o,t[5]=a[7],t[6]=i,t[7]=s}else t[0]=a[0],t[1]=a[3],t[2]=a[6],t[3]=a[1],t[4]=a[4],t[5]=a[7],t[6]=a[2],t[7]=a[5],t[8]=a[8];return t},c.invert=function(t,a){var o=a[0],i=a[1],s=a[2],h=a[3],r=a[4],e=a[5],n=a[6],l=a[7],u=a[8],_=u*r-e*l,f=-u*h+e*n,d=l*h-r*n,v=o*_+i*f+s*d;return v?(v=1/v,t[0]=_*v,t[1]=(-u*i+s*l)*v,t[2]=(e*i-s*r)*v,t[3]=f*v,t[4]=(u*o-s*n)*v,t[5]=(-e*o+s*h)*v,t[6]=d*v,t[7]=(-l*o+i*n)*v,t[8]=(r*o-i*h)*v,t):null},c.adjoint=function(t,a){var o=a[0],i=a[1],s=a[2],h=a[3],r=a[4],e=a[5],n=a[6],l=a[7],u=a[8];return t[0]=r*u-e*l,t[1]=s*l-i*u,t[2]=i*e-s*r,t[3]=e*n-h*u,t[4]=o*u-s*n,t[5]=s*h-o*e,t[6]=h*l-r*n,t[7]=i*n-o*l,t[8]=o*r-i*h,t},c.determinant=function(t){var a=t[0],o=t[1],i=t[2],s=t[3],h=t[4],r=t[5],e=t[6],n=t[7],l=t[8];return a*(l*h-r*n)+o*(-l*s+r*e)+i*(n*s-h*e)},c.multiply=function(t,a,o){var i=a[0],s=a[1],h=a[2],r=a[3],e=a[4],n=a[5],l=a[6],u=a[7],_=a[8],f=o[0],d=o[1],v=o[2],m=o[3],p=o[4],y=o[5],x=o[6],M=o[7],P=o[8];return t[0]=f*i+d*r+v*l,t[1]=f*s+d*e+v*u,t[2]=f*h+d*n+v*_,t[3]=m*i+p*r+y*l,t[4]=m*s+p*e+y*u,t[5]=m*h+p*n+y*_,t[6]=x*i+M*r+P*l,t[7]=x*s+M*e+P*u,t[8]=x*h+M*n+P*_,t},c.mul=c.multiply,c.translate=function(t,a,o){var i=a[0],s=a[1],h=a[2],r=a[3],e=a[4],n=a[5],l=a[6],u=a[7],_=a[8],f=o[0],d=o[1];return t[0]=i,t[1]=s,t[2]=h,t[3]=r,t[4]=e,t[5]=n,t[6]=f*i+d*r+l,t[7]=f*s+d*e+u,t[8]=f*h+d*n+_,t},c.rotate=function(t,a,o){var i=a[0],s=a[1],h=a[2],r=a[3],e=a[4],n=a[5],l=a[6],u=a[7],_=a[8],f=Math.sin(o),d=Math.cos(o);return t[0]=d*i+f*r,t[1]=d*s+f*e,t[2]=d*h+f*n,t[3]=d*r-f*i,t[4]=d*e-f*s,t[5]=d*n-f*h,t[6]=l,t[7]=u,t[8]=_,t},c.scale=function(t,a,o){var i=o[0],s=o[1];return t[0]=i*a[0],t[1]=i*a[1],t[2]=i*a[2],t[3]=s*a[3],t[4]=s*a[4],t[5]=s*a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t},c.fromMat2d=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=0,t[3]=a[2],t[4]=a[3],t[5]=0,t[6]=a[4],t[7]=a[5],t[8]=1,t},c.fromQuat=function(t,a){var o=a[0],i=a[1],s=a[2],h=a[3],r=o+o,e=i+i,n=s+s,l=o*r,u=i*r,_=i*e,f=s*r,d=s*e,v=s*n,m=h*r,p=h*e,y=h*n;return t[0]=1-_-v,t[3]=u-y,t[6]=f+p,t[1]=u+y,t[4]=1-l-v,t[7]=d-m,t[2]=f-p,t[5]=d+m,t[8]=1-l-_,t},c.normalFromMat4=function(t,a){var o=a[0],i=a[1],s=a[2],h=a[3],r=a[4],e=a[5],n=a[6],l=a[7],u=a[8],_=a[9],f=a[10],d=a[11],v=a[12],m=a[13],p=a[14],y=a[15],x=o*e-i*r,M=o*n-s*r,P=o*l-h*r,T=i*n-s*e,O=i*l-h*e,D=s*l-h*n,A=u*m-_*v,C=u*p-f*v,S=u*y-d*v,L=_*p-f*m,I=_*y-d*m,w=f*y-d*p,b=x*w-M*I+P*L+T*S-O*C+D*A;return b?(b=1/b,t[0]=(e*w-n*I+l*L)*b,t[1]=(n*S-r*w-l*C)*b,t[2]=(r*I-e*S+l*A)*b,t[3]=(s*I-i*w-h*L)*b,t[4]=(o*w-s*S+h*C)*b,t[5]=(i*S-o*I-h*A)*b,t[6]=(m*D-p*O+y*T)*b,t[7]=(p*P-v*D-y*M)*b,t[8]=(v*O-m*P+y*x)*b,t):null},c.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},R.a=c},function(F,R,g){var E=g(8),c=g(3),t=g(56),a=g(7),o=g(21),i=g(18),s=0,h=E.a.extend({name:"",position:null,rotation:null,scale:null,worldTransform:null,localTransform:null,autoUpdateLocalTransform:!0,_parent:null,_scene:null,_needsUpdateWorldTransform:!0,_inIterating:!1,__depth:0},function(){this.name||(this.name=(this.type||"NODE")+"_"+s++),this.position||(this.position=new c.a),this.rotation||(this.rotation=new t.a),this.scale||(this.scale=new c.a(1,1,1)),this.worldTransform=new a.a,this.localTransform=new a.a,this._children=[]},{target:null,invisible:!1,isSkinnedMesh:function(){return!1},isRenderable:function(){return!1},setName:function(r){var e=this._scene;if(e){var n=e._nodeRepository;delete n[this.name],n[r]=this}this.name=r},add:function(r){var e=r._parent;if(e!==this){e&&e.remove(r),r._parent=this,this._children.push(r);var n=this._scene;n&&n!==r.scene&&r.traverse(this._addSelfToScene,this),r._needsUpdateWorldTransform=!0}},remove:function(r){var e=this._children,n=e.indexOf(r);n<0||(e.splice(n,1),r._parent=null,this._scene&&r.traverse(this._removeSelfFromScene,this))},removeAll:function(){for(var r=this._children,e=0;e<r.length;e++)r[e]._parent=null,this._scene&&r[e].traverse(this._removeSelfFromScene,this);this._children=[]},getScene:function(){return this._scene},getParent:function(){return this._parent},_removeSelfFromScene:function(r){r._scene.removeFromScene(r),r._scene=null},_addSelfToScene:function(r){this._scene.addToScene(r),r._scene=this._scene},isAncestor:function(r){for(var e=r._parent;e;){if(e===this)return!0;e=e._parent}return!1},children:function(){return this._children.slice()},childAt:function(r){return this._children[r]},getChildByName:function(r){for(var e=this._children,n=0;n<e.length;n++)if(e[n].name===r)return e[n]},getDescendantByName:function(r){for(var e=this._children,n=0;n<e.length;n++){var l=e[n];if(l.name===r)return l;var u=l.getDescendantByName(r);if(u)return u}},queryNode:function(r){if(!!r){for(var e=r.split("/"),n=this,l=0;l<e.length;l++){var u=e[l];if(!!u){for(var _=!1,f=n._children,d=0;d<f.length;d++){var v=f[d];if(v.name===u){n=v,_=!0;break}}if(!_)return}}return n}},getPath:function(r){if(!this._parent)return"/";for(var e=this._parent,n=this.name;e._parent&&(n=e.name+"/"+n,e._parent!=r);)e=e._parent;return!e._parent&&r?null:n},traverse:function(r,e){r.call(e,this);for(var n=this._children,l=0,u=n.length;l<u;l++)n[l].traverse(r,e)},eachChild:function(r,e){for(var n=this._children,l=0,u=n.length;l<u;l++){var _=n[l];r.call(e,_,l)}},setLocalTransform:function(r){o.a.copy(this.localTransform.array,r.array),this.decomposeLocalTransform()},decomposeLocalTransform:function(r){var e=r?null:this.scale;this.localTransform.decomposeMatrix(e,this.rotation,this.position)},setWorldTransform:function(r){o.a.copy(this.worldTransform.array,r.array),this.decomposeWorldTransform()},decomposeWorldTransform:function(){var r=o.a.create();return function(e){var n=this.localTransform,l=this.worldTransform;this._parent?(o.a.invert(r,this._parent.worldTransform.array),o.a.multiply(n.array,r,l.array)):o.a.copy(n.array,l.array);var u=e?null:this.scale;n.decomposeMatrix(u,this.rotation,this.position)}}(),transformNeedsUpdate:function(){return this.position._dirty||this.rotation._dirty||this.scale._dirty},updateLocalTransform:function(){var r=this.position,e=this.rotation,n=this.scale;if(this.transformNeedsUpdate()){var l=this.localTransform.array;o.a.fromRotationTranslation(l,e.array,r.array),o.a.scale(l,l,n.array),e._dirty=!1,n._dirty=!1,r._dirty=!1,this._needsUpdateWorldTransform=!0}},_updateWorldTransformTopDown:function(){var r=this.localTransform.array,e=this.worldTransform.array;this._parent?o.a.multiplyAffine(e,this._parent.worldTransform.array,r):o.a.copy(e,r)},updateWorldTransform:function(){for(var r=this;r&&r.getParent()&&r.getParent().transformNeedsUpdate();)r=r.getParent();r.update()},update:function(r){this.autoUpdateLocalTransform?this.updateLocalTransform():r=!0,(r||this._needsUpdateWorldTransform)&&(this._updateWorldTransformTopDown(),r=!0,this._needsUpdateWorldTransform=!1);for(var e=this._children,n=0,l=e.length;n<l;n++)e[n].update(r)},getBoundingBox:function(){function r(u){return!u.invisible&&u.geometry}var e=new i.a,n=new a.a,l=new a.a;return function(u,_){return _=_||new i.a,this._parent?a.a.invert(l,this._parent.worldTransform):a.a.identity(l),this.traverse(function(f){f.geometry&&f.geometry.boundingBox&&(e.copy(f.geometry.boundingBox),a.a.multiply(n,l,f.worldTransform),e.applyTransform(n),_.union(e))},this,r),_}}(),getWorldPosition:function(r){this.transformNeedsUpdate()&&this.updateWorldTransform();var e=this.worldTransform.array;if(r){var n=r.array;return n[0]=e[12],n[1]=e[13],n[2]=e[14],r}else return new c.a(e[12],e[13],e[14])},clone:function(){var r=new this.constructor,e=this._children;r.setName(this.name),r.position.copy(this.position),r.rotation.copy(this.rotation),r.scale.copy(this.scale);for(var n=0;n<e.length;n++)r.add(e[n].clone());return r},rotateAround:function(){var r=new c.a,e=new a.a;return function(n,l,u){r.copy(this.position).subtract(n);var _=this.localTransform;_.identity(),_.translate(n),_.rotate(u,l),e.fromRotationTranslation(this.rotation,r),_.multiply(e),_.scale(this.scale),this.decomposeLocalTransform(),this._needsUpdateWorldTransform=!0}}(),lookAt:function(){var r=new a.a;return function(e,n){r.lookAt(this.position,e,n||this.localTransform.y).invert(),this.setLocalTransform(r),this.target=e}}()});R.a=h},function(F,R,g){var E=g(35),c=g(24),t=g(58),a=g(18),o=g(23),i=g(21),s=g(68),h=g(7),r=i.a.create(),e=i.a.create(),n={};function l(d){var v=[],m=Object.keys(d);m.sort();for(var p=0;p<m.length;p++){var y=m[p];v.push(y+" "+d[y])}var x=v.join(`
`);if(n[x])return n[x];var M=o.a.genGUID();return n[x]=M,M}function u(){this.opaque=[],this.transparent=[],this._opaqueCount=0,this._transparentCount=0}u.prototype.startCount=function(){this._opaqueCount=0,this._transparentCount=0},u.prototype.add=function(d,v){v?this.transparent[this._transparentCount++]=d:this.opaque[this._opaqueCount++]=d},u.prototype.endCount=function(){this.transparent.length=this._transparentCount,this.opaque.length=this._opaqueCount};var _=E.a.extend(function(){return{material:null,lights:[],viewBoundingBoxLastFrame:new a.a,shadowUniforms:{},_cameraList:[],_lightUniforms:{},_previousLightNumber:{},_lightNumber:{},_lightProgramKeys:{},_nodeRepository:{},_renderLists:new s.a(20)}},function(){this._scene=this},{addToScene:function(d){d instanceof t.a?(this._cameraList.length>0&&console.warn("Found multiple camera in one scene. Use the fist one."),this._cameraList.push(d)):d instanceof c.a&&this.lights.push(d),d.name&&(this._nodeRepository[d.name]=d)},removeFromScene:function(d){var v;d instanceof t.a?(v=this._cameraList.indexOf(d),v>=0&&this._cameraList.splice(v,1)):d instanceof c.a&&(v=this.lights.indexOf(d),v>=0&&this.lights.splice(v,1)),d.name&&delete this._nodeRepository[d.name]},getNode:function(d){return this._nodeRepository[d]},setMainCamera:function(d){var v=this._cameraList.indexOf(d);v>=0&&this._cameraList.splice(v,1),this._cameraList.unshift(d)},getMainCamera:function(){return this._cameraList[0]},getLights:function(){return this.lights},updateLights:function(){var d=this.lights;this._previousLightNumber=this._lightNumber;for(var v={},m=0;m<d.length;m++){var p=d[m];if(!p.invisible){var y=p.group;v[y]||(v[y]={}),v[y][p.type]=v[y][p.type]||0,v[y][p.type]++}}this._lightNumber=v;for(var x in v)this._lightProgramKeys[x]=l(v[x]);this._updateLightUniforms()},cloneNode:function(d){var v=d.clone(),m={};function p(y,x){m[y.__uid__]=x;for(var M=0;M<y._children.length;M++){var P=y._children[M],T=x._children[M];p(P,T)}}return p(d,v),v.traverse(function(y){y.skeleton&&(y.skeleton=y.skeleton.clone(m)),y.material&&(y.material=y.material.clone())}),v},updateRenderList:function(d,v){var m=d.__uid__,p=this._renderLists.get(m);p||(p=new u,this._renderLists.put(m,p)),p.startCount(),v&&(this.viewBoundingBoxLastFrame.min.set(Infinity,Infinity,Infinity),this.viewBoundingBoxLastFrame.max.set(-Infinity,-Infinity,-Infinity));var y=this.material&&this.material.transparent||!1;return this._doUpdateRenderList(this,d,y,p,v),p.endCount(),p},getRenderList:function(d){return this._renderLists.get(d.__uid__)},_doUpdateRenderList:function(d,v,m,p,y){if(!d.invisible)for(var x=0;x<d._children.length;x++){var M=d._children[x];if(M.isRenderable()){var P=M.isSkinnedMesh()?r:M.worldTransform.array,T=M.geometry;i.a.multiplyAffine(e,v.viewMatrix.array,P),(y&&!T.boundingBox||!this.isFrustumCulled(M,v,e))&&p.add(M,M.material.transparent||m)}M._children.length>0&&this._doUpdateRenderList(M,v,m,p,y)}},isFrustumCulled:function(){var d=new a.a,v=new h.a;return function(m,p,y){var x=m.boundingBox;if(x||(m.skeleton&&m.skeleton.boundingBox?x=m.skeleton.boundingBox:x=m.geometry.boundingBox),!x)return!1;if(v.array=y,d.transformFrom(x,v),m.castShadow&&this.viewBoundingBoxLastFrame.union(d),m.frustumCulling){if(!d.intersectBoundingBox(p.frustum.boundingBox))return!0;v.array=p.projectionMatrix.array,d.max.array[2]>0&&d.min.array[2]<0&&(d.max.array[2]=-1e-20),d.applyProjection(v);var M=d.min.array,P=d.max.array;if(P[0]<-1||M[0]>1||P[1]<-1||M[1]>1||P[2]<-1||M[2]>1)return!0}return!1}}(),_updateLightUniforms:function(){var d=this.lights;d.sort(f);var v=this._lightUniforms;for(var m in v)for(var p in v[m])v[m][p].value.length=0;for(var y=0;y<d.length;y++){var x=d[y];if(!x.invisible){var m=x.group;for(var p in x.uniformTemplates){var M=x.uniformTemplates[p],P=M.value(x);if(P!=null){v[m]||(v[m]={}),v[m][p]||(v[m][p]={type:"",value:[]});var T=v[m][p];switch(T.type=M.type+"v",M.type){case"1i":case"1f":case"t":T.value.push(P);break;case"2f":case"3f":case"4f":for(var O=0;O<P.length;O++)T.value.push(P[O]);break;default:console.error("Unkown light uniform type "+M.type)}}}}}},getLightGroups:function(){var d=[];for(var v in this._lightNumber)d.push(v);return d},getNumberChangedLightGroups:function(){var d=[];for(var v in this._lightNumber)this.isLightNumberChanged(v)&&d.push(v);return d},isLightNumberChanged:function(d){var v=this._previousLightNumber,m=this._lightNumber;for(var p in m[d])if(!v[d]||m[d][p]!==v[d][p])return!0;for(var p in v[d])if(!m[d]||m[d][p]!==v[d][p])return!0;return!1},getLightsNumbers:function(d){return this._lightNumber[d]},getProgramKey:function(d){return this._lightProgramKeys[d]},setLightUniforms:function(){function d(v,m,p){for(var y in v){var x=v[y];if(x.type==="tv"){if(!m.hasUniform(y))continue;for(var M=[],P=0;P<x.value.length;P++){var T=x.value[P],O=m.takeCurrentTextureSlot(p,T);M.push(O)}m.setUniform(p.gl,"1iv",y,M)}else m.setUniform(p.gl,x.type,y,x.value)}}return function(v,m,p){d(this._lightUniforms[m],v,p),d(this.shadowUniforms,v,p)}}(),dispose:function(){this.material=null,this._opaqueList=[],this._transparentList=[],this.lights=[],this._lightUniforms={},this._lightNumber={},this._nodeRepository={}}});function f(d,v){if(v.castShadow&&!d.castShadow)return!0}R.a=_},function(F,R,g){var E=g(58),c=E.a.extend({fov:50,aspect:1,near:.1,far:2e3},{updateProjectionMatrix:function(){var t=this.fov/180*Math.PI;this.projectionMatrix.perspective(t,this.aspect,this.near,this.far)},decomposeProjectionMatrix:function(){var t=this.projectionMatrix.array,a=Math.atan(1/t[5])*2;this.fov=a/Math.PI*180,this.aspect=t[5]/t[0],this.near=t[14]/(t[10]-1),this.far=t[14]/(t[10]+1)},clone:function(){var t=E.a.prototype.clone.call(this);return t.fov=this.fov,t.aspect=this.aspect,t.near=this.near,t.far=this.far,t}});R.a=c},function(F,R,g){var E=g(58),c=E.a.extend({left:-1,right:1,near:-1,far:1,top:1,bottom:-1},{updateProjectionMatrix:function(){this.projectionMatrix.ortho(this.left,this.right,this.bottom,this.top,this.near,this.far)},decomposeProjectionMatrix:function(){var t=this.projectionMatrix.array;this.left=(-1-t[12])/t[0],this.right=(1-t[12])/t[0],this.top=(1-t[13])/t[5],this.bottom=(-1-t[13])/t[5],this.near=-(-1-t[14])/t[10],this.far=-(1-t[14])/t[10]},clone:function(){var t=E.a.prototype.clone.call(this);return t.left=this.left,t.right=this.right,t.near=this.near,t.far=this.far,t.top=this.top,t.bottom=this.bottom,t}});R.a=c},function(F,R,g){R.a={convertToDynamicArray:function(E){E&&this.resetOffset();var c=this.attributes;for(var t in c)E||!c[t].value?c[t].value=[]:c[t].value=Array.prototype.slice.call(c[t].value);E||!this.indices?this.indices=[]:this.indices=Array.prototype.slice.call(this.indices)},convertToTypedArray:function(){var E=this.attributes;for(var c in E)E[c].value&&E[c].value.length>0?E[c].value=new Float32Array(E[c].value):E[c].value=null;this.indices&&this.indices.length>0&&(this.indices=this.vertexCount>65535?new Uint32Array(this.indices):new Uint16Array(this.indices)),this.dirty()}}},function(F,R,g){var E=g(0),c=g.n(E);function t(a,o){var i=[];return c.a.util.each(a.dimensions,function(s){var h=a.getDimensionInfo(s),r=h.otherDims,e=r[o];e!=null&&e!==!1&&(i[e]=h.name)}),i}R.a=function(a,o,i){function s(f){var d=[],v=t(h,"tooltip");v.length?c.a.util.each(v,function(p){m(h.get(p,o),p)}):c.a.util.each(f,m);function m(p,y){var x=h.getDimensionInfo(y);if(!(!x||x.otherDims.tooltip===!1)){var M=x.type,P="- "+(x.tooltipName||x.name)+": "+(M==="ordinal"?p+"":M==="time"?i?"":c.a.format.formatTime("yyyy/MM/dd hh:mm:ss",p):c.a.format.addCommas(p));P&&d.push(c.a.format.encodeHTML(P))}}return"<br/>"+d.join("<br/>")}var h=a.getData(),r=a.getRawValue(o),e=c.a.util.isArray(r)?s(r):c.a.format.encodeHTML(c.a.format.addCommas(r)),n=h.getName(o),l=h.getItemVisual(o,"color");c.a.util.isObject(l)&&l.colorStops&&(l=(l.colorStops[0]||{}).color),l=l||"transparent";var u=c.a.format.getTooltipMarker(l),_=a.name;return _==="\0-"&&(_=""),_=_?c.a.format.encodeHTML(_)+(i?": ":"<br/>"):"",i?u+_+e:_+u+(n?c.a.format.encodeHTML(n)+": "+e:e)}},function(F,R,g){var E=g(71),c=g(11),t=E.a.extend({skeleton:null,joints:null},function(){this.joints||(this.joints=[])},{offsetMatrix:null,isInstancedMesh:function(){return!1},isSkinnedMesh:function(){return!!(this.skeleton&&this.joints&&this.joints.length>0)},clone:function(){var a=E.a.prototype.clone.call(this);return a.skeleton=this.skeleton,this.joints&&(a.joints=this.joints.slice()),a}});t.POINTS=c.a.POINTS,t.LINES=c.a.LINES,t.LINE_LOOP=c.a.LINE_LOOP,t.LINE_STRIP=c.a.LINE_STRIP,t.TRIANGLES=c.a.TRIANGLES,t.TRIANGLE_STRIP=c.a.TRIANGLE_STRIP,t.TRIANGLE_FAN=c.a.TRIANGLE_FAN,t.BACK=c.a.BACK,t.FRONT=c.a.FRONT,t.FRONT_AND_BACK=c.a.FRONT_AND_BACK,t.CW=c.a.CW,t.CCW=c.a.CCW,R.a=t},function(F,R,g){var E=g(41),c=g(76),t=g(9),a=g(19),o=g(4),i=g(37),s=g(7),h=g(120);t.a.import(h.a);var r=E.a.extend(function(){var e=new t.a({vertex:t.a.source("clay.skybox.vertex"),fragment:t.a.source("clay.skybox.fragment")}),n=new a.a({shader:e,depthMask:!1});return{scene:null,geometry:new c.a,material:n,environmentMap:null,culling:!1,_dummyCamera:new i.a}},function(){var e=this.scene;e&&this.attachScene(e),this.environmentMap&&this.setEnvironmentMap(this.environmentMap)},{attachScene:function(e){this.scene&&this.detachScene(),e.skybox=this,this.scene=e,e.on("beforerender",this._beforeRenderScene,this)},detachScene:function(){this.scene&&(this.scene.off("beforerender",this._beforeRenderScene),this.scene.skybox=null),this.scene=null},dispose:function(e){this.detachScene(),this.geometry.dispose(e)},setEnvironmentMap:function(e){e.textureType==="texture2D"?(this.material.define("EQUIRECTANGULAR"),e.minFilter=o.a.LINEAR):this.material.undefine("EQUIRECTANGULAR"),this.material.set("environmentMap",e)},getEnvironmentMap:function(){return this.material.get("environmentMap")},_beforeRenderScene:function(e,n,l){this.renderSkybox(e,l)},renderSkybox:function(e,n){var l=this._dummyCamera;l.aspect=e.getViewportAspect(),l.fov=n.fov||50,l.updateProjectionMatrix(),s.a.invert(l.invProjectionMatrix,l.projectionMatrix),l.worldTransform.copy(n.worldTransform),l.viewMatrix.copy(n.viewMatrix),this.position.copy(n.getWorldPosition()),this.update(),e.gl.disable(e.gl.BLEND),this.material.get("lod")>0?this.material.define("fragment","LOD"):this.material.undefine("fragment","LOD"),e.renderPass([this],l)}});R.a=r},function(F,R,g){var E=g(14),c=g(18),t=E.a.extend({dynamic:!1,widthSegments:1,heightSegments:1},function(){this.build()},{build:function(){for(var a=this.heightSegments,o=this.widthSegments,i=this.attributes,s=[],h=[],r=[],e=[],n=0;n<=a;n++)for(var l=n/a,u=0;u<=o;u++){var _=u/o;if(s.push([2*_-1,2*l-1,0]),h&&h.push([_,l]),r&&r.push([0,0,1]),u<o&&n<a){var f=u+n*(o+1);e.push([f,f+1,f+o+1]),e.push([f+o+1,f+1,f+o+2])}}i.position.fromArray(s),i.texcoord0.fromArray(h),i.normal.fromArray(r),this.initIndicesFromArray(e),this.boundingBox=new c.a,this.boundingBox.min.set(-1,-1,0),this.boundingBox.max.set(1,1,0)}});R.a=t},function(F,R,g){R.a={defaultOption:{viewControl:{projection:"perspective",autoRotate:!1,autoRotateDirection:"cw",autoRotateSpeed:10,autoRotateAfterStill:3,damping:.8,rotateSensitivity:1,zoomSensitivity:1,panSensitivity:1,panMouseButton:"middle",rotateMouseButton:"left",distance:150,minDistance:40,maxDistance:400,orthographicSize:150,maxOrthographicSize:400,minOrthographicSize:20,center:[0,0,0],alpha:0,beta:0,minAlpha:-90,maxAlpha:90}},setView:function(E){E=E||{},this.option.viewControl=this.option.viewControl||{},E.alpha!=null&&(this.option.viewControl.alpha=E.alpha),E.beta!=null&&(this.option.viewControl.beta=E.beta),E.distance!=null&&(this.option.viewControl.distance=E.distance),E.center!=null&&(this.option.viewControl.center=E.center)}}},function(F,R,g){var E=g(8),c=g(26),t=g(3);g(56);var a=g(2),o=a.a.firstNotNull,i={left:0,middle:1,right:2};function s(r){return r instanceof Array||(r=[r,r]),r}var h=E.a.extend(function(){return{zr:null,viewGL:null,_center:new t.a,minDistance:.5,maxDistance:1.5,maxOrthographicSize:300,minOrthographicSize:30,minAlpha:-90,maxAlpha:90,minBeta:-Infinity,maxBeta:Infinity,autoRotateAfterStill:0,autoRotateDirection:"cw",autoRotateSpeed:60,damping:.8,rotateSensitivity:1,zoomSensitivity:1,panSensitivity:1,panMouseButton:"middle",rotateMouseButton:"left",_mode:"rotate",_camera:null,_needsUpdate:!1,_rotating:!1,_phi:0,_theta:0,_mouseX:0,_mouseY:0,_rotateVelocity:new c.a,_panVelocity:new c.a,_distance:500,_zoomSpeed:0,_stillTimeout:0,_animators:[]}},function(){["_mouseDownHandler","_mouseWheelHandler","_mouseMoveHandler","_mouseUpHandler","_pinchHandler","_contextMenuHandler","_update"].forEach(function(r){this[r]=this[r].bind(this)},this)},{init:function(){var r=this.zr;r&&(r.on("mousedown",this._mouseDownHandler),r.on("globalout",this._mouseUpHandler),r.on("mousewheel",this._mouseWheelHandler),r.on("pinch",this._pinchHandler),r.animation.on("frame",this._update),r.dom.addEventListener("contextmenu",this._contextMenuHandler))},dispose:function(){var r=this.zr;r&&(r.off("mousedown",this._mouseDownHandler),r.off("mousemove",this._mouseMoveHandler),r.off("mouseup",this._mouseUpHandler),r.off("mousewheel",this._mouseWheelHandler),r.off("pinch",this._pinchHandler),r.off("globalout",this._mouseUpHandler),r.dom.removeEventListener("contextmenu",this._contextMenuHandler),r.animation.off("frame",this._update)),this.stopAllAnimation()},getDistance:function(){return this._distance},setDistance:function(r){this._distance=r,this._needsUpdate=!0},getOrthographicSize:function(){return this._orthoSize},setOrthographicSize:function(r){this._orthoSize=r,this._needsUpdate=!0},getAlpha:function(){return this._theta/Math.PI*180},getBeta:function(){return-this._phi/Math.PI*180},getCenter:function(){return this._center.toArray()},setAlpha:function(r){r=Math.max(Math.min(this.maxAlpha,r),this.minAlpha),this._theta=r/180*Math.PI,this._needsUpdate=!0},setBeta:function(r){r=Math.max(Math.min(this.maxBeta,r),this.minBeta),this._phi=-r/180*Math.PI,this._needsUpdate=!0},setCenter:function(r){this._center.setArray(r)},setViewGL:function(r){this.viewGL=r},getCamera:function(){return this.viewGL.camera},setFromViewControlModel:function(r,e){e=e||{};var n=e.baseDistance||0,l=e.baseOrthoSize||1,u=r.get("projection");u!=="perspective"&&u!=="orthographic"&&u!=="isometric"&&(console.error("Unkown projection type %s, use perspective projection instead.",u),u="perspective"),this._projection=u,this.viewGL.setProjection(u);var _=r.get("distance")+n,f=r.get("orthographicSize")+l;[["damping",.8],["autoRotate",!1],["autoRotateAfterStill",3],["autoRotateDirection","cw"],["autoRotateSpeed",10],["minDistance",30],["maxDistance",400],["minOrthographicSize",30],["maxOrthographicSize",300],["minAlpha",-90],["maxAlpha",90],["minBeta",-Infinity],["maxBeta",Infinity],["rotateSensitivity",1],["zoomSensitivity",1],["panSensitivity",1],["panMouseButton","left"],["rotateMouseButton","middle"]].forEach(function(x){this[x[0]]=o(r.get(x[0]),x[1])},this),this.minDistance+=n,this.maxDistance+=n,this.minOrthographicSize+=l,this.maxOrthographicSize+=l;var d=r.ecModel,v={};["animation","animationDurationUpdate","animationEasingUpdate"].forEach(function(x){v[x]=o(r.get(x),d&&d.get(x))});var m=o(e.alpha,r.get("alpha"))||0,p=o(e.beta,r.get("beta"))||0,y=o(e.center,r.get("center"))||[0,0,0];v.animation&&v.animationDurationUpdate>0&&this._notFirst?this.animateTo({alpha:m,beta:p,center:y,distance:_,orthographicSize:f,easing:v.animationEasingUpdate,duration:v.animationDurationUpdate}):(this.setDistance(_),this.setAlpha(m),this.setBeta(p),this.setCenter(y),this.setOrthographicSize(f)),this._notFirst=!0,this._validateProperties()},_validateProperties:function(){i[this.panMouseButton]==null&&console.error("Unkown panMouseButton %s. It should be left|middle|right",this.panMouseButton),i[this.rotateMouseButton]==null&&console.error("Unkown rotateMouseButton %s. It should be left|middle|right",this.rotateMouseButton),this.autoRotateDirection!=="cw"&&this.autoRotateDirection!=="ccw"&&console.error("Unkown autoRotateDirection %s. It should be cw|ccw",this.autoRotateDirection)},animateTo:function(r){var e=this.zr,n=this,l={},u={};return r.distance!=null&&(l.distance=this.getDistance(),u.distance=r.distance),r.orthographicSize!=null&&(l.orthographicSize=this.getOrthographicSize(),u.orthographicSize=r.orthographicSize),r.alpha!=null&&(l.alpha=this.getAlpha(),u.alpha=r.alpha),r.beta!=null&&(l.beta=this.getBeta(),u.beta=r.beta),r.center!=null&&(l.center=this.getCenter(),u.center=r.center),this._addAnimator(e.animation.animate(l).when(r.duration||1e3,u).during(function(){l.alpha!=null&&n.setAlpha(l.alpha),l.beta!=null&&n.setBeta(l.beta),l.distance!=null&&n.setDistance(l.distance),l.center!=null&&n.setCenter(l.center),l.orthographicSize!=null&&n.setOrthographicSize(l.orthographicSize),n._needsUpdate=!0})).start(r.easing||"linear")},stopAllAnimation:function(){for(var r=0;r<this._animators.length;r++)this._animators[r].stop();this._animators.length=0},update:function(){this._needsUpdate=!0,this._update(20)},_isAnimating:function(){return this._animators.length>0},_update:function(r){if(this._rotating){var e=(this.autoRotateDirection==="cw"?1:-1)*this.autoRotateSpeed/180*Math.PI;this._phi-=e*r/1e3,this._needsUpdate=!0}else this._rotateVelocity.len()>0&&(this._needsUpdate=!0);(Math.abs(this._zoomSpeed)>.1||this._panVelocity.len()>0)&&(this._needsUpdate=!0),!!this._needsUpdate&&(r=Math.min(r,50),this._updateDistanceOrSize(r),this._updatePan(r),this._updateRotate(r),this._updateTransform(),this.getCamera().update(),this.zr&&this.zr.refresh(),this.trigger("update"),this._needsUpdate=!1)},_updateRotate:function(r){var e=this._rotateVelocity;this._phi=e.y*r/20+this._phi,this._theta=e.x*r/20+this._theta,this.setAlpha(this.getAlpha()),this.setBeta(this.getBeta()),this._vectorDamping(e,Math.pow(this.damping,r/16))},_updateDistanceOrSize:function(r){this._projection==="perspective"?this._setDistance(this._distance+this._zoomSpeed*r/20):this._setOrthoSize(this._orthoSize+this._zoomSpeed*r/20),this._zoomSpeed*=Math.pow(this.damping,r/16)},_setDistance:function(r){this._distance=Math.max(Math.min(r,this.maxDistance),this.minDistance)},_setOrthoSize:function(r){this._orthoSize=Math.max(Math.min(r,this.maxOrthographicSize),this.minOrthographicSize);var e=this.getCamera(),n=this._orthoSize,l=n/this.viewGL.viewport.height*this.viewGL.viewport.width;e.left=-l/2,e.right=l/2,e.top=n/2,e.bottom=-n/2},_updatePan:function(r){var e=this._panVelocity,n=this._distance,l=this.getCamera(),u=l.worldTransform.y,_=l.worldTransform.x;this._center.scaleAndAdd(_,-e.x*n/200).scaleAndAdd(u,-e.y*n/200),this._vectorDamping(e,0)},_updateTransform:function(){var r=this.getCamera(),e=new t.a,n=this._theta+Math.PI/2,l=this._phi+Math.PI/2,u=Math.sin(n);e.x=u*Math.cos(l),e.y=-Math.cos(n),e.z=u*Math.sin(l),r.position.copy(this._center).scaleAndAdd(e,this._distance),r.rotation.identity().rotateY(-this._phi).rotateX(-this._theta)},_startCountingStill:function(){clearTimeout(this._stillTimeout);var r=this.autoRotateAfterStill,e=this;!isNaN(r)&&r>0&&(this._stillTimeout=setTimeout(function(){e._rotating=!0},r*1e3))},_vectorDamping:function(r,e){var n=r.len();n=n*e,n<1e-4&&(n=0),r.normalize().scale(n)},_decomposeTransform:function(){if(!!this.getCamera()){this.getCamera().updateWorldTransform();var r=this.getCamera().worldTransform.z,e=Math.asin(r.y),n=Math.atan2(r.x,r.z);this._theta=e,this._phi=-n,this.setBeta(this.getBeta()),this.setAlpha(this.getAlpha()),this.getCamera().aspect?this._setDistance(this.getCamera().position.dist(this._center)):this._setOrthoSize(this.getCamera().top-this.getCamera().bottom)}},_mouseDownHandler:function(r){if(!r.target&&!this._isAnimating()){var e=r.offsetX,n=r.offsetY;this.viewGL&&!this.viewGL.containPoint(e,n)||(this.zr.on("mousemove",this._mouseMoveHandler),this.zr.on("mouseup",this._mouseUpHandler),r.event.targetTouches?r.event.targetTouches.length===1&&(this._mode="rotate"):r.event.button===i[this.rotateMouseButton]?this._mode="rotate":r.event.button===i[this.panMouseButton]?this._mode="pan":this._mode="",this._rotateVelocity.set(0,0),this._rotating=!1,this.autoRotate&&this._startCountingStill(),this._mouseX=r.offsetX,this._mouseY=r.offsetY)}},_mouseMoveHandler:function(r){if(!(r.target&&r.target.__isGLToZRProxy)&&!this._isAnimating()){var e=s(this.panSensitivity),n=s(this.rotateSensitivity);this._mode==="rotate"?(this._rotateVelocity.y=(r.offsetX-this._mouseX)/this.zr.getHeight()*2*n[0],this._rotateVelocity.x=(r.offsetY-this._mouseY)/this.zr.getWidth()*2*n[1]):this._mode==="pan"&&(this._panVelocity.x=(r.offsetX-this._mouseX)/this.zr.getWidth()*e[0]*400,this._panVelocity.y=(-r.offsetY+this._mouseY)/this.zr.getHeight()*e[1]*400),this._mouseX=r.offsetX,this._mouseY=r.offsetY,r.event.preventDefault()}},_mouseWheelHandler:function(r){if(!this._isAnimating()){var e=r.event.wheelDelta||-r.event.detail;this._zoomHandler(r,e)}},_pinchHandler:function(r){this._isAnimating()||(this._zoomHandler(r,r.pinchScale>1?1:-1),this._mode="")},_zoomHandler:function(r,e){if(e!==0){var n=r.offsetX,l=r.offsetY;if(!(this.viewGL&&!this.viewGL.containPoint(n,l))){var u;this._projection==="perspective"?u=Math.max(Math.max(Math.min(this._distance-this.minDistance,this.maxDistance-this._distance))/20,.5):u=Math.max(Math.max(Math.min(this._orthoSize-this.minOrthographicSize,this.maxOrthographicSize-this._orthoSize))/20,.5),this._zoomSpeed=(e>0?-1:1)*u*this.zoomSensitivity,this._rotating=!1,this.autoRotate&&this._mode==="rotate"&&this._startCountingStill(),r.event.preventDefault()}}},_mouseUpHandler:function(){this.zr.off("mousemove",this._mouseMoveHandler),this.zr.off("mouseup",this._mouseUpHandler)},_isRightMouseButtonUsed:function(){return this.rotateMouseButton==="right"||this.panMouseButton==="right"},_contextMenuHandler:function(r){this._isRightMouseButtonUsed()&&r.preventDefault()},_addAnimator:function(r){var e=this._animators;return e.push(r),r.done(function(){var n=e.indexOf(r);n>=0&&e.splice(n,1)}),r}});Object.defineProperty(h.prototype,"autoRotate",{get:function(r){return this._autoRotate},set:function(r){this._autoRotate=r,this._rotating=r}}),R.a=h},function(F,R,g){R.a=`@export ecgl.lines3D.vertex

uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;

attribute vec3 position: POSITION;
attribute vec4 a_Color : COLOR;
varying vec4 v_Color;

void main()
{
 gl_Position = worldViewProjection * vec4(position, 1.0);
 v_Color = a_Color;
}

@end

@export ecgl.lines3D.fragment

uniform vec4 color : [1.0, 1.0, 1.0, 1.0];

varying vec4 v_Color;

@import clay.util.srgb

void main()
{
#ifdef SRGB_DECODE
 gl_FragColor = sRGBToLinear(color * v_Color);
#else
 gl_FragColor = color * v_Color;
#endif
}
@end



@export ecgl.lines3D.clipNear

vec4 clipNear(vec4 p1, vec4 p2) {
 float n = (p1.w - near) / (p1.w - p2.w);
 return vec4(mix(p1.xy, p2.xy, n), -near, near);
}

@end

@export ecgl.lines3D.expandLine
#ifdef VERTEX_ANIMATION
 vec4 prevProj = worldViewProjection * vec4(mix(prevPositionPrev, positionPrev, percent), 1.0);
 vec4 currProj = worldViewProjection * vec4(mix(prevPosition, position, percent), 1.0);
 vec4 nextProj = worldViewProjection * vec4(mix(prevPositionNext, positionNext, percent), 1.0);
#else
 vec4 prevProj = worldViewProjection * vec4(positionPrev, 1.0);
 vec4 currProj = worldViewProjection * vec4(position, 1.0);
 vec4 nextProj = worldViewProjection * vec4(positionNext, 1.0);
#endif

 if (currProj.w < 0.0) {
 if (nextProj.w > 0.0) {
 currProj = clipNear(currProj, nextProj);
 }
 else if (prevProj.w > 0.0) {
 currProj = clipNear(currProj, prevProj);
 }
 }

 vec2 prevScreen = (prevProj.xy / abs(prevProj.w) + 1.0) * 0.5 * viewport.zw;
 vec2 currScreen = (currProj.xy / abs(currProj.w) + 1.0) * 0.5 * viewport.zw;
 vec2 nextScreen = (nextProj.xy / abs(nextProj.w) + 1.0) * 0.5 * viewport.zw;

 vec2 dir;
 float len = offset;
 if (position == positionPrev) {
 dir = normalize(nextScreen - currScreen);
 }
 else if (position == positionNext) {
 dir = normalize(currScreen - prevScreen);
 }
 else {
 vec2 dirA = normalize(currScreen - prevScreen);
 vec2 dirB = normalize(nextScreen - currScreen);

 vec2 tanget = normalize(dirA + dirB);

 float miter = 1.0 / max(dot(tanget, dirA), 0.5);
 len *= miter;
 dir = tanget;
 }

 dir = vec2(-dir.y, dir.x) * len;
 currScreen += dir;

 currProj.xy = (currScreen / viewport.zw - 0.5) * 2.0 * abs(currProj.w);
@end


@export ecgl.meshLines3D.vertex

attribute vec3 position: POSITION;
attribute vec3 positionPrev;
attribute vec3 positionNext;
attribute float offset;
attribute vec4 a_Color : COLOR;

#ifdef VERTEX_ANIMATION
attribute vec3 prevPosition;
attribute vec3 prevPositionPrev;
attribute vec3 prevPositionNext;
uniform float percent : 1.0;
#endif

uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;
uniform vec4 viewport : VIEWPORT;
uniform float near : NEAR;

varying vec4 v_Color;

@import ecgl.common.wireframe.vertexHeader

@import ecgl.lines3D.clipNear

void main()
{
 @import ecgl.lines3D.expandLine

 gl_Position = currProj;

 v_Color = a_Color;

 @import ecgl.common.wireframe.vertexMain
}
@end


@export ecgl.meshLines3D.fragment

uniform vec4 color : [1.0, 1.0, 1.0, 1.0];

varying vec4 v_Color;

@import ecgl.common.wireframe.fragmentHeader

@import clay.util.srgb

void main()
{
#ifdef SRGB_DECODE
 gl_FragColor = sRGBToLinear(color * v_Color);
#else
 gl_FragColor = color * v_Color;
#endif

 @import ecgl.common.wireframe.fragmentMain
}

@end`},function(F,R,g){var E=g(16),c=g(83),t=g(84),a=t.parsePercent,o=g(172),i=E.each,s=["left","right","top","bottom","width","height"],h=[["width","left","right"],["height","top","bottom"]];function r(y,x,M,P,T){var O=0,D=0;P==null&&(P=Infinity),T==null&&(T=Infinity);var A=0;x.eachChild(function(C,S){var L=C.position,I=C.getBoundingRect(),w=x.childAt(S+1),b=w&&w.getBoundingRect(),B,U;if(y==="horizontal"){var W=I.width+(b?-b.x+I.x:0);B=O+W,B>P||C.newline?(O=0,B=W,D+=A+M,A=I.height):A=Math.max(A,I.height)}else{var z=I.height+(b?-b.y+I.y:0);U=D+z,U>T||C.newline?(O+=A+M,D=0,U=z,A=I.width):A=Math.max(A,I.width)}C.newline||(L[0]=O,L[1]=D,y==="horizontal"?O=B+M:D=U+M)})}var e=r,n=E.curry(r,"vertical"),l=E.curry(r,"horizontal");function u(y,x,M){var P=x.width,T=x.height,O=a(y.x,P),D=a(y.y,T),A=a(y.x2,P),C=a(y.y2,T);return(isNaN(O)||isNaN(parseFloat(y.x)))&&(O=0),(isNaN(A)||isNaN(parseFloat(y.x2)))&&(A=P),(isNaN(D)||isNaN(parseFloat(y.y)))&&(D=0),(isNaN(C)||isNaN(parseFloat(y.y2)))&&(C=T),M=o.normalizeCssArray(M||0),{width:Math.max(A-O-M[1]-M[3],0),height:Math.max(C-D-M[0]-M[2],0)}}function _(y,x,M){M=o.normalizeCssArray(M||0);var P=x.width,T=x.height,O=a(y.left,P),D=a(y.top,T),A=a(y.right,P),C=a(y.bottom,T),S=a(y.width,P),L=a(y.height,T),I=M[2]+M[0],w=M[1]+M[3],b=y.aspect;switch(isNaN(S)&&(S=P-A-w-O),isNaN(L)&&(L=T-C-I-D),b!=null&&(isNaN(S)&&isNaN(L)&&(b>P/T?S=P*.8:L=T*.8),isNaN(S)&&(S=b*L),isNaN(L)&&(L=S/b)),isNaN(O)&&(O=P-A-S-w),isNaN(D)&&(D=T-C-L-I),y.left||y.right){case"center":O=P/2-S/2-M[3];break;case"right":O=P-S-w;break}switch(y.top||y.bottom){case"middle":case"center":D=T/2-L/2-M[0];break;case"bottom":D=T-L-I;break}O=O||0,D=D||0,isNaN(S)&&(S=P-w-O-(A||0)),isNaN(L)&&(L=T-I-D-(C||0));var B=new c(O+M[3],D+M[0],S,L);return B.margin=M,B}function f(y,x,M,P,T){var O=!T||!T.hv||T.hv[0],D=!T||!T.hv||T.hv[1],A=T&&T.boundingMode||"all";if(!(!O&&!D)){var C;if(A==="raw")C=y.type==="group"?new c(0,0,+x.width||0,+x.height||0):y.getBoundingRect();else if(C=y.getBoundingRect(),y.needLocalTransform()){var S=y.getLocalTransform();C=C.clone(),C.applyTransform(S)}x=_(E.defaults({width:C.width,height:C.height},x),M,P);var L=y.position,I=O?x.x-C.x:0,w=D?x.y-C.y:0;y.attr("position",A==="raw"?[I,w]:[L[0]+I,L[1]+w])}}function d(y,x){return y[h[x][0]]!=null||y[h[x][1]]!=null&&y[h[x][2]]!=null}function v(y,x,M){!E.isObject(M)&&(M={});var P=M.ignoreSize;!E.isArray(P)&&(P=[P,P]);var T=D(h[0],0),O=D(h[1],1);S(h[0],y,T),S(h[1],y,O);function D(L,I){var w={},b=0,B={},U=0,W=2;if(i(L,function(H){B[H]=y[H]}),i(L,function(H){A(x,H)&&(w[H]=B[H]=x[H]),C(w,H)&&b++,C(B,H)&&U++}),P[I])return C(x,L[1])?B[L[2]]=null:C(x,L[2])&&(B[L[1]]=null),B;if(U===W||!b)return B;if(b>=W)return w;for(var z=0;z<L.length;z++){var G=L[z];if(!A(w,G)&&A(y,G)){w[G]=y[G];break}}return w}function A(L,I){return L.hasOwnProperty(I)}function C(L,I){return L[I]!=null&&L[I]!=="auto"}function S(L,I,w){i(L,function(b){I[b]=w[b]})}}function m(y){return p({},y)}function p(y,x){return x&&y&&i(s,function(M){x.hasOwnProperty(M)&&(y[M]=x[M])}),y}R.LOCATION_PARAMS=s,R.HV_NAMES=h,R.box=e,R.vbox=n,R.hbox=l,R.getAvailableSize=u,R.getLayoutRect=_,R.positionElement=f,R.sizeCalculable=d,R.mergeLayoutParam=v,R.getLayoutParams=m,R.copyLayoutParams=p},function(F,R,g){var E=g(8),c=E.a.extend(function(){return{name:"",inputLinks:{},outputLinks:{},_prevOutputTextures:{},_outputTextures:{},_outputReferences:{},_rendering:!1,_rendered:!1,_compositor:null}},{updateParameter:function(t,a){var o=this.outputs[t],i=o.parameters,s=o._parametersCopy;if(s||(s=o._parametersCopy={}),i)for(var h in i)h!=="width"&&h!=="height"&&(s[h]=i[h]);var r,e;return i.width instanceof Function?r=i.width.call(this,a):r=i.width,i.height instanceof Function?e=i.height.call(this,a):e=i.height,(s.width!==r||s.height!==e)&&this._outputTextures[t]&&this._outputTextures[t].dispose(a.gl),s.width=r,s.height=e,s},setParameter:function(t,a){},getParameter:function(t){},setParameters:function(t){for(var a in t)this.setParameter(a,t[a])},render:function(){},getOutput:function(t,a){if(a==null)return a=t,this._outputTextures[a];var o=this.outputs[a];if(!!o)return this._rendered?o.outputLastFrame?this._prevOutputTextures[a]:this._outputTextures[a]:this._rendering?(this._prevOutputTextures[a]||(this._prevOutputTextures[a]=this._compositor.allocateTexture(o.parameters||{})),this._prevOutputTextures[a]):(this.render(t),this._outputTextures[a])},removeReference:function(t){if(this._outputReferences[t]--,this._outputReferences[t]===0){var a=this.outputs[t];a.keepLastFrame?(this._prevOutputTextures[t]&&this._compositor.releaseTexture(this._prevOutputTextures[t]),this._prevOutputTextures[t]=this._outputTextures[t]):this._compositor.releaseTexture(this._outputTextures[t])}},link:function(t,a,o){this.inputLinks[t]={node:a,pin:o},a.outputLinks[o]||(a.outputLinks[o]=[]),a.outputLinks[o].push({node:this,pin:t}),this.pass.material.enableTexture(t)},clear:function(){this.inputLinks={},this.outputLinks={}},updateReference:function(t){if(!this._rendering){this._rendering=!0;for(var a in this.inputLinks){var o=this.inputLinks[a];o.node.updateReference(o.pin)}this._rendering=!1}t&&this._outputReferences[t]++},beforeFrame:function(){this._rendered=!1;for(var t in this.outputLinks)this._outputReferences[t]=0},afterFrame:function(){for(var t in this.outputLinks)if(this._outputReferences[t]>0){var a=this.outputs[t];a.keepLastFrame?(this._prevOutputTextures[t]&&this._compositor.releaseTexture(this._prevOutputTextures[t]),this._prevOutputTextures[t]=this._outputTextures[t]):this._compositor.releaseTexture(this._outputTextures[t])}}});R.a=c},function(F,R,g){function E(c,t){for(var a=0,o=1/t,i=c;i>0;)a=a+o*(i%t),i=Math.floor(i/t),o=o/t;return a}R.a=E},function(F,R,g){var E=g(0),c=g.n(E);R.a=function(t,a,o){o=o||t.getSource();var i=a||c.a.getCoordinateSystemDimensions(t.get("coordinateSystem"))||["x","y","z"],s=c.a.helper.createDimensions(o,{dimensionsDefine:o.dimensionsDefine||t.get("dimensions"),encodeDefine:o.encodeDefine||t.get("encode"),coordDimensions:i.map(function(e){var n=t.getReferringComponents(e+"Axis3D")[0];return{type:n&&n.get("type")==="category"?"ordinal":"float",name:e}})});t.get("coordinateSystem")==="cartesian3D"&&s.forEach(function(e){if(i.indexOf(e.coordDim)>=0){var n=t.getReferringComponents(e.coordDim+"Axis3D")[0];n&&n.get("type")==="category"&&(e.ordinalMeta=n.getOrdinalMeta())}});var h=c.a.helper.dataStack.enableDataStack(t,s,{byIndex:!0,stackedCoordDimension:"z"}),r=new c.a.List(s,t);return r.setCalculationInfo(h),r.initData(o),r}},function(F,R,g){var E=g(16),c=E.isFunction;function t(a,o,i){return{seriesType:a,performRawSeries:!0,reset:function(s,h,r){var e=s.getData(),n=s.get("symbol"),l=s.get("symbolSize"),u=s.get("symbolKeepAspect"),_=c(n),f=c(l),d=_||f,v=!_&&n?n:o,m=f?null:l;if(e.setVisual({legendSymbol:i||v,symbol:v,symbolSize:m,symbolKeepAspect:u}),h.isSeriesFiltered(s))return;function p(y,x){if(d){var M=s.getRawValue(x),P=s.getDataParams(x);_&&y.setItemVisual(x,"symbol",n(M,P)),f&&y.setItemVisual(x,"symbolSize",l(M,P))}if(y.hasItemOption){var T=y.getItemModel(x),O=T.getShallow("symbol",!0),D=T.getShallow("symbolSize",!0),A=T.getShallow("symbolKeepAspect",!0);O!=null&&y.setItemVisual(x,"symbol",O),D!=null&&y.setItemVisual(x,"symbolSize",D),A!=null&&y.setItemVisual(x,"symbolKeepAspect",A)}}return{dataEach:e.hasItemOption||d?p:null}}}}F.exports=t},function(F,R,g){var E=g(8),c=g(110),t=g(11),a=g(13),o=g(19),i=g(26),s=g(114),h=g(9),r=g(70),e=g(21),n=g(12);h.a.import(r.a);var l=e.a.create,u={};function _(T){return T.material}function f(T,O,D){return O.uniforms[D].value}function d(T,O,D,A){return D!==A}function v(T){return!0}function m(){}var p={float:t.a.FLOAT,byte:t.a.BYTE,ubyte:t.a.UNSIGNED_BYTE,short:t.a.SHORT,ushort:t.a.UNSIGNED_SHORT};function y(T,O,D){this.availableAttributes=T,this.availableAttributeSymbols=O,this.indicesBuffer=D,this.vao=null}function x(T){var O,D;this.bind=function(A){O||(O=a.a.createCanvas(),O.width=O.height=1,O.getContext("2d"));var C=A.gl,S=!D;S&&(D=C.createTexture()),C.bindTexture(C.TEXTURE_2D,D),S&&C.texImage2D(C.TEXTURE_2D,0,C.RGBA,C.RGBA,C.UNSIGNED_BYTE,O)},this.unbind=function(A){A.gl.bindTexture(A.gl.TEXTURE_2D,null)},this.isRenderable=function(){return!0}}var M=E.a.extend(function(){return{canvas:null,_width:100,_height:100,devicePixelRatio:typeof window!="undefined"&&window.devicePixelRatio||1,clearColor:[0,0,0,0],clearBit:17664,logDepthBuffer:!1,alpha:!0,depth:!0,stencil:!1,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1,throwError:!0,gl:null,viewport:{},maxJointNumber:20,__currentFrameBuffer:null,_viewportStack:[],_clearStack:[],_sceneRendering:null}},function(){this.canvas||(this.canvas=a.a.createCanvas());var T=this.canvas;try{var O={alpha:this.alpha,depth:this.depth,stencil:this.stencil,antialias:this.antialias,premultipliedAlpha:this.premultipliedAlpha,preserveDrawingBuffer:this.preserveDrawingBuffer};if(this.gl=T.getContext("webgl",O)||T.getContext("experimental-webgl",O),!this.gl)throw new Error;this._glinfo=new c.a(this.gl),this.gl.targetRenderer&&console.error("Already created a renderer"),this.gl.targetRenderer=this,this.resize()}catch(D){throw"Error creating WebGL Context "+D}this._programMgr=new s.a(this),this._placeholderTexture=new x(this)},{resize:function(T,O){var D=this.canvas,A=this.devicePixelRatio;T!=null?(D.style&&(D.style.width=T+"px",D.style.height=O+"px"),D.width=T*A,D.height=O*A,this._width=T,this._height=O):(this._width=D.width/A,this._height=D.height/A),this.setViewport(0,0,this._width,this._height)},getWidth:function(){return this._width},getHeight:function(){return this._height},getViewportAspect:function(){var T=this.viewport;return T.width/T.height},setDevicePixelRatio:function(T){this.devicePixelRatio=T,this.resize(this._width,this._height)},getDevicePixelRatio:function(){return this.devicePixelRatio},getGLExtension:function(T){return this._glinfo.getExtension(T)},getGLParameter:function(T){return this._glinfo.getParameter(T)},setViewport:function(T,O,D,A,C){if(typeof T=="object"){var S=T;T=S.x,O=S.y,D=S.width,A=S.height,C=S.devicePixelRatio}C=C||this.devicePixelRatio,this.gl.viewport(T*C,O*C,D*C,A*C),this.viewport={x:T,y:O,width:D,height:A,devicePixelRatio:C}},saveViewport:function(){this._viewportStack.push(this.viewport)},restoreViewport:function(){this._viewportStack.length>0&&this.setViewport(this._viewportStack.pop())},saveClear:function(){this._clearStack.push({clearBit:this.clearBit,clearColor:this.clearColor})},restoreClear:function(){if(this._clearStack.length>0){var T=this._clearStack.pop();this.clearColor=T.clearColor,this.clearBit=T.clearBit}},bindSceneRendering:function(T){this._sceneRendering=T},render:function(T,O,D,A){var C=this.gl,S=this.clearColor;if(this.clearBit){C.colorMask(!0,!0,!0,!0),C.depthMask(!0);var L=this.viewport,I=!1,w=L.devicePixelRatio;(L.width!==this._width||L.height!==this._height||w&&w!==this.devicePixelRatio||L.x||L.y)&&(I=!0,C.enable(C.SCISSOR_TEST),C.scissor(L.x*w,L.y*w,L.width*w,L.height*w)),C.clearColor(S[0],S[1],S[2],S[3]),C.clear(this.clearBit),I&&C.disable(C.SCISSOR_TEST)}if(D||T.update(!1),T.updateLights(),O=O||T.getMainCamera(),!O){console.error("Can't find camera in the scene.");return}O.update();var b=T.updateRenderList(O,!0);this._sceneRendering=T;var B=b.opaque,U=b.transparent,W=T.material;T.trigger("beforerender",this,T,O,b),A?(this.renderPreZ(B,T,O),C.depthFunc(C.LEQUAL)):C.depthFunc(C.LESS);for(var z=l(),G=n.a.create(),H=0;H<U.length;H++){var X=U[H];e.a.multiplyAffine(z,O.viewMatrix.array,X.worldTransform.array),n.a.transformMat4(G,X.position.array,z),X.__depth=G[2]}this.renderPass(B,O,{getMaterial:function(Q){return W||Q.material},sortCompare:this.opaqueSortCompare}),this.renderPass(U,O,{getMaterial:function(Q){return W||Q.material},sortCompare:this.transparentSortCompare}),T.trigger("afterrender",this,T,O,b),this._sceneRendering=null},getProgram:function(T,O,D){return O=O||T.material,this._programMgr.getProgram(T,O,D,this)},validateProgram:function(T){if(T.__error){var O=T.__error;if(u[T.__uid__])return;if(u[T.__uid__]=!0,this.throwError)throw new Error(O);this.trigger("error",O)}},updatePrograms:function(T,O,D){var A=D&&D.getMaterial||_;O=O||null;for(var C=0;C<T.length;C++){var S=T[C],L=A.call(this,S);if(C>0){var I=T[C-1],w=I.joints?I.joints.length:0,b=S.joints?S.joints.length:0;if(b===w&&S.material===I.material&&S.lightGroup===I.lightGroup){S.__program=I.__program;continue}}var B=this._programMgr.getProgram(S,L,O,this);this.validateProgram(B),S.__program=B}},renderPass:function(T,O,D){this.trigger("beforerenderpass",this,T,O,D),D=D||{},D.getMaterial=D.getMaterial||_,D.getUniform=D.getUniform||f,D.isMaterialChanged=D.isMaterialChanged||d,D.beforeRender=D.beforeRender||m,D.afterRender=D.afterRender||m;var A=D.ifRender||v;this.updatePrograms(T,this._sceneRendering,D),D.sortCompare&&T.sort(D.sortCompare);var C=this.viewport,S=C.devicePixelRatio,L=[C.x*S,C.y*S,C.width*S,C.height*S],I=this.devicePixelRatio,w=this.__currentFrameBuffer?[this.__currentFrameBuffer.getTextureWidth(),this.__currentFrameBuffer.getTextureHeight()]:[this._width*I,this._height*I],b=[L[2],L[3]],B=Date.now();O?(e.a.copy(P.VIEW,O.viewMatrix.array),e.a.copy(P.PROJECTION,O.projectionMatrix.array),e.a.copy(P.VIEWINVERSE,O.worldTransform.array)):(e.a.identity(P.VIEW),e.a.identity(P.PROJECTION),e.a.identity(P.VIEWINVERSE)),e.a.multiply(P.VIEWPROJECTION,P.PROJECTION,P.VIEW),e.a.invert(P.PROJECTIONINVERSE,P.PROJECTION),e.a.invert(P.VIEWPROJECTIONINVERSE,P.VIEWPROJECTION);for(var U=this.gl,W=this._sceneRendering,z,G,H,X,Q,j,J,Y,at,ot,ut,et,ht=null,ft=0;ft<T.length;ft++){var it=T[ft],N=it.worldTransform!=null,K;if(!!A(it)){N&&(K=it.isSkinnedMesh&&it.isSkinnedMesh()?it.offsetMatrix?it.offsetMatrix.array:P.IDENTITY:it.worldTransform.array);var Z=it.geometry,V=D.getMaterial.call(this,it),k=it.__program,rt=V.shader,nt=Z.__uid__+"-"+k.__uid__,q=nt!==ot;ot=nt,q&&ht&&ht.bindVertexArrayOES(null),N&&(e.a.copy(P.WORLD,K),e.a.multiply(P.WORLDVIEWPROJECTION,P.VIEWPROJECTION,K),e.a.multiplyAffine(P.WORLDVIEW,P.VIEW,K),(rt.matrixSemantics.WORLDINVERSE||rt.matrixSemantics.WORLDINVERSETRANSPOSE)&&e.a.invert(P.WORLDINVERSE,K),(rt.matrixSemantics.WORLDVIEWINVERSE||rt.matrixSemantics.WORLDVIEWINVERSETRANSPOSE)&&e.a.invert(P.WORLDVIEWINVERSE,P.WORLDVIEW),(rt.matrixSemantics.WORLDVIEWPROJECTIONINVERSE||rt.matrixSemantics.WORLDVIEWPROJECTIONINVERSETRANSPOSE)&&e.a.invert(P.WORLDVIEWPROJECTIONINVERSE,P.WORLDVIEWPROJECTION)),it.beforeRender&&it.beforeRender(this),D.beforeRender.call(this,it,V,z);var tt=k!==G;tt?(k.bind(this),k.setUniformOfSemantic(U,"VIEWPORT",L),k.setUniformOfSemantic(U,"WINDOW_SIZE",w),O&&(k.setUniformOfSemantic(U,"NEAR",O.near),k.setUniformOfSemantic(U,"FAR",O.far),this.logDepthBuffer&&k.setUniformOfSemantic(U,"LOG_DEPTH_BUFFER_FC",2/(Math.log(O.far+1)/Math.LN2))),k.setUniformOfSemantic(U,"DEVICEPIXELRATIO",S),k.setUniformOfSemantic(U,"TIME",B),k.setUniformOfSemantic(U,"VIEWPORT_SIZE",b),W&&W.setLightUniforms(k,it.lightGroup,this)):k=G,(tt||D.isMaterialChanged(it,H,V,z))&&(V.depthTest!==X&&(V.depthTest?U.enable(U.DEPTH_TEST):U.disable(U.DEPTH_TEST),X=V.depthTest),V.depthMask!==Q&&(U.depthMask(V.depthMask),Q=V.depthMask),V.transparent!==at&&(V.transparent?U.enable(U.BLEND):U.disable(U.BLEND),at=V.transparent),V.transparent&&(V.blend?V.blend(U):(U.blendEquationSeparate(U.FUNC_ADD,U.FUNC_ADD),U.blendFuncSeparate(U.SRC_ALPHA,U.ONE_MINUS_SRC_ALPHA,U.ONE,U.ONE_MINUS_SRC_ALPHA))),et=this._bindMaterial(it,V,k,H||null,z||null,G||null,D.getUniform),z=V);var st=rt.matrixSemanticKeys;if(N)for(var lt=0;lt<st.length;lt++){var _t=st[lt],vt=rt.matrixSemantics[_t],ct=P[_t];if(vt.isTranspose){var mt=P[vt.semanticNoTranspose];e.a.transpose(ct,mt)}k.setUniform(U,vt.type,vt.symbol,ct)}it.cullFace!==J&&(J=it.cullFace,U.cullFace(J)),it.frontFace!==Y&&(Y=it.frontFace,U.frontFace(Y)),it.culling!==j&&(j=it.culling,j?U.enable(U.CULL_FACE):U.disable(U.CULL_FACE)),this._updateSkeleton(it,k,et),q&&(ut=this._bindVAO(ht,rt,Z,k)),this._renderObject(it,ut,k),D.afterRender(this,it),it.afterRender&&it.afterRender(this),G=k,H=it}}this.trigger("afterrenderpass",this,T,O,D)},getMaxJointNumber:function(){return this.maxJointNumber},_updateSkeleton:function(T,O,D){var A=this.gl,C=T.skeleton;if(C)if(C.update(),T.joints.length>this.getMaxJointNumber()){var S=C.getSubSkinMatricesTexture(T.__uid__,T.joints);O.useTextureSlot(this,S,D),O.setUniform(A,"1i","skinMatricesTexture",D),O.setUniform(A,"1f","skinMatricesTextureSize",S.width)}else{var L=C.getSubSkinMatrices(T.__uid__,T.joints);O.setUniformOfSemantic(A,"SKIN_MATRIX",L)}},_renderObject:function(T,O,D){var A=this.gl,C=T.geometry,S=T.mode;S==null&&(S=4);var L=null,I=T.isInstancedMesh&&T.isInstancedMesh();if(I&&(L=this.getGLExtension("ANGLE_instanced_arrays"),!L)){console.warn("Device not support ANGLE_instanced_arrays extension");return}var w;if(I&&(w=this._bindInstancedAttributes(T,D,L)),O.indicesBuffer){var b=this.getGLExtension("OES_element_index_uint"),B=b&&C.indices instanceof Uint32Array,U=B?A.UNSIGNED_INT:A.UNSIGNED_SHORT;I?L.drawElementsInstancedANGLE(S,O.indicesBuffer.count,U,0,T.getInstanceCount()):A.drawElements(S,O.indicesBuffer.count,U,0)}else I?L.drawArraysInstancedANGLE(S,0,C.vertexCount,T.getInstanceCount()):A.drawArrays(S,0,C.vertexCount);if(I)for(var W=0;W<w.length;W++)w[W].enabled||A.disableVertexAttribArray(w[W].location),L.vertexAttribDivisorANGLE(w[W].location,0)},_bindInstancedAttributes:function(T,O,D){for(var A=this.gl,C=T.getInstancedAttributesBuffers(this),S=[],L=0;L<C.length;L++){var I=C[L],w=O.getAttribLocation(A,I.symbol);if(!(w<0)){var b=p[I.type]||A.FLOAT,B=O.isAttribEnabled(this,w);O.isAttribEnabled(this,w)||A.enableVertexAttribArray(w),S.push({location:w,enabled:B}),A.bindBuffer(A.ARRAY_BUFFER,I.buffer),A.vertexAttribPointer(w,I.size,b,!1,0,0),D.vertexAttribDivisorANGLE(w,I.divisor)}}return S},_bindMaterial:function(T,O,D,A,C,S,L){for(var I=this.gl,w=S===D,b=D.currentTextureSlot(),B=O.getEnabledUniforms(),U=O.getTextureUniforms(),W=this._placeholderTexture,z=0;z<U.length;z++){var G=U[z],H=L(T,O,G),X=O.uniforms[G].type;if(X==="t"&&H)H.__slot=-1;else if(X==="tv")for(var Q=0;Q<H.length;Q++)H[Q]&&(H[Q].__slot=-1)}W.__slot=-1;for(var z=0;z<B.length;z++){var G=B[z],j=O.uniforms[G],H=L(T,O,G),X=j.type,J=X==="t";if(J&&(!H||!H.isRenderable())&&(H=W),C&&w){var Y=L(A,C,G);if(J&&(!Y||!Y.isRenderable())&&(Y=W),Y===H){if(J)D.takeCurrentTextureSlot(this,null);else if(X==="tv"&&H)for(var Q=0;Q<H.length;Q++)D.takeCurrentTextureSlot(this,null);continue}}if(H!=null)if(J)if(H.__slot<0){var at=D.currentTextureSlot(),ot=D.setUniform(I,"1i",G,at);ot&&(D.takeCurrentTextureSlot(this,H),H.__slot=at)}else D.setUniform(I,"1i",G,H.__slot);else if(Array.isArray(H)){if(H.length===0)continue;if(X==="tv"){if(!D.hasUniform(G))continue;for(var ut=[],Q=0;Q<H.length;Q++){var et=H[Q];if(et.__slot<0){var at=D.currentTextureSlot();ut.push(at),D.takeCurrentTextureSlot(this,et),et.__slot=at}else ut.push(et.__slot)}D.setUniform(I,"1iv",G,ut)}else D.setUniform(I,j.type,G,H)}else D.setUniform(I,j.type,G,H)}var ht=D.currentTextureSlot();return D.resetTextureSlot(b),ht},_bindVAO:function(T,O,D,A){var C=!D.dynamic,S=this.gl,L=this.__uid__+"-"+A.__uid__,I=D.__vaoCache[L];if(!I){var w=D.getBufferChunks(this);if(!w||!w.length)return;for(var b=w[0],B=b.attributeBuffers,Y=b.indicesBuffer,J=[],U=[],W=0;W<B.length;W++){var z=B[W],G=z.name,H=z.semantic,X;if(H){var Q=O.attributeSemantics[H];X=Q&&Q.symbol}else X=G;X&&A.attributes[X]&&(J.push(z),U.push(X))}I=new y(J,U,Y),C&&(D.__vaoCache[L]=I)}var j=!0;T&&C&&(I.vao==null?I.vao=T.createVertexArrayOES():j=!1,T.bindVertexArrayOES(I.vao));var J=I.availableAttributes,Y=I.indicesBuffer;if(j){for(var at=A.enableAttributes(this,I.availableAttributeSymbols,T&&C&&I),W=0;W<J.length;W++){var ot=at[W];if(ot!==-1){var z=J[W],ut=z.buffer,et=z.size,ht=p[z.type]||S.FLOAT;S.bindBuffer(S.ARRAY_BUFFER,ut),S.vertexAttribPointer(ot,et,ht,!1,0,0)}}D.isUseIndices()&&S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,Y.buffer)}return I},renderPreZ:function(T,O,D){var A=this.gl,C=this._prezMaterial||new o.a({shader:new h.a(h.a.source("clay.prez.vertex"),h.a.source("clay.prez.fragment"))});this._prezMaterial=C,this.logDepthBuffer&&this._prezMaterial.setUniform("logDepthBufFC",2/(Math.log(D.far+1)/Math.LN2)),A.colorMask(!1,!1,!1,!1),A.depthMask(!0),this.renderPass(T,D,{ifRender:function(S){return!S.ignorePreZ},isMaterialChanged:function(S,L){var I=S.material,w=L.material;return I.get("diffuseMap")!==w.get("diffuseMap")||(I.get("alphaCutoff")||0)!==(w.get("alphaCutoff")||0)},getUniform:function(S,L,I){if(I==="alphaMap")return S.material.get("diffuseMap");if(I==="alphaCutoff"){if(S.material.isDefined("fragment","ALPHA_TEST")&&S.material.get("diffuseMap")){var w=S.material.get("alphaCutoff");return w||0}return 0}else return I==="uvRepeat"?S.material.get("uvRepeat"):I==="uvOffset"?S.material.get("uvOffset"):L.get(I)},getMaterial:function(){return C},sort:this.opaqueSortCompare}),A.colorMask(!0,!0,!0,!0),A.depthMask(!0)},disposeScene:function(T){this.disposeNode(T,!0,!0),T.dispose()},disposeNode:function(T,O,D){T.getParent()&&T.getParent().remove(T);var A={};T.traverse(function(C){var S=C.material;if(C.geometry&&O&&C.geometry.dispose(this),D&&S&&!A[S.__uid__]){for(var L=S.getTextureUniforms(),I=0;I<L.length;I++){var w=L[I],b=S.uniforms[w].value,B=S.uniforms[w].type;if(!!b){if(B==="t")b.dispose&&b.dispose(this);else if(B==="tv")for(var U=0;U<b.length;U++)b[U]&&b[U].dispose&&b[U].dispose(this)}}A[S.__uid__]=!0}C.dispose&&C.dispose(this)},this)},disposeGeometry:function(T){T.dispose(this)},disposeTexture:function(T){T.dispose(this)},disposeFrameBuffer:function(T){T.dispose(this)},dispose:function(){},screenToNDC:function(T,O,D){D||(D=new i.a),O=this._height-O;var A=this.viewport,C=D.array;return C[0]=(T-A.x)/A.width,C[0]=C[0]*2-1,C[1]=(O-A.y)/A.height,C[1]=C[1]*2-1,D}});M.opaqueSortCompare=M.prototype.opaqueSortCompare=function(T,O){return T.renderOrder===O.renderOrder?T.__program===O.__program?T.material===O.material?T.geometry.__uid__-O.geometry.__uid__:T.material.__uid__-O.material.__uid__:T.__program&&O.__program?T.__program.__uid__-O.__program.__uid__:0:T.renderOrder-O.renderOrder},M.transparentSortCompare=M.prototype.transparentSortCompare=function(T,O){return T.renderOrder===O.renderOrder?T.__depth===O.__depth?T.__program===O.__program?T.material===O.material?T.geometry.__uid__-O.geometry.__uid__:T.material.__uid__-O.material.__uid__:T.__program&&O.__program?T.__program.__uid__-O.__program.__uid__:0:T.__depth-O.__depth:T.renderOrder-O.renderOrder};var P={IDENTITY:l(),WORLD:l(),VIEW:l(),PROJECTION:l(),WORLDVIEW:l(),VIEWPROJECTION:l(),WORLDVIEWPROJECTION:l(),WORLDINVERSE:l(),VIEWINVERSE:l(),PROJECTIONINVERSE:l(),WORLDVIEWINVERSE:l(),VIEWPROJECTIONINVERSE:l(),WORLDVIEWPROJECTIONINVERSE:l(),WORLDTRANSPOSE:l(),VIEWTRANSPOSE:l(),PROJECTIONTRANSPOSE:l(),WORLDVIEWTRANSPOSE:l(),VIEWPROJECTIONTRANSPOSE:l(),WORLDVIEWPROJECTIONTRANSPOSE:l(),WORLDINVERSETRANSPOSE:l(),VIEWINVERSETRANSPOSE:l(),PROJECTIONINVERSETRANSPOSE:l(),WORLDVIEWINVERSETRANSPOSE:l(),VIEWPROJECTIONINVERSETRANSPOSE:l(),WORLDVIEWPROJECTIONINVERSETRANSPOSE:l()};M.COLOR_BUFFER_BIT=t.a.COLOR_BUFFER_BIT,M.DEPTH_BUFFER_BIT=t.a.DEPTH_BUFFER_BIT,M.STENCIL_BUFFER_BIT=t.a.STENCIL_BUFFER_BIT,R.a=M},function(F,R,g){function E(t,a){this.action=t,this.context=a}var c={trigger:function(t){if(!!this.hasOwnProperty("__handlers__")&&!!this.__handlers__.hasOwnProperty(t)){var a=this.__handlers__[t],o=a.length,i=-1,s=arguments;switch(s.length){case 1:for(;++i<o;)a[i].action.call(a[i].context);return;case 2:for(;++i<o;)a[i].action.call(a[i].context,s[1]);return;case 3:for(;++i<o;)a[i].action.call(a[i].context,s[1],s[2]);return;case 4:for(;++i<o;)a[i].action.call(a[i].context,s[1],s[2],s[3]);return;case 5:for(;++i<o;)a[i].action.call(a[i].context,s[1],s[2],s[3],s[4]);return;default:for(;++i<o;)a[i].action.apply(a[i].context,Array.prototype.slice.call(s,1));return}}},on:function(t,a,o){if(!(!t||!a)){var i=this.__handlers__||(this.__handlers__={});if(!i[t])i[t]=[];else if(this.has(t,a))return;var s=new E(a,o||this);return i[t].push(s),this}},once:function(t,a,o){if(!t||!a)return;var i=this;function s(){i.off(t,s),a.apply(this,arguments)}return this.on(t,s,o)},before:function(t,a,o){if(!(!t||!a))return t="before"+t,this.on(t,a,o)},after:function(t,a,o){if(!(!t||!a))return t="after"+t,this.on(t,a,o)},success:function(t,a){return this.once("success",t,a)},error:function(t,a){return this.once("error",t,a)},off:function(t,a){var o=this.__handlers__||(this.__handlers__={});if(!a){o[t]=[];return}if(o[t]){for(var i=o[t],s=[],h=0;h<i.length;h++)a&&i[h].action!==a&&s.push(i[h]);o[t]=s}return this},has:function(t,a){var o=this.__handlers__;if(!o||!o[t])return!1;for(var i=o[t],s=0;s<i.length;s++)if(i[s].action===a)return!0}};R.a=c},function(F,R,g){var E=g(3),c=g(12),t=1e-5,a=function(o,i){this.origin=o||new E.a,this.direction=i||new E.a};a.prototype={constructor:a,intersectPlane:function(o,i){var s=o.normal.array,h=o.distance,r=this.origin.array,e=this.direction.array,n=c.a.dot(s,e);if(n===0)return null;i||(i=new E.a);var l=(c.a.dot(s,r)-h)/n;return c.a.scaleAndAdd(i.array,r,e,-l),i._dirty=!0,i},mirrorAgainstPlane:function(o){var i=c.a.dot(o.normal.array,this.direction.array);c.a.scaleAndAdd(this.direction.array,this.direction.array,o.normal.array,-i*2),this.direction._dirty=!0},distanceToPoint:function(){var o=c.a.create();return function(i){c.a.sub(o,i,this.origin.array);var s=c.a.dot(o,this.direction.array);if(s<0)return c.a.distance(this.origin.array,i);var h=c.a.lenSquared(o);return Math.sqrt(h-s*s)}}(),intersectSphere:function(){var o=c.a.create();return function(i,s,h){var r=this.origin.array,e=this.direction.array;i=i.array,c.a.sub(o,i,r);var n=c.a.dot(o,e),l=c.a.squaredLength(o),u=l-n*n,_=s*s;if(!(u>_)){var f=Math.sqrt(_-u),d=n-f,v=n+f;return h||(h=new E.a),d<0?v<0?null:(c.a.scaleAndAdd(h.array,r,e,v),h):(c.a.scaleAndAdd(h.array,r,e,d),h)}}}(),intersectBoundingBox:function(o,i){var s=this.direction.array,h=this.origin.array,r=o.min.array,e=o.max.array,n=1/s[0],l=1/s[1],u=1/s[2],_,f,d,v,m,p;if(n>=0?(_=(r[0]-h[0])*n,f=(e[0]-h[0])*n):(f=(r[0]-h[0])*n,_=(e[0]-h[0])*n),l>=0?(d=(r[1]-h[1])*l,v=(e[1]-h[1])*l):(v=(r[1]-h[1])*l,d=(e[1]-h[1])*l),_>v||d>f||((d>_||_!==_)&&(_=d),(v<f||f!==f)&&(f=v),u>=0?(m=(r[2]-h[2])*u,p=(e[2]-h[2])*u):(p=(r[2]-h[2])*u,m=(e[2]-h[2])*u),_>p||m>f)||((m>_||_!==_)&&(_=m),(p<f||f!==f)&&(f=p),f<0))return null;var y=_>=0?_:f;return i||(i=new E.a),c.a.scaleAndAdd(i.array,h,s,y),i},intersectTriangle:function(){var o=c.a.create(),i=c.a.create(),s=c.a.create(),h=c.a.create();return function(r,e,n,l,u,_){var f=this.direction.array,d=this.origin.array;r=r.array,e=e.array,n=n.array,c.a.sub(o,e,r),c.a.sub(i,n,r),c.a.cross(h,i,f);var v=c.a.dot(o,h);if(l){if(v>-t)return null}else if(v>-t&&v<t)return null;c.a.sub(s,d,r);var m=c.a.dot(h,s)/v;if(m<0||m>1)return null;c.a.cross(h,o,s);var p=c.a.dot(f,h)/v;if(p<0||p>1||m+p>1)return null;c.a.cross(h,o,i);var y=-c.a.dot(s,h)/v;return y<0?null:(u||(u=new E.a),_&&E.a.set(_,1-m-p,m,p),c.a.scaleAndAdd(u.array,d,f,y),u)}}(),applyTransform:function(o){E.a.add(this.direction,this.direction,this.origin),E.a.transformMat4(this.origin,this.origin,o),E.a.transformMat4(this.direction,this.direction,o),E.a.sub(this.direction,this.direction,this.origin),E.a.normalize(this.direction,this.direction)},copy:function(o){E.a.copy(this.origin,o.origin),E.a.copy(this.direction,o.direction)},clone:function(){var o=new a;return o.copy(this),o}},R.a=a},function(F,R,g){var E=g(20),c=g(12),t=g(33),a=g(34),o={};o.create=function(){var i=new E.a(4);return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i},o.rotationTo=function(){var i=c.a.create(),s=c.a.fromValues(1,0,0),h=c.a.fromValues(0,1,0);return function(r,e,n){var l=c.a.dot(e,n);return l<-.999999?(c.a.cross(i,s,e),c.a.length(i)<1e-6&&c.a.cross(i,h,e),c.a.normalize(i,i),o.setAxisAngle(r,i,Math.PI),r):l>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(c.a.cross(i,e,n),r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=1+l,o.normalize(r,r))}}(),o.setAxes=function(){var i=a.a.create();return function(s,h,r,e){return i[0]=r[0],i[3]=r[1],i[6]=r[2],i[1]=e[0],i[4]=e[1],i[7]=e[2],i[2]=-h[0],i[5]=-h[1],i[8]=-h[2],o.normalize(s,o.fromMat3(s,i))}}(),o.clone=t.a.clone,o.fromValues=t.a.fromValues,o.copy=t.a.copy,o.set=t.a.set,o.identity=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i},o.setAxisAngle=function(i,s,h){h=h*.5;var r=Math.sin(h);return i[0]=r*s[0],i[1]=r*s[1],i[2]=r*s[2],i[3]=Math.cos(h),i},o.add=t.a.add,o.multiply=function(i,s,h){var r=s[0],e=s[1],n=s[2],l=s[3],u=h[0],_=h[1],f=h[2],d=h[3];return i[0]=r*d+l*u+e*f-n*_,i[1]=e*d+l*_+n*u-r*f,i[2]=n*d+l*f+r*_-e*u,i[3]=l*d-r*u-e*_-n*f,i},o.mul=o.multiply,o.scale=t.a.scale,o.rotateX=function(i,s,h){h*=.5;var r=s[0],e=s[1],n=s[2],l=s[3],u=Math.sin(h),_=Math.cos(h);return i[0]=r*_+l*u,i[1]=e*_+n*u,i[2]=n*_-e*u,i[3]=l*_-r*u,i},o.rotateY=function(i,s,h){h*=.5;var r=s[0],e=s[1],n=s[2],l=s[3],u=Math.sin(h),_=Math.cos(h);return i[0]=r*_-n*u,i[1]=e*_+l*u,i[2]=n*_+r*u,i[3]=l*_-e*u,i},o.rotateZ=function(i,s,h){h*=.5;var r=s[0],e=s[1],n=s[2],l=s[3],u=Math.sin(h),_=Math.cos(h);return i[0]=r*_+e*u,i[1]=e*_-r*u,i[2]=n*_+l*u,i[3]=l*_-n*u,i},o.calculateW=function(i,s){var h=s[0],r=s[1],e=s[2];return i[0]=h,i[1]=r,i[2]=e,i[3]=Math.sqrt(Math.abs(1-h*h-r*r-e*e)),i},o.dot=t.a.dot,o.lerp=t.a.lerp,o.slerp=function(i,s,h,r){var e=s[0],n=s[1],l=s[2],u=s[3],_=h[0],f=h[1],d=h[2],v=h[3],m,p,y,x,M;return p=e*_+n*f+l*d+u*v,p<0&&(p=-p,_=-_,f=-f,d=-d,v=-v),1-p>1e-6?(m=Math.acos(p),y=Math.sin(m),x=Math.sin((1-r)*m)/y,M=Math.sin(r*m)/y):(x=1-r,M=r),i[0]=x*e+M*_,i[1]=x*n+M*f,i[2]=x*l+M*d,i[3]=x*u+M*v,i},o.invert=function(i,s){var h=s[0],r=s[1],e=s[2],n=s[3],l=h*h+r*r+e*e+n*n,u=l?1/l:0;return i[0]=-h*u,i[1]=-r*u,i[2]=-e*u,i[3]=n*u,i},o.conjugate=function(i,s){return i[0]=-s[0],i[1]=-s[1],i[2]=-s[2],i[3]=s[3],i},o.length=t.a.length,o.len=o.length,o.squaredLength=t.a.squaredLength,o.sqrLen=o.squaredLength,o.normalize=t.a.normalize,o.fromMat3=function(i,s){var h=s[0]+s[4]+s[8],r;if(h>0)r=Math.sqrt(h+1),i[3]=.5*r,r=.5/r,i[0]=(s[5]-s[7])*r,i[1]=(s[6]-s[2])*r,i[2]=(s[1]-s[3])*r;else{var e=0;s[4]>s[0]&&(e=1),s[8]>s[e*3+e]&&(e=2);var n=(e+1)%3,l=(e+2)%3;r=Math.sqrt(s[e*3+e]-s[n*3+n]-s[l*3+l]+1),i[e]=.5*r,r=.5/r,i[3]=(s[n*3+l]-s[l*3+n])*r,i[n]=(s[n*3+e]+s[e*3+n])*r,i[l]=(s[l*3+e]+s[e*3+l])*r}return i},R.a=o},function(F,R,g){var E=g(55),c=g(34),t=function(i,s,h,r){i=i||0,s=s||0,h=h||0,r=r===void 0?1:r,this.array=E.a.fromValues(i,s,h,r),this._dirty=!0};t.prototype={constructor:t,add:function(i){return E.a.add(this.array,this.array,i.array),this._dirty=!0,this},calculateW:function(){return E.a.calculateW(this.array,this.array),this._dirty=!0,this},set:function(i,s,h,r){return this.array[0]=i,this.array[1]=s,this.array[2]=h,this.array[3]=r,this._dirty=!0,this},setArray:function(i){return this.array[0]=i[0],this.array[1]=i[1],this.array[2]=i[2],this.array[3]=i[3],this._dirty=!0,this},clone:function(){return new t(this.x,this.y,this.z,this.w)},conjugate:function(){return E.a.conjugate(this.array,this.array),this._dirty=!0,this},copy:function(i){return E.a.copy(this.array,i.array),this._dirty=!0,this},dot:function(i){return E.a.dot(this.array,i.array)},fromMat3:function(i){return E.a.fromMat3(this.array,i.array),this._dirty=!0,this},fromMat4:function(){var i=c.a.create();return function(s){return c.a.fromMat4(i,s.array),c.a.transpose(i,i),E.a.fromMat3(this.array,i),this._dirty=!0,this}}(),identity:function(){return E.a.identity(this.array),this._dirty=!0,this},invert:function(){return E.a.invert(this.array,this.array),this._dirty=!0,this},len:function(){return E.a.len(this.array)},length:function(){return E.a.length(this.array)},lerp:function(i,s,h){return E.a.lerp(this.array,i.array,s.array,h),this._dirty=!0,this},mul:function(i){return E.a.mul(this.array,this.array,i.array),this._dirty=!0,this},mulLeft:function(i){return E.a.multiply(this.array,i.array,this.array),this._dirty=!0,this},multiply:function(i){return E.a.multiply(this.array,this.array,i.array),this._dirty=!0,this},multiplyLeft:function(i){return E.a.multiply(this.array,i.array,this.array),this._dirty=!0,this},normalize:function(){return E.a.normalize(this.array,this.array),this._dirty=!0,this},rotateX:function(i){return E.a.rotateX(this.array,this.array,i),this._dirty=!0,this},rotateY:function(i){return E.a.rotateY(this.array,this.array,i),this._dirty=!0,this},rotateZ:function(i){return E.a.rotateZ(this.array,this.array,i),this._dirty=!0,this},rotationTo:function(i,s){return E.a.rotationTo(this.array,i.array,s.array),this._dirty=!0,this},setAxes:function(i,s,h){return E.a.setAxes(this.array,i.array,s.array,h.array),this._dirty=!0,this},setAxisAngle:function(i,s){return E.a.setAxisAngle(this.array,i.array,s),this._dirty=!0,this},slerp:function(i,s,h){return E.a.slerp(this.array,i.array,s.array,h),this._dirty=!0,this},sqrLen:function(){return E.a.sqrLen(this.array)},squaredLength:function(){return E.a.squaredLength(this.array)},fromEuler:function(i,s){return t.fromEuler(this,i,s)},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};var a=Object.defineProperty;if(a){var o=t.prototype;a(o,"x",{get:function(){return this.array[0]},set:function(i){this.array[0]=i,this._dirty=!0}}),a(o,"y",{get:function(){return this.array[1]},set:function(i){this.array[1]=i,this._dirty=!0}}),a(o,"z",{get:function(){return this.array[2]},set:function(i){this.array[2]=i,this._dirty=!0}}),a(o,"w",{get:function(){return this.array[3]},set:function(i){this.array[3]=i,this._dirty=!0}})}t.add=function(i,s,h){return E.a.add(i.array,s.array,h.array),i._dirty=!0,i},t.set=function(i,s,h,r,e){E.a.set(i.array,s,h,r,e),i._dirty=!0},t.copy=function(i,s){return E.a.copy(i.array,s.array),i._dirty=!0,i},t.calculateW=function(i,s){return E.a.calculateW(i.array,s.array),i._dirty=!0,i},t.conjugate=function(i,s){return E.a.conjugate(i.array,s.array),i._dirty=!0,i},t.identity=function(i){return E.a.identity(i.array),i._dirty=!0,i},t.invert=function(i,s){return E.a.invert(i.array,s.array),i._dirty=!0,i},t.dot=function(i,s){return E.a.dot(i.array,s.array)},t.len=function(i){return E.a.length(i.array)},t.lerp=function(i,s,h,r){return E.a.lerp(i.array,s.array,h.array,r),i._dirty=!0,i},t.slerp=function(i,s,h,r){return E.a.slerp(i.array,s.array,h.array,r),i._dirty=!0,i},t.mul=function(i,s,h){return E.a.multiply(i.array,s.array,h.array),i._dirty=!0,i},t.multiply=t.mul,t.rotateX=function(i,s,h){return E.a.rotateX(i.array,s.array,h),i._dirty=!0,i},t.rotateY=function(i,s,h){return E.a.rotateY(i.array,s.array,h),i._dirty=!0,i},t.rotateZ=function(i,s,h){return E.a.rotateZ(i.array,s.array,h),i._dirty=!0,i},t.setAxisAngle=function(i,s,h){return E.a.setAxisAngle(i.array,s.array,h),i._dirty=!0,i},t.normalize=function(i,s){return E.a.normalize(i.array,s.array),i._dirty=!0,i},t.sqrLen=function(i){return E.a.sqrLen(i.array)},t.squaredLength=t.sqrLen,t.fromMat3=function(i,s){return E.a.fromMat3(i.array,s.array),i._dirty=!0,i},t.setAxes=function(i,s,h,r){return E.a.setAxes(i.array,s.array,h.array,r.array),i._dirty=!0,i},t.rotationTo=function(i,s,h){return E.a.rotationTo(i.array,s.array,h.array),i._dirty=!0,i},t.fromEuler=function(i,s,h){i._dirty=!0,s=s.array;var r=i.array,e=Math.cos(s[0]/2),n=Math.cos(s[1]/2),l=Math.cos(s[2]/2),u=Math.sin(s[0]/2),_=Math.sin(s[1]/2),f=Math.sin(s[2]/2),h=(h||"XYZ").toUpperCase();switch(h){case"XYZ":r[0]=u*n*l+e*_*f,r[1]=e*_*l-u*n*f,r[2]=e*n*f+u*_*l,r[3]=e*n*l-u*_*f;break;case"YXZ":r[0]=u*n*l+e*_*f,r[1]=e*_*l-u*n*f,r[2]=e*n*f-u*_*l,r[3]=e*n*l+u*_*f;break;case"ZXY":r[0]=u*n*l-e*_*f,r[1]=e*_*l+u*n*f,r[2]=e*n*f+u*_*l,r[3]=e*n*l-u*_*f;break;case"ZYX":r[0]=u*n*l-e*_*f,r[1]=e*_*l+u*n*f,r[2]=e*n*f-u*_*l,r[3]=e*n*l+u*_*f;break;case"YZX":r[0]=u*n*l+e*_*f,r[1]=e*_*l+u*n*f,r[2]=e*n*f-u*_*l,r[3]=e*n*l-u*_*f;break;case"XZY":r[0]=u*n*l-e*_*f,r[1]=e*_*l-u*n*f,r[2]=e*n*f+u*_*l,r[3]=e*n*l+u*_*f;break}},R.a=t},function(F,R,g){var E="__dt__",c=function(){this._contextId=0,this._caches=[],this._context={}};c.prototype={use:function(t,a){var o=this._caches;o[t]||(o[t]={},a&&(o[t]=a())),this._contextId=t,this._context=o[t]},put:function(t,a){this._context[t]=a},get:function(t){return this._context[t]},dirty:function(t){t=t||"";var a=E+t;this.put(a,!0)},dirtyAll:function(t){t=t||"";for(var a=E+t,o=this._caches,i=0;i<o.length;i++)o[i]&&(o[i][a]=!0)},fresh:function(t){t=t||"";var a=E+t;this.put(a,!1)},freshAll:function(t){t=t||"";for(var a=E+t,o=this._caches,i=0;i<o.length;i++)o[i]&&(o[i][a]=!1)},isDirty:function(t){t=t||"";var a=E+t,o=this._context;return!o.hasOwnProperty(a)||o[a]===!0},deleteContext:function(t){delete this._caches[t],this._context={}},delete:function(t){delete this._context[t]},clearAll:function(){this._caches={}},getContext:function(){return this._context},eachContext:function(t,a){var o=Object.keys(this._caches);o.forEach(function(i){t&&t.call(a,i)})},miss:function(t){return!this._context.hasOwnProperty(t)}},c.prototype.constructor=c,R.a=c},function(F,R,g){var E=g(35),c=g(7),t=g(59),a=g(54),o=g(33),i=g(12),s=E.a.extend(function(){return{projectionMatrix:new c.a,invProjectionMatrix:new c.a,viewMatrix:new c.a,frustum:new t.a}},function(){this.update(!0)},{update:function(h){E.a.prototype.update.call(this,h),c.a.invert(this.viewMatrix,this.worldTransform),this.updateProjectionMatrix(),c.a.invert(this.invProjectionMatrix,this.projectionMatrix),this.frustum.setFromProjection(this.projectionMatrix)},setViewMatrix:function(h){c.a.copy(this.viewMatrix,h),c.a.invert(this.worldTransform,h),this.decomposeWorldTransform()},decomposeProjectionMatrix:function(){},setProjectionMatrix:function(h){c.a.copy(this.projectionMatrix,h),c.a.invert(this.invProjectionMatrix,h),this.decomposeProjectionMatrix()},updateProjectionMatrix:function(){},castRay:function(){var h=o.a.create();return function(r,e){var n=e!==void 0?e:new a.a,l=r.array[0],u=r.array[1];return o.a.set(h,l,u,-1,1),o.a.transformMat4(h,h,this.invProjectionMatrix.array),o.a.transformMat4(h,h,this.worldTransform.array),i.a.scale(n.origin.array,h,1/h[3]),o.a.set(h,l,u,1,1),o.a.transformMat4(h,h,this.invProjectionMatrix.array),o.a.transformMat4(h,h,this.worldTransform.array),i.a.scale(h,h,1/h[3]),i.a.sub(n.direction.array,h,n.origin.array),i.a.normalize(n.direction.array,n.direction.array),n.direction._dirty=!0,n.origin._dirty=!0,n}}()});R.a=s},function(F,R,g){var E=g(18),c=g(73),t=g(12),a=t.a.set,o=t.a.copy,i=t.a.transformMat4,s=Math.min,h=Math.max,r=function(){this.planes=[];for(var e=0;e<6;e++)this.planes.push(new c.a);this.boundingBox=new E.a,this.vertices=[];for(var e=0;e<8;e++)this.vertices[e]=t.a.fromValues(0,0,0)};r.prototype={setFromProjection:function(e){var n=this.planes,l=e.array,u=l[0],_=l[1],f=l[2],d=l[3],v=l[4],m=l[5],p=l[6],y=l[7],x=l[8],M=l[9],P=l[10],T=l[11],O=l[12],D=l[13],A=l[14],C=l[15];a(n[0].normal.array,d-u,y-v,T-x),n[0].distance=-(C-O),n[0].normalize(),a(n[1].normal.array,d+u,y+v,T+x),n[1].distance=-(C+O),n[1].normalize(),a(n[2].normal.array,d+_,y+m,T+M),n[2].distance=-(C+D),n[2].normalize(),a(n[3].normal.array,d-_,y-m,T-M),n[3].distance=-(C-D),n[3].normalize(),a(n[4].normal.array,d-f,y-p,T-P),n[4].distance=-(C-A),n[4].normalize(),a(n[5].normal.array,d+f,y+p,T+P),n[5].distance=-(C+A),n[5].normalize();var S=this.boundingBox,L=this.vertices;if(C===0){var I=m/u,w=-A/(P-1),b=-A/(P+1),B=-b/m,U=-w/m;S.min.set(-B*I,-B,b),S.max.set(B*I,B,w),a(L[0],-B*I,-B,b),a(L[1],-B*I,B,b),a(L[2],B*I,-B,b),a(L[3],B*I,B,b),a(L[4],-U*I,-U,w),a(L[5],-U*I,U,w),a(L[6],U*I,-U,w),a(L[7],U*I,U,w)}else{var W=(-1-O)/u,z=(1-O)/u,G=(1-D)/m,H=(-1-D)/m,X=(-1-A)/P,Q=(1-A)/P;S.min.set(Math.min(W,z),Math.min(H,G),Math.min(Q,X)),S.max.set(Math.max(z,W),Math.max(G,H),Math.max(X,Q));var j=S.min.array,J=S.max.array;a(L[0],j[0],j[1],j[2]),a(L[1],j[0],J[1],j[2]),a(L[2],J[0],j[1],j[2]),a(L[3],J[0],J[1],j[2]),a(L[4],j[0],j[1],J[2]),a(L[5],j[0],J[1],J[2]),a(L[6],J[0],j[1],J[2]),a(L[7],J[0],J[1],J[2])}},getTransformedBoundingBox:function(){var e=t.a.create();return function(n,l){var u=this.vertices,_=l.array,f=n.min,d=n.max,v=f.array,m=d.array,p=u[0];i(e,p,_),o(v,e),o(m,e);for(var y=1;y<8;y++)p=u[y],i(e,p,_),v[0]=s(e[0],v[0]),v[1]=s(e[1],v[1]),v[2]=s(e[2],v[2]),m[0]=h(e[0],m[0]),m[1]=h(e[1],m[1]),m[2]=h(e[2],m[2]);return f._dirty=!0,d._dirty=!0,n}}()},R.a=r},function(F,R,g){var E=g(5),c=g(27),t=g(13),a=g(61),o=g(75),i=g(36),s=g(121),h=g(122),r={loadTexture:function(e,n,l,u){var _;if(typeof n=="function"?(l=n,u=l,n={}):n=n||{},typeof e=="string"){if(e.match(/.hdr$/)||n.fileType==="hdr")return _=new E.a({width:0,height:0,sRGB:!1}),r._fetchTexture(e,function(f){h.a.parseRGBE(f,_,n.exposure),_.dirty(),l&&l(_)},u),_;e.match(/.dds$/)||n.fileType==="dds"?(_=new E.a({width:0,height:0}),r._fetchTexture(e,function(f){s.a.parse(f,_),_.dirty(),l&&l(_)},u)):(_=new E.a,_.load(e),_.success(l),_.error(u))}else typeof e=="object"&&typeof e.px!="undefined"&&(_=new c.a,_.load(e),_.success(l),_.error(u));return _},loadPanorama:function(e,n,l,u,_,f){var d=this;typeof u=="function"?(_=u,f=_,u={}):u=u||{},r.loadTexture(n,u,function(v){v.flipY=u.flipY||!1,d.panoramaToCubeMap(e,v,l,u),v.dispose(e),_&&_(l)},f)},panoramaToCubeMap:function(e,n,l,u){var _=new a.a,f=new o.a({scene:new i.a});return f.setEnvironmentMap(n),u=u||{},u.encodeRGBM&&f.material.define("fragment","RGBM_ENCODE"),l.sRGB=n.sRGB,_.texture=l,_.render(e,f.scene),_.texture=null,_.dispose(e),l},heightToNormal:function(e,n){var l=document.createElement("canvas"),u=l.width=e.width,_=l.height=e.height,f=l.getContext("2d");f.drawImage(e,0,0,u,_),n=n||!1;for(var d=f.getImageData(0,0,u,_),v=f.createImageData(u,_),m=0;m<d.data.length;m+=4){if(n){var p=d.data[m],y=d.data[m+1],x=d.data[m+2],M=Math.abs(p-y)+Math.abs(y-x);if(M>20)return console.warn("Given image is not a height map"),e}var P,T,O,D;m%(u*4)==0?(P=d.data[m],O=d.data[m+4]):m%(u*4)==(u-1)*4?(P=d.data[m-4],O=d.data[m]):(P=d.data[m-4],O=d.data[m+4]),m<u*4?(T=d.data[m],D=d.data[m+u*4]):m>u*(_-1)*4?(T=d.data[m-u*4],D=d.data[m]):(T=d.data[m-u*4],D=d.data[m+u*4]),v.data[m]=P-O+127,v.data[m+1]=T-D+127,v.data[m+2]=255,v.data[m+3]=255}return f.putImageData(v,0,0),l},isHeightImage:function(e,n,l){if(!e||!e.width||!e.height)return!1;var u=document.createElement("canvas"),_=u.getContext("2d"),f=n||32;l=l||20,u.width=u.height=f,_.drawImage(e,0,0,f,f);for(var d=_.getImageData(0,0,f,f),v=0;v<d.data.length;v+=4){var m=d.data[v],p=d.data[v+1],y=d.data[v+2],x=Math.abs(m-p)+Math.abs(p-y);if(x>l)return!1}return!0},_fetchTexture:function(e,n,l){t.a.request.get({url:e,responseType:"arraybuffer",onload:n,onerror:l})},createChessboard:function(e,n,l,u){e=e||512,n=n||64,l=l||"black",u=u||"white";var _=Math.ceil(e/n),f=document.createElement("canvas");f.width=e,f.height=e;var d=f.getContext("2d");d.fillStyle=u,d.fillRect(0,0,e,e),d.fillStyle=l;for(var v=0;v<_;v++)for(var m=0;m<_;m++){var p=m%2?v%2:v%2-1;p&&d.fillRect(v*n,m*n,n,n)}var y=new E.a({image:f,anisotropic:8});return y},createBlank:function(e){var n=document.createElement("canvas");n.width=1,n.height=1;var l=n.getContext("2d");l.fillStyle=e,l.fillRect(0,0,1,1);var u=new E.a({image:n});return u}};R.a=r},function(F,R,g){var E=g(8),c=g(3),t=g(37),a=g(10),o=["px","nx","py","ny","pz","nz"],i=E.a.extend(function(){var s={position:new c.a,far:1e3,near:.1,texture:null,shadowMapPass:null},h=s._cameras={px:new t.a({fov:90}),nx:new t.a({fov:90}),py:new t.a({fov:90}),ny:new t.a({fov:90}),pz:new t.a({fov:90}),nz:new t.a({fov:90})};return h.px.lookAt(c.a.POSITIVE_X,c.a.NEGATIVE_Y),h.nx.lookAt(c.a.NEGATIVE_X,c.a.NEGATIVE_Y),h.py.lookAt(c.a.POSITIVE_Y,c.a.POSITIVE_Z),h.ny.lookAt(c.a.NEGATIVE_Y,c.a.NEGATIVE_Z),h.pz.lookAt(c.a.POSITIVE_Z,c.a.NEGATIVE_Y),h.nz.lookAt(c.a.NEGATIVE_Z,c.a.NEGATIVE_Y),s._frameBuffer=new a.a,s},{getCamera:function(s){return this._cameras[s]},render:function(s,h,r){var e=s.gl;r||h.update();for(var n=this.texture.width,l=2*Math.atan(n/(n-.5))/Math.PI*180,u=0;u<6;u++){var _=o[u],f=this._cameras[_];if(c.a.copy(f.position,this.position),f.far=this.far,f.near=this.near,f.fov=l,this.shadowMapPass){f.update();var d=h.getBoundingBox();d.applyTransform(f.viewMatrix),h.viewBoundingBoxLastFrame.copy(d),this.shadowMapPass.render(s,h,f,!0)}this._frameBuffer.attach(this.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+u),this._frameBuffer.bind(s),s.render(h,f,!0),this._frameBuffer.unbind(s)}},dispose:function(s){this._frameBuffer.dispose(s)}});R.a=i},function(F,R,g){var E=g(1),c=g(164),t=g(165);E.a.Shader.import(t.a),R.a=E.a.Mesh.extend(function(){var a=new c.a({dynamic:!0}),o=new E.a.Material({shader:E.a.createShader("ecgl.labels"),transparent:!0,depthMask:!1});return{geometry:a,material:o,culling:!1,castShadow:!1,ignorePicking:!0}})},function(F,R,g){var E=g(0),c=g.n(E),t=g(1),a=g(206),o=g(25),i=g(2),s=g(6),h=g(64),r=g(65),e=g(46),n=s.a.vec3;t.a.Shader.import(e.a);function l(u){this.rootNode=new t.a.Node,this._triangulationResults={},this._shadersMap=t.a.COMMON_SHADERS.reduce(function(f,d){return f[d]=t.a.createShader("ecgl."+d),f},{}),this._linesShader=t.a.createShader("ecgl.meshLines3D");var _={};t.a.COMMON_SHADERS.forEach(function(f){_[f]=new t.a.Material({shader:t.a.createShader("ecgl."+f)})}),this._groundMaterials=_,this._groundMesh=new t.a.Mesh({geometry:new t.a.PlaneGeometry({dynamic:!0}),castShadow:!1,renderNormal:!0,$ignorePicking:!0}),this._groundMesh.rotation.rotateX(-Math.PI/2),this._labelsBuilder=new r.a(512,512,u),this._labelsBuilder.getMesh().renderOrder=100,this._labelsBuilder.getMesh().material.depthTest=!1,this.rootNode.add(this._labelsBuilder.getMesh()),this._initMeshes(),this._api=u}l.prototype={constructor:l,extrudeY:!0,update:function(u,_,f,d,v){var m=u.getData();d==null&&(d=0),v==null&&(v=m.count()),this._startIndex=d,this._endIndex=v-1,this._triangulation(u,d,v);var p=this._getShader(u.get("shading"));this._prepareMesh(u,p,f,d,v),this.rootNode.updateWorldTransform(),this._updateRegionMesh(u,f,d,v);var y=u.coordinateSystem;y.type==="geo3D"&&this._updateGroundPlane(u,y,f);var x=this;this._labelsBuilder.updateData(m,d,v),this._labelsBuilder.getLabelPosition=function(M,P,T){var O=m.getName(M),D,A=T;if(y.type==="geo3D"){var C=y.getRegion(O);if(!C)return[NaN,NaN,NaN];D=C.center;var S=y.dataToPoint([D[0],D[1],A]);return S}else var L=x._triangulationResults[M-x._startIndex],D=x.extrudeY?[(L.max[0]+L.min[0])/2,L.max[1]+A,(L.max[2]+L.min[2])/2]:[(L.max[0]+L.min[0])/2,(L.max[1]+L.min[1])/2,L.max[2]+A]},this._data=m,this._labelsBuilder.updateLabels(),this._updateDebugWireframe(u),this._lastHoverDataIndex=0},_initMeshes:function(){var u=this;function _(){var v=new t.a.Mesh({name:"Polygon",material:new t.a.Material({shader:u._shadersMap.lambert}),geometry:new t.a.Geometry({sortTriangles:!0,dynamic:!0}),culling:!1,ignorePicking:!0,renderNormal:!0});return c.a.util.extend(v.geometry,h.a),v}var f=_(),d=new t.a.Mesh({material:new t.a.Material({shader:this._linesShader}),castShadow:!1,ignorePicking:!0,$ignorePicking:!0,geometry:new o.a({useNativeLine:!1})});this.rootNode.add(f),this.rootNode.add(d),f.material.define("both","VERTEX_COLOR"),f.material.define("fragment","DOUBLE_SIDED"),this._polygonMesh=f,this._linesMesh=d,this.rootNode.add(this._groundMesh)},_getShader:function(u){var _=this._shadersMap[u];return _||(console.warn("Unkown shading "+u),_=this._shadersMap.lambert),_.__shading=u,_},_prepareMesh:function(u,_,f,d,v){for(var m=0,p=0,y=0,x=0,M=d;M<v;M++){var P=this._getRegionPolygonInfo(M),T=this._getRegionLinesInfo(M,u,this._linesMesh.geometry);m+=P.vertexCount,p+=P.triangleCount,y+=T.vertexCount,x+=T.triangleCount}var O=this._polygonMesh,D=O.geometry;["position","normal","texcoord0","color"].forEach(function(A){D.attributes[A].init(m)}),D.indices=m>65535?new Uint32Array(p*3):new Uint16Array(p*3),O.material.shader!==_&&O.material.attachShader(_,!0),t.a.setMaterialFromModel(_.__shading,O.material,u,f),y>0&&(this._linesMesh.geometry.resetOffset(),this._linesMesh.geometry.setVertexCount(y),this._linesMesh.geometry.setTriangleCount(x)),this._dataIndexOfVertex=new Uint32Array(m),this._vertexRangeOfDataIndex=new Uint32Array((v-d)*2)},_updateRegionMesh:function(u,_,f,d){for(var v=u.getData(),m=0,p=0,y=!1,x=this._polygonMesh,M=this._linesMesh,P=f;P<d;P++){var T=u.getRegionModel(P),O=T.getModel("itemStyle"),D=O.get("color"),A=i.a.firstNotNull(O.get("opacity"),1),C=v.getItemVisual(P,"color",!0);C!=null&&v.hasValue(P)&&(D=C),v.setItemVisual(P,"color",D),v.setItemVisual(P,"opacity",A),D=t.a.parseColor(D);var S=t.a.parseColor(O.get("borderColor"));D[3]*=A,S[3]*=A;var L=D[3]<.99;x.material.set("color",[1,1,1,1]),y=y||L;for(var I=i.a.firstNotNull(T.get("height",!0),u.get("regionHeight")),w=this._updatePolygonGeometry(u,x.geometry,P,I,m,p,D),b=m;b<w.vertexOffset;b++)this._dataIndexOfVertex[b]=P;this._vertexRangeOfDataIndex[(P-f)*2]=m,this._vertexRangeOfDataIndex[(P-f)*2+1]=w.vertexOffset,m=w.vertexOffset,p=w.triangleOffset;var B=O.get("borderWidth"),U=B>0;U&&(B*=_.getDevicePixelRatio(),this._updateLinesGeometry(M.geometry,u,P,I,B,u.coordinateSystem.transform)),M.invisible=!U,M.material.set({color:S})}var x=this._polygonMesh;x.material.transparent=y,x.material.depthMask=!y,x.geometry.updateBoundingBox(),x.frontFace=this.extrudeY?t.a.Mesh.CCW:t.a.Mesh.CW,x.material.get("normalMap")&&x.geometry.generateTangents(),x.seriesIndex=u.seriesIndex,x.on("mousemove",this._onmousemove,this),x.on("mouseout",this._onmouseout,this)},_updateDebugWireframe:function(u){var _=u.getModel("debug.wireframe");if(_.get("show")){var f=t.a.parseColor(_.get("lineStyle.color")||"rgba(0,0,0,0.5)"),d=i.a.firstNotNull(_.get("lineStyle.width"),1),v=this._polygonMesh;v.geometry.generateBarycentric(),v.material.define("both","WIREFRAME_TRIANGLE"),v.material.set("wireframeLineColor",f),v.material.set("wireframeLineWidth",d)}},_onmousemove:function(u){var _=this._dataIndexOfVertex[u.triangle[0]];_==null&&(_=-1),_!==this._lastHoverDataIndex&&(this.downplay(this._lastHoverDataIndex),this.highlight(_),this._labelsBuilder.updateLabels([_])),this._lastHoverDataIndex=_,this._polygonMesh.dataIndex=_},_onmouseout:function(u){u.target&&(this.downplay(this._lastHoverDataIndex),this._lastHoverDataIndex=-1,this._polygonMesh.dataIndex=-1),this._labelsBuilder.updateLabels([])},_updateGroundPlane:function(u,_,f){var d=u.getModel("groundPlane",u);if(this._groundMesh.invisible=!d.get("show",!0),!this._groundMesh.invisible){var v=u.get("shading"),m=this._groundMaterials[v];m||(console.warn("Unkown shading "+v),m=this._groundMaterials.lambert),t.a.setMaterialFromModel(v,m,d,f),m.get("normalMap")&&this._groundMesh.geometry.generateTangents(),this._groundMesh.material=m,this._groundMesh.material.set("color",t.a.parseColor(d.get("color"))),this._groundMesh.scale.set(_.size[0],_.size[2],1)}},_triangulation:function(u,_,f){this._triangulationResults=[];for(var d=[Infinity,Infinity,Infinity],v=[-Infinity,-Infinity,-Infinity],m=u.coordinateSystem,p=_;p<f;p++){for(var y=[],x=u.getRegionPolygonCoords(p),M=0;M<x.length;M++){var P=x[M].exterior,T=x[M].interiors,O=[],D=[];if(!(P.length<3)){for(var A=0,C=0;C<P.length;C++){var S=P[C];O[A++]=S[0],O[A++]=S[1]}for(var C=0;C<T.length;C++)if(!(T[C].length<3)){for(var L=O.length/2,I=0;I<T[C].length;I++){var S=T[C][I];O.push(S[0]),O.push(S[1])}D.push(L)}for(var w=Object(a.a)(O,D),b=new Float64Array(O.length/2*3),B=[],U=[Infinity,Infinity,Infinity],W=[-Infinity,-Infinity,-Infinity],z=0,C=0;C<O.length;)n.set(B,O[C++],0,O[C++]),m&&m.transform&&n.transformMat4(B,B,m.transform),n.min(U,U,B),n.max(W,W,B),b[z++]=B[0],b[z++]=B[1],b[z++]=B[2];n.min(d,d,U),n.max(v,v,W),y.push({points:b,indices:w,min:U,max:W})}}this._triangulationResults.push(y)}this._geoBoundingBox=[d,v]},_getRegionPolygonInfo:function(u){for(var _=this._triangulationResults[u-this._startIndex],f=0,d=0,v=0;v<_.length;v++)f+=_[v].points.length/3,d+=_[v].indices.length/3;var m=f*2+f*4,p=d*2+f*2;return{vertexCount:m,triangleCount:p}},_updatePolygonGeometry:function(u,_,f,d,v,m,p){var y=u.get("projectUVOnGround"),x=_.attributes.position,M=_.attributes.normal,P=_.attributes.texcoord0,T=_.attributes.color,O=this._triangulationResults[f-this._startIndex],D=T.value&&p,A=_.indices,C=this.extrudeY?1:2,S=this.extrudeY?2:1,L=[this.rootNode.worldTransform.x.len(),this.rootNode.worldTransform.y.len(),this.rootNode.worldTransform.z.len()],I=n.mul([],this._geoBoundingBox[0],L),w=n.mul([],this._geoBoundingBox[1],L),b=Math.max(w[0]-I[0],w[2]-I[2]);function B(rt,nt,q){for(var tt=rt.points,st=tt.length,lt=[],_t=[],vt=0;vt<st;vt+=3)lt[0]=tt[vt],lt[C]=nt,lt[S]=tt[vt+2],_t[0]=(tt[vt]*L[0]-I[0])/b,_t[1]=(tt[vt+2]*L[S]-I[2])/b,x.set(v,lt),D&&T.set(v,p),P.set(v++,_t)}function U(rt,nt,q){var tt=v;B(rt,nt);for(var st=rt.indices.length,lt=0;lt<st;lt++)A[m*3+lt]=rt.indices[lt]+tt;m+=rt.indices.length/3}for(var W=this.extrudeY?[0,1,0]:[0,0,1],z=n.negate([],W),G=0;G<O.length;G++){var H=v,X=O[G];U(X,0),U(X,d);for(var Q=X.points.length/3,j=0;j<Q;j++)M.set(H+j,z),M.set(H+j+Q,W);for(var J=[0,3,1,1,3,2],Y=[[],[],[],[]],at=[],ot=[],ut=[],et=[],ht=0,j=0;j<Q;j++){for(var ft=(j+1)%Q,it=(X.points[ft*3]-X.points[j*3])*L[0],N=(X.points[ft*3+2]-X.points[j*3+2])*L[S],K=Math.sqrt(it*it+N*N),Z=0;Z<4;Z++){var V=Z===0||Z===3,k=(V?j:ft)*3;Y[Z][0]=X.points[k],Y[Z][C]=Z>1?d:0,Y[Z][S]=X.points[k+2],x.set(v+Z,Y[Z]),y?(et[0]=(X.points[k]*L[0]-I[0])/b,et[1]=(X.points[k+2]*L[S]-I[S])/b):(et[0]=(V?ht:ht+K)/b,et[1]=(Y[Z][C]*L[C]-I[C])/b),P.set(v+Z,et)}n.sub(at,Y[1],Y[0]),n.sub(ot,Y[3],Y[0]),n.cross(ut,at,ot),n.normalize(ut,ut);for(var Z=0;Z<4;Z++)M.set(v+Z,ut),D&&T.set(v+Z,p);for(var Z=0;Z<6;Z++)A[m*3+Z]=J[Z]+v;v+=4,m+=2,ht+=K}}return _.dirty(),{vertexOffset:v,triangleOffset:m}},_getRegionLinesInfo:function(u,_,f){var d=0,v=0,m=_.getRegionModel(u),p=m.getModel("itemStyle"),y=p.get("borderWidth");if(y>0){var x=_.getRegionPolygonCoords(u);x.forEach(function(M){var P=M.exterior,T=M.interiors;d+=f.getPolylineVertexCount(P),v+=f.getPolylineTriangleCount(P);for(var O=0;O<T.length;O++)d+=f.getPolylineVertexCount(T[O]),v+=f.getPolylineTriangleCount(T[O])},this)}return{vertexCount:d,triangleCount:v}},_updateLinesGeometry:function(u,_,f,d,v,m){function p(M){for(var P=new Float64Array(M.length*3),T=0,O=[],D=0;D<M.length;D++)O[0]=M[D][0],O[1]=d+.1,O[2]=M[D][1],m&&n.transformMat4(O,O,m),P[T++]=O[0],P[T++]=O[1],P[T++]=O[2];return P}var y=[1,1,1,1],x=_.getRegionPolygonCoords(f);x.forEach(function(M){var P=M.exterior,T=M.interiors;u.addPolyline(p(P),y,v);for(var O=0;O<T.length;O++)u.addPolyline(p(T[O]),y,v)})},highlight:function(u){var _=this._data;if(!!_){var f=_.getItemModel(u),d=f.getModel("emphasis.itemStyle"),v=d.get("color"),m=i.a.firstNotNull(d.get("opacity"),_.getItemVisual(u,"opacity"),1);if(v==null){var p=_.getItemVisual(u,"color");v=c.a.color.lift(p,-.4)}m==null&&(m=_.getItemVisual(u,"opacity"));var y=t.a.parseColor(v);y[3]*=m,this._setColorOfDataIndex(_,u,y)}},downplay:function(u){var _=this._data;if(!!_){var f=_.getItemVisual(u,"color"),d=i.a.firstNotNull(_.getItemVisual(u,"opacity"),1),v=t.a.parseColor(f);v[3]*=d,this._setColorOfDataIndex(_,u,v)}},_setColorOfDataIndex:function(u,_,f){if(!(_<this._startIndex&&_>this._endIndex)){_-=this._startIndex;for(var d=this._vertexRangeOfDataIndex[_*2];d<this._vertexRangeOfDataIndex[_*2+1];d++)this._polygonMesh.geometry.attributes.color.set(d,f);this._polygonMesh.geometry.dirty(),this._api.getZr().refresh()}}},R.a=l},function(F,R,g){var E=g(96),c=g(6),t=c.a.vec3,a=t.create(),o=t.create(),i=t.create();R.a={needsSortTriangles:function(){return this.indices&&this.sortTriangles},needsSortTrianglesProgressively:function(){return this.needsSortTriangles()&&this.triangleCount>=2e4},doSortTriangles:function(s,h){var r=this.indices;if(h===0){var e=this.attributes.position,s=s.array;(!this._triangleZList||this._triangleZList.length!==this.triangleCount)&&(this._triangleZList=new Float32Array(this.triangleCount),this._sortedTriangleIndices=new Uint32Array(this.triangleCount),this._indicesTmp=new r.constructor(r.length),this._triangleZListTmp=new Float32Array(this.triangleCount));for(var n=0,l,u=0;u<r.length;){e.get(r[u++],a),e.get(r[u++],o),e.get(r[u++],i);var _=t.sqrDist(a,s),f=t.sqrDist(o,s),d=t.sqrDist(i,s),v=Math.min(_,f);v=Math.min(v,d),u===3?(l=v,v=0):v=v-l,this._triangleZList[n++]=v}}for(var m=this._sortedTriangleIndices,u=0;u<m.length;u++)m[u]=u;if(this.triangleCount<2e4)h===0&&this._simpleSort(!0);else for(var u=0;u<3;u++)this._progressiveQuickSort(h*3+u);for(var p=this._indicesTmp,y=this._triangleZListTmp,x=this._triangleZList,u=0;u<this.triangleCount;u++){var M=m[u]*3,P=u*3;p[P++]=r[M++],p[P++]=r[M++],p[P]=r[M],y[u]=x[m[u]]}var T=this._indicesTmp;this._indicesTmp=this.indices,this.indices=T;var T=this._triangleZListTmp;this._triangleZListTmp=this._triangleZList,this._triangleZList=T,this.dirtyIndices()},_simpleSort:function(s){var h=this._triangleZList,r=this._sortedTriangleIndices;function e(n,l){return h[l]-h[n]}s?Array.prototype.sort.call(r,e):E.a.sort(r,e,0,r.length-1)},_progressiveQuickSort:function(s){var h=this._triangleZList,r=this._sortedTriangleIndices;this._quickSort=this._quickSort||new E.a,this._quickSort.step(r,function(e,n){return h[n]-h[e]},s)}}},function(F,R,g){var E=g(0),c=g.n(E),t=g(82),a=g(62),o=g(2),i=1,s=2;function h(r,e,n){this._labelsMesh=new a.a,this._labelTextureSurface=new t.a({width:512,height:512,devicePixelRatio:n.getDevicePixelRatio(),onupdate:function(){n.getZr().refresh()}}),this._api=n,this._labelsMesh.material.set("textureAtlas",this._labelTextureSurface.getTexture())}h.prototype.getLabelPosition=function(r,e,n){return[0,0,0]},h.prototype.getLabelDistance=function(r,e,n){return 0},h.prototype.getMesh=function(){return this._labelsMesh},h.prototype.updateData=function(r,e,n){e==null&&(e=0),n==null&&(n=r.count()),(!this._labelsVisibilitiesBits||this._labelsVisibilitiesBits.length!==n-e)&&(this._labelsVisibilitiesBits=new Uint8Array(n-e));for(var l=["label","show"],u=["emphasis","label","show"],_=e;_<n;_++){var f=r.getItemModel(_),d=f.get(l),v=f.get(u);v==null&&(v=d);var m=(d?i:0)|(v?s:0);this._labelsVisibilitiesBits[_-e]=m}this._start=e,this._end=n,this._data=r},h.prototype.updateLabels=function(r){if(!!this._data){r=r||[];for(var e=r.length>0,n={},l=0;l<r.length;l++)n[r[l]]=!0;this._labelsMesh.geometry.convertToDynamicArray(!0),this._labelTextureSurface.clear();for(var u=["label"],_=["emphasis","label"],f=this._data.hostModel,d=this._data,v=f.getModel(u),m=f.getModel(_,v),p={left:"right",right:"left",top:"center",bottom:"center"},y={left:"middle",right:"middle",top:"bottom",bottom:"top"},x=this._start;x<this._end;x++){var M=!1;e&&n[x]&&(M=!0);var P=this._labelsVisibilitiesBits[x-this._start]&(M?s:i);if(!!P){var T=d.getItemModel(x),O=T.getModel(M?_:u,M?m:v),D=O.get("distance")||0,A=O.get("position"),C=O.getModel("textStyle"),S=this._api.getDevicePixelRatio(),L=f.getFormattedLabel(x,M?"emphasis":"normal");if(L==null||L==="")return;var I=new c.a.graphic.Text;c.a.graphic.setTextStyle(I.style,C,{text:L,textFill:C.get("color")||d.getItemVisual(x,"color")||"#000",textAlign:"left",textVerticalAlign:"top",opacity:o.a.firstNotNull(C.get("opacity"),d.getItemVisual(x,"opacity"),1)});var w=I.getBoundingRect(),b=1.2;w.height*=b;var B=this._labelTextureSurface.add(I),U=p[A]||"center",W=y[A]||"bottom";this._labelsMesh.geometry.addSprite(this.getLabelPosition(x,A,D),[w.width*S,w.height*S],B,U,W,this.getLabelDistance(x,A,D)*S)}}this._labelsMesh.material.set("uvScale",this._labelTextureSurface.getCoordsScale()),this._labelTextureSurface.getZr().refreshImmediately(),this._labelsMesh.geometry.convertToTypedArray(),this._labelsMesh.geometry.dirty()}},R.a=h},function(F,R,g){var E=g(0),c=g.n(E),t=g(1),a=g(241),o=g(242),i=g(65),s=g(7),h=g(2),r=20,e=-10;function n(u,_){return u&&_&&u[0]===_[0]&&u[1]===_[1]}function l(u,_){this.rootNode=new t.a.Node,this.is2D=u,this._labelsBuilder=new i.a(256,256,_),this._labelsBuilder.getMesh().renderOrder=100,this.rootNode.add(this._labelsBuilder.getMesh()),this._api=_,this._spriteImageCanvas=document.createElement("canvas"),this._startDataIndex=0,this._endDataIndex=0,this._sizeScale=1}l.prototype={constructor:l,highlightOnMouseover:!0,update:function(u,_,f,d,v){var m=this._prevMesh;this._prevMesh=this._mesh,this._mesh=m;var p=u.getData();if(d==null&&(d=0),v==null&&(v=p.count()),this._startDataIndex=d,this._endDataIndex=v-1,!this._mesh){var y=this._prevMesh&&this._prevMesh.material;this._mesh=new o.a({renderOrder:10,frustumCulling:!1}),y&&(this._mesh.material=y)}var y=this._mesh.material,x=this._mesh.geometry,M=x.attributes;this.rootNode.remove(this._prevMesh),this.rootNode.add(this._mesh),this._setPositionTextureToMesh(this._mesh,this._positionTexture);var P=this._getSymbolInfo(u,d,v),T=f.getDevicePixelRatio(),O=u.getModel("itemStyle").getItemStyle(),D=u.get("large"),A=1;P.maxSize>2?(A=this._updateSymbolSprite(u,O,P,T),y.enableTexture("sprite")):y.disableTexture("sprite"),M.position.init(v-d);var C=[];if(D){y.undefine("VERTEX_SIZE"),y.undefine("VERTEX_COLOR");var S=p.getVisual("color"),L=p.getVisual("opacity");t.a.parseColor(S,C),C[3]*=L,y.set({color:C,u_Size:P.maxSize*this._sizeScale})}else y.set({color:[1,1,1,1]}),y.define("VERTEX_SIZE"),y.define("VERTEX_COLOR"),M.size.init(v-d),M.color.init(v-d),this._originalOpacity=new Float32Array(v-d);for(var I=p.getLayout("points"),w=M.position.value,b=0;b<v-d;b++){var B=b*3,U=b*2;if(this.is2D?(w[B]=I[U],w[B+1]=I[U+1],w[B+2]=e):(w[B]=I[B],w[B+1]=I[B+1],w[B+2]=I[B+2]),!D){var S=p.getItemVisual(b,"color"),L=p.getItemVisual(b,"opacity");t.a.parseColor(S,C),C[3]*=L,M.color.set(b,C);var W=p.getItemVisual(b,"symbolSize");W=W instanceof Array?Math.max(W[0],W[1]):W,isNaN(W)&&(W=0),M.size.value[b]=W*A*this._sizeScale,this._originalOpacity[b]=C[3]}}this._mesh.sizeScale=A,x.updateBoundingBox(),x.dirty(),this._updateMaterial(u,O);var z=u.coordinateSystem;if(z&&z.viewGL){var G=z.viewGL.isLinearSpace()?"define":"undefine";y[G]("fragment","SRGB_DECODE")}D||this._updateLabelBuilder(u,d,v),this._updateHandler(u,_,f),this._updateAnimation(u),this._api=f},getPointsMesh:function(){return this._mesh},updateLabels:function(u){this._labelsBuilder.updateLabels(u)},hideLabels:function(){this.rootNode.remove(this._labelsBuilder.getMesh())},showLabels:function(){this.rootNode.add(this._labelsBuilder.getMesh())},_updateSymbolSprite:function(u,_,f,d){f.maxSize=Math.min(f.maxSize*2,200);var v=[];return f.aspect>1?(v[0]=f.maxSize,v[1]=f.maxSize/f.aspect):(v[1]=f.maxSize,v[0]=f.maxSize*f.aspect),v[0]=v[0]||1,v[1]=v[1]||1,(this._symbolType!==f.type||!n(this._symbolSize,v)||this._lineWidth!==_.lineWidth)&&(a.a.createSymbolSprite(f.type,v,{fill:"#fff",lineWidth:_.lineWidth,stroke:"transparent",shadowColor:"transparent",minMargin:Math.min(v[0]/2,10)},this._spriteImageCanvas),a.a.createSDFFromCanvas(this._spriteImageCanvas,Math.min(this._spriteImageCanvas.width,32),r,this._mesh.material.get("sprite").image),this._symbolType=f.type,this._symbolSize=v,this._lineWidth=_.lineWidth),this._spriteImageCanvas.width/f.maxSize*d},_updateMaterial:function(u,_){var f=u.get("blendMode")==="lighter"?t.a.additiveBlend:null,d=this._mesh.material;d.blend=f,d.set("lineWidth",_.lineWidth/r);var v=t.a.parseColor(_.stroke);d.set("strokeColor",v),d.transparent=!0,d.depthMask=!1,d.depthTest=!this.is2D,d.sortVertices=!this.is2D},_updateLabelBuilder:function(u,_,f){var d=u.getData(),v=this._mesh.geometry,m=v.attributes.position.value,_=this._startDataIndex,p=this._mesh.sizeScale;this._labelsBuilder.updateData(d,_,f),this._labelsBuilder.getLabelPosition=function(y,x,M){var P=(y-_)*3;return[m[P],m[P+1],m[P+2]]},this._labelsBuilder.getLabelDistance=function(y,x,M){var P=v.attributes.size.get(y-_)/p;return P/2+M},this._labelsBuilder.updateLabels()},_updateAnimation:function(u){t.a.updateVertexAnimation([["prevPosition","position"],["prevSize","size"]],this._prevMesh,this._mesh,u)},_updateHandler:function(u,_,f){var d=u.getData(),v=this._mesh,m=this,p=-1,y=u.coordinateSystem&&u.coordinateSystem.type==="cartesian3D",x;y&&(x=u.coordinateSystem.model),v.seriesIndex=u.seriesIndex,v.off("mousemove"),v.off("mouseout"),v.on("mousemove",function(M){var P=M.vertexIndex+m._startDataIndex;P!==p&&(this.highlightOnMouseover&&(this.downplay(d,p),this.highlight(d,P),this._labelsBuilder.updateLabels([P])),y&&f.dispatchAction({type:"grid3DShowAxisPointer",value:[d.get(u.coordDimToDataDim("x")[0],P),d.get(u.coordDimToDataDim("y")[0],P),d.get(u.coordDimToDataDim("z")[0],P)],grid3DIndex:x.componentIndex})),v.dataIndex=P,p=P},this),v.on("mouseout",function(M){var P=M.vertexIndex+m._startDataIndex;this.highlightOnMouseover&&(this.downplay(d,P),this._labelsBuilder.updateLabels()),p=-1,v.dataIndex=-1,y&&f.dispatchAction({type:"grid3DHideAxisPointer",grid3DIndex:x.componentIndex})},this)},updateLayout:function(u,_,f){var d=u.getData();if(!!this._mesh){var v=this._mesh.geometry.attributes.position.value,m=d.getLayout("points");if(this.is2D)for(var p=0;p<m.length/2;p++){var y=p*3,x=p*2;v[y]=m[x],v[y+1]=m[x+1],v[y+2]=e}else for(var p=0;p<m.length;p++)v[p]=m[p];this._mesh.geometry.dirty(),f.getZr().refresh()}},updateView:function(u){if(!!this._mesh){var _=new s.a;s.a.mul(_,u.viewMatrix,this._mesh.worldTransform),s.a.mul(_,u.projectionMatrix,_),this._mesh.updateNDCPosition(_,this.is2D,this._api)}},highlight:function(u,_){if(!(_>this._endDataIndex||_<this._startDataIndex)){var f=u.getItemModel(_),d=f.getModel("emphasis.itemStyle"),v=d.get("color"),m=d.get("opacity");if(v==null){var p=u.getItemVisual(_,"color");v=c.a.color.lift(p,-.4)}m==null&&(m=u.getItemVisual(_,"opacity"));var y=t.a.parseColor(v);y[3]*=m,this._mesh.geometry.attributes.color.set(_-this._startDataIndex,y),this._mesh.geometry.dirtyAttribute("color"),this._api.getZr().refresh()}},downplay:function(u,_){if(!(_>this._endDataIndex||_<this._startDataIndex)){var f=u.getItemVisual(_,"color"),d=u.getItemVisual(_,"opacity"),v=t.a.parseColor(f);v[3]*=d,this._mesh.geometry.attributes.color.set(_-this._startDataIndex,v),this._mesh.geometry.dirtyAttribute("color"),this._api.getZr().refresh()}},fadeOutAll:function(u){if(this._originalOpacity){for(var _=this._mesh.geometry,f=0;f<_.vertexCount;f++){var d=this._originalOpacity[f]*u;_.attributes.color.value[f*4+3]=d}_.dirtyAttribute("color"),this._api.getZr().refresh()}},fadeInAll:function(){this.fadeOutAll(1)},setPositionTexture:function(u){this._mesh&&this._setPositionTextureToMesh(this._mesh,u),this._positionTexture=u},removePositionTexture:function(){this._positionTexture=null,this._mesh&&this._setPositionTextureToMesh(this._mesh,null)},setSizeScale:function(u){if(u!==this._sizeScale){if(this._mesh){var _=this._mesh.material.get("u_Size");this._mesh.material.set("u_Size",_/this._sizeScale*u);var f=this._mesh.geometry.attributes;if(f.size.value)for(var d=0;d<f.size.value.length;d++)f.size.value[d]=f.size.value[d]/this._sizeScale*u}this._sizeScale=u}},_setPositionTextureToMesh:function(u,_){_&&u.material.set("positionTexture",_),u.material[_?"enableTexture":"disableTexture"]("positionTexture")},_getSymbolInfo:function(u,_,f){if(u.get("large")){var d=h.a.firstNotNull(u.get("symbolSize"),1),M,m;return d instanceof Array?(M=Math.max(d[0],d[1]),m=d[0]/d[1]):(M=d,m=1),{maxSize:d,type:u.get("symbol"),aspect:m}}for(var v=u.getData(),m,p=!1,y=v.getItemVisual(0,"symbol")||"circle",x=!1,M=0,P=_;P<f;P++){var d=v.getItemVisual(P,"symbolSize"),T=v.getItemVisual(P,"symbol"),O;if(d instanceof Array)O=d[0]/d[1],M=Math.max(Math.max(d[0],d[1]),M);else{if(isNaN(d))return;O=1,M=Math.max(d,M)}m!=null&&Math.abs(O-m)>.05&&(p=!0),T!==y&&(x=!0),y=T,m=O}return p&&console.warn("Different symbol width / height ratio will be ignored."),x&&console.warn("Different symbol type will be ignored."),{maxSize:M,type:y,aspect:m}}},R.a=l},function(F,R){var g;g=function(){return this}();try{g=g||Function("return this")()||(0,eval)("this")}catch(E){typeof window=="object"&&(g=window)}F.exports=g},function(F,R,g){var E=g(113),c=function(t){this._list=new E.a,this._map={},this._maxSize=t||10};c.prototype.setMaxSize=function(t){this._maxSize=t},c.prototype.put=function(t,a){if(!this._map.hasOwnProperty(t)){var o=this._list.length();if(o>=this._maxSize&&o>0){var i=this._list.head;this._list.remove(i),delete this._map[i.key]}var s=this._list.insert(a);s.key=t,this._map[t]=s}},c.prototype.get=function(t){var a=this._map[t];if(this._map.hasOwnProperty(t))return a!==this._list.tail&&(this._list.remove(a),this._list.insertEntry(a)),a.value},c.prototype.remove=function(t){var a=this._map[t];typeof a!="undefined"&&(delete this._map[t],this._list.remove(a))},c.prototype.clear=function(){this._list.clear(),this._map={}},R.a=c},function(F,R,g){var E=g(20),c={};c.create=function(){var t=new E.a(2);return t[0]=0,t[1]=0,t},c.clone=function(t){var a=new E.a(2);return a[0]=t[0],a[1]=t[1],a},c.fromValues=function(t,a){var o=new E.a(2);return o[0]=t,o[1]=a,o},c.copy=function(t,a){return t[0]=a[0],t[1]=a[1],t},c.set=function(t,a,o){return t[0]=a,t[1]=o,t},c.add=function(t,a,o){return t[0]=a[0]+o[0],t[1]=a[1]+o[1],t},c.subtract=function(t,a,o){return t[0]=a[0]-o[0],t[1]=a[1]-o[1],t},c.sub=c.subtract,c.multiply=function(t,a,o){return t[0]=a[0]*o[0],t[1]=a[1]*o[1],t},c.mul=c.multiply,c.divide=function(t,a,o){return t[0]=a[0]/o[0],t[1]=a[1]/o[1],t},c.div=c.divide,c.min=function(t,a,o){return t[0]=Math.min(a[0],o[0]),t[1]=Math.min(a[1],o[1]),t},c.max=function(t,a,o){return t[0]=Math.max(a[0],o[0]),t[1]=Math.max(a[1],o[1]),t},c.scale=function(t,a,o){return t[0]=a[0]*o,t[1]=a[1]*o,t},c.scaleAndAdd=function(t,a,o,i){return t[0]=a[0]+o[0]*i,t[1]=a[1]+o[1]*i,t},c.distance=function(t,a){var o=a[0]-t[0],i=a[1]-t[1];return Math.sqrt(o*o+i*i)},c.dist=c.distance,c.squaredDistance=function(t,a){var o=a[0]-t[0],i=a[1]-t[1];return o*o+i*i},c.sqrDist=c.squaredDistance,c.length=function(t){var a=t[0],o=t[1];return Math.sqrt(a*a+o*o)},c.len=c.length,c.squaredLength=function(t){var a=t[0],o=t[1];return a*a+o*o},c.sqrLen=c.squaredLength,c.negate=function(t,a){return t[0]=-a[0],t[1]=-a[1],t},c.inverse=function(t,a){return t[0]=1/a[0],t[1]=1/a[1],t},c.normalize=function(t,a){var o=a[0],i=a[1],s=o*o+i*i;return s>0&&(s=1/Math.sqrt(s),t[0]=a[0]*s,t[1]=a[1]*s),t},c.dot=function(t,a){return t[0]*a[0]+t[1]*a[1]},c.cross=function(t,a,o){var i=a[0]*o[1]-a[1]*o[0];return t[0]=t[1]=0,t[2]=i,t},c.lerp=function(t,a,o,i){var s=a[0],h=a[1];return t[0]=s+i*(o[0]-s),t[1]=h+i*(o[1]-h),t},c.random=function(t,a){a=a||1;var o=GLMAT_RANDOM()*2*Math.PI;return t[0]=Math.cos(o)*a,t[1]=Math.sin(o)*a,t},c.transformMat2=function(t,a,o){var i=a[0],s=a[1];return t[0]=o[0]*i+o[2]*s,t[1]=o[1]*i+o[3]*s,t},c.transformMat2d=function(t,a,o){var i=a[0],s=a[1];return t[0]=o[0]*i+o[2]*s+o[4],t[1]=o[1]*i+o[3]*s+o[5],t},c.transformMat3=function(t,a,o){var i=a[0],s=a[1];return t[0]=o[0]*i+o[3]*s+o[6],t[1]=o[1]*i+o[4]*s+o[7],t},c.transformMat4=function(t,a,o){var i=a[0],s=a[1];return t[0]=o[0]*i+o[4]*s+o[12],t[1]=o[1]*i+o[5]*s+o[13],t},c.forEach=function(){var t=c.create();return function(a,o,i,s,h,r){var e,n;for(o||(o=2),i||(i=0),s?n=Math.min(s*o+i,a.length):n=a.length,e=i;e<n;e+=o)t[0]=a[e],t[1]=a[e+1],h(t,t,r),a[e]=t[0],a[e+1]=t[1];return a}}(),R.a=c},function(F,R,g){R.a=`@export clay.prez.vertex
#define SHADER_NAME prez
uniform mat4 WVP : WORLDVIEWPROJECTION;
attribute vec3 pos : POSITION;
attribute vec2 uv : TEXCOORD_0;
uniform vec2 uvRepeat : [1.0, 1.0];
uniform vec2 uvOffset : [0.0, 0.0];
@import clay.chunk.skinning_header
@import clay.chunk.instancing_header
@import clay.util.logdepth_vertex_header
varying vec2 v_Texcoord;
void main()
{
 vec4 P = vec4(pos, 1.0);
#ifdef SKINNING
 @import clay.chunk.skin_matrix
 P = skinMatrixWS * P;
#endif
#ifdef INSTANCING
 @import clay.chunk.instancing_matrix
 P = instanceMat * P;
#endif
 gl_Position = WVP * P;
 v_Texcoord = uv * uvRepeat + uvOffset;
 @import clay.util.logdepth_vertex_main
}
@end
@export clay.prez.fragment
uniform sampler2D alphaMap;
uniform float alphaCutoff: 0.0;
@import clay.util.logdepth_fragment_header
varying vec2 v_Texcoord;
void main()
{
 if (alphaCutoff > 0.0) {
 if (texture2D(alphaMap, v_Texcoord).a <= alphaCutoff) {
 discard;
 }
 }
 gl_FragColor = vec4(0.0,0.0,0.0,1.0);
 @import clay.util.logdepth_fragment_main
}
@end`},function(F,R,g){var E=g(35),c=g(11),t=E.a.extend({material:null,geometry:null,mode:c.a.TRIANGLES,_renderInfo:null},{__program:null,lightGroup:0,renderOrder:0,culling:!0,cullFace:c.a.BACK,frontFace:c.a.CCW,frustumCulling:!0,receiveShadow:!0,castShadow:!0,ignorePicking:!1,ignorePreZ:!1,ignoreGBuffer:!1,isRenderable:function(){return this.geometry&&this.material&&this.material.shader&&!this.invisible&&this.geometry.vertexCount>0},beforeRender:function(a){},afterRender:function(a,o){},getBoundingBox:function(a,o){return o=E.a.prototype.getBoundingBox.call(this,a,o),this.geometry&&this.geometry.boundingBox&&o.union(this.geometry.boundingBox),o},clone:function(){var a=["castShadow","receiveShadow","mode","culling","cullFace","frontFace","frustumCulling","renderOrder","lineWidth","ignorePicking","ignorePreZ","ignoreGBuffer"];return function(){var o=E.a.prototype.clone.call(this);o.geometry=this.geometry,o.material=this.material;for(var i=0;i<a.length;i++){var s=a[i];o[s]!==this[s]&&(o[s]=this[s])}return o}}()});t.POINTS=c.a.POINTS,t.LINES=c.a.LINES,t.LINE_LOOP=c.a.LINE_LOOP,t.LINE_STRIP=c.a.LINE_STRIP,t.TRIANGLES=c.a.TRIANGLES,t.TRIANGLE_STRIP=c.a.TRIANGLE_STRIP,t.TRIANGLE_FAN=c.a.TRIANGLE_FAN,t.BACK=c.a.BACK,t.FRONT=c.a.FRONT,t.FRONT_AND_BACK=c.a.FRONT_AND_BACK,t.CW=c.a.CW,t.CCW=c.a.CCW,R.a=t},function(F,R,g){var E={};E.isPowerOfTwo=function(c){return(c&c-1)==0},E.nextPowerOfTwo=function(c){return c--,c|=c>>1,c|=c>>2,c|=c>>4,c|=c>>8,c|=c>>16,c++,c},E.nearestPowerOfTwo=function(c){return Math.pow(2,Math.round(Math.log(c)/Math.LN2))},R.a=E},function(F,R,g){var E=g(3),c=g(21),t=g(12),a=g(33),o=function(i,s){this.normal=i||new E.a(0,1,0),this.distance=s||0};o.prototype={constructor:o,distanceToPoint:function(i){return t.a.dot(i.array,this.normal.array)-this.distance},projectPoint:function(i,s){s||(s=new E.a);var h=this.distanceToPoint(i);return t.a.scaleAndAdd(s.array,i.array,this.normal.array,-h),s._dirty=!0,s},normalize:function(){var i=1/t.a.len(this.normal.array);t.a.scale(this.normal.array,i),this.distance*=i},intersectFrustum:function(i){for(var s=i.vertices,h=this.normal.array,r=t.a.dot(s[0].array,h)>this.distance,e=1;e<8;e++)if(t.a.dot(s[e].array,h)>this.distance!=r)return!0},intersectLine:function(){var i=t.a.create();return function(s,h,r){var e=this.distanceToPoint(s),n=this.distanceToPoint(h);if(e>0&&n>0||e<0&&n<0)return null;var l=this.normal.array,u=this.distance,_=s.array;t.a.sub(i,h.array,s.array),t.a.normalize(i,i);var f=t.a.dot(l,i);if(f===0)return null;r||(r=new E.a);var d=(t.a.dot(l,_)-u)/f;return t.a.scaleAndAdd(r.array,_,i,-d),r._dirty=!0,r}}(),applyTransform:function(){var i=c.a.create(),s=a.a.create(),h=a.a.create();return h[3]=1,function(r){r=r.array,t.a.scale(h,this.normal.array,this.distance),a.a.transformMat4(h,h,r),this.distance=t.a.dot(h,this.normal.array),c.a.invert(i,r),c.a.transpose(i,i),s[3]=0,t.a.copy(s,this.normal.array),a.a.transformMat4(s,s,i),t.a.copy(this.normal.array,s)}}(),copy:function(i){t.a.copy(this.normal.array,i.normal.array),this.normal._dirty=!0,this.distance=i.distance},clone:function(){var i=new o;return i.copy(this),i}},R.a=o},function(F,R){var g=function(){this.head=null,this.tail=null,this._len=0},E=g.prototype;E.insert=function(i){var s=new c(i);return this.insertEntry(s),s},E.insertEntry=function(i){this.head?(this.tail.next=i,i.prev=this.tail,i.next=null,this.tail=i):this.head=this.tail=i,this._len++},E.remove=function(i){var s=i.prev,h=i.next;s?s.next=h:this.head=h,h?h.prev=s:this.tail=s,i.next=i.prev=null,this._len--},E.len=function(){return this._len},E.clear=function(){this.head=this.tail=null,this._len=0};var c=function(i){this.value=i,this.next,this.prev},t=function(i){this._list=new g,this._map={},this._maxSize=i||10,this._lastRemovedEntry=null},a=t.prototype;a.put=function(i,s){var h=this._list,r=this._map,e=null;if(r[i]==null){var n=h.len(),l=this._lastRemovedEntry;if(n>=this._maxSize&&n>0){var u=h.head;h.remove(u),delete r[u.key],e=u.value,this._lastRemovedEntry=u}l?l.value=s:l=new c(s),l.key=i,h.insertEntry(l),r[i]=l}return e},a.get=function(i){var s=this._map[i],h=this._list;if(s!=null)return s!==h.tail&&(h.remove(s),h.insertEntry(s)),s.value},a.clear=function(){this._list.clear(),this._map={}};var o=t;F.exports=o},function(F,R,g){var E=g(42);R.a=E.a},function(F,R,g){var E=g(14),c=g(43),t=g(7),a=g(3),o=g(18),i=g(13),s=new t.a,h=E.a.extend({dynamic:!1,widthSegments:1,heightSegments:1,depthSegments:1,inside:!1},function(){this.build()},{build:function(){var e={px:r("px",this.depthSegments,this.heightSegments),nx:r("nx",this.depthSegments,this.heightSegments),py:r("py",this.widthSegments,this.depthSegments),ny:r("ny",this.widthSegments,this.depthSegments),pz:r("pz",this.widthSegments,this.heightSegments),nz:r("nz",this.widthSegments,this.heightSegments)},n=["position","texcoord0","normal"],l=0,u=0;for(var _ in e)l+=e[_].vertexCount,u+=e[_].indices.length;for(var f=0;f<n.length;f++)this.attributes[n[f]].init(l);this.indices=new i.a.Uint16Array(u);var d=0,v=0;for(var _ in e){for(var m=e[_],f=0;f<n.length;f++)for(var p=n[f],y=m.attributes[p].value,x=m.attributes[p].size,M=p==="normal",P=0;P<y.length;P++){var T=y[P];this.inside&&M&&(T=-T),this.attributes[p].value[P+x*v]=T}for(var O=m.indices.length,P=0;P<m.indices.length;P++)this.indices[P+d]=v+m.indices[this.inside?O-P-1:P];d+=m.indices.length,v+=m.vertexCount}this.boundingBox=new o.a,this.boundingBox.max.set(1,1,1),this.boundingBox.min.set(-1,-1,-1)}});function r(e,n,l){s.identity();var u=new c.a({widthSegments:n,heightSegments:l});switch(e){case"px":t.a.translate(s,s,a.a.POSITIVE_X),t.a.rotateY(s,s,Math.PI/2);break;case"nx":t.a.translate(s,s,a.a.NEGATIVE_X),t.a.rotateY(s,s,-Math.PI/2);break;case"py":t.a.translate(s,s,a.a.POSITIVE_Y),t.a.rotateX(s,s,-Math.PI/2);break;case"ny":t.a.translate(s,s,a.a.NEGATIVE_Y),t.a.rotateX(s,s,Math.PI/2);break;case"pz":t.a.translate(s,s,a.a.POSITIVE_Z);break;case"nz":t.a.translate(s,s,a.a.NEGATIVE_Z),t.a.rotateY(s,s,Math.PI);break}return u.applyTransform(s),u}R.a=h},function(F,R,g){var E=g(5),c=g(27),t=g(4),a=g(10),o=g(15),i=g(19),s=g(9),h=g(42),r=g(36),e=g(61),n=g(13),l=g(60),u=g(126),_=g(127),f={},d=["px","nx","py","ny","pz","nz"];f.prefilterEnvironmentMap=function(v,m,p,y,x){(!x||!y)&&(y=f.generateNormalDistribution(),x=f.integrateBRDF(v,y)),p=p||{};var M=p.width||64,P=p.height||64,T=p.type||m.type,O=new c.a({width:M,height:P,type:T,flipY:!1,mipmaps:[]});O.isPowerOfTwo()||console.warn("Width and height must be power of two to enable mipmap.");var D=Math.min(M,P),A=Math.log(D)/Math.log(2)+1,C=new i.a({shader:new s.a({vertex:s.a.source("clay.skybox.vertex"),fragment:_.a})});C.set("normalDistribution",y),p.encodeRGBM&&C.define("fragment","RGBM_ENCODE"),p.decodeRGBM&&C.define("fragment","RGBM_DECODE");var S=new r.a,L;if(m.textureType==="texture2D"){var I=new c.a({width:M,height:P,type:T===t.a.FLOAT?t.a.HALF_FLOAT:T});l.a.panoramaToCubeMap(v,m,I,{encodeRGBM:p.decodeRGBM}),m=I}L=new h.a({scene:S,material:C}),L.material.set("environmentMap",m);var w=new e.a({texture:O});p.encodeRGBM&&(T=O.type=t.a.UNSIGNED_BYTE);for(var b=new E.a({width:M,height:P,type:T}),B=new a.a({depthBuffer:!1}),U=n.a[T===t.a.UNSIGNED_BYTE?"Uint8Array":"Float32Array"],W=0;W<A;W++){O.mipmaps[W]={pixels:{}},L.material.set("roughness",W/(A-1));for(var z=b.width,G=2*Math.atan(z/(z-.5))/Math.PI*180,H=0;H<d.length;H++){var X=new U(b.width*b.height*4);B.attach(b),B.bind(v);var Q=w.getCamera(d[H]);Q.fov=G,v.render(S,Q),v.gl.readPixels(0,0,b.width,b.height,t.a.RGBA,T,X),B.unbind(v),O.mipmaps[W].pixels[d[H]]=X}b.width/=2,b.height/=2,b.dirty()}return B.dispose(v),b.dispose(v),L.dispose(v),y.dispose(v),{environmentMap:O,brdfLookup:x,normalDistribution:y,maxMipmapLevel:A}},f.integrateBRDF=function(v,m){m=m||f.generateNormalDistribution();var p=new a.a({depthBuffer:!1}),y=new o.a({fragment:u.a}),x=new E.a({width:512,height:256,type:t.a.HALF_FLOAT,wrapS:t.a.CLAMP_TO_EDGE,wrapT:t.a.CLAMP_TO_EDGE,minFilter:t.a.NEAREST,magFilter:t.a.NEAREST,useMipmap:!1});return y.setUniform("normalDistribution",m),y.setUniform("viewportSize",[512,256]),y.attachOutput(x),y.render(v,p),p.dispose(v),x},f.generateNormalDistribution=function(v,m){for(var v=v||256,m=m||1024,p=new E.a({width:v,height:m,type:t.a.FLOAT,minFilter:t.a.NEAREST,magFilter:t.a.NEAREST,wrapS:t.a.CLAMP_TO_EDGE,wrapT:t.a.CLAMP_TO_EDGE,useMipmap:!1}),y=new Float32Array(m*v*4),x=[],M=0;M<v;M++){for(var P=M/v,T=P*P,O=0;O<m;O++){var D=(O<<16|O>>>16)>>>0;D=((D&1431655765)<<1|(D&2863311530)>>>1)>>>0,D=((D&858993459)<<2|(D&3435973836)>>>2)>>>0,D=((D&252645135)<<4|(D&4042322160)>>>4)>>>0,D=(((D&16711935)<<8|(D&4278255360)>>>8)>>>0)/4294967296;var A=Math.sqrt((1-D)/(1+(T*T-1)*D));x[O]=A}for(var O=0;O<m;O++){var C=(O*v+M)*4,A=x[O],S=Math.sqrt(1-A*A),L=O/m,I=2*Math.PI*L;y[C]=S*Math.cos(I),y[C+1]=A,y[C+2]=S*Math.sin(I),y[C+3]=1}}return p.pixels=y,p},R.a=f},function(F,R,g){var E=g(20),c={};c.create=function(){var t=new E.a(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},c.clone=function(t){var a=new E.a(4);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a},c.copy=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t},c.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},c.transpose=function(t,a){if(t===a){var o=a[1];t[1]=a[2],t[2]=o}else t[0]=a[0],t[1]=a[2],t[2]=a[1],t[3]=a[3];return t},c.invert=function(t,a){var o=a[0],i=a[1],s=a[2],h=a[3],r=o*h-s*i;return r?(r=1/r,t[0]=h*r,t[1]=-i*r,t[2]=-s*r,t[3]=o*r,t):null},c.adjoint=function(t,a){var o=a[0];return t[0]=a[3],t[1]=-a[1],t[2]=-a[2],t[3]=o,t},c.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},c.multiply=function(t,a,o){var i=a[0],s=a[1],h=a[2],r=a[3],e=o[0],n=o[1],l=o[2],u=o[3];return t[0]=i*e+h*n,t[1]=s*e+r*n,t[2]=i*l+h*u,t[3]=s*l+r*u,t},c.mul=c.multiply,c.rotate=function(t,a,o){var i=a[0],s=a[1],h=a[2],r=a[3],e=Math.sin(o),n=Math.cos(o);return t[0]=i*n+h*e,t[1]=s*n+r*e,t[2]=i*-e+h*n,t[3]=s*-e+r*n,t},c.scale=function(t,a,o){var i=a[0],s=a[1],h=a[2],r=a[3],e=o[0],n=o[1];return t[0]=i*e,t[1]=s*e,t[2]=h*n,t[3]=r*n,t},c.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},c.LDU=function(t,a,o,i){return t[2]=i[2]/i[0],o[0]=i[0],o[1]=i[1],o[3]=i[3]-t[2]*o[1],[t,a,o]},R.a=c},function(F,R,g){var E=g(20),c={};c.create=function(){var t=new E.a(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},c.clone=function(t){var a=new E.a(6);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a},c.copy=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t},c.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},c.invert=function(t,a){var o=a[0],i=a[1],s=a[2],h=a[3],r=a[4],e=a[5],n=o*h-i*s;return n?(n=1/n,t[0]=h*n,t[1]=-i*n,t[2]=-s*n,t[3]=o*n,t[4]=(s*e-h*r)*n,t[5]=(i*r-o*e)*n,t):null},c.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},c.multiply=function(t,a,o){var i=a[0],s=a[1],h=a[2],r=a[3],e=a[4],n=a[5],l=o[0],u=o[1],_=o[2],f=o[3],d=o[4],v=o[5];return t[0]=i*l+h*u,t[1]=s*l+r*u,t[2]=i*_+h*f,t[3]=s*_+r*f,t[4]=i*d+h*v+e,t[5]=s*d+r*v+n,t},c.mul=c.multiply,c.rotate=function(t,a,o){var i=a[0],s=a[1],h=a[2],r=a[3],e=a[4],n=a[5],l=Math.sin(o),u=Math.cos(o);return t[0]=i*u+h*l,t[1]=s*u+r*l,t[2]=i*-l+h*u,t[3]=s*-l+r*u,t[4]=e,t[5]=n,t},c.scale=function(t,a,o){var i=a[0],s=a[1],h=a[2],r=a[3],e=a[4],n=a[5],l=o[0],u=o[1];return t[0]=i*l,t[1]=s*l,t[2]=h*u,t[3]=r*u,t[4]=e,t[5]=n,t},c.translate=function(t,a,o){var i=a[0],s=a[1],h=a[2],r=a[3],e=a[4],n=a[5],l=o[0],u=o[1];return t[0]=i,t[1]=s,t[2]=h,t[3]=r,t[4]=i*l+h*u+e,t[5]=s*l+r*u+n,t},c.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},R.a=c},function(F,R){var g={"[object Function]":1,"[object RegExp]":1,"[object Date]":1,"[object Error]":1,"[object CanvasGradient]":1,"[object CanvasPattern]":1,"[object Image]":1,"[object Canvas]":1},E={"[object Int8Array]":1,"[object Uint8Array]":1,"[object Uint8ClampedArray]":1,"[object Int16Array]":1,"[object Uint16Array]":1,"[object Int32Array]":1,"[object Uint32Array]":1,"[object Float32Array]":1,"[object Float64Array]":1},c=Object.prototype.toString,t=Array.prototype,a=t.forEach,o=t.filter,i=t.slice,s=t.map,h=t.reduce,r={};function e(N,K){N==="createCanvas"&&(v=null),r[N]=K}function n(N){if(N==null||typeof N!="object")return N;var K=N,Z=c.call(N);if(Z==="[object Array]"){if(!ut(N)){K=[];for(var V=0,k=N.length;V<k;V++)K[V]=n(N[V])}}else if(E[Z]){if(!ut(N)){var rt=N.constructor;if(N.constructor.from)K=rt.from(N);else{K=new rt(N.length);for(var V=0,k=N.length;V<k;V++)K[V]=n(N[V])}}}else if(!g[Z]&&!ut(N)&&!W(N)){K={};for(var nt in N)N.hasOwnProperty(nt)&&(K[nt]=n(N[nt]))}return K}function l(N,K,Z){if(!b(K)||!b(N))return Z?n(K):N;for(var V in K)if(K.hasOwnProperty(V)){var k=N[V],rt=K[V];b(rt)&&b(k)&&!L(rt)&&!L(k)&&!W(rt)&&!W(k)&&!B(rt)&&!B(k)&&!ut(rt)&&!ut(k)?l(k,rt,Z):(Z||!(V in N))&&(N[V]=n(K[V]))}return N}function u(N,K){for(var Z=N[0],V=1,k=N.length;V<k;V++)Z=l(Z,N[V],K);return Z}function _(N,K){for(var Z in K)K.hasOwnProperty(Z)&&(N[Z]=K[Z]);return N}function f(N,K,Z){for(var V in K)K.hasOwnProperty(V)&&(Z?K[V]!=null:N[V]==null)&&(N[V]=K[V]);return N}var d=function(){return r.createCanvas()};r.createCanvas=function(){return document.createElement("canvas")};var v;function m(){return v||(v=d().getContext("2d")),v}function p(N,K){if(N){if(N.indexOf)return N.indexOf(K);for(var Z=0,V=N.length;Z<V;Z++)if(N[Z]===K)return Z}return-1}function y(N,K){var Z=N.prototype;function V(){}V.prototype=K.prototype,N.prototype=new V;for(var k in Z)N.prototype[k]=Z[k];N.prototype.constructor=N,N.superClass=K}function x(N,K,Z){N="prototype"in N?N.prototype:N,K="prototype"in K?K.prototype:K,f(N,K,Z)}function M(N){if(!!N)return typeof N=="string"?!1:typeof N.length=="number"}function P(N,K,Z){if(!!(N&&K))if(N.forEach&&N.forEach===a)N.forEach(K,Z);else if(N.length===+N.length)for(var V=0,k=N.length;V<k;V++)K.call(Z,N[V],V,N);else for(var rt in N)N.hasOwnProperty(rt)&&K.call(Z,N[rt],rt,N)}function T(N,K,Z){if(!!(N&&K)){if(N.map&&N.map===s)return N.map(K,Z);for(var V=[],k=0,rt=N.length;k<rt;k++)V.push(K.call(Z,N[k],k,N));return V}}function O(N,K,Z,V){if(!!(N&&K)){if(N.reduce&&N.reduce===h)return N.reduce(K,Z,V);for(var k=0,rt=N.length;k<rt;k++)Z=K.call(V,Z,N[k],k,N);return Z}}function D(N,K,Z){if(!!(N&&K)){if(N.filter&&N.filter===o)return N.filter(K,Z);for(var V=[],k=0,rt=N.length;k<rt;k++)K.call(Z,N[k],k,N)&&V.push(N[k]);return V}}function A(N,K,Z){if(!!(N&&K)){for(var V=0,k=N.length;V<k;V++)if(K.call(Z,N[V],V,N))return N[V]}}function C(N,K){var Z=i.call(arguments,2);return function(){return N.apply(K,Z.concat(i.call(arguments)))}}function S(N){var K=i.call(arguments,1);return function(){return N.apply(this,K.concat(i.call(arguments)))}}function L(N){return c.call(N)==="[object Array]"}function I(N){return typeof N=="function"}function w(N){return c.call(N)==="[object String]"}function b(N){var K=typeof N;return K==="function"||!!N&&K=="object"}function B(N){return!!g[c.call(N)]}function U(N){return!!E[c.call(N)]}function W(N){return typeof N=="object"&&typeof N.nodeType=="number"&&typeof N.ownerDocument=="object"}function z(N){return N!==N}function G(N){for(var K=0,Z=arguments.length;K<Z;K++)if(arguments[K]!=null)return arguments[K]}function H(N,K){return N!=null?N:K}function X(N,K,Z){return N!=null?N:K!=null?K:Z}function Q(){return Function.call.apply(i,arguments)}function j(N){if(typeof N=="number")return[N,N,N,N];var K=N.length;return K===2?[N[0],N[1],N[0],N[1]]:K===3?[N[0],N[1],N[2],N[1]]:N}function J(N,K){if(!N)throw new Error(K)}function Y(N){return N==null?null:typeof N.trim=="function"?N.trim():N.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}var at="__ec_primitive__";function ot(N){N[at]=!0}function ut(N){return N[at]}function et(N){var K=L(N);this.data={};var Z=this;N instanceof et?N.each(V):N&&P(N,V);function V(k,rt){K?Z.set(k,rt):Z.set(rt,k)}}et.prototype={constructor:et,get:function(N){return this.data.hasOwnProperty(N)?this.data[N]:null},set:function(N,K){return this.data[N]=K},each:function(N,K){K!==void 0&&(N=C(N,K));for(var Z in this.data)this.data.hasOwnProperty(Z)&&N(this.data[Z],Z)},removeKey:function(N){delete this.data[N]}};function ht(N){return new et(N)}function ft(N,K){for(var Z=new N.constructor(N.length+K.length),V=0;V<N.length;V++)Z[V]=N[V];var k=N.length;for(V=0;V<K.length;V++)Z[V+k]=K[V];return Z}function it(){}R.$override=e,R.clone=n,R.merge=l,R.mergeAll=u,R.extend=_,R.defaults=f,R.createCanvas=d,R.getContext=m,R.indexOf=p,R.inherits=y,R.mixin=x,R.isArrayLike=M,R.each=P,R.map=T,R.reduce=O,R.filter=D,R.find=A,R.bind=C,R.curry=S,R.isArray=L,R.isFunction=I,R.isString=w,R.isObject=b,R.isBuiltInObject=B,R.isTypedArray=U,R.isDom=W,R.eqNaN=z,R.retrieve=G,R.retrieve2=H,R.retrieve3=X,R.slice=Q,R.normalizeCssArray=j,R.assert=J,R.trim=Y,R.setAsPrimitive=ot,R.isPrimitive=ut,R.createHashMap=ht,R.concatArray=ft,R.noop=it},function(F,R){var g=typeof window!="undefined"&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(E){setTimeout(E,16)};F.exports=g},function(F,R,g){var E=g(0),c=g.n(E),t=g(5);function a(i,s,h,r,e,n,l){this._zr=i,this._x=0,this._y=0,this._rowHeight=0,this.width=r,this.height=e,this.offsetX=s,this.offsetY=h,this.dpr=l,this.gap=n}a.prototype={constructor:a,clear:function(){this._x=0,this._y=0,this._rowHeight=0},add:function(i,s,h){var r=i.getBoundingRect();s==null&&(s=r.width),h==null&&(h=r.height),s*=this.dpr,h*=this.dpr,this._fitElement(i,s,h);var e=this._x,n=this._y,l=this.width*this.dpr,u=this.height*this.dpr,_=this.gap;if(e+s+_>l&&(e=this._x=0,n+=this._rowHeight+_,this._y=n,this._rowHeight=0),this._x+=s+_,this._rowHeight=Math.max(this._rowHeight,h),n+h+_>u)return null;i.position[0]+=this.offsetX*this.dpr+e,i.position[1]+=this.offsetY*this.dpr+n,this._zr.add(i);var f=[this.offsetX/this.width,this.offsetY/this.height],d=[[e/l+f[0],n/u+f[1]],[(e+s)/l+f[0],(n+h)/u+f[1]]];return d},_fitElement:function(i,s,h){var r=i.getBoundingRect(),e=s/r.width,n=h/r.height;i.position=[-r.x*e,-r.y*n],i.scale=[e,n],i.update()}};function o(i){i=i||{},i.width=i.width||512,i.height=i.height||512,i.devicePixelRatio=i.devicePixelRatio||1,i.gap=i.gap==null?2:i.gap;var s=document.createElement("canvas");s.width=i.width*i.devicePixelRatio,s.height=i.height*i.devicePixelRatio,this._canvas=s,this._texture=new t.a({image:s,flipY:!1});var h=this;this._zr=c.a.zrender.init(s);var r=this._zr.refreshImmediately;this._zr.refreshImmediately=function(){r.call(this),h._texture.dirty(),h.onupdate&&h.onupdate()},this._dpr=i.devicePixelRatio,this._coords={},this.onupdate=i.onupdate,this._gap=i.gap,this._textureAtlasNodes=[new a(this._zr,0,0,i.width,i.height,this._gap,this._dpr)],this._nodeWidth=i.width,this._nodeHeight=i.height,this._currentNodeIdx=0}o.prototype={clear:function(){for(var i=0;i<this._textureAtlasNodes.length;i++)this._textureAtlasNodes[i].clear();this._currentNodeIdx=0,this._zr.clear(),this._coords={}},getWidth:function(){return this._width},getHeight:function(){return this._height},getTexture:function(){return this._texture},getDevicePixelRatio:function(){return this._dpr},getZr:function(){return this._zr},_getCurrentNode:function(){return this._textureAtlasNodes[this._currentNodeIdx]},_expand:function(){if(this._currentNodeIdx++,this._textureAtlasNodes[this._currentNodeIdx])return this._textureAtlasNodes[this._currentNodeIdx];var i=4096/this._dpr,s=this._textureAtlasNodes,h=s.length,r=h*this._nodeWidth%i,e=Math.floor(h*this._nodeWidth/i)*this._nodeHeight;if(e>=i){console.error("Too much labels. Some will be ignored.");return}var n=(r+this._nodeWidth)*this._dpr,l=(e+this._nodeHeight)*this._dpr;try{this._zr.resize({width:n,height:l})}catch(_){this._canvas.width=n,this._canvas.height=l}var u=new a(this._zr,r,e,this._nodeWidth,this._nodeHeight,this._gap,this._dpr);return this._textureAtlasNodes.push(u),u},add:function(i,s,h){if(this._coords[i.id])return console.warn("Element already been add"),this._coords[i.id];var r=this._getCurrentNode().add(i,s,h);if(!r){var e=this._expand();if(!e)return;r=e.add(i,s,h)}return this._coords[i.id]=r,r},getCoordsScale:function(){var i=this._dpr;return[this._nodeWidth/this._canvas.width*i,this._nodeHeight/this._canvas.height*i]},getCoords:function(i){return this._coords[i]}},R.a=o},function(F,R,g){var E=g(170),c=g(171),t=E.applyTransform,a=Math.min,o=Math.max;function i(h,r,e,n){e<0&&(h=h+e,e=-e),n<0&&(r=r+n,n=-n),this.x=h,this.y=r,this.width=e,this.height=n}i.prototype={constructor:i,union:function(h){var r=a(h.x,this.x),e=a(h.y,this.y);this.width=o(h.x+h.width,this.x+this.width)-r,this.height=o(h.y+h.height,this.y+this.height)-e,this.x=r,this.y=e},applyTransform:function(){var h=[],r=[],e=[],n=[];return function(l){if(!!l){h[0]=e[0]=this.x,h[1]=n[1]=this.y,r[0]=n[0]=this.x+this.width,r[1]=e[1]=this.y+this.height,t(h,h,l),t(r,r,l),t(e,e,l),t(n,n,l),this.x=a(h[0],r[0],e[0],n[0]),this.y=a(h[1],r[1],e[1],n[1]);var u=o(h[0],r[0],e[0],n[0]),_=o(h[1],r[1],e[1],n[1]);this.width=u-this.x,this.height=_-this.y}}}(),calculateTransform:function(h){var r=this,e=h.width/r.width,n=h.height/r.height,l=c.create();return c.translate(l,l,[-r.x,-r.y]),c.scale(l,l,[e,n]),c.translate(l,l,[h.x,h.y]),l},intersect:function(h){if(!h)return!1;h instanceof i||(h=i.create(h));var r=this,e=r.x,n=r.x+r.width,l=r.y,u=r.y+r.height,_=h.x,f=h.x+h.width,d=h.y,v=h.y+h.height;return!(n<_||f<e||u<d||v<l)},contain:function(h,r){var e=this;return h>=e.x&&h<=e.x+e.width&&r>=e.y&&r<=e.y+e.height},clone:function(){return new i(this.x,this.y,this.width,this.height)},copy:function(h){this.x=h.x,this.y=h.y,this.width=h.width,this.height=h.height},plain:function(){return{x:this.x,y:this.y,width:this.width,height:this.height}}},i.create=function(h){return new i(h.x,h.y,h.width,h.height)};var s=i;F.exports=s},function(F,R,g){var E=g(16),c=1e-4;function t(P){return P.replace(/^\s+|\s+$/g,"")}function a(P,T,O,D){var A=T[1]-T[0],C=O[1]-O[0];if(A===0)return C===0?O[0]:(O[0]+O[1])/2;if(D)if(A>0){if(P<=T[0])return O[0];if(P>=T[1])return O[1]}else{if(P>=T[0])return O[0];if(P<=T[1])return O[1]}else{if(P===T[0])return O[0];if(P===T[1])return O[1]}return(P-T[0])/A*C+O[0]}function o(P,T){switch(P){case"center":case"middle":P="50%";break;case"left":case"top":P="0%";break;case"right":case"bottom":P="100%";break}return typeof P=="string"?t(P).match(/%$/)?parseFloat(P)/100*T:parseFloat(P):P==null?NaN:+P}function i(P,T,O){return T==null&&(T=10),T=Math.min(Math.max(0,T),20),P=(+P).toFixed(T),O?P:+P}function s(P){return P.sort(function(T,O){return T-O}),P}function h(P){if(P=+P,isNaN(P))return 0;for(var T=1,O=0;Math.round(P*T)/T!==P;)T*=10,O++;return O}function r(P){var T=P.toString(),O=T.indexOf("e");if(O>0){var D=+T.slice(O+1);return D<0?-D:0}else{var A=T.indexOf(".");return A<0?0:T.length-1-A}}function e(P,T){var O=Math.log,D=Math.LN10,A=Math.floor(O(P[1]-P[0])/D),C=Math.round(O(Math.abs(T[1]-T[0]))/D),S=Math.min(Math.max(-A+C,0),20);return isFinite(S)?S:20}function n(P,T,O){if(!P[T])return 0;var D=E.reduce(P,function(z,G){return z+(isNaN(G)?0:G)},0);if(D===0)return 0;for(var A=Math.pow(10,O),C=E.map(P,function(z){return(isNaN(z)?0:z)/D*A*100}),S=A*100,L=E.map(C,function(z){return Math.floor(z)}),I=E.reduce(L,function(z,G){return z+G},0),w=E.map(C,function(z,G){return z-L[G]});I<S;){for(var b=Number.NEGATIVE_INFINITY,B=null,U=0,W=w.length;U<W;++U)w[U]>b&&(b=w[U],B=U);++L[B],w[B]=0,++I}return L[T]/A}var l=9007199254740991;function u(P){var T=Math.PI*2;return(P%T+T)%T}function _(P){return P>-c&&P<c}var f=/^(?:(\d{4})(?:[-\/](\d{1,2})(?:[-\/](\d{1,2})(?:[T ](\d{1,2})(?::(\d\d)(?::(\d\d)(?:[.,](\d+))?)?)?(Z|[\+\-]\d\d:?\d\d)?)?)?)?)?$/;function d(P){if(P instanceof Date)return P;if(typeof P=="string"){var T=f.exec(P);if(!T)return new Date(NaN);if(T[8]){var O=+T[4]||0;return T[8].toUpperCase()!=="Z"&&(O-=T[8].slice(0,3)),new Date(Date.UTC(+T[1],+(T[2]||1)-1,+T[3]||1,O,+(T[5]||0),+T[6]||0,+T[7]||0))}else return new Date(+T[1],+(T[2]||1)-1,+T[3]||1,+T[4]||0,+(T[5]||0),+T[6]||0,+T[7]||0)}else if(P==null)return new Date(NaN);return new Date(Math.round(P))}function v(P){return Math.pow(10,m(P))}function m(P){return Math.floor(Math.log(P)/Math.LN10)}function p(P,T){var O=m(P),D=Math.pow(10,O),A=P/D,C;return T?A<1.5?C=1:A<2.5?C=2:A<4?C=3:A<7?C=5:C=10:A<1?C=1:A<2?C=2:A<3?C=3:A<5?C=5:C=10,P=C*D,O>=-20?+P.toFixed(O<0?-O:0):P}function y(P,T){var O=(P.length-1)*T+1,D=Math.floor(O),A=+P[D-1],C=O-D;return C?A+C*(P[D]-A):A}function x(P){P.sort(function(I,w){return L(I,w,0)?-1:1});for(var T=-Infinity,O=1,D=0;D<P.length;){for(var A=P[D].interval,C=P[D].close,S=0;S<2;S++)A[S]<=T&&(A[S]=T,C[S]=S?1:1-O),T=A[S],O=C[S];A[0]===A[1]&&C[0]*C[1]!=1?P.splice(D,1):D++}return P;function L(I,w,b){return I.interval[b]<w.interval[b]||I.interval[b]===w.interval[b]&&(I.close[b]-w.close[b]==(b?-1:1)||!b&&L(I,w,1))}}function M(P){return P-parseFloat(P)>=0}R.linearMap=a,R.parsePercent=o,R.round=i,R.asc=s,R.getPrecision=h,R.getPrecisionSafe=r,R.getPixelPrecision=e,R.getPercentWithPrecision=n,R.MAX_SAFE_INTEGER=l,R.remRadian=u,R.isRadianAroundZero=_,R.parseDate=d,R.quantity=v,R.nice=p,R.quantile=y,R.reformIntervals=x,R.isNumeric=M},function(F,R,g){var E=g(5),c=g(11),t=g(23),a=function(){this._pool={},this._allocatedTextures=[]};a.prototype={constructor:a,get:function(e){var n=s(e);this._pool.hasOwnProperty(n)||(this._pool[n]=[]);var l=this._pool[n];if(!l.length){var u=new E.a(e);return this._allocatedTextures.push(u),u}return l.pop()},put:function(e){var n=s(e);this._pool.hasOwnProperty(n)||(this._pool[n]=[]);var l=this._pool[n];l.push(e)},clear:function(e){for(var n=0;n<this._allocatedTextures.length;n++)this._allocatedTextures[n].dispose(e);this._pool={},this._allocatedTextures=[]}};var o={width:512,height:512,type:c.a.UNSIGNED_BYTE,format:c.a.RGBA,wrapS:c.a.CLAMP_TO_EDGE,wrapT:c.a.CLAMP_TO_EDGE,minFilter:c.a.LINEAR_MIPMAP_LINEAR,magFilter:c.a.LINEAR,useMipmap:!0,anisotropic:1,flipY:!0,unpackAlignment:4,premultiplyAlpha:!1},i=Object.keys(o);function s(e){t.a.defaultsWithPropList(e,o,i),h(e);for(var n="",l=0;l<i.length;l++){var u=i[l],_=e[u].toString();n+=_}return n}function h(e){var n=r(e.width,e.height);e.format===c.a.DEPTH_COMPONENT&&(e.useMipmap=!1),(!n||!e.useMipmap)&&(e.minFilter==c.a.NEAREST_MIPMAP_NEAREST||e.minFilter==c.a.NEAREST_MIPMAP_LINEAR?e.minFilter=c.a.NEAREST:(e.minFilter==c.a.LINEAR_MIPMAP_LINEAR||e.minFilter==c.a.LINEAR_MIPMAP_NEAREST)&&(e.minFilter=c.a.LINEAR)),n||(e.wrapS=c.a.CLAMP_TO_EDGE,e.wrapT=c.a.CLAMP_TO_EDGE)}function r(e,n){return(e&e-1)==0&&(n&n-1)==0}R.a=a},function(F,R,g){R.a=`@export clay.compositor.kernel.gaussian_9
float gaussianKernel[9];
gaussianKernel[0] = 0.07;
gaussianKernel[1] = 0.09;
gaussianKernel[2] = 0.12;
gaussianKernel[3] = 0.14;
gaussianKernel[4] = 0.16;
gaussianKernel[5] = 0.14;
gaussianKernel[6] = 0.12;
gaussianKernel[7] = 0.09;
gaussianKernel[8] = 0.07;
@end
@export clay.compositor.kernel.gaussian_13
float gaussianKernel[13];
gaussianKernel[0] = 0.02;
gaussianKernel[1] = 0.03;
gaussianKernel[2] = 0.06;
gaussianKernel[3] = 0.08;
gaussianKernel[4] = 0.11;
gaussianKernel[5] = 0.13;
gaussianKernel[6] = 0.14;
gaussianKernel[7] = 0.13;
gaussianKernel[8] = 0.11;
gaussianKernel[9] = 0.08;
gaussianKernel[10] = 0.06;
gaussianKernel[11] = 0.03;
gaussianKernel[12] = 0.02;
@end
@export clay.compositor.gaussian_blur
#define SHADER_NAME gaussian_blur
uniform sampler2D texture;varying vec2 v_Texcoord;
uniform float blurSize : 2.0;
uniform vec2 textureSize : [512.0, 512.0];
uniform float blurDir : 0.0;
@import clay.util.rgbm
@import clay.util.clamp_sample
void main (void)
{
 @import clay.compositor.kernel.gaussian_9
 vec2 off = blurSize / textureSize;
 off *= vec2(1.0 - blurDir, blurDir);
 vec4 sum = vec4(0.0);
 float weightAll = 0.0;
 for (int i = 0; i < 9; i++) {
 float w = gaussianKernel[i];
 vec4 texel = decodeHDR(clampSample(texture, v_Texcoord + float(i - 4) * off));
 sum += texel * w;
 weightAll += w;
 }
 gl_FragColor = encodeHDR(sum / max(weightAll, 0.01));
}
@end
`},function(F,R,g){R.a=`
@export clay.compositor.lut
varying vec2 v_Texcoord;
uniform sampler2D texture;
uniform sampler2D lookup;
void main()
{
 vec4 tex = texture2D(texture, v_Texcoord);
 float blueColor = tex.b * 63.0;
 vec2 quad1;
 quad1.y = floor(floor(blueColor) / 8.0);
 quad1.x = floor(blueColor) - (quad1.y * 8.0);
 vec2 quad2;
 quad2.y = floor(ceil(blueColor) / 8.0);
 quad2.x = ceil(blueColor) - (quad2.y * 8.0);
 vec2 texPos1;
 texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.r);
 texPos1.y = (quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.g);
 vec2 texPos2;
 texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.r);
 texPos2.y = (quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.g);
 vec4 newColor1 = texture2D(lookup, texPos1);
 vec4 newColor2 = texture2D(lookup, texPos2);
 vec4 newColor = mix(newColor1, newColor2, fract(blueColor));
 gl_FragColor = vec4(newColor.rgb, tex.w);
}
@end`},function(F,R,g){R.a=`@export clay.compositor.output
#define OUTPUT_ALPHA
varying vec2 v_Texcoord;
uniform sampler2D texture;
@import clay.util.rgbm
void main()
{
 vec4 tex = decodeHDR(texture2D(texture, v_Texcoord));
 gl_FragColor.rgb = tex.rgb;
#ifdef OUTPUT_ALPHA
 gl_FragColor.a = tex.a;
#else
 gl_FragColor.a = 1.0;
#endif
 gl_FragColor = encodeHDR(gl_FragColor);
#ifdef PREMULTIPLY_ALPHA
 gl_FragColor.rgb *= gl_FragColor.a;
#endif
}
@end`},function(F,R,g){R.a=`@export clay.compositor.bright
uniform sampler2D texture;
uniform float threshold : 1;
uniform float scale : 1.0;
uniform vec2 textureSize: [512, 512];
varying vec2 v_Texcoord;
const vec3 lumWeight = vec3(0.2125, 0.7154, 0.0721);
@import clay.util.rgbm
vec4 median(vec4 a, vec4 b, vec4 c)
{
 return a + b + c - min(min(a, b), c) - max(max(a, b), c);
}
void main()
{
 vec4 texel = decodeHDR(texture2D(texture, v_Texcoord));
#ifdef ANTI_FLICKER
 vec3 d = 1.0 / textureSize.xyx * vec3(1.0, 1.0, 0.0);
 vec4 s1 = decodeHDR(texture2D(texture, v_Texcoord - d.xz));
 vec4 s2 = decodeHDR(texture2D(texture, v_Texcoord + d.xz));
 vec4 s3 = decodeHDR(texture2D(texture, v_Texcoord - d.zy));
 vec4 s4 = decodeHDR(texture2D(texture, v_Texcoord + d.zy));
 texel = median(median(texel, s1, s2), s3, s4);
#endif
 float lum = dot(texel.rgb , lumWeight);
 vec4 color;
 if (lum > threshold && texel.a > 0.0)
 {
 color = vec4(texel.rgb * scale, texel.a * scale);
 }
 else
 {
 color = vec4(0.0);
 }
 gl_FragColor = encodeHDR(color);
}
@end
`},function(F,R,g){R.a=`@export clay.compositor.downsample
uniform sampler2D texture;
uniform vec2 textureSize : [512, 512];
varying vec2 v_Texcoord;
@import clay.util.rgbm
float brightness(vec3 c)
{
 return max(max(c.r, c.g), c.b);
}
@import clay.util.clamp_sample
void main()
{
 vec4 d = vec4(-1.0, -1.0, 1.0, 1.0) / textureSize.xyxy;
#ifdef ANTI_FLICKER
 vec3 s1 = decodeHDR(clampSample(texture, v_Texcoord + d.xy)).rgb;
 vec3 s2 = decodeHDR(clampSample(texture, v_Texcoord + d.zy)).rgb;
 vec3 s3 = decodeHDR(clampSample(texture, v_Texcoord + d.xw)).rgb;
 vec3 s4 = decodeHDR(clampSample(texture, v_Texcoord + d.zw)).rgb;
 float s1w = 1.0 / (brightness(s1) + 1.0);
 float s2w = 1.0 / (brightness(s2) + 1.0);
 float s3w = 1.0 / (brightness(s3) + 1.0);
 float s4w = 1.0 / (brightness(s4) + 1.0);
 float oneDivideSum = 1.0 / (s1w + s2w + s3w + s4w);
 vec4 color = vec4(
 (s1 * s1w + s2 * s2w + s3 * s3w + s4 * s4w) * oneDivideSum,
 1.0
 );
#else
 vec4 color = decodeHDR(clampSample(texture, v_Texcoord + d.xy));
 color += decodeHDR(clampSample(texture, v_Texcoord + d.zy));
 color += decodeHDR(clampSample(texture, v_Texcoord + d.xw));
 color += decodeHDR(clampSample(texture, v_Texcoord + d.zw));
 color *= 0.25;
#endif
 gl_FragColor = encodeHDR(color);
}
@end`},function(F,R,g){R.a=`
@export clay.compositor.upsample
#define HIGH_QUALITY
uniform sampler2D texture;
uniform vec2 textureSize : [512, 512];
uniform float sampleScale: 0.5;
varying vec2 v_Texcoord;
@import clay.util.rgbm
@import clay.util.clamp_sample
void main()
{
#ifdef HIGH_QUALITY
 vec4 d = vec4(1.0, 1.0, -1.0, 0.0) / textureSize.xyxy * sampleScale;
 vec4 s;
 s = decodeHDR(clampSample(texture, v_Texcoord - d.xy));
 s += decodeHDR(clampSample(texture, v_Texcoord - d.wy)) * 2.0;
 s += decodeHDR(clampSample(texture, v_Texcoord - d.zy));
 s += decodeHDR(clampSample(texture, v_Texcoord + d.zw)) * 2.0;
 s += decodeHDR(clampSample(texture, v_Texcoord )) * 4.0;
 s += decodeHDR(clampSample(texture, v_Texcoord + d.xw)) * 2.0;
 s += decodeHDR(clampSample(texture, v_Texcoord + d.zy));
 s += decodeHDR(clampSample(texture, v_Texcoord + d.wy)) * 2.0;
 s += decodeHDR(clampSample(texture, v_Texcoord + d.xy));
 gl_FragColor = encodeHDR(s / 16.0);
#else
 vec4 d = vec4(-1.0, -1.0, +1.0, +1.0) / textureSize.xyxy;
 vec4 s;
 s = decodeHDR(clampSample(texture, v_Texcoord + d.xy));
 s += decodeHDR(clampSample(texture, v_Texcoord + d.zy));
 s += decodeHDR(clampSample(texture, v_Texcoord + d.xw));
 s += decodeHDR(clampSample(texture, v_Texcoord + d.zw));
 gl_FragColor = encodeHDR(s / 4.0);
#endif
}
@end`},function(F,R,g){R.a=`@export clay.compositor.hdr.composite
#define TONEMAPPING
uniform sampler2D texture;
#ifdef BLOOM_ENABLED
uniform sampler2D bloom;
#endif
#ifdef LENSFLARE_ENABLED
uniform sampler2D lensflare;
uniform sampler2D lensdirt;
#endif
#ifdef LUM_ENABLED
uniform sampler2D lum;
#endif
#ifdef LUT_ENABLED
uniform sampler2D lut;
#endif
#ifdef COLOR_CORRECTION
uniform float brightness : 0.0;
uniform float contrast : 1.0;
uniform float saturation : 1.0;
#endif
#ifdef VIGNETTE
uniform float vignetteDarkness: 1.0;
uniform float vignetteOffset: 1.0;
#endif
uniform float exposure : 1.0;
uniform float bloomIntensity : 0.25;
uniform float lensflareIntensity : 1;
varying vec2 v_Texcoord;
@import clay.util.srgb
vec3 ACESToneMapping(vec3 color)
{
 const float A = 2.51;
 const float B = 0.03;
 const float C = 2.43;
 const float D = 0.59;
 const float E = 0.14;
 return (color * (A * color + B)) / (color * (C * color + D) + E);
}
float eyeAdaption(float fLum)
{
 return mix(0.2, fLum, 0.5);
}
#ifdef LUT_ENABLED
vec3 lutTransform(vec3 color) {
 float blueColor = color.b * 63.0;
 vec2 quad1;
 quad1.y = floor(floor(blueColor) / 8.0);
 quad1.x = floor(blueColor) - (quad1.y * 8.0);
 vec2 quad2;
 quad2.y = floor(ceil(blueColor) / 8.0);
 quad2.x = ceil(blueColor) - (quad2.y * 8.0);
 vec2 texPos1;
 texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * color.r);
 texPos1.y = (quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * color.g);
 vec2 texPos2;
 texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * color.r);
 texPos2.y = (quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * color.g);
 vec4 newColor1 = texture2D(lut, texPos1);
 vec4 newColor2 = texture2D(lut, texPos2);
 vec4 newColor = mix(newColor1, newColor2, fract(blueColor));
 return newColor.rgb;
}
#endif
@import clay.util.rgbm
void main()
{
 vec4 texel = vec4(0.0);
 vec4 originalTexel = vec4(0.0);
#ifdef TEXTURE_ENABLED
 texel = decodeHDR(texture2D(texture, v_Texcoord));
 originalTexel = texel;
#endif
#ifdef BLOOM_ENABLED
 vec4 bloomTexel = decodeHDR(texture2D(bloom, v_Texcoord));
 texel.rgb += bloomTexel.rgb * bloomIntensity;
 texel.a += bloomTexel.a * bloomIntensity;
#endif
#ifdef LENSFLARE_ENABLED
 texel += decodeHDR(texture2D(lensflare, v_Texcoord)) * texture2D(lensdirt, v_Texcoord) * lensflareIntensity;
#endif
 texel.a = min(texel.a, 1.0);
#ifdef LUM_ENABLED
 float fLum = texture2D(lum, vec2(0.5, 0.5)).r;
 float adaptedLumDest = 3.0 / (max(0.1, 1.0 + 10.0*eyeAdaption(fLum)));
 float exposureBias = adaptedLumDest * exposure;
#else
 float exposureBias = exposure;
#endif
#ifdef TONEMAPPING
 texel.rgb *= exposureBias;
 texel.rgb = ACESToneMapping(texel.rgb);
#endif
 texel = linearTosRGB(texel);
#ifdef LUT_ENABLED
 texel.rgb = lutTransform(clamp(texel.rgb,vec3(0.0),vec3(1.0)));
#endif
#ifdef COLOR_CORRECTION
 texel.rgb = clamp(texel.rgb + vec3(brightness), 0.0, 1.0);
 texel.rgb = clamp((texel.rgb - vec3(0.5))*contrast+vec3(0.5), 0.0, 1.0);
 float lum = dot(texel.rgb, vec3(0.2125, 0.7154, 0.0721));
 texel.rgb = mix(vec3(lum), texel.rgb, saturation);
#endif
#ifdef VIGNETTE
 vec2 uv = (v_Texcoord - vec2(0.5)) * vec2(vignetteOffset);
 texel.rgb = mix(texel.rgb, vec3(1.0 - vignetteDarkness), dot(uv, uv));
#endif
 gl_FragColor = encodeHDR(texel);
#ifdef DEBUG
 #if DEBUG == 1
 gl_FragColor = encodeHDR(decodeHDR(texture2D(texture, v_Texcoord)));
 #elif DEBUG == 2
 gl_FragColor = encodeHDR(decodeHDR(texture2D(bloom, v_Texcoord)) * bloomIntensity);
 #elif DEBUG == 3
 gl_FragColor = encodeHDR(decodeHDR(texture2D(lensflare, v_Texcoord) * lensflareIntensity));
 #endif
#endif
 if (originalTexel.a <= 0.01 && gl_FragColor.a > 1e-5) {
 gl_FragColor.a = dot(gl_FragColor.rgb, vec3(0.2125, 0.7154, 0.0721));
 }
#ifdef PREMULTIPLY_ALPHA
 gl_FragColor.rgb *= gl_FragColor.a;
#endif
}
@end`},function(F,R,g){R.a=`@export clay.compositor.blend
#define SHADER_NAME blend
#ifdef TEXTURE1_ENABLED
uniform sampler2D texture1;
uniform float weight1 : 1.0;
#endif
#ifdef TEXTURE2_ENABLED
uniform sampler2D texture2;
uniform float weight2 : 1.0;
#endif
#ifdef TEXTURE3_ENABLED
uniform sampler2D texture3;
uniform float weight3 : 1.0;
#endif
#ifdef TEXTURE4_ENABLED
uniform sampler2D texture4;
uniform float weight4 : 1.0;
#endif
#ifdef TEXTURE5_ENABLED
uniform sampler2D texture5;
uniform float weight5 : 1.0;
#endif
#ifdef TEXTURE6_ENABLED
uniform sampler2D texture6;
uniform float weight6 : 1.0;
#endif
varying vec2 v_Texcoord;
@import clay.util.rgbm
void main()
{
 vec4 tex = vec4(0.0);
#ifdef TEXTURE1_ENABLED
 tex += decodeHDR(texture2D(texture1, v_Texcoord)) * weight1;
#endif
#ifdef TEXTURE2_ENABLED
 tex += decodeHDR(texture2D(texture2, v_Texcoord)) * weight2;
#endif
#ifdef TEXTURE3_ENABLED
 tex += decodeHDR(texture2D(texture3, v_Texcoord)) * weight3;
#endif
#ifdef TEXTURE4_ENABLED
 tex += decodeHDR(texture2D(texture4, v_Texcoord)) * weight4;
#endif
#ifdef TEXTURE5_ENABLED
 tex += decodeHDR(texture2D(texture5, v_Texcoord)) * weight5;
#endif
#ifdef TEXTURE6_ENABLED
 tex += decodeHDR(texture2D(texture6, v_Texcoord)) * weight6;
#endif
 gl_FragColor = encodeHDR(tex);
}
@end`},function(F,R,g){R.a=`@export clay.compositor.fxaa
uniform sampler2D texture;
uniform vec4 viewport : VIEWPORT;
varying vec2 v_Texcoord;
#define FXAA_REDUCE_MIN (1.0/128.0)
#define FXAA_REDUCE_MUL (1.0/8.0)
#define FXAA_SPAN_MAX 8.0
@import clay.util.rgbm
void main()
{
 vec2 resolution = 1.0 / viewport.zw;
 vec3 rgbNW = decodeHDR( texture2D( texture, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ) ).xyz;
 vec3 rgbNE = decodeHDR( texture2D( texture, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ) ).xyz;
 vec3 rgbSW = decodeHDR( texture2D( texture, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ) ).xyz;
 vec3 rgbSE = decodeHDR( texture2D( texture, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ) ).xyz;
 vec4 rgbaM = decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution ) );
 vec3 rgbM = rgbaM.xyz;
 float opacity = rgbaM.w;
 vec3 luma = vec3( 0.299, 0.587, 0.114 );
 float lumaNW = dot( rgbNW, luma );
 float lumaNE = dot( rgbNE, luma );
 float lumaSW = dot( rgbSW, luma );
 float lumaSE = dot( rgbSE, luma );
 float lumaM = dot( rgbM, luma );
 float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );
 float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );
 vec2 dir;
 dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
 dir.y = ((lumaNW + lumaSW) - (lumaNE + lumaSE));
 float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );
 float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );
 dir = min( vec2( FXAA_SPAN_MAX, FXAA_SPAN_MAX),
 max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
 dir * rcpDirMin)) * resolution;
 vec3 rgbA = decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution + dir * ( 1.0 / 3.0 - 0.5 ) ) ).xyz;
 rgbA += decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution + dir * ( 2.0 / 3.0 - 0.5 ) ) ).xyz;
 rgbA *= 0.5;
 vec3 rgbB = decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution + dir * -0.5 ) ).xyz;
 rgbB += decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution + dir * 0.5 ) ).xyz;
 rgbB *= 0.25;
 rgbB += rgbA * 0.5;
 float lumaB = dot( rgbB, luma );
 if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) )
 {
 gl_FragColor = vec4( rgbA, opacity );
 }
 else {
 gl_FragColor = vec4( rgbB, opacity );
 }
}
@end`},function(F,R,g){var E=g(0),c=g.n(E);R.a={getFilledRegions:function(t,a){var o=(t||[]).slice(),i;if(typeof a=="string"?(a=c.a.getMap(a),i=a&&a.geoJson):a&&a.features&&(i=a),!i)return console.error("Map "+a+" not exists. You can download map file on http://echarts.baidu.com/download-map.html"),i.features||console.error("Invalid GeoJSON for map3D"),[];for(var s={},h=i.features,r=0;r<o.length;r++)s[o[r].name]=o[r];for(var r=0;r<h.length;r++){var e=h[r].properties.name;s[e]||o.push({name:e})}return o},defaultOption:{show:!0,zlevel:-10,map:"",left:0,top:0,width:"100%",height:"100%",boxWidth:100,boxHeight:10,boxDepth:"auto",regionHeight:3,environment:"auto",groundPlane:{show:!1,color:"#aaa"},shading:"lambert",light:{main:{alpha:40,beta:30}},viewControl:{alpha:40,beta:0,distance:100,orthographicSize:60,minAlpha:5,minBeta:-80,maxBeta:80},label:{show:!1,distance:2,textStyle:{fontSize:20,color:"#000",backgroundColor:"rgba(255,255,255,0.7)",padding:3,borderRadius:4}},itemStyle:{color:"#fff",borderWidth:0,borderColor:"#333"},emphasis:{itemStyle:{color:"#639fc0"},label:{show:!0}}}}},function(F,R,g){function E(o,i,s){var h=o[i];o[i]=o[s],o[s]=h}function c(o,i,s,h,r){var e=s,n=o[i];E(o,i,h);for(var l=s;l<h;l++)r(o[l],n)<0&&(E(o,l,e),e++);return E(o,h,e),e}function t(o,i,s,h){if(s<h){var r=Math.floor((s+h)/2),e=c(o,r,s,h,i);t(o,i,s,e-1),t(o,i,e+1,h)}}function a(){this._parts=[]}a.prototype.step=function(o,i,s){var h=o.length;if(s===0){this._parts=[],this._sorted=!1;var r=Math.floor(h/2);this._parts.push({pivot:r,left:0,right:h-1}),this._currentSortPartIdx=0}if(!this._sorted){var e=this._parts;if(e.length===0)return this._sorted=!0,!0;if(e.length<512){for(var n=0;n<e.length;n++)e[n].pivot=c(o,e[n].pivot,e[n].left,e[n].right,i);for(var l=[],n=0;n<e.length;n++){var u=e[n].left,_=e[n].pivot-1;_>u&&l.push({pivot:Math.floor((_+u)/2),left:u,right:_});var u=e[n].pivot+1,_=e[n].right;_>u&&l.push({pivot:Math.floor((_+u)/2),left:u,right:_})}e=this._parts=l}else for(var n=0;n<Math.floor(e.length/10);n++){var f=e.length-1-this._currentSortPartIdx;if(t(o,i,e[f].left,e[f].right),this._currentSortPartIdx++,this._currentSortPartIdx===e.length)return this._sorted=!0,!0}return!1}},a.sort=t,R.a=a},function(F,R,g){var E=g(98),c=g(0),t=g.n(c),a=g(47),o=g.n(a),i=g(22),s=g(2);function h(u,_){var f=u.getBoxLayoutParams(),d=o.a.getLayoutRect(f,{width:_.getWidth(),height:_.getHeight()});d.y=_.getHeight()-d.y-d.height,this.viewGL.setViewport(d.x,d.y,d.width,d.height,_.getDevicePixelRatio());var v=this.getGeoBoundingRect(),m=v.width/v.height*(u.get("aspectScale")||.75),p=u.get("boxWidth"),y=u.get("boxDepth"),x=u.get("boxHeight");x==null&&(x=5),isNaN(p)&&isNaN(y)&&(p=100),isNaN(y)?y=p/m:isNaN(p)&&(p=y/m),this.setSize(p,x,y),this.regionHeight=u.get("regionHeight"),this.altitudeAxis&&this.altitudeAxis.setExtent(0,Math.max(x-this.regionHeight,0))}function r(u,_){var f=[Infinity,-Infinity];if(u.eachSeries(function(v){if(v.coordinateSystem===this&&v.type!=="series.map3D"){var m=v.getData(),p=v.coordDimToDataDim("alt"),y=p&&p[0];if(y){var x=m.getDataExtent(y,!0);f[0]=Math.min(f[0],x[0]),f[1]=Math.max(f[1],x[1])}}},this),f&&isFinite(f[1]-f[0])){var d=t.a.helper.createScale(f,{type:"value",min:"dataMin",max:"dataMax"});this.altitudeAxis=new t.a.Axis("altitude",d),this.resize(this.model,_)}}var e=function(u){console.error("Map "+u+" not exists. You can download map file on http://echarts.baidu.com/download-map.html")},n=0,l={dimensions:E.a.prototype.dimensions,create:function(u,_){var f=[];if(!t.a.getMap)throw new Error("geo3D component depends on geo component");function d(v,m){var p=l.createGeo3D(v);v.__viewGL=v.__viewGL||new i.a,p.viewGL=v.__viewGL,v.coordinateSystem=p,p.model=v,f.push(p),p.resize=h,p.resize(v,_),p.update=r}return u.eachComponent("geo3D",function(v,m){d(v)}),u.eachSeriesByType("map3D",function(v,m){var p=v.get("coordinateSystem");p==null&&(p="geo3D"),p==="geo3D"&&d(v)}),u.eachSeries(function(v){if(v.get("coordinateSystem")==="geo3D"){if(v.type==="series.map3D")return;var m=v.getReferringComponents("geo3D")[0];if(m||(m=u.getComponent("geo3D")),!m)throw new Error('geo "'+s.a.firstNotNull(v.get("geo3DIndex"),v.get("geo3DId"),0)+'" not found');v.coordinateSystem=m.coordinateSystem}}),f},createGeo3D:function(u){var _=u.get("map"),f;if(typeof _=="string"?(f=_,_=t.a.getMap(_)):_&&_.features&&(_={geoJson:_}),_||e(_),!_.geoJson.features)throw new Error("Invalid GeoJSON for map3D");return f==null&&(f="GEO_ANONYMOUS_"+n++),new E.a(f+n++,f,_&&_.geoJson,_&&_.specialAreas,u.get("nameMap"))}};t.a.registerCoordinateSystem("geo3D",l),R.a=l},function(F,R,g){var E=g(0),c=g.n(E),t=g(6),a=g(207),o=g.n(a),i=g(208),s=g.n(i),h=t.a.vec3,r=t.a.mat4,e=[o.a,s.a];function n(l,u,_,f,d){this.name=l,this.map=u,this.regionHeight=0,this.regions=[],this._nameCoordMap={},this.loadGeoJson(_,f,d),this.transform=r.identity(new Float64Array(16)),this.invTransform=r.identity(new Float64Array(16)),this.extrudeY=!0,this.altitudeAxis}n.prototype={constructor:n,type:"geo3D",dimensions:["lng","lat","alt"],containPoint:function(){},loadGeoJson:function(l,u,_){var f=c.a.parseGeoJSON||c.a.parseGeoJson;try{this.regions=l?f(l):[]}catch(x){throw`Invalid geoJson format
`+x}u=u||{},_=_||{};for(var d=this.regions,v={},m=0;m<d.length;m++){var p=d[m].name;p=_[p]||p,d[m].name=p,v[p]=d[m],this.addGeoCoord(p,d[m].center);var y=u[p];y&&d[m].transformTo(y.left,y.top,y.width,y.height)}this._regionsMap=v,this._geoRect=null,e.forEach(function(x){x(this)},this)},getGeoBoundingRect:function(){if(this._geoRect)return this._geoRect;for(var l,u=this.regions,_=0;_<u.length;_++){var f=u[_].getBoundingRect();l=l||f.clone(),l.union(f)}return this._geoRect=l||new c.a.graphic.BoundingRect(0,0,0,0)},addGeoCoord:function(l,u){this._nameCoordMap[l]=u},getRegion:function(l){return this._regionsMap[l]},getRegionByCoord:function(l){for(var u=this.regions,_=0;_<u.length;_++)if(u[_].contain(l))return u[_]},setSize:function(l,u,_){this.size=[l,u,_];var f=this.getGeoBoundingRect(),d=l/f.width,v=-_/f.height,m=-l/2-f.x*d,p=_/2-f.y*v,y=this.extrudeY?[m,0,p]:[m,p,0],x=this.extrudeY?[d,1,v]:[d,v,1],M=this.transform;r.identity(M),r.translate(M,M,y),r.scale(M,M,x),r.invert(this.invTransform,M)},dataToPoint:function(l,u){u=u||[];var _=this.extrudeY?1:2,f=this.extrudeY?2:1,d=l[2];return isNaN(d)&&(d=0),u[0]=l[0],u[f]=l[1],this.altitudeAxis?u[_]=this.altitudeAxis.dataToCoord(d):u[_]=0,u[_]+=this.regionHeight,h.transformMat4(u,u,this.transform),u},pointToData:function(l,u){}},R.a=n},function(F,R,g){var E=g(6),c=E.a.mat4,t=512,a=.6435011087932844,o=Math.PI,i=1/10;function s(){this.width=0,this.height=0,this.altitudeScale=1,this.boxHeight="auto",this.altitudeExtent,this.bearing=0,this.pitch=0,this.center=[0,0],this._origin,this.zoom=0,this._initialZoom,this.maxPitch=60,this.zoomOffset=0}s.prototype={constructor:s,dimensions:["lng","lat","alt"],containPoint:function(){},setCameraOption:function(h){this.bearing=h.bearing,this.pitch=h.pitch,this.center=h.center,this.zoom=h.zoom,this._origin||(this._origin=this.projectOnTileWithScale(this.center,t)),this._initialZoom==null&&(this._initialZoom=this.zoom),this.updateTransform()},updateTransform:function(){if(!!this.height){var h=.5/Math.tan(a/2)*this.height*i,r=Math.max(Math.min(this.pitch,this.maxPitch),0)/180*Math.PI,e=a/2,n=Math.PI/2+r,l=Math.sin(e)*h/Math.sin(Math.PI-n-e),u=Math.cos(Math.PI/2-r)*l+h,_=u*1.1;this.pitch>50&&(_=1e3);var f=[];c.perspective(f,a,this.width/this.height,1,_),this.viewGL.camera.projectionMatrix.setArray(f),this.viewGL.camera.decomposeProjectionMatrix();var f=c.identity([]),d=this.dataToPoint(this.center);c.scale(f,f,[1,-1,1]),c.translate(f,f,[0,0,-h]),c.rotateX(f,f,r),c.rotateZ(f,f,-this.bearing/180*Math.PI),c.translate(f,f,[-d[0]*this.getScale()*i,-d[1]*this.getScale()*i,0]),this.viewGL.camera.viewMatrix.array=f;var v=[];c.invert(v,f),this.viewGL.camera.worldTransform.array=v,this.viewGL.camera.decomposeWorldTransform();var m=t*this.getScale(),p;if(this.altitudeExtent&&!isNaN(this.boxHeight)){var y=this.altitudeExtent[1]-this.altitudeExtent[0];p=this.boxHeight/y*this.getScale()/Math.pow(2,this._initialZoom-this.zoomOffset)}else p=m/(2*Math.PI*6378e3*Math.abs(Math.cos(this.center[1]*(Math.PI/180))))*this.altitudeScale*i;this.viewGL.rootNode.scale.set(this.getScale()*i,this.getScale()*i,p)}},getScale:function(){return Math.pow(2,this.zoom-this.zoomOffset)},projectOnTile:function(h,r){return this.projectOnTileWithScale(h,this.getScale()*t,r)},projectOnTileWithScale:function(h,r,e){var n=h[0],l=h[1],u=n*o/180,_=l*o/180,f=r*(u+o)/(2*o),d=r*(o-Math.log(Math.tan(o/4+_*.5)))/(2*o);return e=e||[],e[0]=f,e[1]=d,e},unprojectFromTile:function(h,r){return this.unprojectOnTileWithScale(h,this.getScale()*t,r)},unprojectOnTileWithScale:function(h,r,e){var n=h[0],l=h[1],u=n/r*(2*o)-o,_=2*(Math.atan(Math.exp(o-l/r*(2*o)))-o/4);return e=e||[],e[0]=u*180/o,e[1]=_*180/o,e},dataToPoint:function(h,r){return r=this.projectOnTileWithScale(h,t,r),r[0]-=this._origin[0],r[1]-=this._origin[1],r[2]=isNaN(h[2])?0:h[2],isNaN(h[2])||(r[2]=h[2],this.altitudeExtent&&(r[2]-=this.altitudeExtent[0])),r}},R.a=s},function(F,R,g){var E=g(2),c=g(1),t=g(22);R.a=function(a,o,i){function s(r,e){var n=e.getWidth(),l=e.getHeight(),u=e.getDevicePixelRatio();this.viewGL.setViewport(0,0,n,l,u),this.width=n,this.height=l,this.altitudeScale=r.get("altitudeScale"),this.boxHeight=r.get("boxHeight")}function h(r,e){if(this.model.get("boxHeight")!=="auto"){var n=[Infinity,-Infinity];r.eachSeries(function(l){if(l.coordinateSystem===this){var u=l.getData(),_=l.coordDimToDataDim("alt")[0];if(_){var f=u.getDataExtent(_,!0);n[0]=Math.min(n[0],f[0]),n[1]=Math.max(n[1],f[1])}}},this),n&&isFinite(n[1]-n[0])&&(this.altitudeExtent=n)}}return{dimensions:o.prototype.dimensions,create:function(r,e){var n=[];return r.eachComponent(a,function(l){var u=l.__viewGL;u||(u=l.__viewGL=new t.a,u.setRootNode(new c.a.Node));var _=new o;_.viewGL=l.__viewGL,_.resize=s,_.resize(l,e),n.push(_),l.coordinateSystem=_,_.model=l,_.update=h}),r.eachSeries(function(l){if(l.get("coordinateSystem")===a){var u=l.getReferringComponents(a)[0];if(u||(u=r.getComponent(a)),!u)throw new Error(a+' "'+E.a.firstNotNull(l.get(a+"Index"),l.get(a+"Id"),0)+'" not found');l.coordinateSystem=u.coordinateSystem}}),i&&i(n,r,e),n}}}},function(F,R,g){R.a=`
@export ecgl.displayShadow.vertex

@import ecgl.common.transformUniforms

@import ecgl.common.uv.header

@import ecgl.common.attributes

varying vec3 v_WorldPosition;

varying vec3 v_Normal;

void main()
{
 @import ecgl.common.uv.main
 v_Normal = normalize((worldInverseTranspose * vec4(normal, 0.0)).xyz);

 v_WorldPosition = (world * vec4(position, 1.0)).xyz;
 gl_Position = worldViewProjection * vec4(position, 1.0);
}

@end


@export ecgl.displayShadow.fragment

@import ecgl.common.uv.fragmentHeader

varying vec3 v_Normal;
varying vec3 v_WorldPosition;

uniform float roughness: 0.2;

#ifdef DIRECTIONAL_LIGHT_COUNT
@import clay.header.directional_light
#endif

@import ecgl.common.ssaoMap.header

@import clay.plugin.compute_shadow_map

void main()
{
 float shadow = 1.0;

 @import ecgl.common.ssaoMap.main

#if defined(DIRECTIONAL_LIGHT_COUNT) && defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)
 float shadowContribsDir[DIRECTIONAL_LIGHT_COUNT];
 if(shadowEnabled)
 {
 computeShadowOfDirectionalLights(v_WorldPosition, shadowContribsDir);
 }
 for (int i = 0; i < DIRECTIONAL_LIGHT_COUNT; i++) {
 shadow = min(shadow, shadowContribsDir[i] * 0.5 + 0.5);
 }
#endif

 shadow *= 0.5 + ao * 0.5;
 shadow = clamp(shadow, 0.0, 1.0);

 gl_FragColor = vec4(vec3(0.0), 1.0 - shadow);
}

@end`},function(F,R,g){var E=g(264),c=g.n(E),t=g(265),a=g.n(t);function o(i){this.viewGL=i}o.prototype.reset=function(i,s){this._updateCamera(s.getWidth(),s.getHeight(),s.getDevicePixelRatio()),this._viewTransform=c.a.create(),this.updateTransform(i,s)},o.prototype.updateTransform=function(i,s){var h=i.coordinateSystem;h.getRoamTransform&&(c.a.invert(this._viewTransform,h.getRoamTransform()),this._setCameraTransform(this._viewTransform),s.getZr().refresh())},o.prototype.dataToPoint=function(i,s,h){h=i.dataToPoint(s,null,h);var r=this._viewTransform;r&&a.a.applyTransform(h,h,r)},o.prototype.removeTransformInPoint=function(i){return this._viewTransform&&a.a.applyTransform(i,i,this._viewTransform),i},o.prototype.getZoom=function(){if(this._viewTransform){var i=this._viewTransform;return 1/Math.max(Math.sqrt(i[0]*i[0]+i[1]*i[1]),Math.sqrt(i[2]*i[2]+i[3]*i[3]))}return 1},o.prototype._setCameraTransform=function(i){var s=this.viewGL.camera;s.position.set(i[4],i[5],0),s.scale.set(Math.sqrt(i[0]*i[0]+i[1]*i[1]),Math.sqrt(i[2]*i[2]+i[3]*i[3]),1)},o.prototype._updateCamera=function(i,s,h){this.viewGL.setViewport(0,0,i,s,h);var r=this.viewGL.camera;r.left=r.top=0,r.bottom=s,r.right=i,r.near=0,r.far=100},R.a=o},function(F,R,g){(function(E){var c;typeof window!="undefined"?c=window.__DEV__:typeof E!="undefined"&&(c=E.__DEV__),typeof c=="undefined"&&(c=!0);var t=c;R.__DEV__=t}).call(R,g(67))},function(F,R,g){var E=g(14),c=g(0),t=g.n(c),a=g(39),o=g(6),i=o.a.vec2,s=[[0,0],[1,1]],h=E.a.extend(function(){return{segmentScale:4,dynamic:!0,useNativeLine:!0,attributes:{position:new E.a.Attribute("position","float",2,"POSITION"),normal:new E.a.Attribute("normal","float",2),offset:new E.a.Attribute("offset","float",1),color:new E.a.Attribute("color","float",4,"COLOR")}}},{resetOffset:function(){this._vertexOffset=0,this._faceOffset=0,this._itemVertexOffsets=[]},setVertexCount:function(r){var e=this.attributes;this.vertexCount!==r&&(e.position.init(r),e.color.init(r),this.useNativeLine||(e.offset.init(r),e.normal.init(r)),r>65535?this.indices instanceof Uint16Array&&(this.indices=new Uint32Array(this.indices)):this.indices instanceof Uint32Array&&(this.indices=new Uint16Array(this.indices)))},setTriangleCount:function(r){this.triangleCount!==r&&(r===0?this.indices=null:this.indices=this.vertexCount>65535?new Uint32Array(r*3):new Uint16Array(r*3))},_getCubicCurveApproxStep:function(r,e,n,l){var u=i.dist(r,e)+i.dist(n,e)+i.dist(l,n),_=1/(u+1)*this.segmentScale;return _},getCubicCurveVertexCount:function(r,e,n,l){var u=this._getCubicCurveApproxStep(r,e,n,l),_=Math.ceil(1/u);return this.useNativeLine?_*2:_*2+2},getCubicCurveTriangleCount:function(r,e,n,l){var u=this._getCubicCurveApproxStep(r,e,n,l),_=Math.ceil(1/u);return this.useNativeLine?0:_*2},getLineVertexCount:function(){return this.getPolylineVertexCount(s)},getLineTriangleCount:function(){return this.getPolylineTriangleCount(s)},getPolylineVertexCount:function(r){var e;if(typeof r=="number")e=r;else{var n=typeof r[0]!="number";e=n?r.length:r.length/2}return this.useNativeLine?(e-1)*2:(e-1)*2+2},getPolylineTriangleCount:function(r){var e;if(typeof r=="number")e=r;else{var n=typeof r[0]!="number";e=n?r.length:r.length/2}return this.useNativeLine?0:(e-1)*2},addCubicCurve:function(r,e,n,l,u,_){_==null&&(_=1);for(var f=r[0],d=r[1],v=e[0],m=e[1],p=n[0],y=n[1],x=l[0],M=l[1],P=this._getCubicCurveApproxStep(r,e,n,l),T=P*P,O=T*P,D=3*P,A=3*T,C=6*T,S=6*O,L=f-v*2+p,I=d-m*2+y,w=(v-p)*3-f+x,b=(m-y)*3-d+M,B=f,U=d,W=(v-f)*D+L*A+w*O,z=(m-d)*D+I*A+b*O,G=L*C+w*S,H=I*C+b*S,X=w*S,Q=b*S,j=0,J=0,Y=Math.ceil(1/P),at=new Float32Array((Y+1)*3),at=[],ot=0,J=0;J<Y+1;J++)at[ot++]=B,at[ot++]=U,B+=W,U+=z,W+=G,z+=H,G+=X,H+=Q,j+=P,j>1&&(B=W>0?Math.min(B,x):Math.max(B,x),U=z>0?Math.min(U,M):Math.max(U,M));this.addPolyline(at,u,_)},addLine:function(r,e,n,l){this.addPolyline([r,e],n,l)},addPolyline:function(){var r=i.create(),e=i.create(),n=i.create(),l=i.create(),u=[],_=[],f=[];return function(d,v,m,p,y){if(!!d.length){var x=typeof d[0]!="number";if(y==null&&(y=x?d.length:d.length/2),!(y<2)){p==null&&(p=0),m==null&&(m=1),this._itemVertexOffsets.push(this._vertexOffset);for(var M=x?typeof v[0]!="number":v.length/4===y,P=this.attributes.position,T=this.attributes.color,O=this.attributes.offset,D=this.attributes.normal,A=this.indices,C=this._vertexOffset,S,L=0;L<y;L++){if(x)u=d[L+p],M?S=v[L+p]:S=v;else{var I=L*2+p;if(u=u||[],u[0]=d[I],u[1]=d[I+1],M){var w=L*4+p;S=S||[],S[0]=v[w],S[1]=v[w+1],S[2]=v[w+2],S[3]=v[w+3]}else S=v}if(this.useNativeLine)L>1&&(P.copy(C,C-1),T.copy(C,C-1),C++);else{var b;if(L<y-1){if(x)i.copy(_,d[L+1]);else{var I=(L+1)*2+p;_=_||[],_[0]=d[I],_[1]=d[I+1]}if(L>0){i.sub(r,u,f),i.sub(e,_,u),i.normalize(r,r),i.normalize(e,e),i.add(l,r,e),i.normalize(l,l);var B=m/2*Math.min(1/i.dot(r,l),2);n[0]=-l[1],n[1]=l[0],b=B}else i.sub(r,_,u),i.normalize(r,r),n[0]=-r[1],n[1]=r[0],b=m/2}else i.sub(r,u,f),i.normalize(r,r),n[0]=-r[1],n[1]=r[0],b=m/2;D.set(C,n),D.set(C+1,n),O.set(C,b),O.set(C+1,-b),i.copy(f,u),P.set(C,u),P.set(C+1,u),T.set(C,S),T.set(C+1,S),C+=2}if(this.useNativeLine)T.set(C,S),P.set(C,u),C++;else if(L>0){var U=this._faceOffset*3,A=this.indices;A[U]=C-4,A[U+1]=C-3,A[U+2]=C-2,A[U+3]=C-3,A[U+4]=C-1,A[U+5]=C-2,this._faceOffset+=2}}this._vertexOffset=C}}}}(),setItemColor:function(r,e){for(var n=this._itemVertexOffsets[r],l=r<this._itemVertexOffsets.length-1?this._itemVertexOffsets[r+1]:this._vertexOffset,u=n;u<l;u++)this.attributes.color.set(u,e);this.dirty("color")}});t.a.util.defaults(h.prototype,a.a),R.a=h},function(F,R,g){Object.defineProperty(R,"__esModule",{value:!0}),g(106),g(153),g(203),g(209),g(215),g(221),g(227),g(234),g(238),g(245),g(251),g(254),g(258),g(261),g(266),g(279),g(285)},function(F,R,g){var E=g(0),c=g.n(E),t=g(107),a=g(108),o=g(152),i=g(1),s={version:"1.1.2",dependencies:{echarts:"4.1.0",claygl:"1.2.1"}},h=s.dependencies;function r(u){throw new Error(u+" version is too old, needs "+h[u]+" or higher")}function e(u,_){u.replace(".","")-0<h[_].replace(".","")-0&&r(_),console.log("Loaded "+_+", version "+u)}e(t.a,"claygl"),e(c.a.version,"echarts");function n(u){this._layers={},this._zr=u}n.prototype.update=function(u,_){var f=this,d=_.getZr();if(!d.getWidth()||!d.getHeight()){console.warn("Dom has no width or height");return}function v(y){var x;y.coordinateSystem&&y.coordinateSystem.model,x=y.get("zlevel");var M=f._layers,P=M[x];if(!P){if(P=M[x]=new a.a("gl-"+x,d),d.painter.isSingleCanvas()){P.virtual=!0;var T=new c.a.graphic.Image({z:1e4,style:{image:P.renderer.canvas},silent:!0});P.__hostImage=T,d.add(T)}d.painter.insertLayer(x,P)}return P.__hostImage&&P.__hostImage.setStyle({width:P.renderer.getWidth(),height:P.renderer.getHeight()}),P}function m(y,x){y&&y.traverse(function(M){M.isRenderable&&M.isRenderable()&&(M.ignorePicking=M.$ignorePicking!=null?M.$ignorePicking:x)})}for(var p in this._layers)this._layers[p].removeViewsAll();u.eachComponent(function(y,x){if(y!=="series"){var M=_.getViewOfComponentModel(x),P=x.coordinateSystem;if(M.__ecgl__){var T;if(P){if(!P.viewGL){console.error("Can't find viewGL in coordinateSystem of component "+x.id);return}T=P.viewGL}else{if(!x.viewGL){console.error("Can't find viewGL of component "+x.id);return}T=P.viewGL}var T=P.viewGL,O=v(x);O.addView(T),M.afterRender&&M.afterRender(x,u,_,O),m(M.groupGL,x.get("silent"))}}}),u.eachSeries(function(y){var x=_.getViewOfSeriesModel(y),M=y.coordinateSystem;if(x.__ecgl__){if(M&&!M.viewGL&&!x.viewGL){console.error("Can't find viewGL of series "+x.id);return}var P=M&&M.viewGL||x.viewGL,T=v(y);T.addView(P),x.afterRender&&x.afterRender(y,u,_,T),m(x.groupGL,y.get("silent"))}})};var l=c.a.init;c.a.init=function(){var u=l.apply(this,arguments);return u.getZr().painter.getRenderedCanvas=function(_){if(_=_||{},this._singleCanvas)return this._layers[0].dom;var f=document.createElement("canvas"),d=_.pixelRatio||this.dpr;f.width=this.getWidth()*d,f.height=this.getHeight()*d;var v=f.getContext("2d");v.dpr=d,v.clearRect(0,0,f.width,f.height),_.backgroundColor&&(v.fillStyle=_.backgroundColor,v.fillRect(0,0,f.width,f.height));var m=this.storage.getDisplayList(!0),p={},y,x=this;function M(D,A){var C=x._zlevelList;D==null&&(D=-Infinity);for(var S,L=0;L<C.length;L++){var I=C[L],w=x._layers[I];if(!w.__builtin__&&I>D&&I<A){S=w;break}}S&&S.renderToCanvas&&(v.save(),S.renderToCanvas(v),v.restore())}for(var P={ctx:v},T=0;T<m.length;T++){var O=m[T];O.zlevel!==y&&(M(y,O.zlevel),y=O.zlevel),this._doPaintEl(O,P,!0,p)}return M(y,Infinity),f},u},c.a.registerPostUpdate(function(u,_){var f=_.getZr(),d=f.__egl=f.__egl||new n(f);d.update(u,_)}),c.a.registerPreprocessor(o.a),c.a.graphicGL=i.a},function(F,R,g){R.a="1.3.0"},function(F,R,g){var E=g(0),c=g.n(E),t=g(52),a=g(116),o=g(4),i=g(1),s=g(53),h=g(81),r=g.n(h),e=function(v,m){this.id=v,this.zr=m;try{this.renderer=new t.a({clearBit:0,devicePixelRatio:m.painter.dpr,preserveDrawingBuffer:!0,premultipliedAlpha:!0}),this.renderer.resize(m.painter.getWidth(),m.painter.getHeight())}catch(y){this.renderer=null,this.dom=document.createElement("div"),this.dom.style.cssText="position:absolute; left: 0; top: 0; right: 0; bottom: 0;",this.dom.className="ecgl-nowebgl",this.dom.innerHTML="Sorry, your browser does not support WebGL",console.error(y);return}this.onglobalout=this.onglobalout.bind(this),m.on("globalout",this.onglobalout),this.dom=this.renderer.canvas;var p=this.dom.style;p.position="absolute",p.left="0",p.top="0",this.views=[],this._picking=new a.a({renderer:this.renderer}),this._viewsToDispose=[],this._accumulatingId=0,this._zrEventProxy=new c.a.graphic.Rect({shape:{x:-1,y:-1,width:2,height:2},__isGLToZRProxy:!0}),this._backgroundColor=null};e.prototype.addView=function(v){if(v.layer!==this){var m=this._viewsToDispose.indexOf(v);m>=0&&this._viewsToDispose.splice(m,1),this.views.push(v),v.layer=this;var p=this.zr;v.scene.traverse(function(y){y.__zr=p,y.addAnimatorsToZr&&y.addAnimatorsToZr(p)})}};function n(v){var m=v.__zr;v.__zr=null,m&&v.removeAnimatorsFromZr&&v.removeAnimatorsFromZr(m)}e.prototype.removeView=function(v){if(v.layer===this){var m=this.views.indexOf(v);m>=0&&(this.views.splice(m,1),v.scene.traverse(n,this),v.layer=null,this._viewsToDispose.push(v))}},e.prototype.removeViewsAll=function(){this.views.forEach(function(v){v.scene.traverse(n,this),v.layer=null,this._viewsToDispose.push(v)},this),this.views.length=0},e.prototype.resize=function(v,m){var p=this.renderer;p.resize(v,m)},e.prototype.clear=function(){var v=this.renderer.gl,m=this._backgroundColor||[0,0,0,0];v.clearColor(m[0],m[1],m[2],m[3]),v.depthMask(!0),v.colorMask(!0,!0,!0,!0),v.clear(v.DEPTH_BUFFER_BIT|v.COLOR_BUFFER_BIT)},e.prototype.clearDepth=function(){var v=this.renderer.gl;v.clear(v.DEPTH_BUFFER_BIT)},e.prototype.clearColor=function(){var v=this.renderer.gl;v.clearColor(0,0,0,0),v.clear(v.COLOR_BUFFER_BIT)},e.prototype.needsRefresh=function(){this.zr.refresh()},e.prototype.refresh=function(v){this._backgroundColor=v?i.a.parseColor(v):[0,0,0,0],this.renderer.clearColor=this._backgroundColor;for(var m=0;m<this.views.length;m++)this.views[m].prepareRender(this.renderer);this._doRender(!1),this._trackAndClean();for(var m=0;m<this._viewsToDispose.length;m++)this._viewsToDispose[m].dispose(this.renderer);this._viewsToDispose.length=0,this._startAccumulating()},e.prototype.renderToCanvas=function(v){this._startAccumulating(!0),v.drawImage(this.dom,0,0,v.canvas.width,v.canvas.height)},e.prototype._doRender=function(v){this.clear(),this.renderer.saveViewport();for(var m=0;m<this.views.length;m++)this.views[m].render(this.renderer,v);this.renderer.restoreViewport()},e.prototype._stopAccumulating=function(){this._accumulatingId=0,clearTimeout(this._accumulatingTimeout)};var l=1;e.prototype._startAccumulating=function(v){var m=this;this._stopAccumulating();for(var p=!1,y=0;y<this.views.length;y++)p=this.views[y].needsAccumulate()||p;if(!p)return;function x(M){if(!(!m._accumulatingId||M!==m._accumulatingId)){for(var P=!0,T=0;T<m.views.length;T++)P=m.views[T].isAccumulateFinished()&&p;P||(m._doRender(!0),v?x(M):r()(function(){x(M)}))}}this._accumulatingId=l++,v?x(m._accumulatingId):this._accumulatingTimeout=setTimeout(function(){x(m._accumulatingId)},50)},e.prototype._trackAndClean=function(){var v=[],m=[];this._textureList&&(u(this._textureList),u(this._geometriesList));for(var p=0;p<this.views.length;p++)d(this.views[p].scene,v,m);this._textureList&&(_(this.renderer,this._textureList),_(this.renderer,this._geometriesList)),this._textureList=v,this._geometriesList=m};function u(v){for(var m=0;m<v.length;m++)v[m].__used__=0}function _(v,m){for(var p=0;p<m.length;p++)m[p].__used__||m[p].dispose(v)}function f(v,m){v.__used__=v.__used__||0,v.__used__++,v.__used__===1&&m.push(v)}function d(v,m,p){var y,x;v.traverse(function(P){if(P.isRenderable()){var T=P.geometry,O=P.material;if(O!==y)for(var D=O.getTextureUniforms(),A=0;A<D.length;A++){var C=D[A],S=O.uniforms[C].value;if(!!S){if(S instanceof o.a)f(S,m);else if(S instanceof Array)for(var L=0;L<S.length;L++)S[L]instanceof o.a&&f(S[L],m)}}T!==x&&f(T,p),y=O,x=T}});for(var M=0;M<v.lights.length;M++)v.lights[M].cubemap&&f(v.lights[M].cubemap,m)}e.prototype.dispose=function(){this._stopAccumulating(),this.renderer.disposeScene(this.scene),this.zr.off("globalout",this.onglobalout)},e.prototype.onmousedown=function(v){if(!(v.target&&v.target.__isGLToZRProxy)){v=v.event;var m=this.pickObject(v.offsetX,v.offsetY);m&&(this._dispatchEvent("mousedown",v,m),this._dispatchDataEvent("mousedown",v,m)),this._downX=v.offsetX,this._downY=v.offsetY}},e.prototype.onmousemove=function(v){if(!(v.target&&v.target.__isGLToZRProxy)){v=v.event;var m=this.pickObject(v.offsetX,v.offsetY),p=m&&m.target,y=this._hovered;this._hovered=m,y&&p!==y.target&&(y.relatedTarget=p,this._dispatchEvent("mouseout",v,y),this.zr.setCursorStyle("default")),this._dispatchEvent("mousemove",v,m),m&&(this.zr.setCursorStyle("pointer"),(!y||p!==y.target)&&this._dispatchEvent("mouseover",v,m)),this._dispatchDataEvent("mousemove",v,m)}},e.prototype.onmouseup=function(v){if(!(v.target&&v.target.__isGLToZRProxy)){v=v.event;var m=this.pickObject(v.offsetX,v.offsetY);m&&(this._dispatchEvent("mouseup",v,m),this._dispatchDataEvent("mouseup",v,m)),this._upX=v.offsetX,this._upY=v.offsetY}},e.prototype.onclick=e.prototype.dblclick=function(v){if(!(v.target&&v.target.__isGLToZRProxy)){var m=this._upX-this._downX,p=this._upY-this._downY;if(!(Math.sqrt(m*m+p*p)>20)){v=v.event;var y=this.pickObject(v.offsetX,v.offsetY);y&&(this._dispatchEvent(v.type,v,y),this._dispatchDataEvent(v.type,v,y));var x=this._clickToSetFocusPoint(v);if(x){var M=x.view.setDOFFocusOnPoint(x.distance);M&&this.zr.refresh()}}}},e.prototype._clickToSetFocusPoint=function(v){for(var m=this.renderer,p=m.viewport,y=this.views.length-1;y>=0;y--){var x=this.views[y];if(x.hasDOF()&&x.containPoint(v.offsetX,v.offsetY)){this._picking.scene=x.scene,this._picking.camera=x.camera,m.viewport=x.viewport;var M=this._picking.pick(v.offsetX,v.offsetY,!0);if(M)return M.view=x,M}}m.viewport=p},e.prototype.onglobalout=function(v){var m=this._hovered;m&&this._dispatchEvent("mouseout",v,{target:m.target})},e.prototype.pickObject=function(v,m){for(var p=[],y=this.renderer,x=y.viewport,M=0;M<this.views.length;M++){var P=this.views[M];P.containPoint(v,m)&&(this._picking.scene=P.scene,this._picking.camera=P.camera,y.viewport=P.viewport,this._picking.pickAll(v,m,p))}return y.viewport=x,p.sort(function(T,O){return T.distance-O.distance}),p[0]},e.prototype._dispatchEvent=function(v,m,p){p||(p={});var y=p.target;for(p.cancelBubble=!1,p.event=m,p.type=v,p.offsetX=m.offsetX,p.offsetY=m.offsetY;y&&(y.trigger(v,p),y=y.getParent(),!p.cancelBubble););this._dispatchToView(v,p)},e.prototype._dispatchDataEvent=function(v,m,p){var y=p&&p.target,x=y&&y.dataIndex,M=y&&y.seriesIndex,P=y&&y.eventData,T=!1,O=this._zrEventProxy;O.position=[m.offsetX,m.offsetY],O.update();var D={target:O};v==="mousemove"&&(x!=null?x!==this._lastDataIndex&&(parseInt(this._lastDataIndex,10)>=0&&(O.dataIndex=this._lastDataIndex,O.seriesIndex=this._lastSeriesIndex,this.zr.handler.dispatchToElement(D,"mouseout",m)),T=!0):P!=null&&P!==this._lastEventData&&(this._lastEventData!=null&&(O.eventData=this._lastEventData,this.zr.handler.dispatchToElement(D,"mouseout",m)),T=!0),this._lastEventData=P,this._lastDataIndex=x,this._lastSeriesIndex=M),O.eventData=P,O.dataIndex=x,O.seriesIndex=M,(P!=null||parseInt(x,10)>=0&&parseInt(M,10)>=0)&&(this.zr.handler.dispatchToElement(D,v,m),T&&this.zr.handler.dispatchToElement(D,"mouseover",m))},e.prototype._dispatchToView=function(v,m){for(var p=0;p<this.views.length;p++)this.views[p].containPoint(m.offsetX,m.offsetY)&&this.views[p].trigger(v,m)},c.a.util.extend(e.prototype,s.a),R.a=e},function(F,R,g){function E(a,o,i){typeof o=="object"&&(i=o,o=null);var s=this,h;if(!(a instanceof Function)){h=[];for(var r in a)a.hasOwnProperty(r)&&h.push(r)}var e=function(l){if(s.apply(this,arguments),a instanceof Function?c(this,a.call(this,l)):t(this,a,h),this.constructor===e)for(var u=e.__initializers__,_=0;_<u.length;_++)u[_].apply(this,arguments)};e.__super__=s,s.__initializers__?e.__initializers__=s.__initializers__.slice():e.__initializers__=[],o&&e.__initializers__.push(o);var n=function(){};return n.prototype=s.prototype,e.prototype=new n,e.prototype.constructor=e,c(e.prototype,i),e.extend=s.extend,e.derive=s.extend,e}function c(a,o){if(!!o)for(var i in o)o.hasOwnProperty(i)&&(a[i]=o[i])}function t(a,o,i){for(var s=0;s<i.length;s++){var h=i[s];a[h]=o[h]}}R.a={extend:E,derive:E}},function(F,R,g){var E=["OES_texture_float","OES_texture_half_float","OES_texture_float_linear","OES_texture_half_float_linear","OES_standard_derivatives","OES_vertex_array_object","OES_element_index_uint","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_astc","WEBGL_depth_texture","EXT_texture_filter_anisotropic","EXT_shader_texture_lod","WEBGL_draw_buffers","EXT_frag_depth","EXT_sRGB","ANGLE_instanced_arrays"],c=["MAX_TEXTURE_SIZE","MAX_CUBE_MAP_TEXTURE_SIZE"];function t(a){for(var o={},i={},s=0;s<E.length;s++){var h=E[s];e(h)}for(var s=0;s<c.length;s++){var r=c[s];i[r]=a.getParameter(a[r])}this.getExtension=function(n){return n in o||e(n),o[n]},this.getParameter=function(n){return i[n]};function e(n){if(a.getExtension){var l=a.getExtension(n);l||(l=a.getExtension("MOZ_"+n)),l||(l=a.getExtension("WEBKIT_"+n)),o[n]=l}}}R.a=t},function(F,R,g){function E(c){var t=new XMLHttpRequest;t.open("get",c.url),t.responseType=c.responseType||"text",c.onprogress&&(t.onprogress=function(a){if(a.lengthComputable){var o=a.loaded/a.total;c.onprogress(o,a.loaded,a.total)}else c.onprogress(null)}),t.onload=function(a){t.status>=400?c.onerror&&c.onerror():c.onload&&c.onload(t.response)},c.onerror&&(t.onerror=c.onerror),t.send(null)}R.a={get:E}},function(F,R,g){var E=g(68),c={},t={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function a(m){return m=Math.round(m),m<0?0:m>255?255:m}function o(m){return m=Math.round(m),m<0?0:m>360?360:m}function i(m){return m<0?0:m>1?1:m}function s(m){return m.length&&m.charAt(m.length-1)==="%"?a(parseFloat(m)/100*255):a(parseInt(m,10))}function h(m){return m.length&&m.charAt(m.length-1)==="%"?i(parseFloat(m)/100):i(parseFloat(m))}function r(m,p,y){return y<0?y+=1:y>1&&(y-=1),y*6<1?m+(p-m)*y*6:y*2<1?p:y*3<2?m+(p-m)*(2/3-y)*6:m}function e(m,p,y){return m+(p-m)*y}function n(m,p,y,x,M){return m[0]=p,m[1]=y,m[2]=x,m[3]=M,m}function l(m,p){return m[0]=p[0],m[1]=p[1],m[2]=p[2],m[3]=p[3],m}var u=new E.a(20),_=null;function f(m,p){_&&l(_,p),_=u.put(m,_||p.slice())}c.parse=function(m,p){if(!!m){p=p||[];var y=u.get(m);if(y)return l(p,y);m=m+"";var x=m.replace(/ /g,"").toLowerCase();if(x in t)return l(p,t[x]),f(m,p),p;if(x.charAt(0)==="#"){if(x.length===4){var M=parseInt(x.substr(1),16);if(!(M>=0&&M<=4095)){n(p,0,0,0,1);return}return n(p,(M&3840)>>4|(M&3840)>>8,M&240|(M&240)>>4,M&15|(M&15)<<4,1),f(m,p),p}else if(x.length===7){var M=parseInt(x.substr(1),16);if(!(M>=0&&M<=16777215)){n(p,0,0,0,1);return}return n(p,(M&16711680)>>16,(M&65280)>>8,M&255,1),f(m,p),p}return}var P=x.indexOf("("),T=x.indexOf(")");if(P!==-1&&T+1===x.length){var O=x.substr(0,P),D=x.substr(P+1,T-(P+1)).split(","),A=1;switch(O){case"rgba":if(D.length!==4){n(p,0,0,0,1);return}A=h(D.pop());case"rgb":if(D.length!==3){n(p,0,0,0,1);return}return n(p,s(D[0]),s(D[1]),s(D[2]),A),f(m,p),p;case"hsla":if(D.length!==4){n(p,0,0,0,1);return}return D[3]=h(D[3]),d(D,p),f(m,p),p;case"hsl":if(D.length!==3){n(p,0,0,0,1);return}return d(D,p),f(m,p),p;default:return}}n(p,0,0,0,1)}},c.parseToFloat=function(m,p){if(p=c.parse(m,p),!!p)return p[0]/=255,p[1]/=255,p[2]/=255,p};function d(m,p){var y=(parseFloat(m[0])%360+360)%360/360,x=h(m[1]),M=h(m[2]),P=M<=.5?M*(x+1):M+x-M*x,T=M*2-P;return p=p||[],n(p,a(r(T,P,y+1/3)*255),a(r(T,P,y)*255),a(r(T,P,y-1/3)*255),1),m.length===4&&(p[3]=m[3]),p}function v(m){if(!!m){var p=m[0]/255,y=m[1]/255,x=m[2]/255,M=Math.min(p,y,x),P=Math.max(p,y,x),T=P-M,O=(P+M)/2,D,A;if(T===0)D=0,A=0;else{O<.5?A=T/(P+M):A=T/(2-P-M);var C=((P-p)/6+T/2)/T,S=((P-y)/6+T/2)/T,L=((P-x)/6+T/2)/T;p===P?D=L-S:y===P?D=1/3+C-L:x===P&&(D=2/3+S-C),D<0&&(D+=1),D>1&&(D-=1)}var I=[D*360,A,O];return m[3]!=null&&I.push(m[3]),I}}c.lift=function(m,p){var y=c.parse(m);if(y){for(var x=0;x<3;x++)p<0?y[x]=y[x]*(1-p)|0:y[x]=(255-y[x])*p+y[x]|0;return c.stringify(y,y.length===4?"rgba":"rgb")}},c.toHex=function(m){var p=c.parse(m);if(p)return((1<<24)+(p[0]<<16)+(p[1]<<8)+ +p[2]).toString(16).slice(1)},c.fastLerp=function(m,p,y){if(!(!(p&&p.length)||!(m>=0&&m<=1))){y=y||[];var x=m*(p.length-1),M=Math.floor(x),P=Math.ceil(x),T=p[M],O=p[P],D=x-M;return y[0]=a(e(T[0],O[0],D)),y[1]=a(e(T[1],O[1],D)),y[2]=a(e(T[2],O[2],D)),y[3]=i(e(T[3],O[3],D)),y}},c.fastMapToColor=c.fastLerp,c.lerp=function(m,p,y){if(!(!(p&&p.length)||!(m>=0&&m<=1))){var x=m*(p.length-1),M=Math.floor(x),P=Math.ceil(x),T=c.parse(p[M]),O=c.parse(p[P]),D=x-M,A=c.stringify([a(e(T[0],O[0],D)),a(e(T[1],O[1],D)),a(e(T[2],O[2],D)),i(e(T[3],O[3],D))],"rgba");return y?{color:A,leftIndex:M,rightIndex:P,value:x}:A}},c.mapToColor=c.lerp,c.modifyHSL=function(m,p,y,x){if(m=c.parse(m),m)return m=v(m),p!=null&&(m[0]=o(p)),y!=null&&(m[1]=h(y)),x!=null&&(m[2]=h(x)),c.stringify(d(m),"rgba")},c.modifyAlpha=function(m,p){if(m=c.parse(m),m&&p!=null)return m[3]=i(p),c.stringify(m,"rgba")},c.stringify=function(m,p){if(!(!m||!m.length)){var y=m[0]+","+m[1]+","+m[2];return(p==="rgba"||p==="hsva"||p==="hsla")&&(y+=","+m[3]),p+"("+y+")"}},R.a=c},function(F,R,g){var E=function(){this.head=null,this.tail=null,this._length=0};E.prototype.insert=function(c){var t=new E.Entry(c);return this.insertEntry(t),t},E.prototype.insertAt=function(c,t){if(!(c<0)){for(var a=this.head,o=0;a&&o!=c;)a=a.next,o++;if(a){var i=new E.Entry(t),s=a.prev;s?(s.next=i,i.prev=s):this.head=i,i.next=a,a.prev=i}else this.insert(t)}},E.prototype.insertBeforeEntry=function(c,t){var a=new E.Entry(c),o=t.prev;o?(o.next=a,a.prev=o):this.head=a,a.next=t,t.prev=a,this._length++},E.prototype.insertEntry=function(c){this.head?(this.tail.next=c,c.prev=this.tail,this.tail=c):this.head=this.tail=c,this._length++},E.prototype.remove=function(c){var t=c.prev,a=c.next;t?t.next=a:this.head=a,a?a.prev=t:this.tail=t,c.next=c.prev=null,this._length--},E.prototype.removeAt=function(c){if(!(c<0)){for(var t=this.head,a=0;t&&a!=c;)t=t.next,a++;if(t)return this.remove(t),t.value}},E.prototype.getHead=function(){if(this.head)return this.head.value},E.prototype.getTail=function(){if(this.tail)return this.tail.value},E.prototype.getAt=function(c){if(!(c<0)){for(var t=this.head,a=0;t&&a!=c;)t=t.next,a++;return t.value}},E.prototype.indexOf=function(c){for(var t=this.head,a=0;t;){if(t.value===c)return a;t=t.next,a++}},E.prototype.length=function(){return this._length},E.prototype.isEmpty=function(){return this._length===0},E.prototype.forEach=function(c,t){for(var a=this.head,o=0,i=typeof t!="undefined";a;)i?c.call(t,a.value,o):c(a.value,o),a=a.next,o++},E.prototype.clear=function(){this.tail=this.head=null,this._length=0},E.Entry=function(c){this.value=c,this.next=null,this.prev=null},R.a=E},function(F,R,g){var E=g(115),c=/for\s*?\(int\s*?_idx_\s*\=\s*([\w-]+)\;\s*_idx_\s*<\s*([\w-]+);\s*_idx_\s*\+\+\s*\)\s*\{\{([\s\S]+?)(?=\}\})\}\}/g;function t(h,r,e){function n(_,f,d,v){var m="";isNaN(f)&&(f in r?f=r[f]:f=l[f]),isNaN(d)&&(d in r?d=r[d]:d=l[d]);for(var p=parseInt(f);p<parseInt(d);p++)m+="{"+v.replace(/float\s*\(\s*_idx_\s*\)/g,p.toFixed(1)).replace(/_idx_/g,p)+"}";return m}var l={};for(var u in e)l[u+"_COUNT"]=e[u];return h.replace(c,n)}function a(h,r,e){var n=[];if(r)for(var l in r){var u=r[l];u>0&&n.push("#define "+l.toUpperCase()+"_COUNT "+u)}if(e)for(var _=0;_<e.length;_++){var f=e[_];n.push("#define "+f.toUpperCase()+"_ENABLED")}for(var f in h){var d=h[f];d===null?n.push("#define "+f):n.push("#define "+f+" "+d.toString())}return n.join(`
`)}function o(h){for(var r=[],e=0;e<h.length;e++)r.push("#extension GL_"+h[e][0]+" : enable");return r.join(`
`)}function i(h){return["precision",h,"float"].join(" ")+`;
`+["precision",h,"int"].join(" ")+`;
`+["precision",h,"sampler2D"].join(" ")+`;
`}function s(h){this._renderer=h,this._cache={}}s.prototype.getProgram=function(h,r,e,n){var l=this._cache,u=h.isSkinnedMesh&&h.isSkinnedMesh(),_=h.isInstancedMesh&&h.isInstancedMesh(),f="s"+r.shader.shaderID+"m"+r.getProgramKey();e&&(f+="se"+e.getProgramKey(h.lightGroup)),u&&(f+=",sk"+h.joints.length),_&&(f+=",is"),n.logDepthBuffer&&(f+=",ld");var d=l[f];if(d)return d;var v=e?e.getLightsNumbers(h.lightGroup):{},n=this._renderer,m=n.gl,p=r.getEnabledTextures(),y="";if(u){var x={SKINNING:null,JOINT_COUNT:h.joints.length};h.joints.length>n.getMaxJointNumber()&&(x.USE_SKIN_MATRICES_TEXTURE=null),y+=`
`+a(x)+`
`}_&&(y+=`
#define INSTANCING
`),n.logDepthBuffer&&(y+=`
#define LOG_DEPTH
`);for(var M=y+a(r.vertexDefines,v,p),P=y+a(r.fragmentDefines,v,p),T=[["OES_standard_derivatives","TEXTURE_LOD"],["EXT_shader_texture_lod","STANDARD_DERIVATIVES"],["EXT_frag_depth","FRAG_DEPTH"]].filter(function(w){return n.getGLExtension(w[0])!=null}),O=0;O<T.length;O++){var D=`
#define SUPPORT_`+T[O][1];P+=D,M+=D}var A=M+`
`+r.shader.vertex,C=o(T)+`
`+i(r.precision)+`
`+P+`
`+r.shader.fragment,S=t(A,r.vertexDefines,v),L=t(C,r.fragmentDefines,v),d=new E.a;d.uniformSemantics=r.shader.uniformSemantics,d.attributes=r.shader.attributes;var I=d.buildProgram(m,r.shader,S,L);return d.__error=I,l[f]=d,d},R.a=s},function(F,R,g){var E=g(13),c=g(8),t=1,a=2,o=3,i={};function s(n){for(var l=n.split(`
`),u=0,_=l.length;u<_;u++)l[u]=u+1+": "+l[u];return l.join(`
`)}function h(n,l,u){if(!n.getShaderParameter(l,n.COMPILE_STATUS))return[n.getShaderInfoLog(l),s(u)].join(`
`)}var r=new E.a.Float32Array(16),e=c.a.extend({uniformSemantics:{},attributes:{}},function(){this._locations={},this._textureSlot=0,this._program=null},{bind:function(n){this._textureSlot=0,n.gl.useProgram(this._program)},hasUniform:function(n){var l=this._locations[n];return l!=null},useTextureSlot:function(n,l,u){l&&(n.gl.activeTexture(n.gl.TEXTURE0+u),l.isRenderable()?l.bind(n):l.unbind(n))},currentTextureSlot:function(){return this._textureSlot},resetTextureSlot:function(n){this._textureSlot=n||0},takeCurrentTextureSlot:function(n,l){var u=this._textureSlot;return this.useTextureSlot(n,l,u),this._textureSlot++,u},setUniform:function(n,l,u,_){var f=this._locations,d=f[u];if(d==null)return!1;switch(l){case"m4":if(!(_ instanceof Float32Array)){for(var v=0;v<_.length;v++)r[v]=_[v];_=r}n.uniformMatrix4fv(d,!1,_);break;case"2i":n.uniform2i(d,_[0],_[1]);break;case"2f":n.uniform2f(d,_[0],_[1]);break;case"3i":n.uniform3i(d,_[0],_[1],_[2]);break;case"3f":n.uniform3f(d,_[0],_[1],_[2]);break;case"4i":n.uniform4i(d,_[0],_[1],_[2],_[3]);break;case"4f":n.uniform4f(d,_[0],_[1],_[2],_[3]);break;case"1i":n.uniform1i(d,_);break;case"1f":n.uniform1f(d,_);break;case"1fv":n.uniform1fv(d,_);break;case"1iv":n.uniform1iv(d,_);break;case"2iv":n.uniform2iv(d,_);break;case"2fv":n.uniform2fv(d,_);break;case"3iv":n.uniform3iv(d,_);break;case"3fv":n.uniform3fv(d,_);break;case"4iv":n.uniform4iv(d,_);break;case"4fv":n.uniform4fv(d,_);break;case"m2":case"m2v":n.uniformMatrix2fv(d,!1,_);break;case"m3":case"m3v":n.uniformMatrix3fv(d,!1,_);break;case"m4v":if(Array.isArray(_)&&Array.isArray(_[0])){for(var m=new E.a.Float32Array(_.length*16),p=0,v=0;v<_.length;v++)for(var y=_[v],x=0;x<16;x++)m[p++]=y[x];n.uniformMatrix4fv(d,!1,m)}else n.uniformMatrix4fv(d,!1,_);break}return!0},setUniformOfSemantic:function(n,l,u){var _=this.uniformSemantics[l];return _?this.setUniform(n,_.type,_.symbol,u):!1},enableAttributes:function(n,l,u){var _=n.gl,f=this._program,d=this._locations,v;u?v=u.__enabledAttributeList:v=i[n.__uid__],v||(u?v=u.__enabledAttributeList=[]:v=i[n.__uid__]=[]);for(var m=[],p=0;p<l.length;p++){var y=l[p];if(!this.attributes[y]){m[p]=-1;continue}var x=d[y];if(x==null){if(x=_.getAttribLocation(f,y),x===-1){m[p]=-1;continue}d[y]=x}m[p]=x,v[x]?v[x]=a:v[x]=t}for(var p=0;p<v.length;p++)switch(v[p]){case t:_.enableVertexAttribArray(p),v[p]=o;break;case a:v[p]=o;break;case o:_.disableVertexAttribArray(p),v[p]=0;break}return m},getAttribLocation:function(n,l){var u=this._locations,_=u[l];return _==null&&(_=n.getAttribLocation(this._program,l),u[l]=_),_},isAttribEnabled:function(n,l){var u=i[n.__uid__]||[];return!!u[l]},buildProgram:function(n,l,u,_){var f=n.createShader(n.VERTEX_SHADER),d=n.createProgram();n.shaderSource(f,u),n.compileShader(f);var v=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(v,_),n.compileShader(v);var m=h(n,f,u);if(m||(m=h(n,v,_),m))return m;if(n.attachShader(d,f),n.attachShader(d,v),l.attributeSemantics.POSITION)n.bindAttribLocation(d,0,l.attributeSemantics.POSITION.symbol);else{var p=Object.keys(this.attributes);n.bindAttribLocation(d,0,p[0])}if(n.linkProgram(d),n.deleteShader(f),n.deleteShader(v),this._program=d,this.vertexCode=u,this.fragmentCode=_,!n.getProgramParameter(d,n.LINK_STATUS))return`Could not link program
`+n.getProgramInfoLog(d);for(var y=0;y<l.uniforms.length;y++){var x=l.uniforms[y];this._locations[x]=n.getUniformLocation(d,x)}}});R.a=e},function(F,R,g){var E=g(8),c=g(54),t=g(26),a=g(3),o=g(7),i=g(71),s=g(11),h=g(12),r=E.a.extend({scene:null,camera:null,renderer:null},function(){this._ray=new c.a,this._ndc=new t.a},{pick:function(e,n,l){var u=this.pickAll(e,n,[],l);return u[0]||null},pickAll:function(e,n,l,u){return this.renderer.screenToNDC(e,n,this._ndc),this.camera.castRay(this._ndc,this._ray),l=l||[],this._intersectNode(this.scene,l,u||!1),l.sort(this._intersectionCompareFunc),l},_intersectNode:function(e,n,l){e instanceof i.a&&e.isRenderable()&&(!e.ignorePicking||l)&&(e.mode===s.a.TRIANGLES&&e.geometry.isUseIndices()||e.geometry.pickByRay||e.geometry.pick)&&this._intersectRenderable(e,n);for(var u=0;u<e._children.length;u++)this._intersectNode(e._children[u],n,l)},_intersectRenderable:function(){var e=new a.a,n=new a.a,l=new a.a,u=new c.a,_=new o.a;return function(f,d){var v=f.isSkinnedMesh();u.copy(this._ray),o.a.invert(_,f.worldTransform),v||u.applyTransform(_);var m=f.geometry,p=v?f.skeleton.boundingBox:m.boundingBox;if(!(p&&!u.intersectBoundingBox(p))){if(m.pick){m.pick(this._ndc.x,this._ndc.y,this.renderer,this.camera,f,d);return}else if(m.pickByRay){m.pickByRay(u,f,d);return}var y=f.cullFace===s.a.BACK&&f.frontFace===s.a.CCW||f.cullFace===s.a.FRONT&&f.frontFace===s.a.CW,x,M=m.indices,P=m.attributes.position,T=m.attributes.weight,O=m.attributes.joint,D,A=[];if(!(!P||!P.value||!M)){if(v){D=f.skeleton.getSubSkinMatrices(f.__uid__,f.joints);for(var C=0;C<f.joints.length;C++){A[C]=A[C]||[];for(var S=0;S<16;S++)A[C][S]=D[C*16+S]}var L=[],I=[],w=[],b=[],B=[],U=m.attributes.skinnedPosition;(!U||!U.value)&&(m.createAttribute("skinnedPosition","f",3),U=m.attributes.skinnedPosition,U.init(m.vertexCount));for(var C=0;C<m.vertexCount;C++){P.get(C,L),T.get(C,I),O.get(C,w),I[3]=1-I[0]-I[1]-I[2],h.a.set(b,0,0,0);for(var S=0;S<4;S++)w[S]>=0&&I[S]>1e-4&&(h.a.transformMat4(B,L,A[w[S]]),h.a.scaleAndAdd(b,b,B,I[S]));U.set(C,b)}}for(var C=0;C<M.length;C+=3){var W=M[C],z=M[C+1],G=M[C+2],H=v?m.attributes.skinnedPosition:P;if(H.get(W,e.array),H.get(z,n.array),H.get(G,l.array),y?x=u.intersectTriangle(e,n,l,f.culling):x=u.intersectTriangle(e,l,n,f.culling),x){var X=new a.a;v?a.a.copy(X,x):a.a.transformMat4(X,x,f.worldTransform),d.push(new r.Intersection(x,X,f,[W,z,G],C/3,a.a.dist(X,this._ray.origin)))}}}}}}(),_intersectionCompareFunc:function(e,n){return e.distance-n.distance}});r.Intersection=function(e,n,l,u,_,f){this.point=e,this.pointWorld=n,this.target=l,this.triangle=u,this.triangleIndex=_,this.distance=f},R.a=r},function(F,R,g){var E=g(8),c=g(11),t=g(57),a=g(13);function o(n){return{byte:a.a.Int8Array,ubyte:a.a.Uint8Array,short:a.a.Int16Array,ushort:a.a.Uint16Array}[n]||a.a.Float32Array}function i(n){return"attr_"+n}function s(n,l,u,_){switch(this.name=n,this.type=l,this.size=u,this.semantic=_||"",this.value=null,u){case 1:this.get=function(f){return this.value[f]},this.set=function(f,d){this.value[f]=d},this.copy=function(f,d){this.value[f]=this.value[f]};break;case 2:this.get=function(f,d){var v=this.value;return d[0]=v[f*2],d[1]=v[f*2+1],d},this.set=function(f,d){var v=this.value;v[f*2]=d[0],v[f*2+1]=d[1]},this.copy=function(f,d){var v=this.value;d*=2,f*=2,v[f]=v[d],v[f+1]=v[d+1]};break;case 3:this.get=function(f,d){var v=f*3,m=this.value;return d[0]=m[v],d[1]=m[v+1],d[2]=m[v+2],d},this.set=function(f,d){var v=f*3,m=this.value;m[v]=d[0],m[v+1]=d[1],m[v+2]=d[2]},this.copy=function(f,d){var v=this.value;d*=3,f*=3,v[f]=v[d],v[f+1]=v[d+1],v[f+2]=v[d+2]};break;case 4:this.get=function(f,d){var v=this.value,m=f*4;return d[0]=v[m],d[1]=v[m+1],d[2]=v[m+2],d[3]=v[m+3],d},this.set=function(f,d){var v=this.value,m=f*4;v[m]=d[0],v[m+1]=d[1],v[m+2]=d[2],v[m+3]=d[3]},this.copy=function(f,d){var v=this.value;d*=4,f*=4,v[f]=v[d],v[f+1]=v[d+1],v[f+2]=v[d+2],v[f+3]=v[d+3]}}}s.prototype.init=function(n){if(!this.value||this.value.length!==n*this.size){var l=o(this.type);this.value=new l(n*this.size)}},s.prototype.fromArray=function(n){var l=o(this.type),u;if(n[0]&&n[0].length){var _=0,f=this.size;u=new l(n.length*f);for(var d=0;d<n.length;d++)for(var v=0;v<f;v++)u[_++]=n[d][v]}else u=new l(n);this.value=u},s.prototype.clone=function(n){var l=new s(this.name,this.type,this.size,this.semantic);return n&&console.warn("todo"),l};function h(n,l,u,_,f){this.name=n,this.type=l,this.buffer=u,this.size=_,this.semantic=f,this.symbol="",this.needsRemove=!1}function r(n){this.buffer=n,this.count=0}var e=E.a.extend(function(){return{attributes:{},indices:null,dynamic:!0,_enabledAttributes:null,__used:0}},function(){this._cache=new t.a,this._attributeList=Object.keys(this.attributes),this.__vaoCache={}},{mainAttribute:"",pick:null,pickByRay:null,dirty:function(){for(var n=this.getEnabledAttributes(),l=0;l<n.length;l++)this.dirtyAttribute(n[l]);this.dirtyIndices(),this._enabledAttributes=null,this._cache.dirtyAll("any")},dirtyIndices:function(){this._cache.dirtyAll("indices")},dirtyAttribute:function(n){this._cache.dirtyAll(i(n)),this._cache.dirtyAll("attributes")},getTriangleIndices:function(n,l){if(n<this.triangleCount&&n>=0){l||(l=[]);var u=this.indices;return l[0]=u[n*3],l[1]=u[n*3+1],l[2]=u[n*3+2],l}},setTriangleIndices:function(n,l){var u=this.indices;u[n*3]=l[0],u[n*3+1]=l[1],u[n*3+2]=l[2]},isUseIndices:function(){return!!this.indices},initIndicesFromArray:function(n){var l,u=this.vertexCount>65535?a.a.Uint32Array:a.a.Uint16Array;if(n[0]&&n[0].length){var _=0,f=3;l=new u(n.length*f);for(var d=0;d<n.length;d++)for(var v=0;v<f;v++)l[_++]=n[d][v]}else l=new u(n);this.indices=l},createAttribute:function(n,l,u,_){var f=new s(n,l,u,_);return this.attributes[n]&&this.removeAttribute(n),this.attributes[n]=f,this._attributeList.push(n),f},removeAttribute:function(n){var l=this._attributeList,u=l.indexOf(n);return u>=0?(l.splice(u,1),delete this.attributes[n],!0):!1},getAttribute:function(n){return this.attributes[n]},getEnabledAttributes:function(){var n=this._enabledAttributes,l=this._attributeList;if(n)return n;for(var u=[],_=this.vertexCount,f=0;f<l.length;f++){var d=l[f],v=this.attributes[d];v.value&&v.value.length===_*v.size&&u.push(d)}return this._enabledAttributes=u,u},getBufferChunks:function(n){var l=this._cache;l.use(n.__uid__);var u=l.isDirty("attributes"),_=l.isDirty("indices");if(u||_){this._updateBuffer(n.gl,u,_);for(var f=this.getEnabledAttributes(),d=0;d<f.length;d++)l.fresh(i(f[d]));l.fresh("attributes"),l.fresh("indices")}return l.fresh("any"),l.get("chunks")},_updateBuffer:function(n,l,u){var _=this._cache,f=_.get("chunks"),d=!1;f||(f=[],f[0]={attributeBuffers:[],indicesBuffer:null},_.put("chunks",f),d=!0);var v=f[0],m=v.attributeBuffers,p=v.indicesBuffer;if(l||d){var y=this.getEnabledAttributes(),x={};if(!d)for(var M=0;M<m.length;M++)x[m[M].name]=m[M];for(var P=0;P<y.length;P++){var T=y[P],O=this.attributes[T],D;d||(D=x[T]);var A;D?A=D.buffer:A=n.createBuffer(),_.isDirty(i(T))&&(n.bindBuffer(n.ARRAY_BUFFER,A),n.bufferData(n.ARRAY_BUFFER,O.value,this.dynamic?n.DYNAMIC_DRAW:n.STATIC_DRAW)),m[P]=new h(T,O.type,A,O.size,O.semantic)}for(var M=P;M<m.length;M++)n.deleteBuffer(m[M].buffer);m.length=P}this.isUseIndices()&&(u||d)&&(p||(p=new r(n.createBuffer()),v.indicesBuffer=p),p.count=this.indices.length,n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,p.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,this.indices,this.dynamic?n.DYNAMIC_DRAW:n.STATIC_DRAW))},dispose:function(n){var l=this._cache;l.use(n.__uid__);var u=l.get("chunks");if(u)for(var _=0;_<u.length;_++){for(var f=u[_],d=0;d<f.attributeBuffers.length;d++){var v=f.attributeBuffers[d];n.gl.deleteBuffer(v.buffer)}f.indicesBuffer&&n.gl.deleteBuffer(f.indicesBuffer.buffer)}if(this.__vaoCache){var m=n.getGLExtension("OES_vertex_array_object");for(var p in this.__vaoCache){var y=this.__vaoCache[p].vao;y&&m.deleteVertexArrayOES(y)}}this.__vaoCache={},l.deleteContext(n.__uid__)}});Object.defineProperty&&(Object.defineProperty(e.prototype,"vertexCount",{enumerable:!1,get:function(){var n=this.attributes[this.mainAttribute];return n||(n=this.attributes[this._attributeList[0]]),!n||!n.value?0:n.value.length/n.size}}),Object.defineProperty(e.prototype,"triangleCount",{enumerable:!1,get:function(){var n=this.indices;return n?n.length/3:0}})),e.STATIC_DRAW=c.a.STATIC_DRAW,e.DYNAMIC_DRAW=c.a.DYNAMIC_DRAW,e.STREAM_DRAW=c.a.STREAM_DRAW,e.AttributeBuffer=h,e.IndicesBuffer=r,e.Attribute=s,R.a=e},function(F,R,g){var E=g(119),c="uniform vec3 ",t="uniform float ",a="@export clay.header.",o="@end",i=":unconfigurable;";R.a=[a+"directional_light",c+"directionalLightDirection[DIRECTIONAL_LIGHT_COUNT]"+i,c+"directionalLightColor[DIRECTIONAL_LIGHT_COUNT]"+i,o,a+"ambient_light",c+"ambientLightColor[AMBIENT_LIGHT_COUNT]"+i,o,a+"ambient_sh_light",c+"ambientSHLightColor[AMBIENT_SH_LIGHT_COUNT]"+i,c+"ambientSHLightCoefficients[AMBIENT_SH_LIGHT_COUNT * 9]"+i,E.a,o,a+"ambient_cubemap_light",c+"ambientCubemapLightColor[AMBIENT_CUBEMAP_LIGHT_COUNT]"+i,"uniform samplerCube ambientCubemapLightCubemap[AMBIENT_CUBEMAP_LIGHT_COUNT]"+i,"uniform sampler2D ambientCubemapLightBRDFLookup[AMBIENT_CUBEMAP_LIGHT_COUNT]"+i,o,a+"point_light",c+"pointLightPosition[POINT_LIGHT_COUNT]"+i,t+"pointLightRange[POINT_LIGHT_COUNT]"+i,c+"pointLightColor[POINT_LIGHT_COUNT]"+i,o,a+"spot_light",c+"spotLightPosition[SPOT_LIGHT_COUNT]"+i,c+"spotLightDirection[SPOT_LIGHT_COUNT]"+i,t+"spotLightRange[SPOT_LIGHT_COUNT]"+i,t+"spotLightUmbraAngleCosine[SPOT_LIGHT_COUNT]"+i,t+"spotLightPenumbraAngleCosine[SPOT_LIGHT_COUNT]"+i,t+"spotLightFalloffFactor[SPOT_LIGHT_COUNT]"+i,c+"spotLightColor[SPOT_LIGHT_COUNT]"+i,o].join(`
`)},function(F,R,g){R.a=`vec3 calcAmbientSHLight(int idx, vec3 N) {
 int offset = 9 * idx;
 return ambientSHLightCoefficients[0]
 + ambientSHLightCoefficients[1] * N.x
 + ambientSHLightCoefficients[2] * N.y
 + ambientSHLightCoefficients[3] * N.z
 + ambientSHLightCoefficients[4] * N.x * N.z
 + ambientSHLightCoefficients[5] * N.z * N.y
 + ambientSHLightCoefficients[6] * N.y * N.x
 + ambientSHLightCoefficients[7] * (3.0 * N.z * N.z - 1.0)
 + ambientSHLightCoefficients[8] * (N.x * N.x - N.y * N.y);
}`},function(F,R,g){R.a=`@export clay.skybox.vertex
#define SHADER_NAME skybox
uniform mat4 world : WORLD;
uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;
attribute vec3 position : POSITION;
varying vec3 v_WorldPosition;
void main()
{
 v_WorldPosition = (world * vec4(position, 1.0)).xyz;
 gl_Position = worldViewProjection * vec4(position, 1.0);
}
@end
@export clay.skybox.fragment
#define PI 3.1415926
uniform mat4 viewInverse : VIEWINVERSE;
#ifdef EQUIRECTANGULAR
uniform sampler2D environmentMap;
#else
uniform samplerCube environmentMap;
#endif
uniform float lod: 0.0;
varying vec3 v_WorldPosition;
@import clay.util.rgbm
@import clay.util.srgb
@import clay.util.ACES
void main()
{
 vec3 eyePos = viewInverse[3].xyz;
 vec3 V = normalize(v_WorldPosition - eyePos);
#ifdef EQUIRECTANGULAR
 float phi = acos(V.y);
 float theta = atan(-V.x, V.z) + PI * 0.5;
 vec2 uv = vec2(theta / 2.0 / PI, phi / PI);
 vec4 texel = decodeHDR(texture2D(environmentMap, fract(uv)));
#else
 #if defined(LOD) || defined(SUPPORT_TEXTURE_LOD)
 vec4 texel = decodeHDR(textureCubeLodEXT(environmentMap, V, lod));
 #else
 vec4 texel = decodeHDR(textureCube(environmentMap, V));
 #endif
#endif
#ifdef SRGB_DECODE
 texel = sRGBToLinear(texel);
#endif
#ifdef TONEMAPPING
 texel.rgb = ACESToneMapping(texel.rgb);
#endif
#ifdef SRGB_ENCODE
 texel = linearTosRGB(texel);
#endif
 gl_FragColor = encodeHDR(vec4(texel.rgb, 1.0));
}
@end`},function(F,R,g){var E=g(4),c=g(5);g(27);var t=542327876,a=131072,o=512,i=4;function s(M){return M.charCodeAt(0)+(M.charCodeAt(1)<<8)+(M.charCodeAt(2)<<16)+(M.charCodeAt(3)<<24)}var h=31,r=s("DXT1"),e=s("DXT3"),n=s("DXT5"),l=0,u=1,_=2,f=3,d=4,v=7,m=20,p=21,y=28,x={parse:function(M,P){var T=new Int32Array(M,0,h);if(T[l]!==t||!T(m)&i)return null;var O=T(p),D=T[d],A=T[f],C=T[y]&o,S=T[_]&a,L,I;switch(O){case r:L=8,I=E.a.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case e:L=16,I=E.a.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case n:L=16,I=E.a.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return null}var w=T[u]+4,b=C?6:1,B=1;S&&(B=Math.max(1,T[v]));for(var U=[],W=0;W<b;W++){var z=D,G=A;U[W]=new c.a({width:z,height:G,format:I});for(var H=[],X=0;X<B;X++){var Q=Math.max(4,z)/4*Math.max(4,G)/4*L,j=new Uint8Array(M,w,Q);w+=Q,z*=.5,G*=.5,H[X]=j}U[W].pixels=H[0],S&&(U[W].mipmaps=H)}if(P)P.width=U[0].width,P.height=U[0].height,P.format=U[0].format,P.pixels=U[0].pixels,P.mipmaps=U[0].mipmaps;else return U[0]}};R.a=x},function(F,R,g){var E=g(4),c=g(5),t=String.fromCharCode,a=8,o=32767;function i(l,u,_,f){if(l[3]>0){var d=Math.pow(2,l[3]-128-8+f);u[_+0]=l[0]*d,u[_+1]=l[1]*d,u[_+2]=l[2]*d}else u[_+0]=0,u[_+1]=0,u[_+2]=0;return u[_+3]=1,u}function s(l,u,_){for(var f="",d=u;d<_;d++)f+=t(l[d]);return f}function h(l,u){u[0]=l[0],u[1]=l[1],u[2]=l[2],u[3]=l[3]}function r(l,u,_,f){for(var d=0,v=0,m=f;m>0;)if(l[v][0]=u[_++],l[v][1]=u[_++],l[v][2]=u[_++],l[v][3]=u[_++],l[v][0]===1&&l[v][1]===1&&l[v][2]===1){for(var p=l[v][3]<<d>>>0;p>0;p--)h(l[v-1],l[v]),v++,m--;d+=8}else v++,m--,d=0;return _}function e(l,u,_,f){if(f<a|f>o)return r(l,u,_,f);var d=u[_++];if(d!=2)return r(l,u,_-1,f);if(l[0][1]=u[_++],l[0][2]=u[_++],d=u[_++],(l[0][2]<<8>>>0|d)>>>0!==f)return null;for(var d=0;d<4;d++)for(var v=0;v<f;){var m=u[_++];if(m>128){m=(m&127)>>>0;for(var p=u[_++];m--;)l[v++][d]=p}else for(;m--;)l[v++][d]=u[_++]}return _}var n={parseRGBE:function(l,u,_){_==null&&(_=0);var f=new Uint8Array(l),d=f.length;if(s(f,0,2)==="#?"){for(var v=2;v<d&&!(t(f[v])===`
`&&t(f[v+1])===`
`);v++);if(!(v>=d)){v+=2;for(var m="";v<d;v++){var p=t(f[v]);if(p===`
`)break;m+=p}var y=m.split(" "),x=parseInt(y[1]),M=parseInt(y[3]);if(!(!M||!x)){for(var P=v+1,T=[],O=0;O<M;O++){T[O]=[];for(var D=0;D<4;D++)T[O][D]=0}for(var A=new Float32Array(M*x*4),C=0,S=0;S<x;S++){var P=e(T,f,P,M);if(!P)return null;for(var O=0;O<M;O++)i(T[O],A,C,_),C+=4}return u||(u=new c.a),u.width=M,u.height=x,u.pixels=A,u.type=E.a.FLOAT,u}}}},parseRGBEFromPNG:function(l){}};R.a=n},function(F,R,g){var E=g(5),c=g(3),t=g(26),a=["mousedown","mouseup","mousemove","mouseover","mouseout","click","dblclick","contextmenu"];function o(s){return"_on"+s}var i=function(s){var h=this;this._texture=new E.a({anisotropic:32,flipY:!1,surface:this,dispose:function(r){h.dispose(),E.a.prototype.dispose.call(this,r)}}),a.forEach(function(r){this[o(r)]=function(e){!e.triangle||this._meshes.forEach(function(n){this.dispatchEvent(r,n,e.triangle,e.point)},this)}},this),this._meshes=[],s&&this.setECharts(s),this.onupdate=null};i.prototype={constructor:i,getTexture:function(){return this._texture},setECharts:function(s){this._chart=s;var h=s.getDom();if(!(h instanceof HTMLCanvasElement))console.error("ECharts must init on canvas if it is used as texture."),h=document.createElement("canvas");else{var r=this,e=s.getZr(),n=e.__oldRefreshImmediately||e.refreshImmediately;e.refreshImmediately=function(){n.call(this),r._texture.dirty(),r.onupdate&&r.onupdate()},e.__oldRefreshImmediately=n}this._texture.image=h,this._texture.dirty(),this.onupdate&&this.onupdate()},dispatchEvent:function(){var s=new c.a,h=new c.a,r=new c.a,e=new t.a,n=new t.a,l=new t.a,u=new t.a,_=new c.a;return function(f,d,v,m){var p=d.geometry,y=p.attributes.position,x=p.attributes.texcoord0,M=c.a.dot,P=c.a.cross;y.get(v[0],s.array),y.get(v[1],h.array),y.get(v[2],r.array),x.get(v[0],e.array),x.get(v[1],n.array),x.get(v[2],l.array),P(_,h,r);var T=M(s,_),O=M(m,_)/T;P(_,r,s);var D=M(m,_)/T;P(_,s,h);var A=M(m,_)/T;t.a.scale(u,e,O),t.a.scaleAndAdd(u,u,n,D),t.a.scaleAndAdd(u,u,l,A);var C=u.x*this._chart.getWidth(),S=u.y*this._chart.getHeight();this._chart.getZr().handler.dispatch(f,{zrX:C,zrY:S})}}(),attachToMesh:function(s){this._meshes.indexOf(s)>=0||(a.forEach(function(h){s.on(h,this[o(h)],this)},this),this._meshes.push(s))},detachFromMesh:function(s){var h=this._meshes.indexOf(s);h>=0&&this._meshes.splice(h,1),a.forEach(function(r){s.off(r,this[o(r)])},this)},dispose:function(){this._meshes.forEach(function(s){this.detachFromMesh(s)},this)}},R.a=i},function(F,R,g){var E=g(24),c=g(77),t=E.a.extend({cubemap:null,castShadow:!1,_normalDistribution:null,_brdfLookup:null},{type:"AMBIENT_CUBEMAP_LIGHT",prefilter:function(a,o){if(!a.getGLExtension("EXT_shader_texture_lod")){console.warn("Device not support textureCubeLodEXT");return}this._brdfLookup||(this._normalDistribution=c.a.generateNormalDistribution(),this._brdfLookup=c.a.integrateBRDF(a,this._normalDistribution));var i=this.cubemap;if(!i.__prefiltered){var s=c.a.prefilterEnvironmentMap(a,i,{encodeRGBM:!0,width:o,height:o},this._normalDistribution,this._brdfLookup);this.cubemap=s.environmentMap,this.cubemap.__prefiltered=!0,i.dispose(a)}},getBRDFLookup:function(){return this._brdfLookup},uniformTemplates:{ambientCubemapLightColor:{type:"3f",value:function(a){var o=a.color,i=a.intensity;return[o[0]*i,o[1]*i,o[2]*i]}},ambientCubemapLightCubemap:{type:"t",value:function(a){return a.cubemap}},ambientCubemapLightBRDFLookup:{type:"t",value:function(a){return a._brdfLookup}}}});R.a=t},function(F,R,g){R.a=`
@export clay.compositor.vertex
uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;
attribute vec3 position : POSITION;
attribute vec2 texcoord : TEXCOORD_0;
varying vec2 v_Texcoord;
void main()
{
 v_Texcoord = texcoord;
 gl_Position = worldViewProjection * vec4(position, 1.0);
}
@end`},function(F,R,g){R.a=`#define SAMPLE_NUMBER 1024
#define PI 3.14159265358979
uniform sampler2D normalDistribution;
uniform vec2 viewportSize : [512, 256];
const vec3 N = vec3(0.0, 0.0, 1.0);
const float fSampleNumber = float(SAMPLE_NUMBER);
vec3 importanceSampleNormal(float i, float roughness, vec3 N) {
 vec3 H = texture2D(normalDistribution, vec2(roughness, i)).rgb;
 vec3 upVector = abs(N.y) > 0.999 ? vec3(1.0, 0.0, 0.0) : vec3(0.0, 1.0, 0.0);
 vec3 tangentX = normalize(cross(N, upVector));
 vec3 tangentZ = cross(N, tangentX);
 return normalize(tangentX * H.x + N * H.y + tangentZ * H.z);
}
float G_Smith(float roughness, float NoV, float NoL) {
 float k = roughness * roughness / 2.0;
 float G1V = NoV / (NoV * (1.0 - k) + k);
 float G1L = NoL / (NoL * (1.0 - k) + k);
 return G1L * G1V;
}
void main() {
 vec2 uv = gl_FragCoord.xy / viewportSize;
 float NoV = uv.x;
 float roughness = uv.y;
 vec3 V;
 V.x = sqrt(1.0 - NoV * NoV);
 V.y = 0.0;
 V.z = NoV;
 float A = 0.0;
 float B = 0.0;
 for (int i = 0; i < SAMPLE_NUMBER; i++) {
 vec3 H = importanceSampleNormal(float(i) / fSampleNumber, roughness, N);
 vec3 L = reflect(-V, H);
 float NoL = clamp(L.z, 0.0, 1.0);
 float NoH = clamp(H.z, 0.0, 1.0);
 float VoH = clamp(dot(V, H), 0.0, 1.0);
 if (NoL > 0.0) {
 float G = G_Smith(roughness, NoV, NoL);
 float G_Vis = G * VoH / (NoH * NoV);
 float Fc = pow(1.0 - VoH, 5.0);
 A += (1.0 - Fc) * G_Vis;
 B += Fc * G_Vis;
 }
 }
 gl_FragColor = vec4(vec2(A, B) / fSampleNumber, 0.0, 1.0);
}
`},function(F,R,g){R.a=`#define SHADER_NAME prefilter
#define SAMPLE_NUMBER 1024
#define PI 3.14159265358979
uniform mat4 viewInverse : VIEWINVERSE;
uniform samplerCube environmentMap;
uniform sampler2D normalDistribution;
uniform float roughness : 0.5;
varying vec2 v_Texcoord;
varying vec3 v_WorldPosition;
@import clay.util.rgbm
vec3 importanceSampleNormal(float i, float roughness, vec3 N) {
 vec3 H = texture2D(normalDistribution, vec2(roughness, i)).rgb;
 vec3 upVector = abs(N.y) > 0.999 ? vec3(1.0, 0.0, 0.0) : vec3(0.0, 1.0, 0.0);
 vec3 tangentX = normalize(cross(N, upVector));
 vec3 tangentZ = cross(N, tangentX);
 return normalize(tangentX * H.x + N * H.y + tangentZ * H.z);
}
void main() {
 vec3 eyePos = viewInverse[3].xyz;
 vec3 V = normalize(v_WorldPosition - eyePos);
 vec3 N = V;
 vec3 prefilteredColor = vec3(0.0);
 float totalWeight = 0.0;
 float fMaxSampleNumber = float(SAMPLE_NUMBER);
 for (int i = 0; i < SAMPLE_NUMBER; i++) {
 vec3 H = importanceSampleNormal(float(i) / fMaxSampleNumber, roughness, N);
 vec3 L = reflect(-V, H);
 float NoL = clamp(dot(N, L), 0.0, 1.0);
 if (NoL > 0.0) {
 prefilteredColor += decodeHDR(textureCube(environmentMap, L)).rgb * NoL;
 totalWeight += NoL;
 }
 }
 gl_FragColor = encodeHDR(vec4(prefilteredColor / totalWeight, 1.0));
}
`},function(F,R,g){var E=g(24),c=g(13),t=E.a.extend({castShadow:!1,coefficients:[]},function(){this._coefficientsTmpArr=new c.a.Float32Array(9*3)},{type:"AMBIENT_SH_LIGHT",uniformTemplates:{ambientSHLightColor:{type:"3f",value:function(a){var o=a.color,i=a.intensity;return[o[0]*i,o[1]*i,o[2]*i]}},ambientSHLightCoefficients:{type:"3f",value:function(a){for(var o=a._coefficientsTmpArr,i=0;i<a.coefficients.length;i++)o[i]=a.coefficients[i];return o}}}});R.a=t},function(F,R,g){var E=g(4),c=g(10),t=g(5);g(15);var a=g(13),o=g(42),i=g(75),s=g(61),h=g(36),r=g(12);g(130);var e={},n=["px","nx","py","ny","pz","nz"];function l(f,d){var v=f[0],m=f[1],p=f[2];return d===0?1:d===1?v:d===2?m:d===3?p:d===4?v*p:d===5?m*p:d===6?v*m:d===7?3*p*p-1:v*v-m*m}var u={px:[2,1,0,-1,-1,1],nx:[2,1,0,1,-1,-1],py:[0,2,1,1,-1,-1],ny:[0,2,1,1,1,1],pz:[0,1,2,-1,-1,-1],nz:[0,1,2,1,-1,1]};function _(f,d,v,m){for(var p=new a.a.Float32Array(9*3),y=r.a.create(),x=r.a.create(),M=r.a.create(),P=0;P<9;P++){for(var T=r.a.create(),O=0;O<n.length;O++){for(var D=d[n[O]],A=r.a.create(),C=0,S=0,L=u[n[O]],I=0;I<m;I++)for(var w=0;w<v;w++){y[0]=w/(v-1)*2-1,y[1]=I/(m-1)*2-1,y[2]=-1,r.a.normalize(y,y),M[0]=y[L[0]]*L[3],M[1]=y[L[1]]*L[4],M[2]=y[L[2]]*L[5],x[0]=D[S++]/255,x[1]=D[S++]/255,x[2]=D[S++]/255;var b=D[S++]/255*8.12;x[0]*=b,x[1]*=b,x[2]*=b,r.a.scaleAndAdd(A,A,x,l(M,P)*-y[2]),C+=-y[2]}r.a.scaleAndAdd(T,T,A,1/C)}p[P*3]=T[0]/6,p[P*3+1]=T[1]/6,p[P*3+2]=T[2]/6}return p}e.projectEnvironmentMap=function(f,d,v){v=v||{},v.lod=v.lod||0;var m,p=new h.a,y=64;d.textureType==="texture2D"?m=new i.a({scene:p,environmentMap:d}):(y=d.image&&d.image.px?d.image.px.width:d.width,m=new o.a({scene:p,environmentMap:d}));var x=Math.ceil(y/Math.pow(2,v.lod)),M=Math.ceil(y/Math.pow(2,v.lod)),P=new t.a({width:x,height:M}),T=new c.a;m.material.define("fragment","RGBM_ENCODE"),v.decodeRGBM&&m.material.define("fragment","RGBM_DECODE"),m.material.set("lod",v.lod);for(var O=new s.a({texture:P}),D={},A=0;A<n.length;A++){D[n[A]]=new Uint8Array(x*M*4);var C=O.getCamera(n[A]);C.fov=90,T.attach(P),T.bind(f),f.render(p,C),f.gl.readPixels(0,0,x,M,E.a.RGBA,E.a.UNSIGNED_BYTE,D[n[A]]),T.unbind(f)}return m.dispose(f),T.dispose(f),P.dispose(f),_(f,D,x,M)},R.a=e},function(F,R,g){R.a=`uniform samplerCube environmentMap;
varying vec2 v_Texcoord;
#define TEXTURE_SIZE 16
mat3 front = mat3(
 1.0, 0.0, 0.0,
 0.0, 1.0, 0.0,
 0.0, 0.0, 1.0
);
mat3 back = mat3(
 -1.0, 0.0, 0.0,
 0.0, 1.0, 0.0,
 0.0, 0.0, -1.0
);
mat3 left = mat3(
 0.0, 0.0, -1.0,
 0.0, 1.0, 0.0,
 1.0, 0.0, 0.0
);
mat3 right = mat3(
 0.0, 0.0, 1.0,
 0.0, 1.0, 0.0,
 -1.0, 0.0, 0.0
);
mat3 up = mat3(
 1.0, 0.0, 0.0,
 0.0, 0.0, 1.0,
 0.0, -1.0, 0.0
);
mat3 down = mat3(
 1.0, 0.0, 0.0,
 0.0, 0.0, -1.0,
 0.0, 1.0, 0.0
);
float harmonics(vec3 normal){
 int index = int(gl_FragCoord.x);
 float x = normal.x;
 float y = normal.y;
 float z = normal.z;
 if(index==0){
 return 1.0;
 }
 else if(index==1){
 return x;
 }
 else if(index==2){
 return y;
 }
 else if(index==3){
 return z;
 }
 else if(index==4){
 return x*z;
 }
 else if(index==5){
 return y*z;
 }
 else if(index==6){
 return x*y;
 }
 else if(index==7){
 return 3.0*z*z - 1.0;
 }
 else{
 return x*x - y*y;
 }
}
vec3 sampleSide(mat3 rot)
{
 vec3 result = vec3(0.0);
 float divider = 0.0;
 for (int i = 0; i < TEXTURE_SIZE * TEXTURE_SIZE; i++) {
 float x = mod(float(i), float(TEXTURE_SIZE));
 float y = float(i / TEXTURE_SIZE);
 vec2 sidecoord = ((vec2(x, y) + vec2(0.5, 0.5)) / vec2(TEXTURE_SIZE)) * 2.0 - 1.0;
 vec3 normal = normalize(vec3(sidecoord, -1.0));
 vec3 fetchNormal = rot * normal;
 vec3 texel = textureCube(environmentMap, fetchNormal).rgb;
 result += harmonics(fetchNormal) * texel * -normal.z;
 divider += -normal.z;
 }
 return result / divider;
}
void main()
{
 vec3 result = (
 sampleSide(front) +
 sampleSide(back) +
 sampleSide(left) +
 sampleSide(right) +
 sampleSide(up) +
 sampleSide(down)
 ) / 6.0;
 gl_FragColor = vec4(result, 1.0);
}`},function(F,R,g){var E=g(14),c=g(18),t=E.a.extend({dynamic:!1,widthSegments:40,heightSegments:20,phiStart:0,phiLength:Math.PI*2,thetaStart:0,thetaLength:Math.PI,radius:1},function(){this.build()},{build:function(){var a=this.heightSegments,o=this.widthSegments,i=this.attributes.position,s=this.attributes.texcoord0,h=this.attributes.normal,r=(o+1)*(a+1);i.init(r),s.init(r),h.init(r);var e=r>65535?Uint32Array:Uint16Array,n=this.indices=new e(o*a*6),l,u,_,f,d,v,m,p=this.radius,y=this.phiStart,x=this.phiLength,M=this.thetaStart,P=this.thetaLength,p=this.radius,T=[],O=[],D=0,A=1/p;for(m=0;m<=a;m++)for(v=0;v<=o;v++)f=v/o,d=m/a,l=-p*Math.cos(y+f*x)*Math.sin(M+d*P),u=p*Math.cos(M+d*P),_=p*Math.sin(y+f*x)*Math.sin(M+d*P),T[0]=l,T[1]=u,T[2]=_,O[0]=f,O[1]=d,i.set(D,T),s.set(D,O),T[0]*=A,T[1]*=A,T[2]*=A,h.set(D,T),D++;var C,S,L,I,w=o+1,b=0;for(m=0;m<a;m++)for(v=0;v<o;v++)S=m*w+v,C=m*w+v+1,I=(m+1)*w+v+1,L=(m+1)*w+v,n[b++]=C,n[b++]=S,n[b++]=I,n[b++]=S,n[b++]=L,n[b++]=I;this.boundingBox=new c.a,this.boundingBox.max.set(p,p,p),this.boundingBox.min.set(-p,-p,-p)}});R.a=t},function(F,R,g){var E=g(24),c=E.a.extend({castShadow:!1},{type:"AMBIENT_LIGHT",uniformTemplates:{ambientLightColor:{type:"3f",value:function(t){var a=t.color,o=t.intensity;return[a[0]*o,a[1]*o,a[2]*o]}}}});R.a=c},function(F,R,g){var E=g(24),c=g(3),t=E.a.extend({shadowBias:.001,shadowSlopeScale:2,shadowCascade:1,cascadeSplitLogFactor:.2},{type:"DIRECTIONAL_LIGHT",uniformTemplates:{directionalLightDirection:{type:"3f",value:function(a){return a.__dir=a.__dir||new c.a,a.__dir.copy(a.worldTransform.z).normalize().negate().array}},directionalLightColor:{type:"3f",value:function(a){var o=a.color,i=a.intensity;return[o[0]*i,o[1]*i,o[2]*i]}}},clone:function(){var a=E.a.prototype.clone.call(this);return a.shadowBias=this.shadowBias,a.shadowSlopeScale=this.shadowSlopeScale,a}});R.a=t},function(F,R,g){var E=g(24),c=E.a.extend({range:100,castShadow:!1},{type:"POINT_LIGHT",uniformTemplates:{pointLightPosition:{type:"3f",value:function(t){return t.getWorldPosition().array}},pointLightRange:{type:"1f",value:function(t){return t.range}},pointLightColor:{type:"3f",value:function(t){var a=t.color,o=t.intensity;return[a[0]*o,a[1]*o,a[2]*o]}}},clone:function(){var t=E.a.prototype.clone.call(this);return t.range=this.range,t}});R.a=c},function(F,R,g){var E=g(24),c=g(3),t=E.a.extend({range:20,umbraAngle:30,penumbraAngle:45,falloffFactor:2,shadowBias:.001,shadowSlopeScale:2},{type:"SPOT_LIGHT",uniformTemplates:{spotLightPosition:{type:"3f",value:function(a){return a.getWorldPosition().array}},spotLightRange:{type:"1f",value:function(a){return a.range}},spotLightUmbraAngleCosine:{type:"1f",value:function(a){return Math.cos(a.umbraAngle*Math.PI/180)}},spotLightPenumbraAngleCosine:{type:"1f",value:function(a){return Math.cos(a.penumbraAngle*Math.PI/180)}},spotLightFalloffFactor:{type:"1f",value:function(a){return a.falloffFactor}},spotLightDirection:{type:"3f",value:function(a){return a.__dir=a.__dir||new c.a,a.__dir.copy(a.worldTransform.z).negate().array}},spotLightColor:{type:"3f",value:function(a){var o=a.color,i=a.intensity;return[o[0]*i,o[1]*i,o[2]*i]}}},clone:function(){var a=E.a.prototype.clone.call(this);return a.range=this.range,a.umbraAngle=this.umbraAngle,a.penumbraAngle=this.penumbraAngle,a.falloffFactor=this.falloffFactor,a.shadowBias=this.shadowBias,a.shadowSlopeScale=this.shadowSlopeScale,a}});R.a=t},function(F,R,g){var E=g(33),c=function(o,i,s,h){o=o||0,i=i||0,s=s||0,h=h||0,this.array=E.a.fromValues(o,i,s,h),this._dirty=!0};c.prototype={constructor:c,add:function(o){return E.a.add(this.array,this.array,o.array),this._dirty=!0,this},set:function(o,i,s,h){return this.array[0]=o,this.array[1]=i,this.array[2]=s,this.array[3]=h,this._dirty=!0,this},setArray:function(o){return this.array[0]=o[0],this.array[1]=o[1],this.array[2]=o[2],this.array[3]=o[3],this._dirty=!0,this},clone:function(){return new c(this.x,this.y,this.z,this.w)},copy:function(o){return E.a.copy(this.array,o.array),this._dirty=!0,this},dist:function(o){return E.a.dist(this.array,o.array)},distance:function(o){return E.a.distance(this.array,o.array)},div:function(o){return E.a.div(this.array,this.array,o.array),this._dirty=!0,this},divide:function(o){return E.a.divide(this.array,this.array,o.array),this._dirty=!0,this},dot:function(o){return E.a.dot(this.array,o.array)},len:function(){return E.a.len(this.array)},length:function(){return E.a.length(this.array)},lerp:function(o,i,s){return E.a.lerp(this.array,o.array,i.array,s),this._dirty=!0,this},min:function(o){return E.a.min(this.array,this.array,o.array),this._dirty=!0,this},max:function(o){return E.a.max(this.array,this.array,o.array),this._dirty=!0,this},mul:function(o){return E.a.mul(this.array,this.array,o.array),this._dirty=!0,this},multiply:function(o){return E.a.multiply(this.array,this.array,o.array),this._dirty=!0,this},negate:function(){return E.a.negate(this.array,this.array),this._dirty=!0,this},normalize:function(){return E.a.normalize(this.array,this.array),this._dirty=!0,this},random:function(o){return E.a.random(this.array,o),this._dirty=!0,this},scale:function(o){return E.a.scale(this.array,this.array,o),this._dirty=!0,this},scaleAndAdd:function(o,i){return E.a.scaleAndAdd(this.array,this.array,o.array,i),this._dirty=!0,this},sqrDist:function(o){return E.a.sqrDist(this.array,o.array)},squaredDistance:function(o){return E.a.squaredDistance(this.array,o.array)},sqrLen:function(){return E.a.sqrLen(this.array)},squaredLength:function(){return E.a.squaredLength(this.array)},sub:function(o){return E.a.sub(this.array,this.array,o.array),this._dirty=!0,this},subtract:function(o){return E.a.subtract(this.array,this.array,o.array),this._dirty=!0,this},transformMat4:function(o){return E.a.transformMat4(this.array,this.array,o.array),this._dirty=!0,this},transformQuat:function(o){return E.a.transformQuat(this.array,this.array,o.array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}};var t=Object.defineProperty;if(t){var a=c.prototype;t(a,"x",{get:function(){return this.array[0]},set:function(o){this.array[0]=o,this._dirty=!0}}),t(a,"y",{get:function(){return this.array[1]},set:function(o){this.array[1]=o,this._dirty=!0}}),t(a,"z",{get:function(){return this.array[2]},set:function(o){this.array[2]=o,this._dirty=!0}}),t(a,"w",{get:function(){return this.array[3]},set:function(o){this.array[3]=o,this._dirty=!0}})}c.add=function(o,i,s){return E.a.add(o.array,i.array,s.array),o._dirty=!0,o},c.set=function(o,i,s,h,r){E.a.set(o.array,i,s,h,r),o._dirty=!0},c.copy=function(o,i){return E.a.copy(o.array,i.array),o._dirty=!0,o},c.dist=function(o,i){return E.a.distance(o.array,i.array)},c.distance=c.dist,c.div=function(o,i,s){return E.a.divide(o.array,i.array,s.array),o._dirty=!0,o},c.divide=c.div,c.dot=function(o,i){return E.a.dot(o.array,i.array)},c.len=function(o){return E.a.length(o.array)},c.lerp=function(o,i,s,h){return E.a.lerp(o.array,i.array,s.array,h),o._dirty=!0,o},c.min=function(o,i,s){return E.a.min(o.array,i.array,s.array),o._dirty=!0,o},c.max=function(o,i,s){return E.a.max(o.array,i.array,s.array),o._dirty=!0,o},c.mul=function(o,i,s){return E.a.multiply(o.array,i.array,s.array),o._dirty=!0,o},c.multiply=c.mul,c.negate=function(o,i){return E.a.negate(o.array,i.array),o._dirty=!0,o},c.normalize=function(o,i){return E.a.normalize(o.array,i.array),o._dirty=!0,o},c.random=function(o,i){return E.a.random(o.array,i),o._dirty=!0,o},c.scale=function(o,i,s){return E.a.scale(o.array,i.array,s),o._dirty=!0,o},c.scaleAndAdd=function(o,i,s,h){return E.a.scaleAndAdd(o.array,i.array,s.array,h),o._dirty=!0,o},c.sqrDist=function(o,i){return E.a.sqrDist(o.array,i.array)},c.squaredDistance=c.sqrDist,c.sqrLen=function(o){return E.a.sqrLen(o.array)},c.squaredLength=c.sqrLen,c.sub=function(o,i,s){return E.a.subtract(o.array,i.array,s.array),o._dirty=!0,o},c.subtract=c.sub,c.transformMat4=function(o,i,s){return E.a.transformMat4(o.array,i.array,s.array),o._dirty=!0,o},c.transformQuat=function(o,i,s){return E.a.transformQuat(o.array,i.array,s.array),o._dirty=!0,o},R.a=c},function(F,R,g){var E=g(78),c=function(){this.array=E.a.create(),this._dirty=!0};c.prototype={constructor:c,setArray:function(t){for(var a=0;a<this.array.length;a++)this.array[a]=t[a];return this._dirty=!0,this},clone:function(){return new c().copy(this)},copy:function(t){return E.a.copy(this.array,t.array),this._dirty=!0,this},adjoint:function(){return E.a.adjoint(this.array,this.array),this._dirty=!0,this},determinant:function(){return E.a.determinant(this.array)},identity:function(){return E.a.identity(this.array),this._dirty=!0,this},invert:function(){return E.a.invert(this.array,this.array),this._dirty=!0,this},mul:function(t){return E.a.mul(this.array,this.array,t.array),this._dirty=!0,this},mulLeft:function(t){return E.a.mul(this.array,t.array,this.array),this._dirty=!0,this},multiply:function(t){return E.a.multiply(this.array,this.array,t.array),this._dirty=!0,this},multiplyLeft:function(t){return E.a.multiply(this.array,t.array,this.array),this._dirty=!0,this},rotate:function(t){return E.a.rotate(this.array,this.array,t),this._dirty=!0,this},scale:function(t){return E.a.scale(this.array,this.array,t.array),this._dirty=!0,this},transpose:function(){return E.a.transpose(this.array,this.array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}},c.adjoint=function(t,a){return E.a.adjoint(t.array,a.array),t._dirty=!0,t},c.copy=function(t,a){return E.a.copy(t.array,a.array),t._dirty=!0,t},c.determinant=function(t){return E.a.determinant(t.array)},c.identity=function(t){return E.a.identity(t.array),t._dirty=!0,t},c.invert=function(t,a){return E.a.invert(t.array,a.array),t._dirty=!0,t},c.mul=function(t,a,o){return E.a.mul(t.array,a.array,o.array),t._dirty=!0,t},c.multiply=c.mul,c.rotate=function(t,a,o){return E.a.rotate(t.array,a.array,o),t._dirty=!0,t},c.scale=function(t,a,o){return E.a.scale(t.array,a.array,o.array),t._dirty=!0,t},c.transpose=function(t,a){return E.a.transpose(t.array,a.array),t._dirty=!0,t},R.a=c},function(F,R,g){var E=g(79),c=function(){this.array=E.a.create(),this._dirty=!0};c.prototype={constructor:c,setArray:function(t){for(var a=0;a<this.array.length;a++)this.array[a]=t[a];return this._dirty=!0,this},clone:function(){return new c().copy(this)},copy:function(t){return E.a.copy(this.array,t.array),this._dirty=!0,this},determinant:function(){return E.a.determinant(this.array)},identity:function(){return E.a.identity(this.array),this._dirty=!0,this},invert:function(){return E.a.invert(this.array,this.array),this._dirty=!0,this},mul:function(t){return E.a.mul(this.array,this.array,t.array),this._dirty=!0,this},mulLeft:function(t){return E.a.mul(this.array,t.array,this.array),this._dirty=!0,this},multiply:function(t){return E.a.multiply(this.array,this.array,t.array),this._dirty=!0,this},multiplyLeft:function(t){return E.a.multiply(this.array,t.array,this.array),this._dirty=!0,this},rotate:function(t){return E.a.rotate(this.array,this.array,t),this._dirty=!0,this},scale:function(t){return E.a.scale(this.array,this.array,t.array),this._dirty=!0,this},translate:function(t){return E.a.translate(this.array,this.array,t.array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}},c.copy=function(t,a){return E.a.copy(t.array,a.array),t._dirty=!0,t},c.determinant=function(t){return E.a.determinant(t.array)},c.identity=function(t){return E.a.identity(t.array),t._dirty=!0,t},c.invert=function(t,a){return E.a.invert(t.array,a.array),t._dirty=!0,t},c.mul=function(t,a,o){return E.a.mul(t.array,a.array,o.array),t._dirty=!0,t},c.multiply=c.mul,c.rotate=function(t,a,o){return E.a.rotate(t.array,a.array,o),t._dirty=!0,t},c.scale=function(t,a,o){return E.a.scale(t.array,a.array,o.array),t._dirty=!0,t},c.translate=function(t,a,o){return E.a.translate(t.array,a.array,o.array),t._dirty=!0,t},R.a=c},function(F,R,g){var E=g(34),c=function(){this.array=E.a.create(),this._dirty=!0};c.prototype={constructor:c,setArray:function(t){for(var a=0;a<this.array.length;a++)this.array[a]=t[a];return this._dirty=!0,this},adjoint:function(){return E.a.adjoint(this.array,this.array),this._dirty=!0,this},clone:function(){return new c().copy(this)},copy:function(t){return E.a.copy(this.array,t.array),this._dirty=!0,this},determinant:function(){return E.a.determinant(this.array)},fromMat2d:function(t){return E.a.fromMat2d(this.array,t.array),this._dirty=!0,this},fromMat4:function(t){return E.a.fromMat4(this.array,t.array),this._dirty=!0,this},fromQuat:function(t){return E.a.fromQuat(this.array,t.array),this._dirty=!0,this},identity:function(){return E.a.identity(this.array),this._dirty=!0,this},invert:function(){return E.a.invert(this.array,this.array),this._dirty=!0,this},mul:function(t){return E.a.mul(this.array,this.array,t.array),this._dirty=!0,this},mulLeft:function(t){return E.a.mul(this.array,t.array,this.array),this._dirty=!0,this},multiply:function(t){return E.a.multiply(this.array,this.array,t.array),this._dirty=!0,this},multiplyLeft:function(t){return E.a.multiply(this.array,t.array,this.array),this._dirty=!0,this},rotate:function(t){return E.a.rotate(this.array,this.array,t),this._dirty=!0,this},scale:function(t){return E.a.scale(this.array,this.array,t.array),this._dirty=!0,this},translate:function(t){return E.a.translate(this.array,this.array,t.array),this._dirty=!0,this},normalFromMat4:function(t){return E.a.normalFromMat4(this.array,t.array),this._dirty=!0,this},transpose:function(){return E.a.transpose(this.array,this.array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}},c.adjoint=function(t,a){return E.a.adjoint(t.array,a.array),t._dirty=!0,t},c.copy=function(t,a){return E.a.copy(t.array,a.array),t._dirty=!0,t},c.determinant=function(t){return E.a.determinant(t.array)},c.identity=function(t){return E.a.identity(t.array),t._dirty=!0,t},c.invert=function(t,a){return E.a.invert(t.array,a.array),t},c.mul=function(t,a,o){return E.a.mul(t.array,a.array,o.array),t._dirty=!0,t},c.multiply=c.mul,c.fromMat2d=function(t,a){return E.a.fromMat2d(t.array,a.array),t._dirty=!0,t},c.fromMat4=function(t,a){return E.a.fromMat4(t.array,a.array),t._dirty=!0,t},c.fromQuat=function(t,a){return E.a.fromQuat(t.array,a.array),t._dirty=!0,t},c.normalFromMat4=function(t,a){return E.a.normalFromMat4(t.array,a.array),t._dirty=!0,t},c.rotate=function(t,a,o){return E.a.rotate(t.array,a.array,o),t._dirty=!0,t},c.scale=function(t,a,o){return E.a.scale(t.array,a.array,o.array),t._dirty=!0,t},c.transpose=function(t,a){return E.a.transpose(t.array,a.array),t._dirty=!0,t},c.translate=function(t,a,o){return E.a.translate(t.array,a.array,o.array),t._dirty=!0,t},R.a=c},function(F,R,g){var E=g(141),c=g.n(E),t={_animators:null,getAnimators:function(){return this._animators=this._animators||[],this._animators},animate:function(a,o){this._animators=this._animators||[];var i=this,s;if(a){for(var h=a.split("."),r=i,e=0,n=h.length;e<n;e++)!r||(r=r[h[e]]);r&&(s=r)}else s=i;if(s==null)throw new Error("Target "+a+" not exists");var l=this._animators,u=new c.a(s,o),_=this;return u.during(function(){_.__zr&&_.__zr.refresh()}).done(function(){var f=l.indexOf(u);f>=0&&l.splice(f,1)}),l.push(u),this.__zr&&this.__zr.animation.addAnimator(u),u},stopAnimation:function(a){this._animators=this._animators||[];for(var o=this._animators,i=o.length,s=0;s<i;s++)o[s].stop(a);return o.length=0,this},addAnimatorsToZr:function(a){if(this._animators)for(var o=0;o<this._animators.length;o++)a.animation.addAnimator(this._animators[o])},removeAnimatorsFromZr:function(a){if(this._animators)for(var o=0;o<this._animators.length;o++)a.animation.removeAnimator(this._animators[o])}};R.a=t},function(F,R,g){var E=g(142),c=g(144),t=g(80),a=t.isArrayLike,o=Array.prototype.slice;function i(x,M){return x[M]}function s(x,M,P){x[M]=P}function h(x,M,P){return(M-x)*P+x}function r(x,M,P){return P>.5?M:x}function e(x,M,P,T,O){var D=x.length;if(O==1)for(var A=0;A<D;A++)T[A]=h(x[A],M[A],P);else for(var C=D&&x[0].length,A=0;A<D;A++)for(var S=0;S<C;S++)T[A][S]=h(x[A][S],M[A][S],P)}function n(x,M,P){var T=x.length,O=M.length;if(T!==O){var D=T>O;if(D)x.length=O;else for(var A=T;A<O;A++)x.push(P===1?M[A]:o.call(M[A]))}for(var C=x[0]&&x[0].length,A=0;A<x.length;A++)if(P===1)isNaN(x[A])&&(x[A]=M[A]);else for(var S=0;S<C;S++)isNaN(x[A][S])&&(x[A][S]=M[A][S])}function l(x,M,P){if(x===M)return!0;var T=x.length;if(T!==M.length)return!1;if(P===1){for(var O=0;O<T;O++)if(x[O]!==M[O])return!1}else for(var D=x[0].length,O=0;O<T;O++)for(var A=0;A<D;A++)if(x[O][A]!==M[O][A])return!1;return!0}function u(x,M,P,T,O,D,A,C,S){var L=x.length;if(S==1)for(var I=0;I<L;I++)C[I]=_(x[I],M[I],P[I],T[I],O,D,A);else for(var w=x[0].length,I=0;I<L;I++)for(var b=0;b<w;b++)C[I][b]=_(x[I][b],M[I][b],P[I][b],T[I][b],O,D,A)}function _(x,M,P,T,O,D,A){var C=(P-x)*.5,S=(T-M)*.5;return(2*(M-P)+C+S)*A+(-3*(M-P)-2*C-S)*D+C*O+M}function f(x){if(a(x)){var M=x.length;if(a(x[0])){for(var P=[],T=0;T<M;T++)P.push(o.call(x[T]));return P}return o.call(x)}return x}function d(x){return x[0]=Math.floor(x[0]),x[1]=Math.floor(x[1]),x[2]=Math.floor(x[2]),"rgba("+x.join(",")+")"}function v(x){var M=x[x.length-1].value;return a(M&&M[0])?2:1}function m(x,M,P,T,O,D){var A=x._getter,C=x._setter,S=M==="spline",L=T.length;if(!!L){var I=T[0].value,w=a(I),b=!1,B=!1,U=w?v(T):0,W;T.sort(function(k,rt){return k.time-rt.time}),W=T[L-1].time;for(var z=[],G=[],H=T[0].value,X=!0,Q=0;Q<L;Q++){z.push(T[Q].time/W);var j=T[Q].value;if(w&&l(j,H,U)||!w&&j===H||(X=!1),H=j,typeof j=="string"){var J=c.parse(j);J?(j=J,b=!0):B=!0}G.push(j)}if(!(!D&&X)){for(var Y=G[L-1],Q=0;Q<L-1;Q++)w?n(G[Q],Y,U):isNaN(G[Q])&&!isNaN(Y)&&!B&&!b&&(G[Q]=Y);w&&n(A(x._target,O),Y,U);var at=0,ot=0,ut,et,ht,ft,it,N;if(b)var K=[0,0,0,0];var Z=function(k,rt){var nt;if(rt<0)nt=0;else if(rt<ot){for(ut=Math.min(at+1,L-1),nt=ut;nt>=0&&!(z[nt]<=rt);nt--);nt=Math.min(nt,L-2)}else{for(nt=at;nt<L&&!(z[nt]>rt);nt++);nt=Math.min(nt-1,L-2)}at=nt,ot=rt;var q=z[nt+1]-z[nt];if(q!==0)if(et=(rt-z[nt])/q,S)if(ft=G[nt],ht=G[nt===0?nt:nt-1],it=G[nt>L-2?L-1:nt+1],N=G[nt>L-3?L-1:nt+2],w)u(ht,ft,it,N,et,et*et,et*et*et,A(k,O),U);else{var tt;if(b)tt=u(ht,ft,it,N,et,et*et,et*et*et,K,1),tt=d(K);else{if(B)return r(ft,it,et);tt=_(ht,ft,it,N,et,et*et,et*et*et)}C(k,O,tt)}else if(w)e(G[nt],G[nt+1],et,A(k,O),U);else{var tt;if(b)e(G[nt],G[nt+1],et,K,1),tt=d(K);else{if(B)return r(G[nt],G[nt+1],et);tt=h(G[nt],G[nt+1],et)}C(k,O,tt)}},V=new E({target:x._target,life:W,loop:x._loop,delay:x._delay,onframe:Z,ondestroy:P});return M&&M!=="spline"&&(V.easing=M),V}}}var p=function(x,M,P,T){this._tracks={},this._target=x,this._loop=M||!1,this._getter=P||i,this._setter=T||s,this._clipCount=0,this._delay=0,this._doneList=[],this._onframeList=[],this._clipList=[]};p.prototype={when:function(x,M){var P=this._tracks;for(var T in M)if(!!M.hasOwnProperty(T)){if(!P[T]){P[T]=[];var O=this._getter(this._target,T);if(O==null)continue;x!==0&&P[T].push({time:0,value:f(O)})}P[T].push({time:x,value:M[T]})}return this},during:function(x){return this._onframeList.push(x),this},pause:function(){for(var x=0;x<this._clipList.length;x++)this._clipList[x].pause();this._paused=!0},resume:function(){for(var x=0;x<this._clipList.length;x++)this._clipList[x].resume();this._paused=!1},isPaused:function(){return!!this._paused},_doneCallback:function(){this._tracks={},this._clipList.length=0;for(var x=this._doneList,M=x.length,P=0;P<M;P++)x[P].call(this)},start:function(x,M){var P=this,T=0,O=function(){T--,T||P._doneCallback()},D;for(var A in this._tracks)if(!!this._tracks.hasOwnProperty(A)){var C=m(this,x,O,this._tracks[A],A,M);C&&(this._clipList.push(C),T++,this.animation&&this.animation.addClip(C),D=C)}if(D){var S=D.onframe;D.onframe=function(L,I){S(L,I);for(var w=0;w<P._onframeList.length;w++)P._onframeList[w](L,I)}}return T||this._doneCallback(),this},stop:function(x){for(var M=this._clipList,P=this.animation,T=0;T<M.length;T++){var O=M[T];x&&O.onframe(this._target,1),P&&P.removeClip(O)}M.length=0},delay:function(x){return this._delay=x,this},done:function(x){return x&&this._doneList.push(x),this},getClips:function(){return this._clipList}};var y=p;F.exports=y},function(F,R,g){var E=g(143);function c(a){this._target=a.target,this._life=a.life||1e3,this._delay=a.delay||0,this._initialized=!1,this.loop=a.loop==null?!1:a.loop,this.gap=a.gap||0,this.easing=a.easing||"Linear",this.onframe=a.onframe,this.ondestroy=a.ondestroy,this.onrestart=a.onrestart,this._pausedTime=0,this._paused=!1}c.prototype={constructor:c,step:function(a,o){if(this._initialized||(this._startTime=a+this._delay,this._initialized=!0),this._paused){this._pausedTime+=o;return}var i=(a-this._startTime-this._pausedTime)/this._life;if(!(i<0)){i=Math.min(i,1);var s=this.easing,h=typeof s=="string"?E[s]:s,r=typeof h=="function"?h(i):i;return this.fire("frame",r),i==1?this.loop?(this.restart(a),"restart"):(this._needsRemove=!0,"destroy"):null}},restart:function(a){var o=(a-this._startTime-this._pausedTime)%this._life;this._startTime=a-o+this.gap,this._pausedTime=0,this._needsRemove=!1},fire:function(a,o){a="on"+a,this[a]&&this[a](this._target,o)},pause:function(){this._paused=!0},resume:function(){this._paused=!1}};var t=c;F.exports=t},function(F,R){var g={linear:function(c){return c},quadraticIn:function(c){return c*c},quadraticOut:function(c){return c*(2-c)},quadraticInOut:function(c){return(c*=2)<1?.5*c*c:-.5*(--c*(c-2)-1)},cubicIn:function(c){return c*c*c},cubicOut:function(c){return--c*c*c+1},cubicInOut:function(c){return(c*=2)<1?.5*c*c*c:.5*((c-=2)*c*c+2)},quarticIn:function(c){return c*c*c*c},quarticOut:function(c){return 1- --c*c*c*c},quarticInOut:function(c){return(c*=2)<1?.5*c*c*c*c:-.5*((c-=2)*c*c*c-2)},quinticIn:function(c){return c*c*c*c*c},quinticOut:function(c){return--c*c*c*c*c+1},quinticInOut:function(c){return(c*=2)<1?.5*c*c*c*c*c:.5*((c-=2)*c*c*c*c+2)},sinusoidalIn:function(c){return 1-Math.cos(c*Math.PI/2)},sinusoidalOut:function(c){return Math.sin(c*Math.PI/2)},sinusoidalInOut:function(c){return .5*(1-Math.cos(Math.PI*c))},exponentialIn:function(c){return c===0?0:Math.pow(1024,c-1)},exponentialOut:function(c){return c===1?1:1-Math.pow(2,-10*c)},exponentialInOut:function(c){return c===0?0:c===1?1:(c*=2)<1?.5*Math.pow(1024,c-1):.5*(-Math.pow(2,-10*(c-1))+2)},circularIn:function(c){return 1-Math.sqrt(1-c*c)},circularOut:function(c){return Math.sqrt(1- --c*c)},circularInOut:function(c){return(c*=2)<1?-.5*(Math.sqrt(1-c*c)-1):.5*(Math.sqrt(1-(c-=2)*c)+1)},elasticIn:function(c){var t,a=.1,o=.4;return c===0?0:c===1?1:(!a||a<1?(a=1,t=o/4):t=o*Math.asin(1/a)/(2*Math.PI),-(a*Math.pow(2,10*(c-=1))*Math.sin((c-t)*(2*Math.PI)/o)))},elasticOut:function(c){var t,a=.1,o=.4;return c===0?0:c===1?1:(!a||a<1?(a=1,t=o/4):t=o*Math.asin(1/a)/(2*Math.PI),a*Math.pow(2,-10*c)*Math.sin((c-t)*(2*Math.PI)/o)+1)},elasticInOut:function(c){var t,a=.1,o=.4;return c===0?0:c===1?1:(!a||a<1?(a=1,t=o/4):t=o*Math.asin(1/a)/(2*Math.PI),(c*=2)<1?-.5*(a*Math.pow(2,10*(c-=1))*Math.sin((c-t)*(2*Math.PI)/o)):a*Math.pow(2,-10*(c-=1))*Math.sin((c-t)*(2*Math.PI)/o)*.5+1)},backIn:function(c){var t=1.70158;return c*c*((t+1)*c-t)},backOut:function(c){var t=1.70158;return--c*c*((t+1)*c+t)+1},backInOut:function(c){var t=1.70158*1.525;return(c*=2)<1?.5*(c*c*((t+1)*c-t)):.5*((c-=2)*c*((t+1)*c+t)+2)},bounceIn:function(c){return 1-g.bounceOut(1-c)},bounceOut:function(c){return c<1/2.75?7.5625*c*c:c<2/2.75?7.5625*(c-=1.5/2.75)*c+.75:c<2.5/2.75?7.5625*(c-=2.25/2.75)*c+.9375:7.5625*(c-=2.625/2.75)*c+.984375},bounceInOut:function(c){return c<.5?g.bounceIn(c*2)*.5:g.bounceOut(c*2-1)*.5+.5}},E=g;F.exports=E},function(F,R,g){var E=g(74),c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function t(A){return A=Math.round(A),A<0?0:A>255?255:A}function a(A){return A=Math.round(A),A<0?0:A>360?360:A}function o(A){return A<0?0:A>1?1:A}function i(A){return A.length&&A.charAt(A.length-1)==="%"?t(parseFloat(A)/100*255):t(parseInt(A,10))}function s(A){return A.length&&A.charAt(A.length-1)==="%"?o(parseFloat(A)/100):o(parseFloat(A))}function h(A,C,S){return S<0?S+=1:S>1&&(S-=1),S*6<1?A+(C-A)*S*6:S*2<1?C:S*3<2?A+(C-A)*(2/3-S)*6:A}function r(A,C,S){return A+(C-A)*S}function e(A,C,S,L,I){return A[0]=C,A[1]=S,A[2]=L,A[3]=I,A}function n(A,C){return A[0]=C[0],A[1]=C[1],A[2]=C[2],A[3]=C[3],A}var l=new E(20),u=null;function _(A,C){u&&n(u,C),u=l.put(A,u||C.slice())}function f(A,C){if(!!A){C=C||[];var S=l.get(A);if(S)return n(C,S);A=A+"";var L=A.replace(/ /g,"").toLowerCase();if(L in c)return n(C,c[L]),_(A,C),C;if(L.charAt(0)==="#"){if(L.length===4){var I=parseInt(L.substr(1),16);if(!(I>=0&&I<=4095)){e(C,0,0,0,1);return}return e(C,(I&3840)>>4|(I&3840)>>8,I&240|(I&240)>>4,I&15|(I&15)<<4,1),_(A,C),C}else if(L.length===7){var I=parseInt(L.substr(1),16);if(!(I>=0&&I<=16777215)){e(C,0,0,0,1);return}return e(C,(I&16711680)>>16,(I&65280)>>8,I&255,1),_(A,C),C}return}var w=L.indexOf("("),b=L.indexOf(")");if(w!==-1&&b+1===L.length){var B=L.substr(0,w),U=L.substr(w+1,b-(w+1)).split(","),W=1;switch(B){case"rgba":if(U.length!==4){e(C,0,0,0,1);return}W=s(U.pop());case"rgb":if(U.length!==3){e(C,0,0,0,1);return}return e(C,i(U[0]),i(U[1]),i(U[2]),W),_(A,C),C;case"hsla":if(U.length!==4){e(C,0,0,0,1);return}return U[3]=s(U[3]),d(U,C),_(A,C),C;case"hsl":if(U.length!==3){e(C,0,0,0,1);return}return d(U,C),_(A,C),C;default:return}}e(C,0,0,0,1)}}function d(A,C){var S=(parseFloat(A[0])%360+360)%360/360,L=s(A[1]),I=s(A[2]),w=I<=.5?I*(L+1):I+L-I*L,b=I*2-w;return C=C||[],e(C,t(h(b,w,S+1/3)*255),t(h(b,w,S)*255),t(h(b,w,S-1/3)*255),1),A.length===4&&(C[3]=A[3]),C}function v(A){if(!!A){var C=A[0]/255,S=A[1]/255,L=A[2]/255,I=Math.min(C,S,L),w=Math.max(C,S,L),b=w-I,B=(w+I)/2,U,W;if(b===0)U=0,W=0;else{B<.5?W=b/(w+I):W=b/(2-w-I);var z=((w-C)/6+b/2)/b,G=((w-S)/6+b/2)/b,H=((w-L)/6+b/2)/b;C===w?U=H-G:S===w?U=1/3+z-H:L===w&&(U=2/3+G-z),U<0&&(U+=1),U>1&&(U-=1)}var X=[U*360,W,B];return A[3]!=null&&X.push(A[3]),X}}function m(A,C){var S=f(A);if(S){for(var L=0;L<3;L++)C<0?S[L]=S[L]*(1-C)|0:S[L]=(255-S[L])*C+S[L]|0,S[L]>255?S[L]=255:A[L]<0&&(S[L]=0);return D(S,S.length===4?"rgba":"rgb")}}function p(A){var C=f(A);if(C)return((1<<24)+(C[0]<<16)+(C[1]<<8)+ +C[2]).toString(16).slice(1)}function y(A,C,S){if(!(!(C&&C.length)||!(A>=0&&A<=1))){S=S||[];var L=A*(C.length-1),I=Math.floor(L),w=Math.ceil(L),b=C[I],B=C[w],U=L-I;return S[0]=t(r(b[0],B[0],U)),S[1]=t(r(b[1],B[1],U)),S[2]=t(r(b[2],B[2],U)),S[3]=o(r(b[3],B[3],U)),S}}var x=y;function M(A,C,S){if(!(!(C&&C.length)||!(A>=0&&A<=1))){var L=A*(C.length-1),I=Math.floor(L),w=Math.ceil(L),b=f(C[I]),B=f(C[w]),U=L-I,W=D([t(r(b[0],B[0],U)),t(r(b[1],B[1],U)),t(r(b[2],B[2],U)),o(r(b[3],B[3],U))],"rgba");return S?{color:W,leftIndex:I,rightIndex:w,value:L}:W}}var P=M;function T(A,C,S,L){if(A=f(A),A)return A=v(A),C!=null&&(A[0]=a(C)),S!=null&&(A[1]=s(S)),L!=null&&(A[2]=s(L)),D(d(A),"rgba")}function O(A,C){if(A=f(A),A&&C!=null)return A[3]=o(C),D(A,"rgba")}function D(A,C){if(!(!A||!A.length)){var S=A[0]+","+A[1]+","+A[2];return(C==="rgba"||C==="hsva"||C==="hsla")&&(S+=","+A[3]),C+"("+S+")"}}R.parse=f,R.lift=m,R.toHex=p,R.fastLerp=y,R.fastMapToColor=x,R.lerp=M,R.mapToColor=P,R.modifyHSL=T,R.modifyAlpha=O,R.stringify=D},function(F,R,g){R.a=`
@export clay.util.rand
highp float rand(vec2 uv) {
 const highp float a = 12.9898, b = 78.233, c = 43758.5453;
 highp float dt = dot(uv.xy, vec2(a,b)), sn = mod(dt, 3.141592653589793);
 return fract(sin(sn) * c);
}
@end
@export clay.util.calculate_attenuation
uniform float attenuationFactor : 5.0;
float lightAttenuation(float dist, float range)
{
 float attenuation = 1.0;
 attenuation = dist*dist/(range*range+1.0);
 float att_s = attenuationFactor;
 attenuation = 1.0/(attenuation*att_s+1.0);
 att_s = 1.0/(att_s+1.0);
 attenuation = attenuation - att_s;
 attenuation /= 1.0 - att_s;
 return clamp(attenuation, 0.0, 1.0);
}
@end
@export clay.util.edge_factor
#ifdef SUPPORT_STANDARD_DERIVATIVES
float edgeFactor(float width)
{
 vec3 d = fwidth(v_Barycentric);
 vec3 a3 = smoothstep(vec3(0.0), d * width, v_Barycentric);
 return min(min(a3.x, a3.y), a3.z);
}
#else
float edgeFactor(float width)
{
 return 1.0;
}
#endif
@end
@export clay.util.encode_float
vec4 encodeFloat(const in float depth)
{
 const vec4 bitShifts = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);
 const vec4 bit_mask = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);
 vec4 res = fract(depth * bitShifts);
 res -= res.xxyz * bit_mask;
 return res;
}
@end
@export clay.util.decode_float
float decodeFloat(const in vec4 color)
{
 const vec4 bitShifts = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);
 return dot(color, bitShifts);
}
@end
@export clay.util.float
@import clay.util.encode_float
@import clay.util.decode_float
@end
@export clay.util.rgbm_decode
vec3 RGBMDecode(vec4 rgbm, float range) {
 return range * rgbm.rgb * rgbm.a;
}
@end
@export clay.util.rgbm_encode
vec4 RGBMEncode(vec3 color, float range) {
 if (dot(color, color) == 0.0) {
 return vec4(0.0);
 }
 vec4 rgbm;
 color /= range;
 rgbm.a = clamp(max(max(color.r, color.g), max(color.b, 1e-6)), 0.0, 1.0);
 rgbm.a = ceil(rgbm.a * 255.0) / 255.0;
 rgbm.rgb = color / rgbm.a;
 return rgbm;
}
@end
@export clay.util.rgbm
@import clay.util.rgbm_decode
@import clay.util.rgbm_encode
vec4 decodeHDR(vec4 color)
{
#if defined(RGBM_DECODE) || defined(RGBM)
 return vec4(RGBMDecode(color, 8.12), 1.0);
#else
 return color;
#endif
}
vec4 encodeHDR(vec4 color)
{
#if defined(RGBM_ENCODE) || defined(RGBM)
 return RGBMEncode(color.xyz, 8.12);
#else
 return color;
#endif
}
@end
@export clay.util.srgb
vec4 sRGBToLinear(in vec4 value) {
 return vec4(mix(pow(value.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), value.rgb * 0.0773993808, vec3(lessThanEqual(value.rgb, vec3(0.04045)))), value.w);
}
vec4 linearTosRGB(in vec4 value) {
 return vec4(mix(pow(value.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), value.rgb * 12.92, vec3(lessThanEqual(value.rgb, vec3(0.0031308)))), value.w);
}
@end
@export clay.chunk.skinning_header
#ifdef SKINNING
attribute vec3 weight : WEIGHT;
attribute vec4 joint : JOINT;
#ifdef USE_SKIN_MATRICES_TEXTURE
uniform sampler2D skinMatricesTexture : ignore;
uniform float skinMatricesTextureSize: ignore;
mat4 getSkinMatrix(sampler2D tex, float idx) {
 float j = idx * 4.0;
 float x = mod(j, skinMatricesTextureSize);
 float y = floor(j / skinMatricesTextureSize) + 0.5;
 vec2 scale = vec2(skinMatricesTextureSize);
 return mat4(
 texture2D(tex, vec2(x + 0.5, y) / scale),
 texture2D(tex, vec2(x + 1.5, y) / scale),
 texture2D(tex, vec2(x + 2.5, y) / scale),
 texture2D(tex, vec2(x + 3.5, y) / scale)
 );
}
mat4 getSkinMatrix(float idx) {
 return getSkinMatrix(skinMatricesTexture, idx);
}
#else
uniform mat4 skinMatrix[JOINT_COUNT] : SKIN_MATRIX;
mat4 getSkinMatrix(float idx) {
 return skinMatrix[int(idx)];
}
#endif
#endif
@end
@export clay.chunk.skin_matrix
mat4 skinMatrixWS = getSkinMatrix(joint.x) * weight.x;
if (weight.y > 1e-4)
{
 skinMatrixWS += getSkinMatrix(joint.y) * weight.y;
}
if (weight.z > 1e-4)
{
 skinMatrixWS += getSkinMatrix(joint.z) * weight.z;
}
float weightW = 1.0-weight.x-weight.y-weight.z;
if (weightW > 1e-4)
{
 skinMatrixWS += getSkinMatrix(joint.w) * weightW;
}
@end
@export clay.chunk.instancing_header
#ifdef INSTANCING
attribute vec4 instanceMat1;
attribute vec4 instanceMat2;
attribute vec4 instanceMat3;
#endif
@end
@export clay.chunk.instancing_matrix
mat4 instanceMat = mat4(
 vec4(instanceMat1.xyz, 0.0),
 vec4(instanceMat2.xyz, 0.0),
 vec4(instanceMat3.xyz, 0.0),
 vec4(instanceMat1.w, instanceMat2.w, instanceMat3.w, 1.0)
);
@end
@export clay.util.parallax_correct
vec3 parallaxCorrect(in vec3 dir, in vec3 pos, in vec3 boxMin, in vec3 boxMax) {
 vec3 first = (boxMax - pos) / dir;
 vec3 second = (boxMin - pos) / dir;
 vec3 further = max(first, second);
 float dist = min(further.x, min(further.y, further.z));
 vec3 fixedPos = pos + dir * dist;
 vec3 boxCenter = (boxMax + boxMin) * 0.5;
 return normalize(fixedPos - boxCenter);
}
@end
@export clay.util.clamp_sample
vec4 clampSample(const in sampler2D texture, const in vec2 coord)
{
#ifdef STEREO
 float eye = step(0.5, coord.x) * 0.5;
 vec2 coordClamped = clamp(coord, vec2(eye, 0.0), vec2(0.5 + eye, 1.0));
#else
 vec2 coordClamped = clamp(coord, vec2(0.0), vec2(1.0));
#endif
 return texture2D(texture, coordClamped);
}
@end
@export clay.util.ACES
vec3 ACESToneMapping(vec3 color)
{
 const float A = 2.51;
 const float B = 0.03;
 const float C = 2.43;
 const float D = 0.59;
 const float E = 0.14;
 return (color * (A * color + B)) / (color * (C * color + D) + E);
}
@end
@export clay.util.logdepth_vertex_header
#ifdef LOG_DEPTH
#ifdef SUPPORT_FRAG_DEPTH
varying float v_FragDepth;
#else
uniform float logDepthBufFC: LOG_DEPTH_BUFFER_FC;
#endif
#endif
@end
@export clay.util.logdepth_vertex_main
#ifdef LOG_DEPTH
 #ifdef SUPPORT_FRAG_DEPTH
 v_FragDepth = 1.0 + gl_Position.w;
 #else
 gl_Position.z = log2(max(1e-6, gl_Position.w + 1.0)) * logDepthBufFC - 1.0;
 gl_Position.z *= gl_Position.w;
 #endif
#endif
@end
@export clay.util.logdepth_fragment_header
#if defined(LOG_DEPTH) && defined(SUPPORT_FRAG_DEPTH)
varying float v_FragDepth;
uniform float logDepthBufFC : LOG_DEPTH_BUFFER_FC;
#endif
@end
@export clay.util.logdepth_fragment_main
#if defined(LOG_DEPTH) && defined(SUPPORT_FRAG_DEPTH)
 gl_FragDepthEXT = log2(v_FragDepth) * logDepthBufFC * 0.5;
#endif
@end
`},function(F,R,g){R.a=`
@export ecgl.common.transformUniforms
uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;
uniform mat4 worldInverseTranspose : WORLDINVERSETRANSPOSE;
uniform mat4 world : WORLD;
@end

@export ecgl.common.attributes
attribute vec3 position : POSITION;
attribute vec2 texcoord : TEXCOORD_0;
attribute vec3 normal : NORMAL;
@end

@export ecgl.common.uv.header
uniform vec2 uvRepeat : [1.0, 1.0];
uniform vec2 uvOffset : [0.0, 0.0];
uniform vec2 detailUvRepeat : [1.0, 1.0];
uniform vec2 detailUvOffset : [0.0, 0.0];

varying vec2 v_Texcoord;
varying vec2 v_DetailTexcoord;
@end

@export ecgl.common.uv.main
v_Texcoord = texcoord * uvRepeat + uvOffset;
v_DetailTexcoord = texcoord * detailUvRepeat + detailUvOffset;
@end

@export ecgl.common.uv.fragmentHeader
varying vec2 v_Texcoord;
varying vec2 v_DetailTexcoord;
@end


@export ecgl.common.albedo.main

 vec4 albedoTexel = vec4(1.0);
#ifdef DIFFUSEMAP_ENABLED
 albedoTexel = texture2D(diffuseMap, v_Texcoord);
 #ifdef SRGB_DECODE
 albedoTexel = sRGBToLinear(albedoTexel);
 #endif
#endif

#ifdef DETAILMAP_ENABLED
 vec4 detailTexel = texture2D(detailMap, v_DetailTexcoord);
 #ifdef SRGB_DECODE
 detailTexel = sRGBToLinear(detailTexel);
 #endif
 albedoTexel.rgb = mix(albedoTexel.rgb, detailTexel.rgb, detailTexel.a);
 albedoTexel.a = detailTexel.a + (1.0 - detailTexel.a) * albedoTexel.a;
#endif

@end

@export ecgl.common.wireframe.vertexHeader

#ifdef WIREFRAME_QUAD
attribute vec4 barycentric;
varying vec4 v_Barycentric;
#elif defined(WIREFRAME_TRIANGLE)
attribute vec3 barycentric;
varying vec3 v_Barycentric;
#endif

@end

@export ecgl.common.wireframe.vertexMain

#if defined(WIREFRAME_QUAD) || defined(WIREFRAME_TRIANGLE)
 v_Barycentric = barycentric;
#endif

@end


@export ecgl.common.wireframe.fragmentHeader

uniform float wireframeLineWidth : 1;
uniform vec4 wireframeLineColor: [0, 0, 0, 0.5];

#ifdef WIREFRAME_QUAD
varying vec4 v_Barycentric;
float edgeFactor () {
 vec4 d = fwidth(v_Barycentric);
 vec4 a4 = smoothstep(vec4(0.0), d * wireframeLineWidth, v_Barycentric);
 return min(min(min(a4.x, a4.y), a4.z), a4.w);
}
#elif defined(WIREFRAME_TRIANGLE)
varying vec3 v_Barycentric;
float edgeFactor () {
 vec3 d = fwidth(v_Barycentric);
 vec3 a3 = smoothstep(vec3(0.0), d * wireframeLineWidth, v_Barycentric);
 return min(min(a3.x, a3.y), a3.z);
}
#endif

@end


@export ecgl.common.wireframe.fragmentMain

#if defined(WIREFRAME_QUAD) || defined(WIREFRAME_TRIANGLE)
 if (wireframeLineWidth > 0.) {
 vec4 lineColor = wireframeLineColor;
#ifdef SRGB_DECODE
 lineColor = sRGBToLinear(lineColor);
#endif

 gl_FragColor.rgb = mix(gl_FragColor.rgb, lineColor.rgb, (1.0 - edgeFactor()) * lineColor.a);
 }
#endif
@end




@export ecgl.common.bumpMap.header

#ifdef BUMPMAP_ENABLED
uniform sampler2D bumpMap;
uniform float bumpScale : 1.0;


vec3 bumpNormal(vec3 surfPos, vec3 surfNormal, vec3 baseNormal)
{
 vec2 dSTdx = dFdx(v_Texcoord);
 vec2 dSTdy = dFdy(v_Texcoord);

 float Hll = bumpScale * texture2D(bumpMap, v_Texcoord).x;
 float dHx = bumpScale * texture2D(bumpMap, v_Texcoord + dSTdx).x - Hll;
 float dHy = bumpScale * texture2D(bumpMap, v_Texcoord + dSTdy).x - Hll;

 vec3 vSigmaX = dFdx(surfPos);
 vec3 vSigmaY = dFdy(surfPos);
 vec3 vN = surfNormal;

 vec3 R1 = cross(vSigmaY, vN);
 vec3 R2 = cross(vN, vSigmaX);

 float fDet = dot(vSigmaX, R1);

 vec3 vGrad = sign(fDet) * (dHx * R1 + dHy * R2);
 return normalize(abs(fDet) * baseNormal - vGrad);

}
#endif

@end

@export ecgl.common.normalMap.vertexHeader

#ifdef NORMALMAP_ENABLED
attribute vec4 tangent : TANGENT;
varying vec3 v_Tangent;
varying vec3 v_Bitangent;
#endif

@end

@export ecgl.common.normalMap.vertexMain

#ifdef NORMALMAP_ENABLED
 if (dot(tangent, tangent) > 0.0) {
 v_Tangent = normalize((worldInverseTranspose * vec4(tangent.xyz, 0.0)).xyz);
 v_Bitangent = normalize(cross(v_Normal, v_Tangent) * tangent.w);
 }
#endif

@end


@export ecgl.common.normalMap.fragmentHeader

#ifdef NORMALMAP_ENABLED
uniform sampler2D normalMap;
varying vec3 v_Tangent;
varying vec3 v_Bitangent;
#endif

@end

@export ecgl.common.normalMap.fragmentMain
#ifdef NORMALMAP_ENABLED
 if (dot(v_Tangent, v_Tangent) > 0.0) {
 vec3 normalTexel = texture2D(normalMap, v_DetailTexcoord).xyz;
 if (dot(normalTexel, normalTexel) > 0.0) { N = normalTexel * 2.0 - 1.0;
 mat3 tbn = mat3(v_Tangent, v_Bitangent, v_Normal);
 N = normalize(tbn * N);
 }
 }
#endif
@end



@export ecgl.common.vertexAnimation.header

#ifdef VERTEX_ANIMATION
attribute vec3 prevPosition;
attribute vec3 prevNormal;
uniform float percent;
#endif

@end

@export ecgl.common.vertexAnimation.main

#ifdef VERTEX_ANIMATION
 vec3 pos = mix(prevPosition, position, percent);
 vec3 norm = mix(prevNormal, normal, percent);
#else
 vec3 pos = position;
 vec3 norm = normal;
#endif

@end


@export ecgl.common.ssaoMap.header
#ifdef SSAOMAP_ENABLED
uniform sampler2D ssaoMap;
uniform vec4 viewport : VIEWPORT;
#endif
@end

@export ecgl.common.ssaoMap.main
 float ao = 1.0;
#ifdef SSAOMAP_ENABLED
 ao = texture2D(ssaoMap, (gl_FragCoord.xy - viewport.xy) / viewport.zw).r;
#endif
@end




@export ecgl.common.diffuseLayer.header

#if (LAYER_DIFFUSEMAP_COUNT > 0)
uniform float layerDiffuseIntensity[LAYER_DIFFUSEMAP_COUNT];
uniform sampler2D layerDiffuseMap[LAYER_DIFFUSEMAP_COUNT];
#endif

@end

@export ecgl.common.emissiveLayer.header

#if (LAYER_EMISSIVEMAP_COUNT > 0)
uniform float layerEmissionIntensity[LAYER_EMISSIVEMAP_COUNT];
uniform sampler2D layerEmissiveMap[LAYER_EMISSIVEMAP_COUNT];
#endif

@end

@export ecgl.common.layers.header
@import ecgl.common.diffuseLayer.header
@import ecgl.common.emissiveLayer.header
@end

@export ecgl.common.diffuseLayer.main

#if (LAYER_DIFFUSEMAP_COUNT > 0)
 for (int _idx_ = 0; _idx_ < LAYER_DIFFUSEMAP_COUNT; _idx_++) {{
 float intensity = layerDiffuseIntensity[_idx_];
 vec4 texel2 = texture2D(layerDiffuseMap[_idx_], v_Texcoord);
 #ifdef SRGB_DECODE
 texel2 = sRGBToLinear(texel2);
 #endif
 albedoTexel.rgb = mix(albedoTexel.rgb, texel2.rgb * intensity, texel2.a);
 albedoTexel.a = texel2.a + (1.0 - texel2.a) * albedoTexel.a;
 }}
#endif

@end

@export ecgl.common.emissiveLayer.main

#if (LAYER_EMISSIVEMAP_COUNT > 0)
 for (int _idx_ = 0; _idx_ < LAYER_EMISSIVEMAP_COUNT; _idx_++)
 {{
 vec4 texel2 = texture2D(layerEmissiveMap[_idx_], v_Texcoord) * layerEmissionIntensity[_idx_];
 #ifdef SRGB_DECODE
 texel2 = sRGBToLinear(texel2);
 #endif
 float intensity = layerEmissionIntensity[_idx_];
 gl_FragColor.rgb += texel2.rgb * texel2.a * intensity;
 }}
#endif

@end
`},function(F,R,g){R.a=`@export ecgl.color.vertex

uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;

@import ecgl.common.uv.header

attribute vec2 texcoord : TEXCOORD_0;
attribute vec3 position: POSITION;

@import ecgl.common.wireframe.vertexHeader

#ifdef VERTEX_COLOR
attribute vec4 a_Color : COLOR;
varying vec4 v_Color;
#endif

#ifdef VERTEX_ANIMATION
attribute vec3 prevPosition;
uniform float percent : 1.0;
#endif

void main()
{
#ifdef VERTEX_ANIMATION
 vec3 pos = mix(prevPosition, position, percent);
#else
 vec3 pos = position;
#endif

 gl_Position = worldViewProjection * vec4(pos, 1.0);

 @import ecgl.common.uv.main

#ifdef VERTEX_COLOR
 v_Color = a_Color;
#endif

 @import ecgl.common.wireframe.vertexMain

}

@end

@export ecgl.color.fragment

#define LAYER_DIFFUSEMAP_COUNT 0
#define LAYER_EMISSIVEMAP_COUNT 0

uniform sampler2D diffuseMap;
uniform sampler2D detailMap;

uniform vec4 color : [1.0, 1.0, 1.0, 1.0];

#ifdef VERTEX_COLOR
varying vec4 v_Color;
#endif

@import ecgl.common.layers.header

@import ecgl.common.uv.fragmentHeader

@import ecgl.common.wireframe.fragmentHeader

@import clay.util.srgb

void main()
{
#ifdef SRGB_DECODE
 gl_FragColor = sRGBToLinear(color);
#else
 gl_FragColor = color;
#endif

#ifdef VERTEX_COLOR
 gl_FragColor *= v_Color;
#endif

 @import ecgl.common.albedo.main

 @import ecgl.common.diffuseLayer.main

 gl_FragColor *= albedoTexel;

 @import ecgl.common.emissiveLayer.main

 @import ecgl.common.wireframe.fragmentMain

}
@end`},function(F,R,g){R.a=`/**
 * http: */

@export ecgl.lambert.vertex

@import ecgl.common.transformUniforms

@import ecgl.common.uv.header


@import ecgl.common.attributes

@import ecgl.common.wireframe.vertexHeader

#ifdef VERTEX_COLOR
attribute vec4 a_Color : COLOR;
varying vec4 v_Color;
#endif


@import ecgl.common.vertexAnimation.header


varying vec3 v_Normal;
varying vec3 v_WorldPosition;

void main()
{
 @import ecgl.common.uv.main

 @import ecgl.common.vertexAnimation.main


 gl_Position = worldViewProjection * vec4(pos, 1.0);

 v_Normal = normalize((worldInverseTranspose * vec4(norm, 0.0)).xyz);
 v_WorldPosition = (world * vec4(pos, 1.0)).xyz;

#ifdef VERTEX_COLOR
 v_Color = a_Color;
#endif

 @import ecgl.common.wireframe.vertexMain
}

@end


@export ecgl.lambert.fragment

#define LAYER_DIFFUSEMAP_COUNT 0
#define LAYER_EMISSIVEMAP_COUNT 0

#define NORMAL_UP_AXIS 1
#define NORMAL_FRONT_AXIS 2

@import ecgl.common.uv.fragmentHeader

varying vec3 v_Normal;
varying vec3 v_WorldPosition;

uniform sampler2D diffuseMap;
uniform sampler2D detailMap;

@import ecgl.common.layers.header

uniform float emissionIntensity: 1.0;

uniform vec4 color : [1.0, 1.0, 1.0, 1.0];

uniform mat4 viewInverse : VIEWINVERSE;

#ifdef AMBIENT_LIGHT_COUNT
@import clay.header.ambient_light
#endif
#ifdef AMBIENT_SH_LIGHT_COUNT
@import clay.header.ambient_sh_light
#endif

#ifdef DIRECTIONAL_LIGHT_COUNT
@import clay.header.directional_light
#endif

#ifdef VERTEX_COLOR
varying vec4 v_Color;
#endif


@import ecgl.common.ssaoMap.header

@import ecgl.common.bumpMap.header

@import clay.util.srgb

@import ecgl.common.wireframe.fragmentHeader

@import clay.plugin.compute_shadow_map

void main()
{
#ifdef SRGB_DECODE
 gl_FragColor = sRGBToLinear(color);
#else
 gl_FragColor = color;
#endif

#ifdef VERTEX_COLOR
 #ifdef SRGB_DECODE
 gl_FragColor *= sRGBToLinear(v_Color);
 #else
 gl_FragColor *= v_Color;
 #endif
#endif

 @import ecgl.common.albedo.main

 @import ecgl.common.diffuseLayer.main

 gl_FragColor *= albedoTexel;

 vec3 N = v_Normal;
#ifdef DOUBLE_SIDED
 vec3 eyePos = viewInverse[3].xyz;
 vec3 V = normalize(eyePos - v_WorldPosition);

 if (dot(N, V) < 0.0) {
 N = -N;
 }
#endif

 float ambientFactor = 1.0;

#ifdef BUMPMAP_ENABLED
 N = bumpNormal(v_WorldPosition, v_Normal, N);
 ambientFactor = dot(v_Normal, N);
#endif

 vec3 N2 = vec3(N.x, N[NORMAL_UP_AXIS], N[NORMAL_FRONT_AXIS]);

 vec3 diffuseColor = vec3(0.0, 0.0, 0.0);

 @import ecgl.common.ssaoMap.main

#ifdef AMBIENT_LIGHT_COUNT
 for(int i = 0; i < AMBIENT_LIGHT_COUNT; i++)
 {
 diffuseColor += ambientLightColor[i] * ambientFactor * ao;
 }
#endif
#ifdef AMBIENT_SH_LIGHT_COUNT
 for(int _idx_ = 0; _idx_ < AMBIENT_SH_LIGHT_COUNT; _idx_++)
 {{
 diffuseColor += calcAmbientSHLight(_idx_, N2) * ambientSHLightColor[_idx_] * ao;
 }}
#endif
#ifdef DIRECTIONAL_LIGHT_COUNT
#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)
 float shadowContribsDir[DIRECTIONAL_LIGHT_COUNT];
 if(shadowEnabled)
 {
 computeShadowOfDirectionalLights(v_WorldPosition, shadowContribsDir);
 }
#endif
 for(int i = 0; i < DIRECTIONAL_LIGHT_COUNT; i++)
 {
 vec3 lightDirection = -directionalLightDirection[i];
 vec3 lightColor = directionalLightColor[i];

 float shadowContrib = 1.0;
#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)
 if (shadowEnabled)
 {
 shadowContrib = shadowContribsDir[i];
 }
#endif

 float ndl = dot(N, normalize(lightDirection)) * shadowContrib;

 diffuseColor += lightColor * clamp(ndl, 0.0, 1.0);
 }
#endif

 gl_FragColor.rgb *= diffuseColor;

 @import ecgl.common.emissiveLayer.main

 @import ecgl.common.wireframe.fragmentMain
}

@end`},function(F,R,g){R.a=`@export ecgl.realistic.vertex

@import ecgl.common.transformUniforms

@import ecgl.common.uv.header

@import ecgl.common.attributes


@import ecgl.common.wireframe.vertexHeader

#ifdef VERTEX_COLOR
attribute vec4 a_Color : COLOR;
varying vec4 v_Color;
#endif

#ifdef NORMALMAP_ENABLED
attribute vec4 tangent : TANGENT;
varying vec3 v_Tangent;
varying vec3 v_Bitangent;
#endif

@import ecgl.common.vertexAnimation.header

varying vec3 v_Normal;
varying vec3 v_WorldPosition;

void main()
{

 @import ecgl.common.uv.main

 @import ecgl.common.vertexAnimation.main

 gl_Position = worldViewProjection * vec4(pos, 1.0);

 v_Normal = normalize((worldInverseTranspose * vec4(norm, 0.0)).xyz);
 v_WorldPosition = (world * vec4(pos, 1.0)).xyz;

#ifdef VERTEX_COLOR
 v_Color = a_Color;
#endif

#ifdef NORMALMAP_ENABLED
 v_Tangent = normalize((worldInverseTranspose * vec4(tangent.xyz, 0.0)).xyz);
 v_Bitangent = normalize(cross(v_Normal, v_Tangent) * tangent.w);
#endif

 @import ecgl.common.wireframe.vertexMain

}

@end



@export ecgl.realistic.fragment

#define LAYER_DIFFUSEMAP_COUNT 0
#define LAYER_EMISSIVEMAP_COUNT 0
#define PI 3.14159265358979
#define ROUGHNESS_CHANEL 0
#define METALNESS_CHANEL 1

#define NORMAL_UP_AXIS 1
#define NORMAL_FRONT_AXIS 2

#ifdef VERTEX_COLOR
varying vec4 v_Color;
#endif

@import ecgl.common.uv.fragmentHeader

varying vec3 v_Normal;
varying vec3 v_WorldPosition;

uniform sampler2D diffuseMap;

uniform sampler2D detailMap;
uniform sampler2D metalnessMap;
uniform sampler2D roughnessMap;

@import ecgl.common.layers.header

uniform float emissionIntensity: 1.0;

uniform vec4 color : [1.0, 1.0, 1.0, 1.0];

uniform float metalness : 0.0;
uniform float roughness : 0.5;

uniform mat4 viewInverse : VIEWINVERSE;

#ifdef AMBIENT_LIGHT_COUNT
@import clay.header.ambient_light
#endif

#ifdef AMBIENT_SH_LIGHT_COUNT
@import clay.header.ambient_sh_light
#endif

#ifdef AMBIENT_CUBEMAP_LIGHT_COUNT
@import clay.header.ambient_cubemap_light
#endif

#ifdef DIRECTIONAL_LIGHT_COUNT
@import clay.header.directional_light
#endif

@import ecgl.common.normalMap.fragmentHeader

@import ecgl.common.ssaoMap.header

@import ecgl.common.bumpMap.header

@import clay.util.srgb

@import clay.util.rgbm

@import ecgl.common.wireframe.fragmentHeader

@import clay.plugin.compute_shadow_map

vec3 F_Schlick(float ndv, vec3 spec) {
 return spec + (1.0 - spec) * pow(1.0 - ndv, 5.0);
}

float D_Phong(float g, float ndh) {
 float a = pow(8192.0, g);
 return (a + 2.0) / 8.0 * pow(ndh, a);
}

void main()
{
 vec4 albedoColor = color;

 vec3 eyePos = viewInverse[3].xyz;
 vec3 V = normalize(eyePos - v_WorldPosition);
#ifdef VERTEX_COLOR
 #ifdef SRGB_DECODE
 albedoColor *= sRGBToLinear(v_Color);
 #else
 albedoColor *= v_Color;
 #endif
#endif

 @import ecgl.common.albedo.main

 @import ecgl.common.diffuseLayer.main

 albedoColor *= albedoTexel;

 float m = metalness;

#ifdef METALNESSMAP_ENABLED
 float m2 = texture2D(metalnessMap, v_DetailTexcoord)[METALNESS_CHANEL];
 m = clamp(m2 + (m - 0.5) * 2.0, 0.0, 1.0);
#endif

 vec3 baseColor = albedoColor.rgb;
 albedoColor.rgb = baseColor * (1.0 - m);
 vec3 specFactor = mix(vec3(0.04), baseColor, m);

 float g = 1.0 - roughness;

#ifdef ROUGHNESSMAP_ENABLED
 float g2 = 1.0 - texture2D(roughnessMap, v_DetailTexcoord)[ROUGHNESS_CHANEL];
 g = clamp(g2 + (g - 0.5) * 2.0, 0.0, 1.0);
#endif

 vec3 N = v_Normal;

#ifdef DOUBLE_SIDED
 if (dot(N, V) < 0.0) {
 N = -N;
 }
#endif

 float ambientFactor = 1.0;

#ifdef BUMPMAP_ENABLED
 N = bumpNormal(v_WorldPosition, v_Normal, N);
 ambientFactor = dot(v_Normal, N);
#endif

@import ecgl.common.normalMap.fragmentMain

 vec3 N2 = vec3(N.x, N[NORMAL_UP_AXIS], N[NORMAL_FRONT_AXIS]);

 vec3 diffuseTerm = vec3(0.0);
 vec3 specularTerm = vec3(0.0);

 float ndv = clamp(dot(N, V), 0.0, 1.0);
 vec3 fresnelTerm = F_Schlick(ndv, specFactor);

 @import ecgl.common.ssaoMap.main

#ifdef AMBIENT_LIGHT_COUNT
 for(int _idx_ = 0; _idx_ < AMBIENT_LIGHT_COUNT; _idx_++)
 {{
 diffuseTerm += ambientLightColor[_idx_] * ambientFactor * ao;
 }}
#endif

#ifdef AMBIENT_SH_LIGHT_COUNT
 for(int _idx_ = 0; _idx_ < AMBIENT_SH_LIGHT_COUNT; _idx_++)
 {{
 diffuseTerm += calcAmbientSHLight(_idx_, N2) * ambientSHLightColor[_idx_] * ao;
 }}
#endif

#ifdef DIRECTIONAL_LIGHT_COUNT
#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)
 float shadowContribsDir[DIRECTIONAL_LIGHT_COUNT];
 if(shadowEnabled)
 {
 computeShadowOfDirectionalLights(v_WorldPosition, shadowContribsDir);
 }
#endif
 for(int _idx_ = 0; _idx_ < DIRECTIONAL_LIGHT_COUNT; _idx_++)
 {{
 vec3 L = -directionalLightDirection[_idx_];
 vec3 lc = directionalLightColor[_idx_];

 vec3 H = normalize(L + V);
 float ndl = clamp(dot(N, normalize(L)), 0.0, 1.0);
 float ndh = clamp(dot(N, H), 0.0, 1.0);

 float shadowContrib = 1.0;
#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)
 if (shadowEnabled)
 {
 shadowContrib = shadowContribsDir[_idx_];
 }
#endif

 vec3 li = lc * ndl * shadowContrib;

 diffuseTerm += li;
 specularTerm += li * fresnelTerm * D_Phong(g, ndh);
 }}
#endif


#ifdef AMBIENT_CUBEMAP_LIGHT_COUNT
 vec3 L = reflect(-V, N);
 L = vec3(L.x, L[NORMAL_UP_AXIS], L[NORMAL_FRONT_AXIS]);
 float rough2 = clamp(1.0 - g, 0.0, 1.0);
 float bias2 = rough2 * 5.0;
 vec2 brdfParam2 = texture2D(ambientCubemapLightBRDFLookup[0], vec2(rough2, ndv)).xy;
 vec3 envWeight2 = specFactor * brdfParam2.x + brdfParam2.y;
 vec3 envTexel2;
 for(int _idx_ = 0; _idx_ < AMBIENT_CUBEMAP_LIGHT_COUNT; _idx_++)
 {{
 envTexel2 = RGBMDecode(textureCubeLodEXT(ambientCubemapLightCubemap[_idx_], L, bias2), 8.12);
 specularTerm += ambientCubemapLightColor[_idx_] * envTexel2 * envWeight2 * ao;
 }}
#endif

 gl_FragColor.rgb = albedoColor.rgb * diffuseTerm + specularTerm;
 gl_FragColor.a = albedoColor.a;

#ifdef SRGB_ENCODE
 gl_FragColor = linearTosRGB(gl_FragColor);
#endif

 @import ecgl.common.emissiveLayer.main

 @import ecgl.common.wireframe.fragmentMain
}

@end`},function(F,R,g){R.a=`@export ecgl.hatching.vertex

@import ecgl.realistic.vertex

@end


@export ecgl.hatching.fragment

#define NORMAL_UP_AXIS 1
#define NORMAL_FRONT_AXIS 2

@import ecgl.common.uv.fragmentHeader

varying vec3 v_Normal;
varying vec3 v_WorldPosition;

uniform vec4 color : [0.0, 0.0, 0.0, 1.0];
uniform vec4 paperColor : [1.0, 1.0, 1.0, 1.0];

uniform mat4 viewInverse : VIEWINVERSE;

#ifdef AMBIENT_LIGHT_COUNT
@import clay.header.ambient_light
#endif
#ifdef AMBIENT_SH_LIGHT_COUNT
@import clay.header.ambient_sh_light
#endif

#ifdef DIRECTIONAL_LIGHT_COUNT
@import clay.header.directional_light
#endif

#ifdef VERTEX_COLOR
varying vec4 v_Color;
#endif


@import ecgl.common.ssaoMap.header

@import ecgl.common.bumpMap.header

@import clay.util.srgb

@import ecgl.common.wireframe.fragmentHeader

@import clay.plugin.compute_shadow_map

uniform sampler2D hatch1;
uniform sampler2D hatch2;
uniform sampler2D hatch3;
uniform sampler2D hatch4;
uniform sampler2D hatch5;
uniform sampler2D hatch6;

float shade(in float tone) {
 vec4 c = vec4(1. ,1., 1., 1.);
 float step = 1. / 6.;
 vec2 uv = v_DetailTexcoord;
 if (tone <= step / 2.0) {
 c = mix(vec4(0.), texture2D(hatch6, uv), 12. * tone);
 }
 else if (tone <= step) {
 c = mix(texture2D(hatch6, uv), texture2D(hatch5, uv), 6. * tone);
 }
 if(tone > step && tone <= 2. * step){
 c = mix(texture2D(hatch5, uv), texture2D(hatch4, uv) , 6. * (tone - step));
 }
 if(tone > 2. * step && tone <= 3. * step){
 c = mix(texture2D(hatch4, uv), texture2D(hatch3, uv), 6. * (tone - 2. * step));
 }
 if(tone > 3. * step && tone <= 4. * step){
 c = mix(texture2D(hatch3, uv), texture2D(hatch2, uv), 6. * (tone - 3. * step));
 }
 if(tone > 4. * step && tone <= 5. * step){
 c = mix(texture2D(hatch2, uv), texture2D(hatch1, uv), 6. * (tone - 4. * step));
 }
 if(tone > 5. * step){
 c = mix(texture2D(hatch1, uv), vec4(1.), 6. * (tone - 5. * step));
 }

 return c.r;
}

const vec3 w = vec3(0.2125, 0.7154, 0.0721);

void main()
{
#ifdef SRGB_DECODE
 vec4 inkColor = sRGBToLinear(color);
#else
 vec4 inkColor = color;
#endif

#ifdef VERTEX_COLOR
 #ifdef SRGB_DECODE
 inkColor *= sRGBToLinear(v_Color);
 #else
 inkColor *= v_Color;
 #endif
#endif

 vec3 N = v_Normal;
#ifdef DOUBLE_SIDED
 vec3 eyePos = viewInverse[3].xyz;
 vec3 V = normalize(eyePos - v_WorldPosition);

 if (dot(N, V) < 0.0) {
 N = -N;
 }
#endif

 float tone = 0.0;

 float ambientFactor = 1.0;

#ifdef BUMPMAP_ENABLED
 N = bumpNormal(v_WorldPosition, v_Normal, N);
 ambientFactor = dot(v_Normal, N);
#endif

 vec3 N2 = vec3(N.x, N[NORMAL_UP_AXIS], N[NORMAL_FRONT_AXIS]);

 @import ecgl.common.ssaoMap.main

#ifdef AMBIENT_LIGHT_COUNT
 for(int i = 0; i < AMBIENT_LIGHT_COUNT; i++)
 {
 tone += dot(ambientLightColor[i], w) * ambientFactor * ao;
 }
#endif
#ifdef AMBIENT_SH_LIGHT_COUNT
 for(int _idx_ = 0; _idx_ < AMBIENT_SH_LIGHT_COUNT; _idx_++)
 {{
 tone += dot(calcAmbientSHLight(_idx_, N2) * ambientSHLightColor[_idx_], w) * ao;
 }}
#endif
#ifdef DIRECTIONAL_LIGHT_COUNT
#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)
 float shadowContribsDir[DIRECTIONAL_LIGHT_COUNT];
 if(shadowEnabled)
 {
 computeShadowOfDirectionalLights(v_WorldPosition, shadowContribsDir);
 }
#endif
 for(int i = 0; i < DIRECTIONAL_LIGHT_COUNT; i++)
 {
 vec3 lightDirection = -directionalLightDirection[i];
 float lightTone = dot(directionalLightColor[i], w);

 float shadowContrib = 1.0;
#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)
 if (shadowEnabled)
 {
 shadowContrib = shadowContribsDir[i];
 }
#endif

 float ndl = dot(N, normalize(lightDirection)) * shadowContrib;

 tone += lightTone * clamp(ndl, 0.0, 1.0);
 }
#endif

 gl_FragColor = mix(inkColor, paperColor, shade(clamp(tone, 0.0, 1.0)));
 }
@end
`},function(F,R,g){R.a=`@export ecgl.sm.depth.vertex

uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;

attribute vec3 position : POSITION;
attribute vec2 texcoord : TEXCOORD_0;

#ifdef VERTEX_ANIMATION
attribute vec3 prevPosition;
uniform float percent : 1.0;
#endif

varying vec4 v_ViewPosition;
varying vec2 v_Texcoord;

void main(){

#ifdef VERTEX_ANIMATION
 vec3 pos = mix(prevPosition, position, percent);
#else
 vec3 pos = position;
#endif

 v_ViewPosition = worldViewProjection * vec4(pos, 1.0);
 gl_Position = v_ViewPosition;

 v_Texcoord = texcoord;

}
@end



@export ecgl.sm.depth.fragment

@import clay.sm.depth.fragment

@end`},function(F,R,g){var E=g(0),c=g.n(E),t=["bar3D","line3D","map3D","scatter3D","surface","lines3D","scatterGL","scatter3D"];function a(s,h){if(s&&s[h]&&(s[h].normal||s[h].emphasis)){var r=s[h].normal,e=s[h].emphasis;r&&(s[h]=r),e&&(s.emphasis=s.emphasis||{},s.emphasis[h]=e)}}function o(s){a(s,"itemStyle"),a(s,"lineStyle"),a(s,"areaStyle"),a(s,"label")}function i(s){!s||(s instanceof Array||(s=[s]),c.a.util.each(s,function(h){if(h.axisLabel){var r=h.axisLabel;c.a.util.extend(r,r.textStyle),r.textStyle=null}}))}R.a=function(s){c.a.util.each(s.series,function(h){c.a.util.indexOf(t,h.type)>=0&&(o(h),h.coordinateSystem==="mapbox"&&(h.coordinateSystem="mapbox3D",s.mapbox3D=s.mapbox))}),i(s.xAxis3D),i(s.yAxis3D),i(s.zAxis3D),i(s.grid3D),a(s.geo3D)}},function(F,R,g){g(154),g(158),g(159),g(166);var E=g(0),c=g.n(E);c.a.registerAction({type:"grid3DChangeCamera",event:"grid3dcamerachanged",update:"series:updateCamera"},function(t,a){a.eachComponent({mainType:"grid3D",query:t},function(o){o.setView(t)})}),c.a.registerAction({type:"grid3DShowAxisPointer",event:"grid3dshowaxispointer",update:"grid3D:showAxisPointer"},function(t,a){}),c.a.registerAction({type:"grid3DHideAxisPointer",event:"grid3dhideaxispointer",update:"grid3D:hideAxisPointer"},function(t,a){})},function(F,R,g){var E=g(0),c=g.n(E),t=g(155),a=c.a.extendComponentModel({type:"cartesian3DAxis",axis:null,getCoordSysModel:function(){return this.ecModel.queryComponents({mainType:"grid3D",index:this.option.gridIndex,id:this.option.gridId})[0]}});c.a.helper.mixinAxisModelCommonMethods(a);function o(i,s){return s.type||(s.data?"category":"value")}Object(t.a)("x",a,o,{name:"X"}),Object(t.a)("y",a,o,{name:"Y"}),Object(t.a)("z",a,o,{name:"Z"})},function(F,R,g){var E=g(0),c=g.n(E),t=g(156),a=g(157),o=g.n(a),i=["value","category","time","log"];R.a=function(s,h,r,e){c.a.util.each(i,function(n){h.extend({type:s+"Axis3D."+n,__ordinalMeta:null,mergeDefaultAndTheme:function(l,u){var _=u.getTheme();c.a.util.merge(l,_.get(n+"Axis3D")),c.a.util.merge(l,this.getDefaultOption()),l.type=r(s,l)},optionUpdated:function(){var l=this.option;l.type==="category"&&(this.__ordinalMeta=o.a.createByAxisModel(this))},getCategories:function(){if(this.option.type==="category")return this.__ordinalMeta.categories},getOrdinalMeta:function(){return this.__ordinalMeta},defaultOption:c.a.util.merge(c.a.util.clone(t.a[n+"Axis3D"]),e||{},!0)})}),h.superClass.registerSubTypeDefaulter(s+"Axis3D",c.a.util.curry(r,s))}},function(F,R,g){var E=g(0),c=g.n(E),t={show:!0,grid3DIndex:0,inverse:!1,name:"",nameLocation:"middle",nameTextStyle:{fontSize:16},nameGap:20,axisPointer:{},axisLine:{},axisTick:{},axisLabel:{},splitArea:{}},a=c.a.util.merge({boundaryGap:!0,axisTick:{alignWithLabel:!1,interval:"auto"},axisLabel:{interval:"auto"},axisPointer:{label:{show:!1}}},t),o=c.a.util.merge({boundaryGap:[0,0],splitNumber:5,axisPointer:{label:{}}},t),i=c.a.util.defaults({scale:!0,min:"dataMin",max:"dataMax"},o),s=c.a.util.defaults({logBase:10},o);s.scale=!0,R.a={categoryAxis3D:a,valueAxis3D:o,timeAxis3D:i,logAxis3D:s}},function(F,R,g){var E=g(16),c=E.createHashMap,t=E.isObject,a=E.map;function o(e){this.categories=e.categories||[],this._needCollect=e.needCollect,this._deduplication=e.deduplication,this._map}o.createByAxisModel=function(e){var n=e.option,l=n.data,u=l&&a(l,h);return new o({categories:u,needCollect:!u,deduplication:n.dedplication!==!1})};var i=o.prototype;i.getOrdinal=function(e){return s(this).get(e)},i.parseAndCollect=function(e){var n,l=this._needCollect;if(typeof e!="string"&&!l)return e;if(l&&!this._deduplication)return n=this.categories.length,this.categories[n]=e,n;var u=s(this);return n=u.get(e),n==null&&(l?(n=this.categories.length,this.categories[n]=e,u.set(e,n)):n=NaN),n};function s(e){return e._map||(e._map=c(e.categories))}function h(e){return t(e)&&e.value!=null?e.value:e+""}var r=o;F.exports=r},function(F,R,g){var E=g(0),c=g.n(E),t=g(44),a=g(28),o=g(29),i=c.a.extendComponentModel({type:"grid3D",dependencies:["xAxis3D","yAxis3D","zAxis3D"],defaultOption:{show:!0,zlevel:-10,left:0,top:0,width:"100%",height:"100%",environment:"auto",boxWidth:100,boxHeight:100,boxDepth:100,axisPointer:{show:!0,lineStyle:{color:"rgba(0, 0, 0, 0.8)",width:1},label:{show:!0,formatter:null,margin:8,textStyle:{fontSize:14,color:"#fff",backgroundColor:"rgba(0,0,0,0.5)",padding:3,borderRadius:3}}},axisLine:{show:!0,lineStyle:{color:"#333",width:2,type:"solid"}},axisTick:{show:!0,inside:!1,length:3,lineStyle:{width:1}},axisLabel:{show:!0,inside:!1,rotate:0,margin:8,textStyle:{fontSize:12}},splitLine:{show:!0,lineStyle:{color:["#ccc"],width:1,type:"solid"}},splitArea:{show:!1,areaStyle:{color:["rgba(250,250,250,0.3)","rgba(200,200,200,0.3)"]}},light:{main:{alpha:30,beta:40},ambient:{intensity:.4}},viewControl:{alpha:20,beta:40,autoRotate:!1,distance:200,minDistance:40,maxDistance:400}}});c.a.util.merge(i.prototype,t.a),c.a.util.merge(i.prototype,a.a),c.a.util.merge(i.prototype,o.a)},function(F,R,g){var E=g(0),c=g.n(E),t=g(1),a=g(45),o=g(25),i=g(2),s=g(82),h=g(30),r=g(161),e=g(163),n=g(62),l=g(46),u=i.a.firstNotNull;t.a.Shader.import(l.a),["x","y","z"].forEach(function(f){c.a.extendComponentView({type:f+"Axis3D"})});var _={x:0,y:2,z:1};c.a.extendComponentView({type:"grid3D",__ecgl__:!0,init:function(f,d){var v=[["y","z","x",-1,"left"],["y","z","x",1,"right"],["x","y","z",-1,"bottom"],["x","y","z",1,"top"],["x","z","y",-1,"far"],["x","z","y",1,"near"]],m=["x","y","z"],p=new t.a.Material({shader:t.a.createShader("ecgl.color"),depthMask:!1,transparent:!0}),y=new t.a.Material({shader:t.a.createShader("ecgl.meshLines3D"),depthMask:!1,transparent:!0});p.define("fragment","DOUBLE_SIDED"),p.define("both","VERTEX_COLOR"),this.groupGL=new t.a.Node,this._control=new a.a({zr:d.getZr()}),this._control.init(),this._faces=v.map(function(M){var P=new r.a(M,y,p);return this.groupGL.add(P.rootNode),P},this),this._axes=m.map(function(M){var P=new e.a(M,y);return this.groupGL.add(P.rootNode),P},this);var x=d.getDevicePixelRatio();this._axisLabelSurface=new s.a({width:256,height:256,devicePixelRatio:x}),this._axisLabelSurface.onupdate=function(){d.getZr().refresh()},this._axisPointerLineMesh=new t.a.Mesh({geometry:new o.a({useNativeLine:!1}),material:y,castShadow:!1,ignorePicking:!0,renderOrder:3}),this.groupGL.add(this._axisPointerLineMesh),this._axisPointerLabelsSurface=new s.a({width:128,height:128,devicePixelRatio:x}),this._axisPointerLabelsMesh=new n.a({ignorePicking:!0,renderOrder:4,castShadow:!1}),this._axisPointerLabelsMesh.material.set("textureAtlas",this._axisPointerLabelsSurface.getTexture()),this.groupGL.add(this._axisPointerLabelsMesh),this._lightRoot=new t.a.Node,this._sceneHelper=new h.a,this._sceneHelper.initLight(this._lightRoot)},render:function(f,d,v){this._model=f,this._api=v;var m=f.coordinateSystem;m.viewGL.add(this._lightRoot),f.get("show")?m.viewGL.add(this.groupGL):m.viewGL.remove(this.groupGL);var p=this._control;p.setViewGL(m.viewGL);var y=f.getModel("viewControl");p.setFromViewControlModel(y,0),this._axisLabelSurface.clear(),p.off("update"),f.get("show")&&(this._faces.forEach(function(x){x.update(f,d,v)},this),this._axes.forEach(function(x){x.update(f,this._axisLabelSurface,v)},this)),p.on("update",this._onCameraChange.bind(this,f,v),this),this._sceneHelper.setScene(m.viewGL.scene),this._sceneHelper.updateLight(f),m.viewGL.setPostEffect(f.getModel("postEffect"),v),m.viewGL.setTemporalSuperSampling(f.getModel("temporalSuperSampling")),this._initMouseHandler(f)},afterRender:function(f,d,v,m){var p=m.renderer;this._sceneHelper.updateAmbientCubemap(p,f,v),this._sceneHelper.updateSkybox(p,f,v)},showAxisPointer:function(f,d,v,m){this._doShowAxisPointer(),this._updateAxisPointer(m.value)},hideAxisPointer:function(f,d,v,m){this._doHideAxisPointer()},_initMouseHandler:function(f){var d=f.coordinateSystem,v=d.viewGL;f.get("show")&&f.get("axisPointer.show")?v.on("mousemove",this._updateAxisPointerOnMousePosition,this):v.off("mousemove",this._updateAxisPointerOnMousePosition)},_updateAxisPointerOnMousePosition:function(f){if(!f.target){for(var d=this._model,v=d.coordinateSystem,m=v.viewGL,p=m.castRay(f.offsetX,f.offsetY,new t.a.Ray),y,x=0;x<this._faces.length;x++){var M=this._faces[x];if(!M.rootNode.invisible){M.plane.normal.dot(m.camera.worldTransform.z)<0&&M.plane.normal.negate();var P=p.intersectPlane(M.plane);if(!!P){var T=v.getAxis(M.faceInfo[0]),O=v.getAxis(M.faceInfo[1]),D=_[M.faceInfo[0]],A=_[M.faceInfo[1]];T.contain(P.array[D])&&O.contain(P.array[A])&&(y=P)}}}if(y){var C=v.pointToData(y.array,[],!0);this._updateAxisPointer(C),this._doShowAxisPointer()}else this._doHideAxisPointer()}},_onCameraChange:function(f,d){f.get("show")&&(this._updateFaceVisibility(),this._updateAxisLinePosition());var v=this._control;d.dispatchAction({type:"grid3DChangeCamera",alpha:v.getAlpha(),beta:v.getBeta(),distance:v.getDistance(),center:v.getCenter(),from:this.uid,grid3DId:f.id})},_updateFaceVisibility:function(){var f=this._control.getCamera(),d=new t.a.Vector3;f.update();for(var v=0;v<this._faces.length/2;v++){for(var m=[],p=0;p<2;p++){var y=this._faces[v*2+p];y.rootNode.getWorldPosition(d),d.transformMat4(f.viewMatrix),m[p]=d.z}var x=m[0]>m[1]?0:1,M=this._faces[v*2+x],P=this._faces[v*2+1-x];M.rootNode.invisible=!0,P.rootNode.invisible=!1}},_updateAxisLinePosition:function(){var f=this._model.coordinateSystem,d=f.getAxis("x"),v=f.getAxis("y"),m=f.getAxis("z"),p=m.getExtentMax(),y=m.getExtentMin(),x=d.getExtentMin(),M=d.getExtentMax(),P=v.getExtentMax(),T=v.getExtentMin(),O=this._axes[0].rootNode,D=this._axes[1].rootNode,A=this._axes[2].rootNode,C=this._faces,S=C[4].rootNode.invisible?T:P,L=C[2].rootNode.invisible?p:y,I=C[0].rootNode.invisible?x:M,w=C[2].rootNode.invisible?p:y,b=C[0].rootNode.invisible?M:x,B=C[4].rootNode.invisible?T:P;O.rotation.identity(),D.rotation.identity(),A.rotation.identity(),C[4].rootNode.invisible&&(this._axes[0].flipped=!0,O.rotation.rotateX(Math.PI)),C[0].rootNode.invisible&&(this._axes[1].flipped=!0,D.rotation.rotateZ(Math.PI)),C[4].rootNode.invisible&&(this._axes[2].flipped=!0,A.rotation.rotateY(Math.PI)),O.position.set(0,L,S),D.position.set(I,w,0),A.position.set(b,0,B),O.update(),D.update(),A.update(),this._updateAxisLabelAlign()},_updateAxisLabelAlign:function(){var f=this._control.getCamera(),d=[new t.a.Vector4,new t.a.Vector4],v=new t.a.Vector4;this.groupGL.getWorldPosition(v),v.w=1,v.transformMat4(f.viewMatrix).transformMat4(f.projectionMatrix),v.x/=v.w,v.y/=v.w,this._axes.forEach(function(m){var p=m.axisLineCoords;m.labelsMesh.geometry;for(var y=0;y<d.length;y++)d[y].setArray(p[y]),d[y].w=1,d[y].transformMat4(m.rootNode.worldTransform).transformMat4(f.viewMatrix).transformMat4(f.projectionMatrix),d[y].x/=d[y].w,d[y].y/=d[y].w;var x=d[1].x-d[0].x,M=d[1].y-d[0].y,P=(d[1].x+d[0].x)/2,T=(d[1].y+d[0].y)/2,O,D;Math.abs(M/x)<.5?(O="center",D=T>v.y?"bottom":"top"):(D="middle",O=P>v.x?"left":"right"),m.setSpriteAlign(O,D,this._api)},this)},_doShowAxisPointer:function(){!this._axisPointerLineMesh.invisible||(this._axisPointerLineMesh.invisible=!1,this._axisPointerLabelsMesh.invisible=!1,this._api.getZr().refresh())},_doHideAxisPointer:function(){this._axisPointerLineMesh.invisible||(this._axisPointerLineMesh.invisible=!0,this._axisPointerLabelsMesh.invisible=!0,this._api.getZr().refresh())},_updateAxisPointer:function(f){var d=this._model.coordinateSystem,v=d.dataToPoint(f),m=this._axisPointerLineMesh,p=m.geometry,y=this._model.getModel("axisPointer"),x=this._api.getDevicePixelRatio();p.convertToDynamicArray(!0);function M(H){return i.a.firstNotNull(H.model.get("axisPointer.show"),y.get("show"))}function P(H){var X=H.model.getModel("axisPointer",y),Q=X.getModel("lineStyle"),j=t.a.parseColor(Q.get("color")),J=u(Q.get("width"),1),Y=u(Q.get("opacity"),1);return j[3]*=Y,{color:j,lineWidth:J}}for(var T=0;T<this._faces.length;T++){var O=this._faces[T];if(!O.rootNode.invisible){for(var D=O.faceInfo,A=D[3]<0?d.getAxis(D[2]).getExtentMin():d.getAxis(D[2]).getExtentMax(),C=_[D[2]],S=0;S<2;S++){var L=D[S],I=D[1-S],w=d.getAxis(L),b=d.getAxis(I);if(!!M(w)){var B=[0,0,0],U=[0,0,0],W=_[L],z=_[I];B[W]=U[W]=v[W],B[C]=U[C]=A,B[z]=b.getExtentMin(),U[z]=b.getExtentMax();var G=P(w);p.addLine(B,U,G.color,G.lineWidth*x)}}if(M(d.getAxis(D[2]))){var B=v.slice(),U=v.slice();U[C]=A;var G=P(d.getAxis(D[2]));p.addLine(B,U,G.color,G.lineWidth*x)}}}p.convertToTypedArray(),this._updateAxisPointerLabelsMesh(f),this._api.getZr().refresh()},_updateAxisPointerLabelsMesh:function(f){var d=this._model,v=this._axisPointerLabelsMesh,m=this._axisPointerLabelsSurface,p=d.coordinateSystem,y=d.getModel("axisPointer");v.geometry.convertToDynamicArray(!0),m.clear();var x={x:"y",y:"x",z:"y"};this._axes.forEach(function(M,P){var T=p.getAxis(M.dim),O=T.model,D=O.getModel("axisPointer",y),A=D.getModel("label"),C=D.get("lineStyle.color");if(!(!A.get("show")||!D.get("show"))){var S=f[P],L=A.get("formatter"),I=T.scale.getLabel(S);if(L!=null)I=L(I,f);else if(T.scale.type==="interval"||T.scale.type==="log"){var w=c.a.number.getPrecisionSafe(T.scale.getTicks()[0]);I=S.toFixed(w+2)}var b=A.getModel("textStyle"),B=b.get("color"),U=new c.a.graphic.Text;c.a.graphic.setTextStyle(U.style,b,{text:I,textFill:B||C,textAlign:"left",textVerticalAlign:"top"});var W=m.add(U),z=U.getBoundingRect(),G=this._api.getDevicePixelRatio(),H=M.rootNode.position.toArray(),X=_[x[M.dim]];H[X]+=(M.flipped?-1:1)*A.get("margin"),H[_[M.dim]]=T.dataToCoord(f[P]),v.geometry.addSprite(H,[z.width*G,z.height*G],W,M.textAlign,M.textVerticalAlign)}},this),m.getZr().refreshImmediately(),v.material.set("uvScale",m.getCoordsScale()),v.geometry.convertToTypedArray()},dispose:function(){this.groupGL.removeAll(),this._control.dispose()}})},function(F,R,g){var E=g(69),c=g(12),t=g(33),a=g(78),o=g(79),i=g(34),s=g(21),h=g(55);R.a={vec2:E.a,vec3:c.a,vec4:t.a,mat2:a.a,mat2d:o.a,mat3:i.a,mat4:s.a,quat:h.a}},function(F,R,g){var E=g(0),c=g.n(E),t=g(1),a=g(2),o=g(25),i=g(162),s=a.a.firstNotNull,h={x:0,y:2,z:1};function r(n,l,u,_){var f=[0,0,0],d=_<0?u.getExtentMin():u.getExtentMax();f[h[u.dim]]=d,n.position.setArray(f),n.rotation.identity(),l.distance=-Math.abs(d),l.normal.set(0,0,0),u.dim==="x"?(n.rotation.rotateY(_*Math.PI/2),l.normal.x=-_):u.dim==="z"?(n.rotation.rotateX(-_*Math.PI/2),l.normal.y=-_):(_>0&&n.rotation.rotateY(Math.PI),l.normal.z=-_)}function e(n,l,u){this.rootNode=new t.a.Node;var _=new t.a.Mesh({geometry:new o.a({useNativeLine:!1}),material:l,castShadow:!1,ignorePicking:!0,$ignorePicking:!0,renderOrder:1}),f=new t.a.Mesh({geometry:new i.a,material:u,castShadow:!1,culling:!1,ignorePicking:!0,$ignorePicking:!0,renderOrder:0});this.rootNode.add(f),this.rootNode.add(_),this.faceInfo=n,this.plane=new t.a.Plane,this.linesMesh=_,this.quadsMesh=f}e.prototype.update=function(n,l,u){var _=n.coordinateSystem,f=[_.getAxis(this.faceInfo[0]),_.getAxis(this.faceInfo[1])],d=this.linesMesh.geometry,v=this.quadsMesh.geometry;d.convertToDynamicArray(!0),v.convertToDynamicArray(!0),this._updateSplitLines(d,f,n,u),this._udpateSplitAreas(v,f,n,u),d.convertToTypedArray(),v.convertToTypedArray();var m=_.getAxis(this.faceInfo[2]);r(this.rootNode,this.plane,m,this.faceInfo[3])},e.prototype._updateSplitLines=function(n,l,u,_){var f=_.getDevicePixelRatio();l.forEach(function(d,v){var m=d.model,p=l[1-v].getExtent();if(!d.scale.isBlank()){var y=m.getModel("splitLine",u.getModel("splitLine"));if(y.get("show")){var x=y.getModel("lineStyle"),M=x.get("color"),P=s(x.get("opacity"),1),T=s(x.get("width"),1);M=c.a.util.isArray(M)?M:[M];for(var O=d.getTicksCoords({tickModel:y}),D=0,A=0;A<O.length;A++){var C=O[A].coord,S=t.a.parseColor(M[D%M.length]);S[3]*=P;var L=[0,0,0],I=[0,0,0];L[v]=I[v]=C,L[1-v]=p[0],I[1-v]=p[1],n.addLine(L,I,S,T*f),D++}}}})},e.prototype._udpateSplitAreas=function(n,l,u,_){l.forEach(function(f,d){var v=f.model,m=l[1-d].getExtent();if(!f.scale.isBlank()){var p=v.getModel("splitArea",u.getModel("splitArea"));if(p.get("show")){var y=p.getModel("areaStyle"),x=y.get("color"),M=s(y.get("opacity"),1);x=c.a.util.isArray(x)?x:[x];for(var P=f.getTicksCoords({tickModel:p,clamp:!0}),T=0,O=[0,0,0],D=[0,0,0],A=0;A<P.length;A++){var C=P[A].coord,S=[0,0,0],L=[0,0,0];if(S[d]=L[d]=C,S[1-d]=m[0],L[1-d]=m[1],A===0){O=S,D=L;continue}var I=t.a.parseColor(x[T%x.length]);I[3]*=M,n.addQuad([O,S,L,D],I),O=S,D=L,T++}}}})},R.a=e},function(F,R,g){var E=g(14),c=g(0),t=g.n(c),a=g(39),o=g(6),i=o.a.vec3,s=E.a.extend(function(){return{segmentScale:1,useNativeLine:!0,attributes:{position:new E.a.Attribute("position","float",3,"POSITION"),normal:new E.a.Attribute("normal","float",3,"NORMAL"),color:new E.a.Attribute("color","float",4,"COLOR")}}},{resetOffset:function(){this._vertexOffset=0,this._faceOffset=0},setQuadCount:function(h){var r=this.attributes,e=this.getQuadVertexCount()*h,n=this.getQuadTriangleCount()*h;this.vertexCount!==e&&(r.position.init(e),r.normal.init(e),r.color.init(e)),this.triangleCount!==n&&(this.indices=e>65535?new Uint32Array(n*3):new Uint16Array(n*3))},getQuadVertexCount:function(){return 4},getQuadTriangleCount:function(){return 2},addQuad:function(){var h=i.create(),r=i.create(),e=i.create(),n=[0,3,1,3,2,1];return function(l,u){var _=this.attributes.position,f=this.attributes.normal,d=this.attributes.color;i.sub(h,l[1],l[0]),i.sub(r,l[2],l[1]),i.cross(e,h,r),i.normalize(e,e);for(var v=0;v<4;v++)_.set(this._vertexOffset+v,l[v]),d.set(this._vertexOffset+v,u),f.set(this._vertexOffset+v,e);for(var m=this._faceOffset*3,v=0;v<6;v++)this.indices[m+v]=n[v]+this._vertexOffset;this._vertexOffset+=4,this._faceOffset+=2}}()});t.a.util.defaults(s.prototype,a.a),R.a=s},function(F,R,g){var E=g(0),c=g.n(E),t=g(1),a=g(25),o=g(2),i=g(62),s=o.a.firstNotNull,h={x:0,y:2,z:1};function r(n,l){var u=new t.a.Mesh({geometry:new a.a({useNativeLine:!1}),material:l,castShadow:!1,ignorePicking:!0,renderOrder:2}),_=new i.a;_.material.depthMask=!1;var f=new t.a.Node;f.add(u),f.add(_),this.rootNode=f,this.dim=n,this.linesMesh=u,this.labelsMesh=_,this.axisLineCoords=null,this.labelElements=[]}var e={x:"y",y:"x",z:"y"};r.prototype.update=function(n,l,u){var _=n.coordinateSystem,f=_.getAxis(this.dim),d=this.linesMesh.geometry,v=this.labelsMesh.geometry;d.convertToDynamicArray(!0),v.convertToDynamicArray(!0);var m=f.model,p=f.getExtent(),y=u.getDevicePixelRatio(),x=m.getModel("axisLine",n.getModel("axisLine")),M=m.getModel("axisTick",n.getModel("axisTick")),P=m.getModel("axisLabel",n.getModel("axisLabel")),T=x.get("lineStyle.color");if(x.get("show")){var O=x.getModel("lineStyle"),D=[0,0,0],A=[0,0,0],C=h[f.dim];D[C]=p[0],A[C]=p[1],this.axisLineCoords=[D,A];var S=t.a.parseColor(T),L=s(O.get("width"),1),I=s(O.get("opacity"),1);S[3]*=I,d.addLine(D,A,S,L*y)}if(M.get("show")){var w=M.getModel("lineStyle"),b=t.a.parseColor(s(w.get("color"),T)),L=s(w.get("width"),1);b[3]*=s(w.get("opacity"),1);for(var B=f.getTicksCoords(),U=M.get("length"),W=0;W<B.length;W++){var z=B[W].coord,D=[0,0,0],A=[0,0,0],C=h[f.dim],G=h[e[f.dim]];D[C]=A[C]=z,A[G]=U,d.addLine(D,A,b,L*y)}}this.labelElements=[];var y=u.getDevicePixelRatio();if(P.get("show"))for(var B=f.getTicksCoords(),H=m.get("data"),X=P.get("margin"),Q=f.getViewLabels(),W=0;W<Q.length;W++){var j=Q[W].tickValue,J=Q[W].formattedLabel,Y=Q[W].rawLabel,z=f.dataToCoord(j),at=[0,0,0],C=h[f.dim],G=h[e[f.dim]];at[C]=at[C]=z,at[G]=X;var ot=P;H&&H[j]&&H[j].textStyle&&(ot=new c.a.Model(H[j].textStyle,P,m.ecModel));var ut=s(ot.get("color"),T),et=new c.a.graphic.Text;c.a.graphic.setTextStyle(et.style,ot,{text:J,textFill:typeof ut=="function"?ut(f.type==="category"?Y:f.type==="value"?j+"":j,W):ut,textVerticalAlign:"top",textAlign:"left"});var ht=l.add(et),ft=et.getBoundingRect();v.addSprite(at,[ft.width*y,ft.height*y],ht),this.labelElements.push(et)}if(m.get("name")){var it=m.getModel("nameTextStyle"),at=[0,0,0],C=h[f.dim],G=h[e[f.dim]],N=s(it.get("color"),T),K=it.get("borderColor"),L=it.get("borderWidth");at[C]=at[C]=(p[0]+p[1])/2,at[G]=m.get("nameGap");var et=new c.a.graphic.Text;c.a.graphic.setTextStyle(et.style,it,{text:m.get("name"),textFill:N,textStroke:K,lineWidth:L});var ht=l.add(et),ft=et.getBoundingRect();v.addSprite(at,[ft.width*y,ft.height*y],ht),et.__idx=this.labelElements.length,this.nameLabelElement=et}this.labelsMesh.material.set("textureAtlas",l.getTexture()),this.labelsMesh.material.set("uvScale",l.getCoordsScale()),d.convertToTypedArray(),v.convertToTypedArray()},r.prototype.setSpriteAlign=function(n,l,u){for(var _=u.getDevicePixelRatio(),f=this.labelsMesh.geometry,d=0;d<this.labelElements.length;d++){var v=this.labelElements[d],m=v.getBoundingRect();f.setSpriteAlign(d,[m.width*_,m.height*_],n,l)}var p=this.nameLabelElement;if(p){var m=p.getBoundingRect();f.setSpriteAlign(p.__idx,[m.width*_,m.height*_],n,l),f.dirty()}this.textAlign=n,this.textVerticalAlign=l},R.a=r},function(F,R,g){var E=g(0),c=g.n(E),t=g(14),a=g(39),o=[0,1,2,0,2,3],i=t.a.extend(function(){return{attributes:{position:new t.a.Attribute("position","float",3,"POSITION"),texcoord:new t.a.Attribute("texcoord","float",2,"TEXCOORD_0"),offset:new t.a.Attribute("offset","float",2),color:new t.a.Attribute("color","float",4,"COLOR")}}},{resetOffset:function(){this._vertexOffset=0,this._faceOffset=0},setSpriteCount:function(s){this._spriteCount=s;var h=s*4,r=s*2;this.vertexCount!==h&&(this.attributes.position.init(h),this.attributes.offset.init(h),this.attributes.color.init(h)),this.triangleCount!==r&&(this.indices=h>65535?new Uint32Array(r*3):new Uint16Array(r*3))},setSpriteAlign:function(s,h,r,e,n){r==null&&(r="left"),e==null&&(e="top");var l,u,_,f;switch(n=n||0,r){case"left":l=n,_=h[0]+n;break;case"center":case"middle":l=-h[0]/2,_=h[0]/2;break;case"right":l=-h[0]-n,_=-n;break}switch(e){case"bottom":u=n,f=h[1]+n;break;case"middle":u=-h[1]/2,f=h[1]/2;break;case"top":u=-h[1]-n,f=-n;break}var d=s*4,v=this.attributes.offset;v.set(d,[l,f]),v.set(d+1,[_,f]),v.set(d+2,[_,u]),v.set(d+3,[l,u])},addSprite:function(s,h,r,e,n,l){var u=this._vertexOffset;this.setSprite(this._vertexOffset/4,s,h,r,e,n,l);for(var _=0;_<o.length;_++)this.indices[this._faceOffset*3+_]=o[_]+u;return this._faceOffset+=2,this._vertexOffset+=4,u/4},setSprite:function(s,h,r,e,n,l,u){for(var _=s*4,f=this.attributes,d=0;d<4;d++)f.position.set(_+d,h);var v=f.texcoord;v.set(_,[e[0][0],e[0][1]]),v.set(_+1,[e[1][0],e[0][1]]),v.set(_+2,[e[1][0],e[1][1]]),v.set(_+3,[e[0][0],e[1][1]]),this.setSpriteAlign(s,r,n,l,u)}});c.a.util.defaults(i.prototype,a.a),R.a=i},function(F,R,g){R.a=`@export ecgl.labels.vertex

attribute vec3 position: POSITION;
attribute vec2 texcoord: TEXCOORD_0;
attribute vec2 offset;
#ifdef VERTEX_COLOR
attribute vec4 a_Color : COLOR;
varying vec4 v_Color;
#endif

uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;
uniform vec4 viewport : VIEWPORT;

varying vec2 v_Texcoord;

void main()
{
 vec4 proj = worldViewProjection * vec4(position, 1.0);

 vec2 screen = (proj.xy / abs(proj.w) + 1.0) * 0.5 * viewport.zw;

 screen += offset;

 proj.xy = (screen / viewport.zw - 0.5) * 2.0 * abs(proj.w);
 gl_Position = proj;
#ifdef VERTEX_COLOR
 v_Color = a_Color;
#endif
 v_Texcoord = texcoord;
}
@end


@export ecgl.labels.fragment

uniform vec3 color : [1.0, 1.0, 1.0];
uniform float alpha : 1.0;
uniform sampler2D textureAtlas;
uniform vec2 uvScale: [1.0, 1.0];

#ifdef VERTEX_COLOR
varying vec4 v_Color;
#endif
varying float v_Miter;

varying vec2 v_Texcoord;

void main()
{
 gl_FragColor = vec4(color, alpha) * texture2D(textureAtlas, v_Texcoord * uvScale);
#ifdef VERTEX_COLOR
 gl_FragColor *= v_Color;
#endif
}

@end`},function(F,R,g){var E=g(167),c=g(169),t=g(0),a=g.n(t),o=g(47),i=g.n(o),s=g(22),h=g(2);function r(l,u){var _=l.getBoxLayoutParams(),f=i.a.getLayoutRect(_,{width:u.getWidth(),height:u.getHeight()});f.y=u.getHeight()-f.y-f.height,this.viewGL.setViewport(f.x,f.y,f.width,f.height,u.getDevicePixelRatio());var d=l.get("boxWidth"),v=l.get("boxHeight"),m=l.get("boxDepth");["x","y","z"].forEach(function(p){if(!this.getAxis(p))throw new Error("Grid"+l.id+" don't have "+p+"Axis")},this),this.getAxis("x").setExtent(-d/2,d/2),this.getAxis("y").setExtent(m/2,-m/2),this.getAxis("z").setExtent(-v/2,v/2),this.size=[d,v,m]}function e(l,u){var _={};function f(d,v){_[d]=_[d]||[Infinity,-Infinity],_[d][0]=Math.min(v[0],_[d][0]),_[d][1]=Math.max(v[1],_[d][1])}l.eachSeries(function(d){if(d.coordinateSystem===this){var v=d.getData();["x","y","z"].forEach(function(m){v.mapDimension(m,!0).forEach(function(p){f(m,v.getDataExtent(p,!0))})})}},this),["xAxis3D","yAxis3D","zAxis3D"].forEach(function(d){l.eachComponent(d,function(v){var m=d.charAt(0),p=v.getReferringComponents("grid3D")[0],y=p.coordinateSystem;if(y===this){var x=y.getAxis(m);if(x){console.warn("Can't have two %s in one grid3D",d);return}var M=a.a.helper.createScale(_[m]||[Infinity,-Infinity],v);x=new c.a(m,M),x.type=v.get("type");var P=x.type==="category";x.onBand=P&&v.get("boundaryGap"),x.inverse=v.get("inverse"),v.axis=x,x.model=v,x.getLabelModel=function(){return v.getModel("axisLabel",p.getModel("axisLabel"))},x.getTickModel=function(){return v.getModel("axisTick",p.getModel("axisTick"))},y.addAxis(x)}},this)},this),this.resize(this.model,u)}var n={dimensions:E.a.prototype.dimensions,create:function(l,u){var _=[];l.eachComponent("grid3D",function(v){v.__viewGL=v.__viewGL||new s.a;var m=new E.a;m.model=v,m.viewGL=v.__viewGL,v.coordinateSystem=m,_.push(m),m.resize=r,m.update=e});var f=["xAxis3D","yAxis3D","zAxis3D"];function d(v,m){return f.map(function(p){var y=v.getReferringComponents(p)[0];if(y==null&&(y=m.getComponent(p)),!y)throw new Error(p+' "'+h.a.firstNotNull(v.get(p+"Index"),v.get(p+"Id"),0)+'" not found');return y})}return l.eachSeries(function(v){if(v.get("coordinateSystem")==="cartesian3D"){var m=v.getReferringComponents("grid3D")[0];if(m==null){var p=d(v,l),m=p[0].getCoordSysModel();p.forEach(function(M){var P=M.getCoordSysModel();{if(!P)throw new Error('grid3D "'+h.a.firstNotNull(M.get("gridIndex"),M.get("gridId"),0)+'" not found');if(P!==m)throw new Error("xAxis3D, yAxis3D, zAxis3D must use the same grid")}})}var y=m.coordinateSystem;v.coordinateSystem=y}}),_}};a.a.registerCoordinateSystem("grid3D",n)},function(F,R,g){var E=g(0),c=g.n(E),t=g(168),a=g.n(t);function o(i){a.a.call(this,i),this.size=[0,0,0]}o.prototype={constructor:o,type:"cartesian3D",dimensions:["x","y","z"],model:null,containPoint:function(i){return this.getAxis("x").contain(i[0])&&this.getAxis("y").contain(i[2])&&this.getAxis("z").contain(i[1])},containData:function(i){return this.getAxis("x").containData(i[0])&&this.getAxis("y").containData(i[1])&&this.getAxis("z").containData(i[2])},dataToPoint:function(i,s,h){return s=s||[],s[0]=this.getAxis("x").dataToCoord(i[0],h),s[2]=this.getAxis("y").dataToCoord(i[1],h),s[1]=this.getAxis("z").dataToCoord(i[2],h),s},pointToData:function(i,s,h){return s=s||[],s[0]=this.getAxis("x").coordToData(i[0],h),s[1]=this.getAxis("y").coordToData(i[2],h),s[2]=this.getAxis("z").coordToData(i[1],h),s}},c.a.util.inherits(o,a.a),R.a=o},function(F,R,g){var E=g(16);function c(o){return this._axes[o]}var t=function(o){this._axes={},this._dimList=[],this.name=o||""};t.prototype={constructor:t,type:"cartesian",getAxis:function(o){return this._axes[o]},getAxes:function(){return E.map(this._dimList,c,this)},getAxesByScale:function(o){return o=o.toLowerCase(),E.filter(this.getAxes(),function(i){return i.scale.type===o})},addAxis:function(o){var i=o.dim;this._axes[i]=o,this._dimList.push(i)},dataToCoord:function(o){return this._dataCoordConvert(o,"dataToCoord")},coordToData:function(o){return this._dataCoordConvert(o,"coordToData")},_dataCoordConvert:function(o,i){for(var s=this._dimList,h=o instanceof Array?[]:{},r=0;r<s.length;r++){var e=s[r],n=this._axes[e];h[e]=n[i](o[e])}return h}};var a=t;F.exports=a},function(F,R,g){var E=g(0),c=g.n(E);function t(a,o,i){c.a.Axis.call(this,a,o,i)}t.prototype={constructor:t,getExtentMin:function(){var a=this._extent;return Math.min(a[0],a[1])},getExtentMax:function(){var a=this._extent;return Math.max(a[0],a[1])},calculateCategoryInterval:function(){return Math.floor(this.scale.count()/8)}},c.a.util.inherits(t,c.a.Axis),R.a=t},function(F,R){var g=typeof Float32Array=="undefined"?Array:Float32Array;function E(D,A){var C=new g(2);return D==null&&(D=0),A==null&&(A=0),C[0]=D,C[1]=A,C}function c(D,A){return D[0]=A[0],D[1]=A[1],D}function t(D){var A=new g(2);return A[0]=D[0],A[1]=D[1],A}function a(D,A,C){return D[0]=A,D[1]=C,D}function o(D,A,C){return D[0]=A[0]+C[0],D[1]=A[1]+C[1],D}function i(D,A,C,S){return D[0]=A[0]+C[0]*S,D[1]=A[1]+C[1]*S,D}function s(D,A,C){return D[0]=A[0]-C[0],D[1]=A[1]-C[1],D}function h(D){return Math.sqrt(e(D))}var r=h;function e(D){return D[0]*D[0]+D[1]*D[1]}var n=e;function l(D,A,C){return D[0]=A[0]*C[0],D[1]=A[1]*C[1],D}function u(D,A,C){return D[0]=A[0]/C[0],D[1]=A[1]/C[1],D}function _(D,A){return D[0]*A[0]+D[1]*A[1]}function f(D,A,C){return D[0]=A[0]*C,D[1]=A[1]*C,D}function d(D,A){var C=h(A);return C===0?(D[0]=0,D[1]=0):(D[0]=A[0]/C,D[1]=A[1]/C),D}function v(D,A){return Math.sqrt((D[0]-A[0])*(D[0]-A[0])+(D[1]-A[1])*(D[1]-A[1]))}var m=v;function p(D,A){return(D[0]-A[0])*(D[0]-A[0])+(D[1]-A[1])*(D[1]-A[1])}var y=p;function x(D,A){return D[0]=-A[0],D[1]=-A[1],D}function M(D,A,C,S){return D[0]=A[0]+S*(C[0]-A[0]),D[1]=A[1]+S*(C[1]-A[1]),D}function P(D,A,C){var S=A[0],L=A[1];return D[0]=C[0]*S+C[2]*L+C[4],D[1]=C[1]*S+C[3]*L+C[5],D}function T(D,A,C){return D[0]=Math.min(A[0],C[0]),D[1]=Math.min(A[1],C[1]),D}function O(D,A,C){return D[0]=Math.max(A[0],C[0]),D[1]=Math.max(A[1],C[1]),D}R.create=E,R.copy=c,R.clone=t,R.set=a,R.add=o,R.scaleAndAdd=i,R.sub=s,R.len=h,R.length=r,R.lenSquare=e,R.lengthSquare=n,R.mul=l,R.div=u,R.dot=_,R.scale=f,R.normalize=d,R.distance=v,R.dist=m,R.distanceSquare=p,R.distSquare=y,R.negate=x,R.lerp=M,R.applyTransform=P,R.min=T,R.max=O},function(F,R){var g=typeof Float32Array=="undefined"?Array:Float32Array;function E(){var e=new g(6);return c(e),e}function c(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function t(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e}function a(e,n,l){var u=n[0]*l[0]+n[2]*l[1],_=n[1]*l[0]+n[3]*l[1],f=n[0]*l[2]+n[2]*l[3],d=n[1]*l[2]+n[3]*l[3],v=n[0]*l[4]+n[2]*l[5]+n[4],m=n[1]*l[4]+n[3]*l[5]+n[5];return e[0]=u,e[1]=_,e[2]=f,e[3]=d,e[4]=v,e[5]=m,e}function o(e,n,l){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4]+l[0],e[5]=n[5]+l[1],e}function i(e,n,l){var u=n[0],_=n[2],f=n[4],d=n[1],v=n[3],m=n[5],p=Math.sin(l),y=Math.cos(l);return e[0]=u*y+d*p,e[1]=-u*p+d*y,e[2]=_*y+v*p,e[3]=-_*p+y*v,e[4]=y*f+p*m,e[5]=y*m-p*f,e}function s(e,n,l){var u=l[0],_=l[1];return e[0]=n[0]*u,e[1]=n[1]*_,e[2]=n[2]*u,e[3]=n[3]*_,e[4]=n[4]*u,e[5]=n[5]*_,e}function h(e,n){var l=n[0],u=n[2],_=n[4],f=n[1],d=n[3],v=n[5],m=l*d-f*u;return m?(m=1/m,e[0]=d*m,e[1]=-f*m,e[2]=-u*m,e[3]=l*m,e[4]=(u*v-d*_)*m,e[5]=(f*_-l*v)*m,e):null}function r(e){var n=E();return t(n,e),n}R.create=E,R.identity=c,R.copy=t,R.mul=a,R.translate=o,R.rotate=i,R.scale=s,R.invert=h,R.clone=r},function(F,R,g){var E=g(16),c=g(173),t=g(84);function a(x){return isNaN(x)?"-":(x=(x+"").split("."),x[0].replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g,"$1,")+(x.length>1?"."+x[1]:""))}function o(x,M){return x=(x||"").toLowerCase().replace(/-(.)/g,function(P,T){return T.toUpperCase()}),M&&x&&(x=x.charAt(0).toUpperCase()+x.slice(1)),x}var i=E.normalizeCssArray,s=/([&<>"'])/g,h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function r(x){return x==null?"":(x+"").replace(s,function(M,P){return h[P]})}var e=["a","b","c","d","e","f","g"],n=function(x,M){return"{"+x+(M==null?"":M)+"}"};function l(x,M,P){E.isArray(M)||(M=[M]);var T=M.length;if(!T)return"";for(var O=M[0].$vars||[],D=0;D<O.length;D++){var A=e[D];x=x.replace(n(A),n(A,0))}for(var C=0;C<T;C++)for(var S=0;S<O.length;S++){var L=M[C][O[S]];x=x.replace(n(e[S],C),P?r(L):L)}return x}function u(x,M,P){return E.each(M,function(T,O){x=x.replace("{"+O+"}",P?r(T):T)}),x}function _(x,M){x=E.isString(x)?{color:x,extraCssText:M}:x||{};var P=x.color,T=x.type,M=x.extraCssText,O=x.renderMode||"html",D=x.markerId||"X";return P?O==="html"?T==="subItem"?'<span style="display:inline-block;vertical-align:middle;margin-right:8px;margin-left:3px;border-radius:4px;width:4px;height:4px;background-color:'+r(P)+";"+(M||"")+'"></span>':'<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:'+r(P)+";"+(M||"")+'"></span>':{renderMode:O,content:"{marker"+D+"|}  ",style:{color:P}}:""}function f(x,M){return x+="","0000".substr(0,M-x.length)+x}function d(x,M,P){(x==="week"||x==="month"||x==="quarter"||x==="half-year"||x==="year")&&(x=`MM-dd
yyyy`);var T=t.parseDate(M),O=P?"UTC":"",D=T["get"+O+"FullYear"](),A=T["get"+O+"Month"]()+1,C=T["get"+O+"Date"](),S=T["get"+O+"Hours"](),L=T["get"+O+"Minutes"](),I=T["get"+O+"Seconds"](),w=T["get"+O+"Milliseconds"]();return x=x.replace("MM",f(A,2)).replace("M",A).replace("yyyy",D).replace("yy",D%100).replace("dd",f(C,2)).replace("d",C).replace("hh",f(S,2)).replace("h",S).replace("mm",f(L,2)).replace("m",L).replace("ss",f(I,2)).replace("s",I).replace("SSS",f(w,3)),x}function v(x){return x&&x.charAt(0).toUpperCase()+x.substr(1)}var m=c.truncateText;function p(x){return c.getBoundingRect(x.text,x.font,x.textAlign,x.textVerticalAlign,x.textPadding,x.textLineHeight,x.rich,x.truncate)}function y(x,M,P,T,O,D,A,C){return c.getBoundingRect(x,M,P,T,O,C,D,A)}R.addCommas=a,R.toCamelCase=o,R.normalizeCssArray=i,R.encodeHTML=r,R.formatTpl=l,R.formatTplSimple=u,R.getTooltipMarker=_,R.formatTime=d,R.capitalFirst=v,R.truncateText=m,R.getTextBoundingRect=p,R.getTextRect=y},function(F,R,g){var E=g(83),c=g(174),t=g(16),a=t.getContext,o=t.extend,i=t.retrieve2,s=t.retrieve3,h=t.trim,r={},e=0,n=5e3,l=/\{([a-zA-Z0-9_]+)\|([^}]*)\}/g,u="12px sans-serif",_={};function f(B,U){_[B]=U}function d(B,U){U=U||u;var W=B+":"+U;if(r[W])return r[W];for(var z=(B+"").split(`
`),G=0,H=0,X=z.length;H<X;H++)G=Math.max(S(z[H],U).width,G);return e>n&&(e=0,r={}),e++,r[W]=G,G}function v(B,U,W,z,G,H,X,Q){return X?p(B,U,W,z,G,H,X,Q):m(B,U,W,z,G,H,Q)}function m(B,U,W,z,G,H,X){var Q=L(B,U,G,H,X),j=d(B,U);G&&(j+=G[1]+G[3]);var J=Q.outerHeight,Y=y(0,j,W),at=x(0,J,z),ot=new E(Y,at,j,J);return ot.lineHeight=Q.lineHeight,ot}function p(B,U,W,z,G,H,X,Q){var j=I(B,{rich:X,truncate:Q,font:U,textAlign:W,textPadding:G,textLineHeight:H}),J=j.outerWidth,Y=j.outerHeight,at=y(0,J,W),ot=x(0,Y,z);return new E(at,ot,J,Y)}function y(B,U,W){return W==="right"?B-=U:W==="center"&&(B-=U/2),B}function x(B,U,W){return W==="middle"?B-=U/2:W==="bottom"&&(B-=U),B}function M(B,U,W){var z=U.textPosition,G=U.textDistance,H=W.x,X=W.y,Q=W.height,j=W.width,J=Q/2,Y="left",at="top";switch(z){case"left":H-=G,X+=J,Y="right",at="middle";break;case"right":H+=G+j,X+=J,at="middle";break;case"top":H+=j/2,X-=G,Y="center",at="bottom";break;case"bottom":H+=j/2,X+=Q+G,Y="center";break;case"inside":H+=j/2,X+=J,Y="center",at="middle";break;case"insideLeft":H+=G,X+=J,at="middle";break;case"insideRight":H+=j-G,X+=J,Y="right",at="middle";break;case"insideTop":H+=j/2,X+=G,Y="center";break;case"insideBottom":H+=j/2,X+=Q-G,Y="center",at="bottom";break;case"insideTopLeft":H+=G,X+=G;break;case"insideTopRight":H+=j-G,X+=G,Y="right";break;case"insideBottomLeft":H+=G,X+=Q-G,at="bottom";break;case"insideBottomRight":H+=j-G,X+=Q-G,Y="right",at="bottom";break}return B=B||{},B.x=H,B.y=X,B.textAlign=Y,B.textVerticalAlign=at,B}function P(B,U,W){var z={textPosition:B,textDistance:W};return M({},z,U)}function T(B,U,W,z,G){if(!U)return"";var H=(B+"").split(`
`);G=O(U,W,z,G);for(var X=0,Q=H.length;X<Q;X++)H[X]=D(H[X],G);return H.join(`
`)}function O(B,U,W,z){z=o({},z),z.font=U;var W=i(W,"...");z.maxIterations=i(z.maxIterations,2);var G=z.minChar=i(z.minChar,0);z.cnCharWidth=d("\u56FD",U);var H=z.ascCharWidth=d("a",U);z.placeholder=i(z.placeholder,"");for(var X=B=Math.max(0,B-1),Q=0;Q<G&&X>=H;Q++)X-=H;var j=d(W,U);return j>X&&(W="",j=0),X=B-j,z.ellipsis=W,z.ellipsisWidth=j,z.contentWidth=X,z.containerWidth=B,z}function D(B,U){var W=U.containerWidth,z=U.font,G=U.contentWidth;if(!W)return"";var H=d(B,z);if(H<=W)return B;for(var X=0;;X++){if(H<=G||X>=U.maxIterations){B+=U.ellipsis;break}var Q=X===0?A(B,G,U.ascCharWidth,U.cnCharWidth):H>0?Math.floor(B.length*G/H):0;B=B.substr(0,Q),H=d(B,z)}return B===""&&(B=U.placeholder),B}function A(B,U,W,z){for(var G=0,H=0,X=B.length;H<X&&G<U;H++){var Q=B.charCodeAt(H);G+=0<=Q&&Q<=127?W:z}return H}function C(B){return d("\u56FD",B)}function S(B,U){return _.measureText(B,U)}_.measureText=function(B,U){var W=a();return W.font=U||u,W.measureText(B)};function L(B,U,W,z,G){B!=null&&(B+="");var H=i(z,C(U)),X=B?B.split(`
`):[],Q=X.length*H,j=Q;if(W&&(j+=W[0]+W[2]),B&&G){var J=G.outerHeight,Y=G.outerWidth;if(J!=null&&j>J)B="",X=[];else if(Y!=null)for(var at=O(Y-(W?W[1]+W[3]:0),U,G.ellipsis,{minChar:G.minChar,placeholder:G.placeholder}),ot=0,ut=X.length;ot<ut;ot++)X[ot]=D(X[ot],at)}return{lines:X,height:Q,outerHeight:j,lineHeight:H}}function I(B,U){var W={lines:[],width:0,height:0};if(B!=null&&(B+=""),!B)return W;for(var z=l.lastIndex=0,G;(G=l.exec(B))!=null;){var H=G.index;H>z&&w(W,B.substring(z,H)),w(W,G[2],G[1]),z=l.lastIndex}z<B.length&&w(W,B.substring(z,B.length));var X=W.lines,Q=0,j=0,J=[],Y=U.textPadding,at=U.truncate,ot=at&&at.outerWidth,ut=at&&at.outerHeight;Y&&(ot!=null&&(ot-=Y[1]+Y[3]),ut!=null&&(ut-=Y[0]+Y[2]));for(var et=0;et<X.length;et++){for(var ht=X[et],ft=0,it=0,N=0;N<ht.tokens.length;N++){var K=ht.tokens[N],Z=K.styleName&&U.rich[K.styleName]||{},V=K.textPadding=Z.textPadding,k=K.font=Z.font||U.font,rt=K.textHeight=i(Z.textHeight,C(k));if(V&&(rt+=V[0]+V[2]),K.height=rt,K.lineHeight=s(Z.textLineHeight,U.textLineHeight,rt),K.textAlign=Z&&Z.textAlign||U.textAlign,K.textVerticalAlign=Z&&Z.textVerticalAlign||"middle",ut!=null&&Q+K.lineHeight>ut)return{lines:[],width:0,height:0};K.textWidth=d(K.text,k);var nt=Z.textWidth,q=nt==null||nt==="auto";if(typeof nt=="string"&&nt.charAt(nt.length-1)==="%")K.percentWidth=nt,J.push(K),nt=0;else{if(q){nt=K.textWidth;var tt=Z.textBackgroundColor,st=tt&&tt.image;st&&(st=c.findExistImage(st),c.isImageReady(st)&&(nt=Math.max(nt,st.width*rt/st.height)))}var lt=V?V[1]+V[3]:0;nt+=lt;var _t=ot!=null?ot-it:null;_t!=null&&_t<nt&&(!q||_t<lt?(K.text="",K.textWidth=nt=0):(K.text=T(K.text,_t-lt,k,at.ellipsis,{minChar:at.minChar}),K.textWidth=d(K.text,k),nt=K.textWidth+lt))}it+=K.width=nt,Z&&(ft=Math.max(ft,K.lineHeight))}ht.width=it,ht.lineHeight=ft,Q+=ft,j=Math.max(j,it)}W.outerWidth=W.width=i(U.textWidth,j),W.outerHeight=W.height=i(U.textHeight,Q),Y&&(W.outerWidth+=Y[1]+Y[3],W.outerHeight+=Y[0]+Y[2]);for(var et=0;et<J.length;et++){var K=J[et],vt=K.percentWidth;K.width=parseInt(vt,10)/100*j}return W}function w(B,U,W){for(var z=U==="",G=U.split(`
`),H=B.lines,X=0;X<G.length;X++){var Q=G[X],j={styleName:W,text:Q,isLineHolder:!Q&&!z};if(X)H.push({tokens:[j]});else{var J=(H[H.length-1]||(H[0]={tokens:[]})).tokens,Y=J.length;Y===1&&J[0].isLineHolder?J[0]=j:(Q||!Y||z)&&J.push(j)}}}function b(B){var U=(B.fontSize||B.fontFamily)&&[B.fontStyle,B.fontWeight,(B.fontSize||12)+"px",B.fontFamily||"sans-serif"].join(" ");return U&&h(U)||B.textFont||B.font}R.DEFAULT_FONT=u,R.$override=f,R.getWidth=d,R.getBoundingRect=v,R.adjustTextX=y,R.adjustTextY=x,R.calculateTextPosition=M,R.adjustTextPositionOnRect=P,R.truncateText=T,R.getLineHeight=C,R.measureText=S,R.parsePlainText=L,R.parseRichText=I,R.makeFont=b},function(F,R,g){var E=g(175),c=new E(50);function t(s){if(typeof s=="string"){var h=c.get(s);return h&&h.image}else return s}function a(s,h,r,e,n){if(s)if(typeof s=="string"){if(h&&h.__zrImageSrc===s||!r)return h;var l=c.get(s),u={hostEl:r,cb:e,cbPayload:n};return l?(h=l.image,!i(h)&&l.pending.push(u)):(h=new Image,h.onload=h.onerror=o,c.put(s,h.__cachedImgObj={image:h,pending:[u]}),h.src=h.__zrImageSrc=s),h}else return s;else return h}function o(){var s=this.__cachedImgObj;this.onload=this.onerror=this.__cachedImgObj=null;for(var h=0;h<s.pending.length;h++){var r=s.pending[h],e=r.cb;e&&e(this,r.cbPayload),r.hostEl.dirty()}s.pending.length=0}function i(s){return s&&s.width&&s.height}R.findExistImage=t,R.createOrUpdateImage=a,R.isImageReady=i},function(F,R){var g=function(){this.head=null,this.tail=null,this._len=0},E=g.prototype;E.insert=function(i){var s=new c(i);return this.insertEntry(s),s},E.insertEntry=function(i){this.head?(this.tail.next=i,i.prev=this.tail,i.next=null,this.tail=i):this.head=this.tail=i,this._len++},E.remove=function(i){var s=i.prev,h=i.next;s?s.next=h:this.head=h,h?h.prev=s:this.tail=s,i.next=i.prev=null,this._len--},E.len=function(){return this._len},E.clear=function(){this.head=this.tail=null,this._len=0};var c=function(i){this.value=i,this.next,this.prev},t=function(i){this._list=new g,this._map={},this._maxSize=i||10,this._lastRemovedEntry=null},a=t.prototype;a.put=function(i,s){var h=this._list,r=this._map,e=null;if(r[i]==null){var n=h.len(),l=this._lastRemovedEntry;if(n>=this._maxSize&&n>0){var u=h.head;h.remove(u),delete r[u.key],e=u.value,this._lastRemovedEntry=u}l?l.value=s:l=new c(s),l.key=i,h.insertEntry(l),r[i]=l}return e},a.get=function(i){var s=this._map[i],h=this._list;if(s!=null)return s!==h.tail&&(h.remove(s),h.insertEntry(s)),s.value},a.clear=function(){this._list.clear(),this._map={}};var o=t;F.exports=o},function(F,R,g){var E=g(8),c=g(11),t=g(3),a=g(18),o=g(59),i=g(7),s=g(52),h=g(9),r=g(19),e=g(10),n=g(4),l=g(5),u=g(27),_=g(37),f=g(38),d=g(15),v=g(85),m=g(21),p=g(177),y=["px","nx","py","ny","pz","nz"];h.a.import(p.a);function x(T,O,D){if(D==="alphaMap")return T.material.get("diffuseMap");if(D==="alphaCutoff"){if(T.material.isDefined("fragment","ALPHA_TEST")&&T.material.get("diffuseMap")){var A=T.material.get("alphaCutoff");return A||0}return 0}else return D==="uvRepeat"?T.material.get("uvRepeat"):D==="uvOffset"?T.material.get("uvOffset"):O.get(D)}function M(T,O){var D=T.material,A=O.material;return D.get("diffuseMap")!==A.get("diffuseMap")||(D.get("alphaCutoff")||0)!==(A.get("alphaCutoff")||0)}var P=E.a.extend(function(){return{softShadow:P.PCF,shadowBlur:1,lightFrustumBias:"auto",kernelPCF:new Float32Array([1,0,1,1,-1,1,0,1,-1,0,-1,-1,1,-1,0,-1]),precision:"highp",_lastRenderNotCastShadow:!1,_frameBuffer:new e.a,_textures:{},_shadowMapNumber:{POINT_LIGHT:0,DIRECTIONAL_LIGHT:0,SPOT_LIGHT:0},_depthMaterials:{},_distanceMaterials:{},_receivers:[],_lightsCastShadow:[],_lightCameras:{},_lightMaterials:{},_texturePool:new v.a}},function(){this._gaussianPassH=new d.a({fragment:h.a.source("clay.compositor.gaussian_blur")}),this._gaussianPassV=new d.a({fragment:h.a.source("clay.compositor.gaussian_blur")}),this._gaussianPassH.setUniform("blurSize",this.shadowBlur),this._gaussianPassH.setUniform("blurDir",0),this._gaussianPassV.setUniform("blurSize",this.shadowBlur),this._gaussianPassV.setUniform("blurDir",1),this._outputDepthPass=new d.a({fragment:h.a.source("clay.sm.debug_depth")})},{render:function(T,O,D,A){D||(D=O.getMainCamera()),this.trigger("beforerender",this,T,O,D),this._renderShadowPass(T,O,D,A),this.trigger("afterrender",this,T,O,D)},renderDebug:function(T,O){T.saveClear();var D=T.viewport,A=0,C=0,S=O||D.width/4,L=S;this.softShadow===P.VSM?this._outputDepthPass.material.define("fragment","USE_VSM"):this._outputDepthPass.material.undefine("fragment","USE_VSM");for(var I in this._textures){var w=this._textures[I];T.setViewport(A,C,S*w.width/w.height,L),this._outputDepthPass.setUniform("depthMap",w),this._outputDepthPass.render(T),A+=S*w.width/w.height}T.setViewport(D),T.restoreClear()},_updateReceivers:function(T,O){if(O.receiveShadow?(this._receivers.push(O),O.material.set("shadowEnabled",1),O.material.set("pcfKernel",this.kernelPCF)):O.material.set("shadowEnabled",0),this.softShadow===P.VSM)O.material.define("fragment","USE_VSM"),O.material.undefine("fragment","PCF_KERNEL_SIZE");else{O.material.undefine("fragment","USE_VSM");var D=this.kernelPCF;D&&D.length?O.material.define("fragment","PCF_KERNEL_SIZE",D.length/2):O.material.undefine("fragment","PCF_KERNEL_SIZE")}},_update:function(T,O){var D=this;O.traverse(function(S){S.isRenderable()&&D._updateReceivers(T,S)});for(var A=0;A<O.lights.length;A++){var C=O.lights[A];C.castShadow&&!C.invisible&&this._lightsCastShadow.push(C)}},_renderShadowPass:function(T,O,D,A){for(var C in this._shadowMapNumber)this._shadowMapNumber[C]=0;this._lightsCastShadow.length=0,this._receivers.length=0;var S=T.gl;if(A||O.update(),D&&D.update(),O.updateLights(),this._update(T,O),!this._lightsCastShadow.length&&this._lastRenderNotCastShadow)return;this._lastRenderNotCastShadow=this._lightsCastShadow===0,S.enable(S.DEPTH_TEST),S.depthMask(!0),S.disable(S.BLEND),S.clearColor(1,1,1,1);for(var L=[],I=[],w=[],b=[],B=[],U=[],W,z=0;z<this._lightsCastShadow.length;z++){var G=this._lightsCastShadow[z];if(G.type==="DIRECTIONAL_LIGHT"){if(W){console.warn("Only one direectional light supported with shadow cascade");continue}if(G.shadowCascade>4){console.warn("Support at most 4 cascade");continue}G.shadowCascade>1&&(W=G),this.renderDirectionalLightShadow(T,O,D,G,B,b,w)}else G.type==="SPOT_LIGHT"?this.renderSpotLightShadow(T,O,G,I,L):G.type==="POINT_LIGHT"&&this.renderPointLightShadow(T,O,G,U);this._shadowMapNumber[G.type]++}for(var H in this._shadowMapNumber)for(var X=this._shadowMapNumber[H],Q=H+"_SHADOWMAP_COUNT",z=0;z<this._receivers.length;z++){var j=this._receivers[z],J=j.material;J.fragmentDefines[Q]!==X&&(X>0?J.define("fragment",Q,X):J.isDefined("fragment",Q)&&J.undefine("fragment",Q))}for(var z=0;z<this._receivers.length;z++){var j=this._receivers[z],J=j.material;W?J.define("fragment","SHADOW_CASCADE",W.shadowCascade):J.undefine("fragment","SHADOW_CASCADE")}var Y=O.shadowUniforms;function at(ft){return ft.height}if(w.length>0){var ot=w.map(at);if(Y.directionalLightShadowMaps={value:w,type:"tv"},Y.directionalLightMatrices={value:b,type:"m4v"},Y.directionalLightShadowMapSizes={value:ot,type:"1fv"},W){var ut=B.slice(),et=B.slice();ut.pop(),et.shift(),ut.reverse(),et.reverse(),b.reverse(),Y.shadowCascadeClipsNear={value:ut,type:"1fv"},Y.shadowCascadeClipsFar={value:et,type:"1fv"}}}if(L.length>0){var ht=L.map(at),Y=O.shadowUniforms;Y.spotLightShadowMaps={value:L,type:"tv"},Y.spotLightMatrices={value:I,type:"m4v"},Y.spotLightShadowMapSizes={value:ht,type:"1fv"}}U.length>0&&(Y.pointLightShadowMaps={value:U,type:"tv"})},renderDirectionalLightShadow:function(){var T=new o.a,O=new i.a,D=new a.a,A=new i.a,C=new i.a,S=new i.a,L=new i.a;return function(I,w,b,B,U,W,z){var G=this._getDepthMaterial(B),H={getMaterial:function(_t){return _t.shadowDepthMaterial||G},isMaterialChanged:M,getUniform:x,ifRender:function(_t){return _t.castShadow},sortCompare:s.a.opaqueSortCompare};if(!w.viewBoundingBoxLastFrame.isFinite()){var X=w.getBoundingBox();w.viewBoundingBoxLastFrame.copy(X).applyTransform(b.viewMatrix)}var Q=Math.min(-w.viewBoundingBoxLastFrame.min.z,b.far),j=Math.max(-w.viewBoundingBoxLastFrame.max.z,b.near),J=this._getDirectionalLightCamera(B,w,b),Y=S.array;L.copy(J.projectionMatrix),m.a.invert(C.array,J.worldTransform.array),m.a.multiply(C.array,C.array,b.worldTransform.array),m.a.multiply(Y,L.array,C.array);for(var at=[],ot=b instanceof _.a,ut=(b.near+b.far)/(b.near-b.far),et=2*b.near*b.far/(b.near-b.far),ht=0;ht<=B.shadowCascade;ht++){var ft=j*Math.pow(Q/j,ht/B.shadowCascade),it=j+(Q-j)*ht/B.shadowCascade,N=ft*B.cascadeSplitLogFactor+it*(1-B.cascadeSplitLogFactor);at.push(N),U.push(-(-N*ut+et)/-N)}var K=this._getTexture(B,B.shadowCascade);z.push(K);var Z=I.viewport,V=I.gl;this._frameBuffer.attach(K),this._frameBuffer.bind(I),V.clear(V.COLOR_BUFFER_BIT|V.DEPTH_BUFFER_BIT);for(var ht=0;ht<B.shadowCascade;ht++){var k=at[ht],rt=at[ht+1];ot?m.a.perspective(O.array,b.fov/180*Math.PI,b.aspect,k,rt):m.a.ortho(O.array,b.left,b.right,b.bottom,b.top,k,rt),T.setFromProjection(O),T.getTransformedBoundingBox(D,C),D.applyProjection(L);var nt=D.min.array,q=D.max.array;nt[0]=Math.max(nt[0],-1),nt[1]=Math.max(nt[1],-1),q[0]=Math.min(q[0],1),q[1]=Math.min(q[1],1),A.ortho(nt[0],q[0],nt[1],q[1],1,-1),J.projectionMatrix.multiplyLeft(A);var tt=B.shadowResolution||512;I.setViewport((B.shadowCascade-ht-1)*tt,0,tt,tt,1);var st=w.updateRenderList(J);I.renderPass(st.opaque,J,H),this.softShadow===P.VSM&&this._gaussianFilter(I,K,K.width);var lt=new i.a;lt.copy(J.viewMatrix).multiplyLeft(J.projectionMatrix),W.push(lt.array),J.projectionMatrix.copy(L)}this._frameBuffer.unbind(I),I.setViewport(Z)}}(),renderSpotLightShadow:function(T,O,D,A,C){var S=this._getTexture(D),L=this._getSpotLightCamera(D),I=T.gl;this._frameBuffer.attach(S),this._frameBuffer.bind(T),I.clear(I.COLOR_BUFFER_BIT|I.DEPTH_BUFFER_BIT);var w=this._getDepthMaterial(D),b={getMaterial:function(W){return W.shadowDepthMaterial||w},isMaterialChanged:M,getUniform:x,ifRender:function(W){return W.castShadow},sortCompare:s.a.opaqueSortCompare},B=O.updateRenderList(L);T.renderPass(B.opaque,L,b),this._frameBuffer.unbind(T),this.softShadow===P.VSM&&this._gaussianFilter(T,S,S.width);var U=new i.a;U.copy(L.worldTransform).invert().multiplyLeft(L.projectionMatrix),C.push(S),A.push(U.array)},renderPointLightShadow:function(T,O,D,A){var C=this._getTexture(D),S=T.gl;A.push(C);var L=this._getDepthMaterial(D),I={getMaterial:function(j){return j.shadowDepthMaterial||L},getUniform:x,sortCompare:s.a.opaqueSortCompare},w={px:[],py:[],pz:[],nx:[],ny:[],nz:[]},b=new a.a,B=D.getWorldPosition().array,U=new a.a,W=D.range;U.min.setArray(B),U.max.setArray(B);var z=new t.a(W,W,W);U.max.add(z),U.min.sub(z);var G={px:!1,py:!1,pz:!1,nx:!1,ny:!1,nz:!1};O.traverse(function(j){if(j.isRenderable()&&j.castShadow){var J=j.geometry;if(!J.boundingBox){for(var Y=0;Y<y.length;Y++)w[y[Y]].push(j);return}if(b.transformFrom(J.boundingBox,j.worldTransform),!b.intersectBoundingBox(U))return;b.updateVertices();for(var Y=0;Y<y.length;Y++)G[y[Y]]=!1;for(var Y=0;Y<8;Y++){var at=b.vertices[Y],ot=at[0]-B[0],ut=at[1]-B[1],et=at[2]-B[2],ht=Math.abs(ot),ft=Math.abs(ut),it=Math.abs(et);ht>ft?ht>it?G[ot>0?"px":"nx"]=!0:G[et>0?"pz":"nz"]=!0:ft>it?G[ut>0?"py":"ny"]=!0:G[et>0?"pz":"nz"]=!0}for(var Y=0;Y<y.length;Y++)G[y[Y]]&&w[y[Y]].push(j)}});for(var H=0;H<6;H++){var X=y[H],Q=this._getPointLightCamera(D,X);this._frameBuffer.attach(C,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+H),this._frameBuffer.bind(T),S.clear(S.COLOR_BUFFER_BIT|S.DEPTH_BUFFER_BIT),T.renderPass(w[X],Q,I)}this._frameBuffer.unbind(T)},_getDepthMaterial:function(T){var O=this._lightMaterials[T.__uid__],D=T.type==="POINT_LIGHT";if(!O){var A=D?"clay.sm.distance.":"clay.sm.depth.";O=new r.a({precision:this.precision,shader:new h.a(h.a.source(A+"vertex"),h.a.source(A+"fragment"))}),this._lightMaterials[T.__uid__]=O}return T.shadowSlopeScale!=null&&O.setUniform("slopeScale",T.shadowSlopeScale),T.shadowBias!=null&&O.setUniform("bias",T.shadowBias),this.softShadow===P.VSM?O.define("fragment","USE_VSM"):O.undefine("fragment","USE_VSM"),D&&(O.set("lightPosition",T.getWorldPosition().array),O.set("range",T.range)),O},_gaussianFilter:function(T,O,D){var A={width:D,height:D,type:n.a.FLOAT},C=this._texturePool.get(A);this._frameBuffer.attach(C),this._frameBuffer.bind(T),this._gaussianPassH.setUniform("texture",O),this._gaussianPassH.setUniform("textureWidth",D),this._gaussianPassH.render(T),this._frameBuffer.attach(O),this._gaussianPassV.setUniform("texture",C),this._gaussianPassV.setUniform("textureHeight",D),this._gaussianPassV.render(T),this._frameBuffer.unbind(T),this._texturePool.put(C)},_getTexture:function(T,O){var D=T.__uid__,A=this._textures[D],C=T.shadowResolution||512;return O=O||1,A||(T.type==="POINT_LIGHT"?A=new u.a:A=new l.a,A.width=C*O,A.height=C,this.softShadow===P.VSM?(A.type=n.a.FLOAT,A.anisotropic=4):(A.minFilter=c.a.NEAREST,A.magFilter=c.a.NEAREST,A.useMipmap=!1),this._textures[D]=A),A},_getPointLightCamera:function(T,O){this._lightCameras.point||(this._lightCameras.point={px:new _.a,nx:new _.a,py:new _.a,ny:new _.a,pz:new _.a,nz:new _.a});var D=this._lightCameras.point[O];switch(D.far=T.range,D.fov=90,D.position.set(0,0,0),O){case"px":D.lookAt(t.a.POSITIVE_X,t.a.NEGATIVE_Y);break;case"nx":D.lookAt(t.a.NEGATIVE_X,t.a.NEGATIVE_Y);break;case"py":D.lookAt(t.a.POSITIVE_Y,t.a.POSITIVE_Z);break;case"ny":D.lookAt(t.a.NEGATIVE_Y,t.a.NEGATIVE_Z);break;case"pz":D.lookAt(t.a.POSITIVE_Z,t.a.NEGATIVE_Y);break;case"nz":D.lookAt(t.a.NEGATIVE_Z,t.a.NEGATIVE_Y);break}return T.getWorldPosition(D.position),D.update(),D},_getDirectionalLightCamera:function(){var T=new i.a,O=new a.a,D=new a.a;return function(A,C,S){this._lightCameras.directional||(this._lightCameras.directional=new f.a);var L=this._lightCameras.directional;O.copy(C.viewBoundingBoxLastFrame),O.intersection(S.frustum.boundingBox),L.position.copy(O.min).add(O.max).scale(.5).transformMat4(S.worldTransform),L.rotation.copy(A.rotation),L.scale.copy(A.scale),L.updateWorldTransform(),i.a.invert(T,L.worldTransform),i.a.multiply(T,T,S.worldTransform),D.copy(O).applyTransform(T);var I=D.min.array,w=D.max.array;return L.position.set((I[0]+w[0])/2,(I[1]+w[1])/2,w[2]).transformMat4(L.worldTransform),L.near=0,L.far=-I[2]+w[2],isNaN(this.lightFrustumBias)?L.far*=4:L.far+=this.lightFrustumBias,L.left=I[0],L.right=w[0],L.top=w[1],L.bottom=I[1],L.update(!0),L}}(),_getSpotLightCamera:function(T){this._lightCameras.spot||(this._lightCameras.spot=new _.a);var O=this._lightCameras.spot;return O.fov=T.penumbraAngle*2,O.far=T.range,O.worldTransform.copy(T.worldTransform),O.updateProjectionMatrix(),m.a.invert(O.viewMatrix.array,O.worldTransform.array),O},dispose:function(T){var O=T.gl||T;this._frameBuffer&&this._frameBuffer.dispose(O);for(var D in this._textures)this._textures[D].dispose(O);this._texturePool.clear(T.gl),this._depthMaterials={},this._distanceMaterials={},this._textures={},this._lightCameras={},this._shadowMapNumber={POINT_LIGHT:0,DIRECTIONAL_LIGHT:0,SPOT_LIGHT:0},this._meshMaterials={};for(var A=0;A<this._receivers.length;A++){var C=this._receivers[A];if(C.material){var S=C.material;S.undefine("fragment","POINT_LIGHT_SHADOW_COUNT"),S.undefine("fragment","DIRECTIONAL_LIGHT_SHADOW_COUNT"),S.undefine("fragment","AMBIENT_LIGHT_SHADOW_COUNT"),S.set("shadowEnabled",0)}}this._receivers=[],this._lightsCastShadow=[]}});P.VSM=1,P.PCF=2,R.a=P},function(F,R,g){R.a=`@export clay.sm.depth.vertex
uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;
attribute vec3 position : POSITION;
attribute vec2 texcoord : TEXCOORD_0;
uniform vec2 uvRepeat = vec2(1.0, 1.0);
uniform vec2 uvOffset = vec2(0.0, 0.0);
@import clay.chunk.skinning_header
@import clay.chunk.instancing_header
varying vec4 v_ViewPosition;
varying vec2 v_Texcoord;
void main(){
 vec4 P = vec4(position, 1.0);
#ifdef SKINNING
 @import clay.chunk.skin_matrix
 P = skinMatrixWS * P;
#endif
#ifdef INSTANCING
 @import clay.chunk.instancing_matrix
 P = instanceMat * P;
#endif
 v_ViewPosition = worldViewProjection * P;
 gl_Position = v_ViewPosition;
 v_Texcoord = texcoord * uvRepeat + uvOffset;
}
@end
@export clay.sm.depth.fragment
varying vec4 v_ViewPosition;
varying vec2 v_Texcoord;
uniform float bias : 0.001;
uniform float slopeScale : 1.0;
uniform sampler2D alphaMap;
uniform float alphaCutoff: 0.0;
@import clay.util.encode_float
void main(){
 float depth = v_ViewPosition.z / v_ViewPosition.w;
 if (alphaCutoff > 0.0) {
 if (texture2D(alphaMap, v_Texcoord).a <= alphaCutoff) {
 discard;
 }
 }
#ifdef USE_VSM
 depth = depth * 0.5 + 0.5;
 float moment1 = depth;
 float moment2 = depth * depth;
 #ifdef SUPPORT_STANDARD_DERIVATIVES
 float dx = dFdx(depth);
 float dy = dFdy(depth);
 moment2 += 0.25*(dx*dx+dy*dy);
 #endif
 gl_FragColor = vec4(moment1, moment2, 0.0, 1.0);
#else
 #ifdef SUPPORT_STANDARD_DERIVATIVES
 float dx = dFdx(depth);
 float dy = dFdy(depth);
 depth += sqrt(dx*dx + dy*dy) * slopeScale + bias;
 #else
 depth += bias;
 #endif
 gl_FragColor = encodeFloat(depth * 0.5 + 0.5);
#endif
}
@end
@export clay.sm.debug_depth
uniform sampler2D depthMap;
varying vec2 v_Texcoord;
@import clay.util.decode_float
void main() {
 vec4 tex = texture2D(depthMap, v_Texcoord);
#ifdef USE_VSM
 gl_FragColor = vec4(tex.rgb, 1.0);
#else
 float depth = decodeFloat(tex);
 gl_FragColor = vec4(depth, depth, depth, 1.0);
#endif
}
@end
@export clay.sm.distance.vertex
uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;
uniform mat4 world : WORLD;
attribute vec3 position : POSITION;
@import clay.chunk.skinning_header
varying vec3 v_WorldPosition;
void main (){
 vec4 P = vec4(position, 1.0);
#ifdef SKINNING
 @import clay.chunk.skin_matrix
 P = skinMatrixWS * P;
#endif
#ifdef INSTANCING
 @import clay.chunk.instancing_matrix
 P = instanceMat * P;
#endif
 gl_Position = worldViewProjection * P;
 v_WorldPosition = (world * P).xyz;
}
@end
@export clay.sm.distance.fragment
uniform vec3 lightPosition;
uniform float range : 100;
varying vec3 v_WorldPosition;
@import clay.util.encode_float
void main(){
 float dist = distance(lightPosition, v_WorldPosition);
#ifdef USE_VSM
 gl_FragColor = vec4(dist, dist * dist, 0.0, 0.0);
#else
 dist = dist / range;
 gl_FragColor = encodeFloat(dist);
#endif
}
@end
@export clay.plugin.shadow_map_common
@import clay.util.decode_float
float tapShadowMap(sampler2D map, vec2 uv, float z){
 vec4 tex = texture2D(map, uv);
 return step(z, decodeFloat(tex) * 2.0 - 1.0);
}
float pcf(sampler2D map, vec2 uv, float z, float textureSize, vec2 scale) {
 float shadowContrib = tapShadowMap(map, uv, z);
 vec2 offset = vec2(1.0 / textureSize) * scale;
#ifdef PCF_KERNEL_SIZE
 for (int _idx_ = 0; _idx_ < PCF_KERNEL_SIZE; _idx_++) {{
 shadowContrib += tapShadowMap(map, uv + offset * pcfKernel[_idx_], z);
 }}
 return shadowContrib / float(PCF_KERNEL_SIZE + 1);
#else
 shadowContrib += tapShadowMap(map, uv+vec2(offset.x, 0.0), z);
 shadowContrib += tapShadowMap(map, uv+vec2(offset.x, offset.y), z);
 shadowContrib += tapShadowMap(map, uv+vec2(-offset.x, offset.y), z);
 shadowContrib += tapShadowMap(map, uv+vec2(0.0, offset.y), z);
 shadowContrib += tapShadowMap(map, uv+vec2(-offset.x, 0.0), z);
 shadowContrib += tapShadowMap(map, uv+vec2(-offset.x, -offset.y), z);
 shadowContrib += tapShadowMap(map, uv+vec2(offset.x, -offset.y), z);
 shadowContrib += tapShadowMap(map, uv+vec2(0.0, -offset.y), z);
 return shadowContrib / 9.0;
#endif
}
float pcf(sampler2D map, vec2 uv, float z, float textureSize) {
 return pcf(map, uv, z, textureSize, vec2(1.0));
}
float chebyshevUpperBound(vec2 moments, float z){
 float p = 0.0;
 z = z * 0.5 + 0.5;
 if (z <= moments.x) {
 p = 1.0;
 }
 float variance = moments.y - moments.x * moments.x;
 variance = max(variance, 0.0000001);
 float mD = moments.x - z;
 float pMax = variance / (variance + mD * mD);
 pMax = clamp((pMax-0.4)/(1.0-0.4), 0.0, 1.0);
 return max(p, pMax);
}
float computeShadowContrib(
 sampler2D map, mat4 lightVPM, vec3 position, float textureSize, vec2 scale, vec2 offset
) {
 vec4 posInLightSpace = lightVPM * vec4(position, 1.0);
 posInLightSpace.xyz /= posInLightSpace.w;
 float z = posInLightSpace.z;
 if(all(greaterThan(posInLightSpace.xyz, vec3(-0.99, -0.99, -1.0))) &&
 all(lessThan(posInLightSpace.xyz, vec3(0.99, 0.99, 1.0)))){
 vec2 uv = (posInLightSpace.xy+1.0) / 2.0;
 #ifdef USE_VSM
 vec2 moments = texture2D(map, uv * scale + offset).xy;
 return chebyshevUpperBound(moments, z);
 #else
 return pcf(map, uv * scale + offset, z, textureSize, scale);
 #endif
 }
 return 1.0;
}
float computeShadowContrib(sampler2D map, mat4 lightVPM, vec3 position, float textureSize) {
 return computeShadowContrib(map, lightVPM, position, textureSize, vec2(1.0), vec2(0.0));
}
float computeShadowContribOmni(samplerCube map, vec3 direction, float range)
{
 float dist = length(direction);
 vec4 shadowTex = textureCube(map, direction);
#ifdef USE_VSM
 vec2 moments = shadowTex.xy;
 float variance = moments.y - moments.x * moments.x;
 float mD = moments.x - dist;
 float p = variance / (variance + mD * mD);
 if(moments.x + 0.001 < dist){
 return clamp(p, 0.0, 1.0);
 }else{
 return 1.0;
 }
#else
 return step(dist, (decodeFloat(shadowTex) + 0.0002) * range);
#endif
}
@end
@export clay.plugin.compute_shadow_map
#if defined(SPOT_LIGHT_SHADOWMAP_COUNT) || defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT) || defined(POINT_LIGHT_SHADOWMAP_COUNT)
#ifdef SPOT_LIGHT_SHADOWMAP_COUNT
uniform sampler2D spotLightShadowMaps[SPOT_LIGHT_SHADOWMAP_COUNT]:unconfigurable;
uniform mat4 spotLightMatrices[SPOT_LIGHT_SHADOWMAP_COUNT]:unconfigurable;
uniform float spotLightShadowMapSizes[SPOT_LIGHT_SHADOWMAP_COUNT]:unconfigurable;
#endif
#ifdef DIRECTIONAL_LIGHT_SHADOWMAP_COUNT
#if defined(SHADOW_CASCADE)
uniform sampler2D directionalLightShadowMaps[1]:unconfigurable;
uniform mat4 directionalLightMatrices[SHADOW_CASCADE]:unconfigurable;
uniform float directionalLightShadowMapSizes[1]:unconfigurable;
uniform float shadowCascadeClipsNear[SHADOW_CASCADE]:unconfigurable;
uniform float shadowCascadeClipsFar[SHADOW_CASCADE]:unconfigurable;
#else
uniform sampler2D directionalLightShadowMaps[DIRECTIONAL_LIGHT_SHADOWMAP_COUNT]:unconfigurable;
uniform mat4 directionalLightMatrices[DIRECTIONAL_LIGHT_SHADOWMAP_COUNT]:unconfigurable;
uniform float directionalLightShadowMapSizes[DIRECTIONAL_LIGHT_SHADOWMAP_COUNT]:unconfigurable;
#endif
#endif
#ifdef POINT_LIGHT_SHADOWMAP_COUNT
uniform samplerCube pointLightShadowMaps[POINT_LIGHT_SHADOWMAP_COUNT]:unconfigurable;
#endif
uniform bool shadowEnabled : true;
#ifdef PCF_KERNEL_SIZE
uniform vec2 pcfKernel[PCF_KERNEL_SIZE];
#endif
@import clay.plugin.shadow_map_common
#if defined(SPOT_LIGHT_SHADOWMAP_COUNT)
void computeShadowOfSpotLights(vec3 position, inout float shadowContribs[SPOT_LIGHT_COUNT] ) {
 float shadowContrib;
 for(int _idx_ = 0; _idx_ < SPOT_LIGHT_SHADOWMAP_COUNT; _idx_++) {{
 shadowContrib = computeShadowContrib(
 spotLightShadowMaps[_idx_], spotLightMatrices[_idx_], position,
 spotLightShadowMapSizes[_idx_]
 );
 shadowContribs[_idx_] = shadowContrib;
 }}
 for(int _idx_ = SPOT_LIGHT_SHADOWMAP_COUNT; _idx_ < SPOT_LIGHT_COUNT; _idx_++){{
 shadowContribs[_idx_] = 1.0;
 }}
}
#endif
#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)
#ifdef SHADOW_CASCADE
void computeShadowOfDirectionalLights(vec3 position, inout float shadowContribs[DIRECTIONAL_LIGHT_COUNT]){
 float depth = (2.0 * gl_FragCoord.z - gl_DepthRange.near - gl_DepthRange.far)
 / (gl_DepthRange.far - gl_DepthRange.near);
 float shadowContrib;
 shadowContribs[0] = 1.0;
 for (int _idx_ = 0; _idx_ < SHADOW_CASCADE; _idx_++) {{
 if (
 depth >= shadowCascadeClipsNear[_idx_] &&
 depth <= shadowCascadeClipsFar[_idx_]
 ) {
 shadowContrib = computeShadowContrib(
 directionalLightShadowMaps[0], directionalLightMatrices[_idx_], position,
 directionalLightShadowMapSizes[0],
 vec2(1.0 / float(SHADOW_CASCADE), 1.0),
 vec2(float(_idx_) / float(SHADOW_CASCADE), 0.0)
 );
 shadowContribs[0] = shadowContrib;
 }
 }}
 for(int _idx_ = DIRECTIONAL_LIGHT_SHADOWMAP_COUNT; _idx_ < DIRECTIONAL_LIGHT_COUNT; _idx_++) {{
 shadowContribs[_idx_] = 1.0;
 }}
}
#else
void computeShadowOfDirectionalLights(vec3 position, inout float shadowContribs[DIRECTIONAL_LIGHT_COUNT]){
 float shadowContrib;
 for(int _idx_ = 0; _idx_ < DIRECTIONAL_LIGHT_SHADOWMAP_COUNT; _idx_++) {{
 shadowContrib = computeShadowContrib(
 directionalLightShadowMaps[_idx_], directionalLightMatrices[_idx_], position,
 directionalLightShadowMapSizes[_idx_]
 );
 shadowContribs[_idx_] = shadowContrib;
 }}
 for(int _idx_ = DIRECTIONAL_LIGHT_SHADOWMAP_COUNT; _idx_ < DIRECTIONAL_LIGHT_COUNT; _idx_++) {{
 shadowContribs[_idx_] = 1.0;
 }}
}
#endif
#endif
#if defined(POINT_LIGHT_SHADOWMAP_COUNT)
void computeShadowOfPointLights(vec3 position, inout float shadowContribs[POINT_LIGHT_COUNT] ){
 vec3 lightPosition;
 vec3 direction;
 for(int _idx_ = 0; _idx_ < POINT_LIGHT_SHADOWMAP_COUNT; _idx_++) {{
 lightPosition = pointLightPosition[_idx_];
 direction = position - lightPosition;
 shadowContribs[_idx_] = computeShadowContribOmni(pointLightShadowMaps[_idx_], direction, pointLightRange[_idx_]);
 }}
 for(int _idx_ = POINT_LIGHT_SHADOWMAP_COUNT; _idx_ < POINT_LIGHT_COUNT; _idx_++) {{
 shadowContribs[_idx_] = 1.0;
 }}
}
#endif
#endif
@end`},function(F,R,g){var E=g(9),c=g(5),t=g(4),a=g(10),o=g(179),i=g(191),s=g(193),h=g(195),r=g(1),e=g(196),n=g(198);g(7);var l=g(199),u=g(86),_=g(87),f=g(88),d=g(89),v=g(90),m=g(91),p=g(92),y=g(93),x=g(94),M=g(200),P=g(201);E.a.import(u.a),E.a.import(_.a),E.a.import(f.a),E.a.import(d.a),E.a.import(v.a),E.a.import(m.a),E.a.import(p.a),E.a.import(y.a),E.a.import(x.a),E.a.import(M.a),E.a.import(P.a);var T={color:{parameters:{width:function(A){return A.getWidth()},height:function(A){return A.getHeight()}}}},O=["composite","FXAA"];function D(){this._sourceTexture=new c.a({type:t.a.HALF_FLOAT}),this._depthTexture=new c.a({format:t.a.DEPTH_COMPONENT,type:t.a.UNSIGNED_INT}),this._framebuffer=new a.a,this._framebuffer.attach(this._sourceTexture),this._framebuffer.attach(this._depthTexture,a.a.DEPTH_ATTACHMENT),this._normalPass=new e.a,this._compositor=Object(o.a)(l.a);var A=this._compositor.getNodeByName("source");A.texture=this._sourceTexture;var C=this._compositor.getNodeByName("coc");this._sourceNode=A,this._cocNode=C,this._compositeNode=this._compositor.getNodeByName("composite"),this._fxaaNode=this._compositor.getNodeByName("FXAA"),this._dofBlurNodes=["dof_far_blur","dof_near_blur","dof_coc_blur"].map(function(L){return this._compositor.getNodeByName(L)},this),this._dofBlurKernel=0,this._dofBlurKernelSize=new Float32Array(0),this._finalNodesChain=O.map(function(L){return this._compositor.getNodeByName(L)},this);var S={normalTexture:this._normalPass.getNormalTexture(),depthTexture:this._normalPass.getDepthTexture()};this._ssaoPass=new i.a(S),this._ssrPass=new s.a(S),this._edgePass=new n.a(S)}D.prototype.resize=function(A,C,S){S=S||1;var A=A*S,C=C*S,L=this._sourceTexture,I=this._depthTexture;L.width=A,L.height=C,I.width=A,I.height=C},D.prototype._ifRenderNormalPass=function(){return this._enableSSAO||this._enableEdge||this._enableSSR},D.prototype._getPrevNode=function(A){for(var C=O.indexOf(A.name)-1,S=this._finalNodesChain[C];S&&!this._compositor.getNodeByName(S.name);)C-=1,S=this._finalNodesChain[C];return S},D.prototype._getNextNode=function(A){for(var C=O.indexOf(A.name)+1,S=this._finalNodesChain[C];S&&!this._compositor.getNodeByName(S.name);)C+=1,S=this._finalNodesChain[C];return S},D.prototype._addChainNode=function(A){var C=this._getPrevNode(A),S=this._getNextNode(A);!C||(C.outputs=T,A.inputs.texture=C.name,S?(A.outputs=T,S.inputs.texture=A.name):A.outputs=null,this._compositor.addNode(A))},D.prototype._removeChainNode=function(A){var C=this._getPrevNode(A),S=this._getNextNode(A);!C||(S?(C.outputs=T,S.inputs.texture=C.name):C.outputs=null,this._compositor.removeNode(A))},D.prototype.updateNormal=function(A,C,S,L){this._ifRenderNormalPass()&&this._normalPass.update(A,C,S)},D.prototype.updateSSAO=function(A,C,S,L){this._ssaoPass.update(A,S,L)},D.prototype.enableSSAO=function(){this._enableSSAO=!0},D.prototype.disableSSAO=function(){this._enableSSAO=!1},D.prototype.enableSSR=function(){this._enableSSR=!0},D.prototype.disableSSR=function(){this._enableSSR=!1},D.prototype.getSSAOTexture=function(){return this._ssaoPass.getTargetTexture()},D.prototype.getSourceFrameBuffer=function(){return this._framebuffer},D.prototype.getSourceTexture=function(){return this._sourceTexture},D.prototype.disableFXAA=function(){this._removeChainNode(this._fxaaNode)},D.prototype.enableFXAA=function(){this._addChainNode(this._fxaaNode)},D.prototype.enableBloom=function(){this._compositeNode.inputs.bloom="bloom_composite",this._compositor.dirty()},D.prototype.disableBloom=function(){this._compositeNode.inputs.bloom=null,this._compositor.dirty()},D.prototype.enableDOF=function(){this._compositeNode.inputs.texture="dof_composite",this._compositor.dirty()},D.prototype.disableDOF=function(){this._compositeNode.inputs.texture="source",this._compositor.dirty()},D.prototype.enableColorCorrection=function(){this._compositeNode.define("COLOR_CORRECTION"),this._enableColorCorrection=!0},D.prototype.disableColorCorrection=function(){this._compositeNode.undefine("COLOR_CORRECTION"),this._enableColorCorrection=!1},D.prototype.enableEdge=function(){this._enableEdge=!0},D.prototype.disableEdge=function(){this._enableEdge=!1},D.prototype.setBloomIntensity=function(A){this._compositeNode.setParameter("bloomIntensity",A)},D.prototype.setSSAOParameter=function(A,C){switch(A){case"quality":var S={low:6,medium:12,high:32,ultra:62}[C]||12;this._ssaoPass.setParameter("kernelSize",S);break;case"radius":this._ssaoPass.setParameter(A,C),this._ssaoPass.setParameter("bias",C/200);break;case"intensity":this._ssaoPass.setParameter(A,C);break;default:console.warn("Unkown SSAO parameter "+A)}},D.prototype.setDOFParameter=function(A,C){switch(A){case"focalDistance":case"focalRange":case"fstop":this._cocNode.setParameter(A,C);break;case"blurRadius":for(var S=0;S<this._dofBlurNodes.length;S++)this._dofBlurNodes[S].setParameter("blurRadius",C);break;case"quality":var L={low:4,medium:8,high:16,ultra:32}[C]||8;this._dofBlurKernelSize=L;for(var S=0;S<this._dofBlurNodes.length;S++)this._dofBlurNodes[S].pass.material.define("POISSON_KERNEL_SIZE",L);this._dofBlurKernel=new Float32Array(L*2);break;default:console.warn("Unkown DOF parameter "+A)}},D.prototype.setSSRParameter=function(A,C){if(C!=null)switch(A){case"quality":var S={low:10,medium:15,high:30,ultra:80}[C]||20,L={low:32,medium:16,high:8,ultra:4}[C]||16;this._ssrPass.setParameter("maxIteration",S),this._ssrPass.setParameter("pixelStride",L);break;case"maxRoughness":this._ssrPass.setParameter("minGlossiness",Math.max(Math.min(1-C,1),0));break;case"physical":this.setPhysicallyCorrectSSR(C);break;default:console.warn("Unkown SSR parameter "+A)}},D.prototype.setPhysicallyCorrectSSR=function(A){this._ssrPass.setPhysicallyCorrect(A)},D.prototype.setEdgeColor=function(A){var C=r.a.parseColor(A);this._edgePass.setParameter("edgeColor",C)},D.prototype.setExposure=function(A){this._compositeNode.setParameter("exposure",Math.pow(2,A))},D.prototype.setColorLookupTexture=function(A,C){this._compositeNode.pass.material.setTextureImage("lut",this._enableColorCorrection?A:"none",C,{minFilter:r.a.Texture.NEAREST,magFilter:r.a.Texture.NEAREST,flipY:!1})},D.prototype.setColorCorrection=function(A,C){this._compositeNode.setParameter(A,C)},D.prototype.isSSREnabled=function(){return this._enableSSR},D.prototype.composite=function(A,C,S,L,I){var w=this._sourceTexture,b=w;this._enableEdge&&(this._edgePass.update(A,S,w,I),w=b=this._edgePass.getTargetTexture()),this._enableSSR&&(this._ssrPass.update(A,S,w,I),b=this._ssrPass.getTargetTexture(),this._ssrPass.setSSAOTexture(this._enableSSAO?this._ssaoPass.getTargetTexture():null)),this._sourceNode.texture=b,this._cocNode.setParameter("depth",this._depthTexture);for(var B=this._dofBlurKernel,U=this._dofBlurKernelSize,W=Math.floor(h.a.length/2/U),z=I%W,G=0;G<U*2;G++)B[G]=h.a[G+z*U*2];for(var G=0;G<this._dofBlurNodes.length;G++)this._dofBlurNodes[G].setParameter("percent",I/30),this._dofBlurNodes[G].setParameter("poissonKernel",B);this._cocNode.setParameter("zNear",S.near),this._cocNode.setParameter("zFar",S.far),this._compositor.render(A,L)},D.prototype.dispose=function(A){this._sourceTexture.dispose(A),this._depthTexture.dispose(A),this._framebuffer.dispose(A),this._compositor.dispose(A),this._normalPass.dispose(A),this._ssaoPass.dispose(A)},R.a=D},function(F,R,g){var E=g(180);R.a=E.a},function(F,R,g){var E=g(23),c=g(181),t=g(183),a=g(184),o=g(185),i=g(9),s=g(4),h=g(5),r=g(27),e=g(186);Object(e.a)(i.a);var n=/^#source\((.*?)\)/;function l(x,M){var P=new c.a;M=M||{};var T={textures:{},parameters:{}},O=function(C,S){for(var L=0;L<x.nodes.length;L++){var I=x.nodes[L],w=u(I,T,M);w&&P.addNode(w)}};for(var D in x.parameters){var A=x.parameters[D];T.parameters[D]=d(A)}return v(x,T,M,function(C){T.textures=C,O()}),P}function u(x,M,P){var T=x.type||"filter",O,D,A;if(T==="filter"){var C=x.shader.trim(),S=n.exec(C);if(S?O=i.a.source(S[1].trim()):C.charAt(0)==="#"&&(O=M.shaders[C.substr(1)]),O||(O=C),!O)return}if(x.inputs){D={};for(var L in x.inputs)typeof x.inputs[L]=="string"?D[L]=x.inputs[L]:D[L]={node:x.inputs[L].node,pin:x.inputs[L].pin}}if(x.outputs){A={};for(var L in x.outputs){var I=x.outputs[L];A[L]={},I.attachment!=null&&(A[L].attachment=I.attachment),I.keepLastFrame!=null&&(A[L].keepLastFrame=I.keepLastFrame),I.outputLastFrame!=null&&(A[L].outputLastFrame=I.outputLastFrame),I.parameters&&(A[L].parameters=d(I.parameters))}}var w;if(T==="scene"?w=new t.a({name:x.name,scene:P.scene,camera:P.camera,outputs:A}):T==="texture"?w=new a.a({name:x.name,outputs:A}):w=new o.a({name:x.name,shader:O,inputs:D,outputs:A}),w){if(x.parameters)for(var L in x.parameters){var b=x.parameters[L];typeof b=="string"?(b=b.trim(),b.charAt(0)==="#"?b=M.textures[b.substr(1)]:w.on("beforerender",m(L,y(b)))):typeof b=="function"&&w.on("beforerender",b),w.setParameter(L,b)}if(x.defines&&w.pass)for(var L in x.defines){var b=x.defines[L];w.pass.material.define("fragment",L,b)}}return w}function _(x,M){return x}function f(x,M){return M}function d(x){var M={};if(!x)return M;["type","minFilter","magFilter","wrapS","wrapT","flipY","useMipmap"].forEach(function(T){var O=x[T];O!=null&&(typeof O=="string"&&(O=s.a[O]),M[T]=O)});var P=x.scale||1;return["width","height"].forEach(function(T){if(x[T]!=null){var O=x[T];typeof O=="string"?(O=O.trim(),M[T]=p(T,y(O),P)):M[T]=O}}),M.width||(M.width=_),M.height||(M.height=f),x.useMipmap!=null&&(M.useMipmap=x.useMipmap),M}function v(x,M,P,T){if(!x.textures){T({});return}var O={},D=0,A=!1,C=P.textureRootPath;E.a.each(x.textures,function(S,L){var I,w=S.path,b=d(S.parameters);if(Array.isArray(w)&&w.length===6)C&&(w=w.map(function(B){return E.a.relative2absolute(B,C)})),I=new r.a(b);else if(typeof w=="string")C&&(w=E.a.relative2absolute(w,C)),I=new h.a(b);else return;I.load(w),D++,I.once("success",function(){O[L]=I,D--,D===0&&(T(O),A=!0)})}),D===0&&!A&&T(O)}function m(x,M){return function(P){var T=P.getDevicePixelRatio(),O=P.getWidth(),D=P.getHeight(),A=M(O,D,T);this.setParameter(x,A)}}function p(x,M,P){return P=P||1,function(T){var O=T.getDevicePixelRatio(),D=T.getWidth()*P,A=T.getHeight()*P;return M(D,A,O)}}function y(x){var M=/^expr\((.*)\)$/.exec(x);if(M)try{var P=new Function("width","height","dpr","return "+M[1]);return P(1,1),P}catch(T){throw new Error("Invalid expression.")}}R.a=l},function(F,R,g){var E=g(182),c=g(85),t=g(10),a=E.a.extend(function(){return{_outputs:[],_texturePool:new c.a,_frameBuffer:new t.a({depthBuffer:!1})}},{addNode:function(o){E.a.prototype.addNode.call(this,o),o._compositor=this},render:function(o,i){if(this._dirty){this.update(),this._dirty=!1,this._outputs.length=0;for(var s=0;s<this.nodes.length;s++)this.nodes[s].outputs||this._outputs.push(this.nodes[s])}for(var s=0;s<this.nodes.length;s++)this.nodes[s].beforeFrame();for(var s=0;s<this._outputs.length;s++)this._outputs[s].updateReference();for(var s=0;s<this._outputs.length;s++)this._outputs[s].render(o,i);for(var s=0;s<this.nodes.length;s++)this.nodes[s].afterFrame()},allocateTexture:function(o){return this._texturePool.get(o)},releaseTexture:function(o){this._texturePool.put(o)},getFrameBuffer:function(){return this._frameBuffer},dispose:function(o){this._texturePool.clear(o)}});R.a=a},function(F,R,g){var E=g(8),c=g(48),t=E.a.extend(function(){return{nodes:[]}},{dirty:function(){this._dirty=!0},addNode:function(a){this.nodes.indexOf(a)>=0||(this.nodes.push(a),this._dirty=!0)},removeNode:function(a){typeof a=="string"&&(a=this.getNodeByName(a));var o=this.nodes.indexOf(a);o>=0&&(this.nodes.splice(o,1),this._dirty=!0)},getNodeByName:function(a){for(var o=0;o<this.nodes.length;o++)if(this.nodes[o].name===a)return this.nodes[o]},update:function(){for(var a=0;a<this.nodes.length;a++)this.nodes[a].clear();for(var a=0;a<this.nodes.length;a++){var o=this.nodes[a];if(!!o.inputs){for(var i in o.inputs)if(!!o.inputs[i]){if(o.pass&&!o.pass.material.isUniformEnabled(i)){console.warn("Pin "+o.name+"."+i+" not used.");continue}var s=o.inputs[i],h=this.findPin(s);h?o.link(i,h.node,h.pin):typeof s=="string"?console.warn("Node "+s+" not exist"):console.warn("Pin of "+s.node+"."+s.pin+" not exist")}}}},findPin:function(a){var o;if((typeof a=="string"||a instanceof c.a)&&(a={node:a}),typeof a.node=="string")for(var i=0;i<this.nodes.length;i++){var s=this.nodes[i];s.name===a.node&&(o=s)}else o=a.node;if(o){var h=a.pin;if(h||o.outputs&&(h=Object.keys(o.outputs)[0]),o.outputs[h])return{node:o,pin:h}}}});R.a=t},function(F,R,g){var E=g(48),c=g(11),t=g(10),a=E.a.extend({name:"scene",scene:null,camera:null,autoUpdateScene:!0,preZ:!1},function(){this.frameBuffer=new t.a},{render:function(o){this._rendering=!0;var i=o.gl;this.trigger("beforerender");var s;if(!this.outputs)s=o.render(this.scene,this.camera,!this.autoUpdateScene,this.preZ);else{var h=this.frameBuffer;for(var r in this.outputs){var e=this.updateParameter(r,o),n=this.outputs[r],l=this._compositor.allocateTexture(e);this._outputTextures[r]=l;var u=n.attachment||i.COLOR_ATTACHMENT0;typeof u=="string"&&(u=i[u]),h.attach(l,u)}h.bind(o);var _=o.getGLExtension("EXT_draw_buffers");if(_){var f=[];for(var u in this.outputs)u=parseInt(u),u>=i.COLOR_ATTACHMENT0&&u<=i.COLOR_ATTACHMENT0+8&&f.push(u);_.drawBuffersEXT(f)}o.saveClear(),o.clearBit=c.a.DEPTH_BUFFER_BIT|c.a.COLOR_BUFFER_BIT,s=o.render(this.scene,this.camera,!this.autoUpdateScene,this.preZ),o.restoreClear(),h.unbind(o)}this.trigger("afterrender",s),this._rendering=!1,this._rendered=!0}});R.a=a},function(F,R,g){var E=g(48),c=E.a.extend(function(){return{texture:null,outputs:{color:{}}}},function(){},{getOutput:function(t,a){return this.texture},beforeFrame:function(){},afterFrame:function(){}});R.a=c},function(F,R,g){var E=g(15),c=g(48),t=c.a.extend(function(){return{name:"",inputs:{},outputs:null,shader:"",inputLinks:{},outputLinks:{},pass:null,_prevOutputTextures:{},_outputTextures:{},_outputReferences:{},_rendering:!1,_rendered:!1,_compositor:null}},function(){var a=new E.a({fragment:this.shader});this.pass=a},{render:function(a,o){this.trigger("beforerender",a),this._rendering=!0;var i=a.gl;for(var s in this.inputLinks){var h=this.inputLinks[s],r=h.node.getOutput(a,h.pin);this.pass.setUniform(s,r)}if(!this.outputs)this.pass.outputs=null,this._compositor.getFrameBuffer().unbind(a),this.pass.render(a,o);else{this.pass.outputs={};var e={};for(var n in this.outputs){var l=this.updateParameter(n,a);isNaN(l.width)&&this.updateParameter(n,a);var u=this.outputs[n],_=this._compositor.allocateTexture(l);this._outputTextures[n]=_;var f=u.attachment||i.COLOR_ATTACHMENT0;typeof f=="string"&&(f=i[f]),e[f]=_}this._compositor.getFrameBuffer().bind(a);for(var f in e)this._compositor.getFrameBuffer().attach(e[f],f);this.pass.render(a),this._compositor.getFrameBuffer().updateMipmap(a)}for(var s in this.inputLinks){var h=this.inputLinks[s];h.node.removeReference(h.pin)}this._rendering=!1,this._rendered=!0,this.trigger("afterrender",a)},updateParameter:function(a,o){var i=this.outputs[a],s=i.parameters,h=i._parametersCopy;if(h||(h=i._parametersCopy={}),s)for(var r in s)r!=="width"&&r!=="height"&&(h[r]=s[r]);var e,n;return typeof s.width=="function"?e=s.width.call(this,o):e=s.width,typeof s.height=="function"?n=s.height.call(this,o):n=s.height,e=Math.ceil(e),n=Math.ceil(n),(h.width!==e||h.height!==n)&&this._outputTextures[a]&&this._outputTextures[a].dispose(o),h.width=e,h.height=n,h},setParameter:function(a,o){this.pass.setUniform(a,o)},getParameter:function(a){return this.pass.getUniform(a)},setParameters:function(a){for(var o in a)this.setParameter(o,a[o])},define:function(a,o){this.pass.material.define("fragment",a,o)},undefine:function(a){this.pass.material.undefine("fragment",a)},removeReference:function(a){if(this._outputReferences[a]--,this._outputReferences[a]===0){var o=this.outputs[a];o.keepLastFrame?(this._prevOutputTextures[a]&&this._compositor.releaseTexture(this._prevOutputTextures[a]),this._prevOutputTextures[a]=this._outputTextures[a]):this._compositor.releaseTexture(this._outputTextures[a])}},clear:function(){c.a.prototype.clear.call(this),this.pass.material.disableTexturesAll()}});R.a=t},function(F,R,g){R.a=_;var E=g(187),c=g(86),t=g(188),a=g(87),o=g(189),i=g(88),s=g(89),h=g(90),r=g(91),e=g(92),n=g(190),l=g(93),u=g(94);function _(f){f.import(E.a),f.import(c.a),f.import(t.a),f.import(a.a),f.import(o.a),f.import(i.a),f.import(s.a),f.import(h.a),f.import(r.a),f.import(e.a),f.import(n.a),f.import(l.a),f.import(u.a)}},function(F,R,g){R.a=`@export clay.compositor.coloradjust
varying vec2 v_Texcoord;
uniform sampler2D texture;
uniform float brightness : 0.0;
uniform float contrast : 1.0;
uniform float exposure : 0.0;
uniform float gamma : 1.0;
uniform float saturation : 1.0;
const vec3 w = vec3(0.2125, 0.7154, 0.0721);
void main()
{
 vec4 tex = texture2D( texture, v_Texcoord);
 vec3 color = clamp(tex.rgb + vec3(brightness), 0.0, 1.0);
 color = clamp( (color-vec3(0.5))*contrast+vec3(0.5), 0.0, 1.0);
 color = clamp( color * pow(2.0, exposure), 0.0, 1.0);
 color = clamp( pow(color, vec3(gamma)), 0.0, 1.0);
 float luminance = dot( color, w );
 color = mix(vec3(luminance), color, saturation);
 gl_FragColor = vec4(color, tex.a);
}
@end
@export clay.compositor.brightness
varying vec2 v_Texcoord;
uniform sampler2D texture;
uniform float brightness : 0.0;
void main()
{
 vec4 tex = texture2D( texture, v_Texcoord);
 vec3 color = tex.rgb + vec3(brightness);
 gl_FragColor = vec4(color, tex.a);
}
@end
@export clay.compositor.contrast
varying vec2 v_Texcoord;
uniform sampler2D texture;
uniform float contrast : 1.0;
void main()
{
 vec4 tex = texture2D( texture, v_Texcoord);
 vec3 color = (tex.rgb-vec3(0.5))*contrast+vec3(0.5);
 gl_FragColor = vec4(color, tex.a);
}
@end
@export clay.compositor.exposure
varying vec2 v_Texcoord;
uniform sampler2D texture;
uniform float exposure : 0.0;
void main()
{
 vec4 tex = texture2D(texture, v_Texcoord);
 vec3 color = tex.rgb * pow(2.0, exposure);
 gl_FragColor = vec4(color, tex.a);
}
@end
@export clay.compositor.gamma
varying vec2 v_Texcoord;
uniform sampler2D texture;
uniform float gamma : 1.0;
void main()
{
 vec4 tex = texture2D(texture, v_Texcoord);
 vec3 color = pow(tex.rgb, vec3(gamma));
 gl_FragColor = vec4(color, tex.a);
}
@end
@export clay.compositor.saturation
varying vec2 v_Texcoord;
uniform sampler2D texture;
uniform float saturation : 1.0;
const vec3 w = vec3(0.2125, 0.7154, 0.0721);
void main()
{
 vec4 tex = texture2D(texture, v_Texcoord);
 vec3 color = tex.rgb;
 float luminance = dot(color, w);
 color = mix(vec3(luminance), color, saturation);
 gl_FragColor = vec4(color, tex.a);
}
@end`},function(F,R,g){R.a=`@export clay.compositor.hdr.log_lum
varying vec2 v_Texcoord;
uniform sampler2D texture;
const vec3 w = vec3(0.2125, 0.7154, 0.0721);
@import clay.util.rgbm
void main()
{
 vec4 tex = decodeHDR(texture2D(texture, v_Texcoord));
 float luminance = dot(tex.rgb, w);
 luminance = log(luminance + 0.001);
 gl_FragColor = encodeHDR(vec4(vec3(luminance), 1.0));
}
@end
@export clay.compositor.hdr.lum_adaption
varying vec2 v_Texcoord;
uniform sampler2D adaptedLum;
uniform sampler2D currentLum;
uniform float frameTime : 0.02;
@import clay.util.rgbm
void main()
{
 float fAdaptedLum = decodeHDR(texture2D(adaptedLum, vec2(0.5, 0.5))).r;
 float fCurrentLum = exp(encodeHDR(texture2D(currentLum, vec2(0.5, 0.5))).r);
 fAdaptedLum += (fCurrentLum - fAdaptedLum) * (1.0 - pow(0.98, 30.0 * frameTime));
 gl_FragColor = encodeHDR(vec4(vec3(fAdaptedLum), 1.0));
}
@end
@export clay.compositor.lum
varying vec2 v_Texcoord;
uniform sampler2D texture;
const vec3 w = vec3(0.2125, 0.7154, 0.0721);
void main()
{
 vec4 tex = texture2D( texture, v_Texcoord );
 float luminance = dot(tex.rgb, w);
 gl_FragColor = vec4(vec3(luminance), 1.0);
}
@end`},function(F,R,g){R.a=`@export clay.compositor.vignette
#define OUTPUT_ALPHA
varying vec2 v_Texcoord;
uniform sampler2D texture;
uniform float darkness: 1;
uniform float offset: 1;
@import clay.util.rgbm
void main()
{
 vec4 texel = decodeHDR(texture2D(texture, v_Texcoord));
 gl_FragColor.rgb = texel.rgb;
 vec2 uv = (v_Texcoord - vec2(0.5)) * vec2(offset);
 gl_FragColor = encodeHDR(vec4(mix(texel.rgb, vec3(1.0 - darkness), dot(uv, uv)), texel.a));
}
@end`},function(F,R,g){R.a=`@export clay.compositor.lensflare
#define SAMPLE_NUMBER 8
uniform sampler2D texture;
uniform sampler2D lenscolor;
uniform vec2 textureSize : [512, 512];
uniform float dispersal : 0.3;
uniform float haloWidth : 0.4;
uniform float distortion : 1.0;
varying vec2 v_Texcoord;
@import clay.util.rgbm
vec4 textureDistorted(
 in vec2 texcoord,
 in vec2 direction,
 in vec3 distortion
) {
 return vec4(
 decodeHDR(texture2D(texture, texcoord + direction * distortion.r)).r,
 decodeHDR(texture2D(texture, texcoord + direction * distortion.g)).g,
 decodeHDR(texture2D(texture, texcoord + direction * distortion.b)).b,
 1.0
 );
}
void main()
{
 vec2 texcoord = -v_Texcoord + vec2(1.0); vec2 textureOffset = 1.0 / textureSize;
 vec2 ghostVec = (vec2(0.5) - texcoord) * dispersal;
 vec2 haloVec = normalize(ghostVec) * haloWidth;
 vec3 distortion = vec3(-textureOffset.x * distortion, 0.0, textureOffset.x * distortion);
 vec4 result = vec4(0.0);
 for (int i = 0; i < SAMPLE_NUMBER; i++)
 {
 vec2 offset = fract(texcoord + ghostVec * float(i));
 float weight = length(vec2(0.5) - offset) / length(vec2(0.5));
 weight = pow(1.0 - weight, 10.0);
 result += textureDistorted(offset, normalize(ghostVec), distortion) * weight;
 }
 result *= texture2D(lenscolor, vec2(length(vec2(0.5) - texcoord)) / length(vec2(0.5)));
 float weight = length(vec2(0.5) - fract(texcoord + haloVec)) / length(vec2(0.5));
 weight = pow(1.0 - weight, 10.0);
 vec2 offset = fract(texcoord + haloVec);
 result += textureDistorted(offset, normalize(ghostVec), distortion) * weight;
 gl_FragColor = result;
}
@end`},function(F,R,g){var E=g(7),c=g(3),t=g(5),a=g(4),o=g(15),i=g(9),s=g(10),h=g(49),r=g(192);i.a.import(r.a);function e(_){for(var f=new Uint8Array(_*_*4),d=0,v=new c.a,m=0;m<_;m++)for(var p=0;p<_;p++)v.set(Math.random()*2-1,Math.random()*2-1,0).normalize(),f[d++]=(v.x*.5+.5)*255,f[d++]=(v.y*.5+.5)*255,f[d++]=0,f[d++]=255;return f}function n(_){return new t.a({pixels:e(_),wrapS:a.a.REPEAT,wrapT:a.a.REPEAT,width:_,height:_})}function l(_,f,d){var v=new Float32Array(_*3);f=f||0;for(var m=0;m<_;m++){var p=Object(h.a)(m+f,2)*(d?1:2)*Math.PI,y=Object(h.a)(m+f,3)*Math.PI,x=Math.random(),M=Math.cos(p)*Math.sin(y)*x,P=Math.cos(y)*x,T=Math.sin(p)*Math.sin(y)*x;v[m*3]=M,v[m*3+1]=P,v[m*3+2]=T}return v}function u(_){_=_||{},this._ssaoPass=new o.a({fragment:i.a.source("ecgl.ssao.estimate")}),this._blurPass=new o.a({fragment:i.a.source("ecgl.ssao.blur")}),this._framebuffer=new s.a({depthBuffer:!1}),this._ssaoTexture=new t.a,this._blurTexture=new t.a,this._blurTexture2=new t.a,this._depthTex=_.depthTexture,this._normalTex=_.normalTexture,this.setNoiseSize(4),this.setKernelSize(_.kernelSize||12),_.radius!=null&&this.setParameter("radius",_.radius),_.power!=null&&this.setParameter("power",_.power),this._normalTex||(this._ssaoPass.material.disableTexture("normalTex"),this._blurPass.material.disableTexture("normalTex")),this._depthTex||this._blurPass.material.disableTexture("depthTex"),this._blurPass.material.setUniform("normalTex",this._normalTex),this._blurPass.material.setUniform("depthTex",this._depthTex)}u.prototype.setDepthTexture=function(_){this._depthTex=_},u.prototype.setNormalTexture=function(_){this._normalTex=_,this._ssaoPass.material[_?"enableTexture":"disableTexture"]("normalTex"),this.setKernelSize(this._kernelSize)},u.prototype.update=function(_,f,d){var v=_.getWidth(),m=_.getHeight(),p=this._ssaoPass,y=this._blurPass;p.setUniform("kernel",this._kernels[d%this._kernels.length]),p.setUniform("depthTex",this._depthTex),this._normalTex!=null&&p.setUniform("normalTex",this._normalTex),p.setUniform("depthTexSize",[this._depthTex.width,this._depthTex.height]);var x=new E.a;E.a.transpose(x,f.worldTransform),p.setUniform("projection",f.projectionMatrix.array),p.setUniform("projectionInv",f.invProjectionMatrix.array),p.setUniform("viewInverseTranspose",x.array);var M=this._ssaoTexture,P=this._blurTexture,T=this._blurTexture2;M.width=v/2,M.height=m/2,P.width=v,P.height=m,T.width=v,T.height=m,this._framebuffer.attach(M),this._framebuffer.bind(_),_.gl.clearColor(1,1,1,1),_.gl.clear(_.gl.COLOR_BUFFER_BIT),p.render(_),y.setUniform("textureSize",[v/2,m/2]),y.setUniform("projection",f.projectionMatrix.array),this._framebuffer.attach(P),y.setUniform("direction",0),y.setUniform("ssaoTexture",M),y.render(_),this._framebuffer.attach(T),y.setUniform("textureSize",[v,m]),y.setUniform("direction",1),y.setUniform("ssaoTexture",P),y.render(_),this._framebuffer.unbind(_);var O=_.clearColor;_.gl.clearColor(O[0],O[1],O[2],O[3])},u.prototype.getTargetTexture=function(){return this._blurTexture2},u.prototype.setParameter=function(_,f){_==="noiseTexSize"?this.setNoiseSize(f):_==="kernelSize"?this.setKernelSize(f):_==="intensity"?this._ssaoPass.material.set("intensity",f):this._ssaoPass.setUniform(_,f)},u.prototype.setKernelSize=function(_){this._kernelSize=_,this._ssaoPass.material.define("fragment","KERNEL_SIZE",_),this._kernels=this._kernels||[];for(var f=0;f<30;f++)this._kernels[f]=l(_,f*_,!!this._normalTex)},u.prototype.setNoiseSize=function(_){var f=this._ssaoPass.getUniform("noiseTex");f?(f.data=e(_),f.width=f.height=_,f.dirty()):(f=n(_),this._ssaoPass.setUniform("noiseTex",n(_))),this._ssaoPass.setUniform("noiseTexSize",[_,_])},u.prototype.dispose=function(_){this._blurTexture.dispose(_),this._ssaoTexture.dispose(_),this._blurTexture2.dispose(_)},R.a=u},function(F,R,g){R.a=`@export ecgl.ssao.estimate

uniform sampler2D depthTex;

uniform sampler2D normalTex;

uniform sampler2D noiseTex;

uniform vec2 depthTexSize;

uniform vec2 noiseTexSize;

uniform mat4 projection;

uniform mat4 projectionInv;

uniform mat4 viewInverseTranspose;

uniform vec3 kernel[KERNEL_SIZE];

uniform float radius : 1;

uniform float power : 1;

uniform float bias: 1e-2;

uniform float intensity: 1.0;

varying vec2 v_Texcoord;

float ssaoEstimator(in vec3 originPos, in mat3 kernelBasis) {
 float occlusion = 0.0;

 for (int i = 0; i < KERNEL_SIZE; i++) {
 vec3 samplePos = kernel[i];
#ifdef NORMALTEX_ENABLED
 samplePos = kernelBasis * samplePos;
#endif
 samplePos = samplePos * radius + originPos;

 vec4 texCoord = projection * vec4(samplePos, 1.0);
 texCoord.xy /= texCoord.w;

 vec4 depthTexel = texture2D(depthTex, texCoord.xy * 0.5 + 0.5);

 float sampleDepth = depthTexel.r * 2.0 - 1.0;
 if (projection[3][3] == 0.0) {
 sampleDepth = projection[3][2] / (sampleDepth * projection[2][3] - projection[2][2]);
 }
 else {
 sampleDepth = (sampleDepth - projection[3][2]) / projection[2][2];
 }
 
 float rangeCheck = smoothstep(0.0, 1.0, radius / abs(originPos.z - sampleDepth));
 occlusion += rangeCheck * step(samplePos.z, sampleDepth - bias);
 }
#ifdef NORMALTEX_ENABLED
 occlusion = 1.0 - occlusion / float(KERNEL_SIZE);
#else
 occlusion = 1.0 - clamp((occlusion / float(KERNEL_SIZE) - 0.6) * 2.5, 0.0, 1.0);
#endif
 return pow(occlusion, power);
}

void main()
{

 vec4 depthTexel = texture2D(depthTex, v_Texcoord);

#ifdef NORMALTEX_ENABLED
 vec4 tex = texture2D(normalTex, v_Texcoord);
 if (dot(tex.rgb, tex.rgb) == 0.0) {
 gl_FragColor = vec4(1.0);
 return;
 }
 vec3 N = tex.rgb * 2.0 - 1.0;
 N = (viewInverseTranspose * vec4(N, 0.0)).xyz;

 vec2 noiseTexCoord = depthTexSize / vec2(noiseTexSize) * v_Texcoord;
 vec3 rvec = texture2D(noiseTex, noiseTexCoord).rgb * 2.0 - 1.0;
 vec3 T = normalize(rvec - N * dot(rvec, N));
 vec3 BT = normalize(cross(N, T));
 mat3 kernelBasis = mat3(T, BT, N);
#else
 if (depthTexel.r > 0.99999) {
 gl_FragColor = vec4(1.0);
 return;
 }
 mat3 kernelBasis;
#endif

 float z = depthTexel.r * 2.0 - 1.0;

 vec4 projectedPos = vec4(v_Texcoord * 2.0 - 1.0, z, 1.0);
 vec4 p4 = projectionInv * projectedPos;

 vec3 position = p4.xyz / p4.w;

 float ao = ssaoEstimator(position, kernelBasis);
 ao = clamp(1.0 - (1.0 - ao) * intensity, 0.0, 1.0);
 gl_FragColor = vec4(vec3(ao), 1.0);
}

@end


@export ecgl.ssao.blur
#define SHADER_NAME SSAO_BLUR

uniform sampler2D ssaoTexture;

#ifdef NORMALTEX_ENABLED
uniform sampler2D normalTex;
#endif

varying vec2 v_Texcoord;

uniform vec2 textureSize;
uniform float blurSize : 1.0;

uniform int direction: 0.0;

#ifdef DEPTHTEX_ENABLED
uniform sampler2D depthTex;
uniform mat4 projection;
uniform float depthRange : 0.5;

float getLinearDepth(vec2 coord)
{
 float depth = texture2D(depthTex, coord).r * 2.0 - 1.0;
 return projection[3][2] / (depth * projection[2][3] - projection[2][2]);
}
#endif

void main()
{
 float kernel[5];
 kernel[0] = 0.122581;
 kernel[1] = 0.233062;
 kernel[2] = 0.288713;
 kernel[3] = 0.233062;
 kernel[4] = 0.122581;

 vec2 off = vec2(0.0);
 if (direction == 0) {
 off[0] = blurSize / textureSize.x;
 }
 else {
 off[1] = blurSize / textureSize.y;
 }

 vec2 coord = v_Texcoord;

 float sum = 0.0;
 float weightAll = 0.0;

#ifdef NORMALTEX_ENABLED
 vec3 centerNormal = texture2D(normalTex, v_Texcoord).rgb * 2.0 - 1.0;
#endif
#if defined(DEPTHTEX_ENABLED)
 float centerDepth = getLinearDepth(v_Texcoord);
#endif

 for (int i = 0; i < 5; i++) {
 vec2 coord = clamp(v_Texcoord + vec2(float(i) - 2.0) * off, vec2(0.0), vec2(1.0));

 float w = kernel[i];
#ifdef NORMALTEX_ENABLED
 vec3 normal = texture2D(normalTex, coord).rgb * 2.0 - 1.0;
 w *= clamp(dot(normal, centerNormal), 0.0, 1.0);
#endif
#ifdef DEPTHTEX_ENABLED
 float d = getLinearDepth(coord);
 w *= (1.0 - smoothstep(abs(centerDepth - d) / depthRange, 0.0, 1.0));
#endif

 weightAll += w;
 sum += texture2D(ssaoTexture, coord).r * w;
 }

 gl_FragColor = vec4(vec3(sum / weightAll), 1.0);
}

@end
`},function(F,R,g){var E=g(7);g(3);var c=g(5),t=g(4),a=g(15),o=g(9),i=g(10);g(49);var s=g(77),h=g(194);o.a.import(h.a);function r(e){e=e||{},this._ssrPass=new a.a({fragment:o.a.source("ecgl.ssr.main"),clearColor:[0,0,0,0]}),this._blurPass1=new a.a({fragment:o.a.source("ecgl.ssr.blur"),clearColor:[0,0,0,0]}),this._blurPass2=new a.a({fragment:o.a.source("ecgl.ssr.blur"),clearColor:[0,0,0,0]}),this._blendPass=new a.a({fragment:o.a.source("clay.compositor.blend")}),this._blendPass.material.disableTexturesAll(),this._blendPass.material.enableTexture(["texture1","texture2"]),this._ssrPass.setUniform("gBufferTexture1",e.normalTexture),this._ssrPass.setUniform("gBufferTexture2",e.depthTexture),this._blurPass1.setUniform("gBufferTexture1",e.normalTexture),this._blurPass1.setUniform("gBufferTexture2",e.depthTexture),this._blurPass2.setUniform("gBufferTexture1",e.normalTexture),this._blurPass2.setUniform("gBufferTexture2",e.depthTexture),this._blurPass2.material.define("fragment","VERTICAL"),this._blurPass2.material.define("fragment","BLEND"),this._ssrTexture=new c.a({type:t.a.HALF_FLOAT}),this._texture2=new c.a({type:t.a.HALF_FLOAT}),this._texture3=new c.a({type:t.a.HALF_FLOAT}),this._prevTexture=new c.a({type:t.a.HALF_FLOAT}),this._currentTexture=new c.a({type:t.a.HALF_FLOAT}),this._frameBuffer=new i.a({depthBuffer:!1}),this._normalDistribution=null,this._totalSamples=256,this._samplePerFrame=4,this._ssrPass.material.define("fragment","SAMPLE_PER_FRAME",this._samplePerFrame),this._ssrPass.material.define("fragment","TOTAL_SAMPLES",this._totalSamples),this._downScale=1}r.prototype.setAmbientCubemap=function(e,n){this._ssrPass.material.set("specularCubemap",e),this._ssrPass.material.set("specularIntensity",n);var l=e&&n;this._ssrPass.material[l?"enableTexture":"disableTexture"]("specularCubemap")},r.prototype.update=function(e,n,l,u){var _=e.getWidth(),f=e.getHeight(),d=this._ssrTexture,v=this._texture2,m=this._texture3;d.width=this._prevTexture.width=this._currentTexture.width=_/this._downScale,d.height=this._prevTexture.height=this._currentTexture.height=f/this._downScale,v.width=m.width=_,v.height=m.height=f;var p=this._frameBuffer,y=this._ssrPass,x=this._blurPass1,M=this._blurPass2,P=this._blendPass,T=new E.a,O=new E.a;E.a.transpose(T,n.worldTransform),E.a.transpose(O,n.viewMatrix),y.setUniform("sourceTexture",l),y.setUniform("projection",n.projectionMatrix.array),y.setUniform("projectionInv",n.invProjectionMatrix.array),y.setUniform("toViewSpace",T.array),y.setUniform("toWorldSpace",O.array),y.setUniform("nearZ",n.near);var D=u/this._totalSamples*this._samplePerFrame;if(y.setUniform("jitterOffset",D),y.setUniform("sampleOffset",u*this._samplePerFrame),x.setUniform("textureSize",[d.width,d.height]),M.setUniform("textureSize",[_,f]),M.setUniform("sourceTexture",l),x.setUniform("projection",n.projectionMatrix.array),M.setUniform("projection",n.projectionMatrix.array),p.attach(d),p.bind(e),y.render(e),this._physicallyCorrect&&(p.attach(this._currentTexture),P.setUniform("texture1",this._prevTexture),P.setUniform("texture2",d),P.material.set({weight1:u>=1?.95:0,weight2:u>=1?.05:1}),P.render(e)),p.attach(v),x.setUniform("texture",this._physicallyCorrect?this._currentTexture:d),x.render(e),p.attach(m),M.setUniform("texture",v),M.render(e),p.unbind(e),this._physicallyCorrect){var A=this._prevTexture;this._prevTexture=this._currentTexture,this._currentTexture=A}},r.prototype.getTargetTexture=function(){return this._texture3},r.prototype.setParameter=function(e,n){e==="maxIteration"?this._ssrPass.material.define("fragment","MAX_ITERATION",n):this._ssrPass.setUniform(e,n)},r.prototype.setPhysicallyCorrect=function(e){e?(this._normalDistribution||(this._normalDistribution=s.a.generateNormalDistribution(64,this._totalSamples)),this._ssrPass.material.define("fragment","PHYSICALLY_CORRECT"),this._ssrPass.material.set("normalDistribution",this._normalDistribution),this._ssrPass.material.set("normalDistributionSize",[64,this._totalSamples])):this._ssrPass.material.undefine("fragment","PHYSICALLY_CORRECT"),this._physicallyCorrect=e},r.prototype.setSSAOTexture=function(e){var n=this._blurPass2;e?(n.material.enableTexture("ssaoTex"),n.material.set("ssaoTex",e)):n.material.disableTexture("ssaoTex")},r.prototype.isFinished=function(e){return this._physicallyCorrect?e>this._totalSamples/this._samplePerFrame:!0},r.prototype.dispose=function(e){this._ssrTexture.dispose(e),this._texture2.dispose(e),this._texture3.dispose(e),this._prevTexture.dispose(e),this._currentTexture.dispose(e),this._frameBuffer.dispose(e)},R.a=r},function(F,R,g){R.a=`@export ecgl.ssr.main

#define SHADER_NAME SSR
#define MAX_ITERATION 20;
#define SAMPLE_PER_FRAME 5;
#define TOTAL_SAMPLES 128;

uniform sampler2D sourceTexture;
uniform sampler2D gBufferTexture1;
uniform sampler2D gBufferTexture2;
uniform sampler2D gBufferTexture3;
uniform samplerCube specularCubemap;
uniform float specularIntensity: 1;

uniform mat4 projection;
uniform mat4 projectionInv;
uniform mat4 toViewSpace;
uniform mat4 toWorldSpace;

uniform float maxRayDistance: 200;

uniform float pixelStride: 16;
uniform float pixelStrideZCutoff: 50; 
uniform float screenEdgeFadeStart: 0.9; 
uniform float eyeFadeStart : 0.2; uniform float eyeFadeEnd: 0.8; 
uniform float minGlossiness: 0.2; uniform float zThicknessThreshold: 1;

uniform float nearZ;
uniform vec2 viewportSize : VIEWPORT_SIZE;

uniform float jitterOffset: 0;

varying vec2 v_Texcoord;

#ifdef DEPTH_DECODE
@import clay.util.decode_float
#endif

#ifdef PHYSICALLY_CORRECT
uniform sampler2D normalDistribution;
uniform float sampleOffset: 0;
uniform vec2 normalDistributionSize;

vec3 transformNormal(vec3 H, vec3 N) {
 vec3 upVector = N.y > 0.999 ? vec3(1.0, 0.0, 0.0) : vec3(0.0, 1.0, 0.0);
 vec3 tangentX = normalize(cross(N, upVector));
 vec3 tangentZ = cross(N, tangentX);
 return normalize(tangentX * H.x + N * H.y + tangentZ * H.z);
}
vec3 importanceSampleNormalGGX(float i, float roughness, vec3 N) {
 float p = fract((i + sampleOffset) / float(TOTAL_SAMPLES));
 vec3 H = texture2D(normalDistribution,vec2(roughness, p)).rgb;
 return transformNormal(H, N);
}
float G_Smith(float g, float ndv, float ndl) {
 float roughness = 1.0 - g;
 float k = roughness * roughness / 2.0;
 float G1V = ndv / (ndv * (1.0 - k) + k);
 float G1L = ndl / (ndl * (1.0 - k) + k);
 return G1L * G1V;
}
vec3 F_Schlick(float ndv, vec3 spec) {
 return spec + (1.0 - spec) * pow(1.0 - ndv, 5.0);
}
#endif

float fetchDepth(sampler2D depthTexture, vec2 uv)
{
 vec4 depthTexel = texture2D(depthTexture, uv);
 return depthTexel.r * 2.0 - 1.0;
}

float linearDepth(float depth)
{
 if (projection[3][3] == 0.0) {
 return projection[3][2] / (depth * projection[2][3] - projection[2][2]);
 }
 else {
 return (depth - projection[3][2]) / projection[2][2];
 }
}

bool rayIntersectDepth(float rayZNear, float rayZFar, vec2 hitPixel)
{
 if (rayZFar > rayZNear)
 {
 float t = rayZFar; rayZFar = rayZNear; rayZNear = t;
 }
 float cameraZ = linearDepth(fetchDepth(gBufferTexture2, hitPixel));
 return rayZFar <= cameraZ && rayZNear >= cameraZ - zThicknessThreshold;
}


bool traceScreenSpaceRay(
 vec3 rayOrigin, vec3 rayDir, float jitter,
 out vec2 hitPixel, out vec3 hitPoint, out float iterationCount
)
{
 float rayLength = ((rayOrigin.z + rayDir.z * maxRayDistance) > -nearZ)
 ? (-nearZ - rayOrigin.z) / rayDir.z : maxRayDistance;

 vec3 rayEnd = rayOrigin + rayDir * rayLength;

 vec4 H0 = projection * vec4(rayOrigin, 1.0);
 vec4 H1 = projection * vec4(rayEnd, 1.0);

 float k0 = 1.0 / H0.w, k1 = 1.0 / H1.w;

 vec3 Q0 = rayOrigin * k0, Q1 = rayEnd * k1;

 vec2 P0 = (H0.xy * k0 * 0.5 + 0.5) * viewportSize;
 vec2 P1 = (H1.xy * k1 * 0.5 + 0.5) * viewportSize;

 P1 += dot(P1 - P0, P1 - P0) < 0.0001 ? 0.01 : 0.0;
 vec2 delta = P1 - P0;

 bool permute = false;
 if (abs(delta.x) < abs(delta.y)) {
 permute = true;
 delta = delta.yx;
 P0 = P0.yx;
 P1 = P1.yx;
 }
 float stepDir = sign(delta.x);
 float invdx = stepDir / delta.x;

 vec3 dQ = (Q1 - Q0) * invdx;
 float dk = (k1 - k0) * invdx;

 vec2 dP = vec2(stepDir, delta.y * invdx);

 float strideScaler = 1.0 - min(1.0, -rayOrigin.z / pixelStrideZCutoff);
 float pixStride = 1.0 + strideScaler * pixelStride;

 dP *= pixStride; dQ *= pixStride; dk *= pixStride;

 vec4 pqk = vec4(P0, Q0.z, k0);
 vec4 dPQK = vec4(dP, dQ.z, dk);

 pqk += dPQK * jitter;
 float rayZFar = (dPQK.z * 0.5 + pqk.z) / (dPQK.w * 0.5 + pqk.w);
 float rayZNear;

 bool intersect = false;

 vec2 texelSize = 1.0 / viewportSize;

 iterationCount = 0.0;

 for (int i = 0; i < MAX_ITERATION; i++)
 {
 pqk += dPQK;

 rayZNear = rayZFar;
 rayZFar = (dPQK.z * 0.5 + pqk.z) / (dPQK.w * 0.5 + pqk.w);

 hitPixel = permute ? pqk.yx : pqk.xy;
 hitPixel *= texelSize;

 intersect = rayIntersectDepth(rayZNear, rayZFar, hitPixel);

 iterationCount += 1.0;

 dPQK *= 1.2;

 if (intersect) {
 break;
 }
 }

 Q0.xy += dQ.xy * iterationCount;
 Q0.z = pqk.z;
 hitPoint = Q0 / pqk.w;

 return intersect;
}

float calculateAlpha(
 float iterationCount, float reflectivity,
 vec2 hitPixel, vec3 hitPoint, float dist, vec3 rayDir
)
{
 float alpha = clamp(reflectivity, 0.0, 1.0);
 alpha *= 1.0 - (iterationCount / float(MAX_ITERATION));
 vec2 hitPixelNDC = hitPixel * 2.0 - 1.0;
 float maxDimension = min(1.0, max(abs(hitPixelNDC.x), abs(hitPixelNDC.y)));
 alpha *= 1.0 - max(0.0, maxDimension - screenEdgeFadeStart) / (1.0 - screenEdgeFadeStart);

 float _eyeFadeStart = eyeFadeStart;
 float _eyeFadeEnd = eyeFadeEnd;
 if (_eyeFadeStart > _eyeFadeEnd) {
 float tmp = _eyeFadeEnd;
 _eyeFadeEnd = _eyeFadeStart;
 _eyeFadeStart = tmp;
 }

 float eyeDir = clamp(rayDir.z, _eyeFadeStart, _eyeFadeEnd);
 alpha *= 1.0 - (eyeDir - _eyeFadeStart) / (_eyeFadeEnd - _eyeFadeStart);

 alpha *= 1.0 - clamp(dist / maxRayDistance, 0.0, 1.0);

 return alpha;
}

@import clay.util.rand

@import clay.util.rgbm

void main()
{
 vec4 normalAndGloss = texture2D(gBufferTexture1, v_Texcoord);

 if (dot(normalAndGloss.rgb, vec3(1.0)) == 0.0) {
 discard;
 }

 float g = normalAndGloss.a;
#if !defined(PHYSICALLY_CORRECT)
 if (g <= minGlossiness) {
 discard;
 }
#endif

 float reflectivity = (g - minGlossiness) / (1.0 - minGlossiness);

 vec3 N = normalize(normalAndGloss.rgb * 2.0 - 1.0);
 N = normalize((toViewSpace * vec4(N, 0.0)).xyz);

 vec4 projectedPos = vec4(v_Texcoord * 2.0 - 1.0, fetchDepth(gBufferTexture2, v_Texcoord), 1.0);
 vec4 pos = projectionInv * projectedPos;
 vec3 rayOrigin = pos.xyz / pos.w;
 vec3 V = -normalize(rayOrigin);

 float ndv = clamp(dot(N, V), 0.0, 1.0);
 float iterationCount;
 float jitter = rand(fract(v_Texcoord + jitterOffset));

#ifdef PHYSICALLY_CORRECT
 vec4 color = vec4(vec3(0.0), 1.0);
 vec4 albedoMetalness = texture2D(gBufferTexture3, v_Texcoord);
 vec3 albedo = albedoMetalness.rgb;
 float m = albedoMetalness.a;
 vec3 diffuseColor = albedo * (1.0 - m);
 vec3 spec = mix(vec3(0.04), albedo, m);

 float jitter2 = rand(fract(v_Texcoord)) * float(TOTAL_SAMPLES);

 for (int i = 0; i < SAMPLE_PER_FRAME; i++) {
 vec3 H = importanceSampleNormalGGX(float(i) + jitter2, 1.0 - g, N);
 vec3 rayDir = normalize(reflect(-V, H));
#else
 vec3 rayDir = normalize(reflect(-V, N));
#endif
 vec2 hitPixel;
 vec3 hitPoint;

 bool intersect = traceScreenSpaceRay(rayOrigin, rayDir, jitter, hitPixel, hitPoint, iterationCount);

 float dist = distance(rayOrigin, hitPoint);

 vec3 hitNormal = texture2D(gBufferTexture1, hitPixel).rgb * 2.0 - 1.0;
 hitNormal = normalize((toViewSpace * vec4(hitNormal, 0.0)).xyz);
#ifdef PHYSICALLY_CORRECT
 float ndl = clamp(dot(N, rayDir), 0.0, 1.0);
 float vdh = clamp(dot(V, H), 0.0, 1.0);
 float ndh = clamp(dot(N, H), 0.0, 1.0);
 vec3 litTexel = vec3(0.0);
 if (dot(hitNormal, rayDir) < 0.0 && intersect) {
 litTexel = texture2D(sourceTexture, hitPixel).rgb;
 litTexel *= pow(clamp(1.0 - dist / 200.0, 0.0, 1.0), 3.0);

 }
 else {
 #ifdef SPECULARCUBEMAP_ENABLED
 vec3 rayDirW = normalize(toWorldSpace * vec4(rayDir, 0.0)).rgb;
 litTexel = RGBMDecode(textureCubeLodEXT(specularCubemap, rayDirW, 0.0), 8.12).rgb * specularIntensity;
#endif
 }
 color.rgb += ndl * litTexel * (
 F_Schlick(ndl, spec) * G_Smith(g, ndv, ndl) * vdh / (ndh * ndv + 0.001)
 );
 }
 color.rgb /= float(SAMPLE_PER_FRAME);
#else
 #if !defined(SPECULARCUBEMAP_ENABLED)
 if (dot(hitNormal, rayDir) >= 0.0) {
 discard;
 }
 if (!intersect) {
 discard;
 }
#endif
 float alpha = clamp(calculateAlpha(iterationCount, reflectivity, hitPixel, hitPoint, dist, rayDir), 0.0, 1.0);
 vec4 color = texture2D(sourceTexture, hitPixel);
 color.rgb *= alpha;

#ifdef SPECULARCUBEMAP_ENABLED
 vec3 rayDirW = normalize(toWorldSpace * vec4(rayDir, 0.0)).rgb;
 alpha = alpha * (intersect ? 1.0 : 0.0);
 float bias = (1.0 -g) * 5.0;
 color.rgb += (1.0 - alpha)
 * RGBMDecode(textureCubeLodEXT(specularCubemap, rayDirW, bias), 8.12).rgb
 * specularIntensity;
#endif

#endif

 gl_FragColor = encodeHDR(color);
}
@end

@export ecgl.ssr.blur

uniform sampler2D texture;
uniform sampler2D gBufferTexture1;
uniform sampler2D gBufferTexture2;
uniform mat4 projection;
uniform float depthRange : 0.05;

varying vec2 v_Texcoord;

uniform vec2 textureSize;
uniform float blurSize : 1.0;

#ifdef BLEND
 #ifdef SSAOTEX_ENABLED
uniform sampler2D ssaoTex;
 #endif
uniform sampler2D sourceTexture;
#endif

float getLinearDepth(vec2 coord)
{
 float depth = texture2D(gBufferTexture2, coord).r * 2.0 - 1.0;
 return projection[3][2] / (depth * projection[2][3] - projection[2][2]);
}

@import clay.util.rgbm


void main()
{
 @import clay.compositor.kernel.gaussian_9

 vec4 centerNTexel = texture2D(gBufferTexture1, v_Texcoord);
 float g = centerNTexel.a;
 float maxBlurSize = clamp(1.0 - g, 0.0, 1.0) * blurSize;
#ifdef VERTICAL
 vec2 off = vec2(0.0, maxBlurSize / textureSize.y);
#else
 vec2 off = vec2(maxBlurSize / textureSize.x, 0.0);
#endif

 vec2 coord = v_Texcoord;

 vec4 sum = vec4(0.0);
 float weightAll = 0.0;

 vec3 cN = centerNTexel.rgb * 2.0 - 1.0;
 float cD = getLinearDepth(v_Texcoord);
 for (int i = 0; i < 9; i++) {
 vec2 coord = clamp((float(i) - 4.0) * off + v_Texcoord, vec2(0.0), vec2(1.0));
 float w = gaussianKernel[i]
 * clamp(dot(cN, texture2D(gBufferTexture1, coord).rgb * 2.0 - 1.0), 0.0, 1.0);
 float d = getLinearDepth(coord);
 w *= (1.0 - smoothstep(abs(cD - d) / depthRange, 0.0, 1.0));

 weightAll += w;
 sum += decodeHDR(texture2D(texture, coord)) * w;
 }

#ifdef BLEND
 float aoFactor = 1.0;
 #ifdef SSAOTEX_ENABLED
 aoFactor = texture2D(ssaoTex, v_Texcoord).r;
 #endif
 gl_FragColor = encodeHDR(
 sum / weightAll * aoFactor + decodeHDR(texture2D(sourceTexture, v_Texcoord))
 );
#else
 gl_FragColor = encodeHDR(sum / weightAll);
#endif
}

@end`},function(F,R,g){R.a=[0,0,-.321585265978,-.154972575841,.458126042375,.188473391593,.842080129861,.527766490688,.147304551086,-.659453822776,-.331943915203,-.940619700594,.0479226680259,.54812163202,.701581552186,-.709825561388,-.295436780218,.940589268233,-.901489676764,.237713156085,.973570876096,-.109899459384,-.866792314779,-.451805525005,.330975007087,.800048655954,-.344275183665,.381779221166,-.386139432542,-.437418421534,-.576478634965,-.0148463392551,.385798197415,-.262426961053,-.666302061145,.682427250835,-.628010632582,-.732836215494,.10163141741,-.987658134403,.711995289051,-.320024291314,.0296005138058,.950296523438,.0130612307608,-.351024443122,-.879596633704,-.10478487883,.435712737232,.504254490347,.779203817497,.206477676721,.388264289969,-.896736162545,-.153106280781,-.629203242522,-.245517550697,.657969239148,.126830499058,.26862328493,-.634888119007,-.302301223431,.617074219636,.779817204925]},function(F,R,g){var E=g(5),c=g(4),t=g(9),a=g(10),o=g(19),i=g(15),s=g(60),h=g(197);t.a.import(h.a);function r(l,u,_,f,d){var v=l.gl;u.setUniform(v,"1i",_,d),v.activeTexture(v.TEXTURE0+d),f.isRenderable()?f.bind(l):f.unbind(l)}function e(l,u,_,f,d){var v,m,p,y,x=l.gl;return function(M,P,T){if(!(y&&y.material===M.material)){var O=M.material,D=M.__program,A=O.get("roughness");A==null&&(A=1);var C=O.get("normalMap")||u,S=O.get("roughnessMap"),L=O.get("bumpMap"),I=O.get("uvRepeat"),w=O.get("uvOffset"),b=O.get("detailUvRepeat"),B=O.get("detailUvOffset"),U=!!L&&O.isTextureEnabled("bumpMap"),W=!!S&&O.isTextureEnabled("roughnessMap"),z=O.isDefined("fragment","DOUBLE_SIDED");L=L||_,S=S||f,T!==P?(P.set("normalMap",C),P.set("bumpMap",L),P.set("roughnessMap",S),P.set("useBumpMap",U),P.set("useRoughnessMap",W),P.set("doubleSide",z),I!=null&&P.set("uvRepeat",I),w!=null&&P.set("uvOffset",w),b!=null&&P.set("detailUvRepeat",b),B!=null&&P.set("detailUvOffset",B),P.set("roughness",A)):(D.setUniform(x,"1f","roughness",A),v!==C&&r(l,D,"normalMap",C,0),m!==L&&L&&r(l,D,"bumpMap",L,1),p!==S&&S&&r(l,D,"roughnessMap",S,2),I!=null&&D.setUniform(x,"2f","uvRepeat",I),w!=null&&D.setUniform(x,"2f","uvOffset",w),b!=null&&D.setUniform(x,"2f","detailUvRepeat",b),B!=null&&D.setUniform(x,"2f","detailUvOffset",B),D.setUniform(x,"1i","useBumpMap",+U),D.setUniform(x,"1i","useRoughnessMap",+W),D.setUniform(x,"1i","doubleSide",+z)),v=C,m=L,p=S,y=M}}}function n(l){this._depthTex=new E.a({format:c.a.DEPTH_COMPONENT,type:c.a.UNSIGNED_INT}),this._normalTex=new E.a({type:c.a.HALF_FLOAT}),this._framebuffer=new a.a,this._framebuffer.attach(this._normalTex),this._framebuffer.attach(this._depthTex,a.a.DEPTH_ATTACHMENT),this._normalMaterial=new o.a({shader:new t.a(t.a.source("ecgl.normal.vertex"),t.a.source("ecgl.normal.fragment"))}),this._normalMaterial.enableTexture(["normalMap","bumpMap","roughnessMap"]),this._defaultNormalMap=s.a.createBlank("#000"),this._defaultBumpMap=s.a.createBlank("#000"),this._defaultRoughessMap=s.a.createBlank("#000"),this._debugPass=new i.a({fragment:t.a.source("clay.compositor.output")}),this._debugPass.setUniform("texture",this._normalTex),this._debugPass.material.undefine("fragment","OUTPUT_ALPHA")}n.prototype.getDepthTexture=function(){return this._depthTex},n.prototype.getNormalTexture=function(){return this._normalTex},n.prototype.update=function(l,u,_){var f=l.getWidth(),d=l.getHeight(),v=this._depthTex,m=this._normalTex,p=this._normalMaterial;v.width=f,v.height=d,m.width=f,m.height=d;var y=u.getRenderList(_).opaque;this._framebuffer.bind(l),l.gl.clearColor(0,0,0,0),l.gl.clear(l.gl.COLOR_BUFFER_BIT|l.gl.DEPTH_BUFFER_BIT),l.gl.disable(l.gl.BLEND),l.renderPass(y,_,{getMaterial:function(){return p},ifRender:function(x){return x.renderNormal},beforeRender:e(l,this._defaultNormalMap,this._defaultBumpMap,this._defaultRoughessMap,this._normalMaterial),sort:l.opaqueSortCompare}),this._framebuffer.unbind(l)},n.prototype.renderDebug=function(l){this._debugPass.render(l)},n.prototype.dispose=function(l){this._depthTex.dispose(l),this._normalTex.dispose(l)},R.a=n},function(F,R,g){R.a=`@export ecgl.normal.vertex

@import ecgl.common.transformUniforms

@import ecgl.common.uv.header

@import ecgl.common.attributes

varying vec3 v_Normal;
varying vec3 v_WorldPosition;

@import ecgl.common.normalMap.vertexHeader

@import ecgl.common.vertexAnimation.header

void main()
{

 @import ecgl.common.vertexAnimation.main

 @import ecgl.common.uv.main

 v_Normal = normalize((worldInverseTranspose * vec4(normal, 0.0)).xyz);
 v_WorldPosition = (world * vec4(pos, 1.0)).xyz;

 @import ecgl.common.normalMap.vertexMain

 gl_Position = worldViewProjection * vec4(pos, 1.0);

}


@end


@export ecgl.normal.fragment

#define ROUGHNESS_CHANEL 0

uniform bool useBumpMap;
uniform bool useRoughnessMap;
uniform bool doubleSide;
uniform float roughness;

@import ecgl.common.uv.fragmentHeader

varying vec3 v_Normal;
varying vec3 v_WorldPosition;

uniform mat4 viewInverse : VIEWINVERSE;

@import ecgl.common.normalMap.fragmentHeader
@import ecgl.common.bumpMap.header

uniform sampler2D roughnessMap;

void main()
{
 vec3 N = v_Normal;
 
 bool flipNormal = false;
 if (doubleSide) {
 vec3 eyePos = viewInverse[3].xyz;
 vec3 V = normalize(eyePos - v_WorldPosition);

 if (dot(N, V) < 0.0) {
 flipNormal = true;
 }
 }

 @import ecgl.common.normalMap.fragmentMain

 if (useBumpMap) {
 N = bumpNormal(v_WorldPosition, v_Normal, N);
 }

 float g = 1.0 - roughness;

 if (useRoughnessMap) {
 float g2 = 1.0 - texture2D(roughnessMap, v_DetailTexcoord)[ROUGHNESS_CHANEL];
 g = clamp(g2 + (g - 0.5) * 2.0, 0.0, 1.0);
 }

 if (flipNormal) {
 N = -N;
 }

 gl_FragColor.rgb = (N.xyz + 1.0) * 0.5;
 gl_FragColor.a = g;
}
@end`},function(F,R,g){g(7),g(3);var E=g(5),c=g(4),t=g(15),a=g(9),o=g(10);function i(s){s=s||{},this._edgePass=new t.a({fragment:a.a.source("ecgl.edge")}),this._edgePass.setUniform("normalTexture",s.normalTexture),this._edgePass.setUniform("depthTexture",s.depthTexture),this._targetTexture=new E.a({type:c.a.HALF_FLOAT}),this._frameBuffer=new o.a,this._frameBuffer.attach(this._targetTexture)}i.prototype.update=function(s,h,r,e){var n=s.getWidth(),l=s.getHeight(),u=this._targetTexture;u.width=n,u.height=l;var _=this._frameBuffer;_.bind(s),this._edgePass.setUniform("projectionInv",h.invProjectionMatrix.array),this._edgePass.setUniform("textureSize",[n,l]),this._edgePass.setUniform("texture",r),this._edgePass.render(s),_.unbind(s)},i.prototype.getTargetTexture=function(){return this._targetTexture},i.prototype.setParameter=function(s,h){this._edgePass.setUniform(s,h)},i.prototype.dispose=function(s){this._targetTexture.dispose(s),this._frameBuffer.dispose(s)},R.a=i},function(F,R,g){R.a={type:"compositor",nodes:[{name:"source",type:"texture",outputs:{color:{}}},{name:"source_half",shader:"#source(clay.compositor.downsample)",inputs:{texture:"source"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0, height * 1.0] )"}},{name:"bright",shader:"#source(clay.compositor.bright)",inputs:{texture:"source_half"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{threshold:2,scale:4,textureSize:"expr([width * 1.0 / 2, height / 2])"}},{name:"bright_downsample_4",shader:"#source(clay.compositor.downsample)",inputs:{texture:"bright"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 4)",height:"expr(height * 1.0 / 4)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0 / 2, height / 2] )"}},{name:"bright_downsample_8",shader:"#source(clay.compositor.downsample)",inputs:{texture:"bright_downsample_4"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 8)",height:"expr(height * 1.0 / 8)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0 / 4, height / 4] )"}},{name:"bright_downsample_16",shader:"#source(clay.compositor.downsample)",inputs:{texture:"bright_downsample_8"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 16)",height:"expr(height * 1.0 / 16)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0 / 8, height / 8] )"}},{name:"bright_downsample_32",shader:"#source(clay.compositor.downsample)",inputs:{texture:"bright_downsample_16"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 32)",height:"expr(height * 1.0 / 32)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0 / 16, height / 16] )"}},{name:"bright_upsample_16_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_downsample_32"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 16)",height:"expr(height * 1.0 / 16)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 32, height / 32] )"}},{name:"bright_upsample_16_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_16_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 16)",height:"expr(height * 1.0 / 16)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0 / 16, height * 1.0 / 16] )"}},{name:"bright_upsample_8_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_downsample_16"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 8)",height:"expr(height * 1.0 / 8)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 16, height * 1.0 / 16] )"}},{name:"bright_upsample_8_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_8_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 8)",height:"expr(height * 1.0 / 8)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0 / 8, height * 1.0 / 8] )"}},{name:"bright_upsample_8_blend",shader:"#source(clay.compositor.blend)",inputs:{texture1:"bright_upsample_8_blur_v",texture2:"bright_upsample_16_blur_v"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 8)",height:"expr(height * 1.0 / 8)",type:"HALF_FLOAT"}}},parameters:{weight1:.3,weight2:.7}},{name:"bright_upsample_4_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_downsample_8"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 4)",height:"expr(height * 1.0 / 4)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 8, height * 1.0 / 8] )"}},{name:"bright_upsample_4_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_4_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 4)",height:"expr(height * 1.0 / 4)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0 / 4, height * 1.0 / 4] )"}},{name:"bright_upsample_4_blend",shader:"#source(clay.compositor.blend)",inputs:{texture1:"bright_upsample_4_blur_v",texture2:"bright_upsample_8_blend"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 4)",height:"expr(height * 1.0 / 4)",type:"HALF_FLOAT"}}},parameters:{weight1:.3,weight2:.7}},{name:"bright_upsample_2_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_downsample_4"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 4, height * 1.0 / 4] )"}},{name:"bright_upsample_2_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_2_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0 / 2, height * 1.0 / 2] )"}},{name:"bright_upsample_2_blend",shader:"#source(clay.compositor.blend)",inputs:{texture1:"bright_upsample_2_blur_v",texture2:"bright_upsample_4_blend"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{weight1:.3,weight2:.7}},{name:"bright_upsample_full_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 2, height * 1.0 / 2] )"}},{name:"bright_upsample_full_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_full_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0, height * 1.0] )"}},{name:"bloom_composite",shader:"#source(clay.compositor.blend)",inputs:{texture1:"bright_upsample_full_blur_v",texture2:"bright_upsample_2_blend"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{weight1:.3,weight2:.7}},{name:"coc",shader:"#source(ecgl.dof.coc)",outputs:{color:{parameters:{minFilter:"NEAREST",magFilter:"NEAREST",width:"expr(width * 1.0)",height:"expr(height * 1.0)"}}},parameters:{focalDist:50,focalRange:30}},{name:"dof_far_blur",shader:"#source(ecgl.dof.diskBlur)",inputs:{texture:"source",coc:"coc"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0, height * 1.0] )"}},{name:"dof_near_blur",shader:"#source(ecgl.dof.diskBlur)",inputs:{texture:"source",coc:"coc"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0, height * 1.0] )"},defines:{BLUR_NEARFIELD:null}},{name:"dof_coc_blur",shader:"#source(ecgl.dof.diskBlur)",inputs:{texture:"coc"},outputs:{color:{parameters:{minFilter:"NEAREST",magFilter:"NEAREST",width:"expr(width * 1.0)",height:"expr(height * 1.0)"}}},parameters:{textureSize:"expr( [width * 1.0, height * 1.0] )"},defines:{BLUR_COC:null}},{name:"dof_composite",shader:"#source(ecgl.dof.composite)",inputs:{original:"source",blurred:"dof_far_blur",nearfield:"dof_near_blur",coc:"coc",nearcoc:"dof_coc_blur"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}}},{name:"composite",shader:"#source(clay.compositor.hdr.composite)",inputs:{texture:"source",bloom:"bloom_composite"},defines:{}},{name:"FXAA",shader:"#source(clay.compositor.fxaa)",inputs:{texture:"composite"}}]}},function(F,R,g){R.a=`@export ecgl.dof.coc

uniform sampler2D depth;

uniform float zNear: 0.1;
uniform float zFar: 2000;

uniform float focalDistance: 3;
uniform float focalRange: 1;
uniform float focalLength: 30;
uniform float fstop: 2.8;

varying vec2 v_Texcoord;

@import clay.util.encode_float

void main()
{
 float z = texture2D(depth, v_Texcoord).r * 2.0 - 1.0;

 float dist = 2.0 * zNear * zFar / (zFar + zNear - z * (zFar - zNear));

 float aperture = focalLength / fstop;

 float coc;

 float uppper = focalDistance + focalRange;
 float lower = focalDistance - focalRange;
 if (dist <= uppper && dist >= lower) {
 coc = 0.5;
 }
 else {
 float focalAdjusted = dist > uppper ? uppper : lower;

 coc = abs(aperture * (focalLength * (dist - focalAdjusted)) / (dist * (focalAdjusted - focalLength)));
 coc = clamp(coc, 0.0, 2.0) / 2.00001;

 if (dist < lower) {
 coc = -coc;
 }
 coc = coc * 0.5 + 0.5;
 }

 gl_FragColor = encodeFloat(coc);
}
@end


@export ecgl.dof.composite

#define DEBUG 0

uniform sampler2D original;
uniform sampler2D blurred;
uniform sampler2D nearfield;
uniform sampler2D coc;
uniform sampler2D nearcoc;
varying vec2 v_Texcoord;

@import clay.util.rgbm
@import clay.util.float

void main()
{
 vec4 blurredColor = texture2D(blurred, v_Texcoord);
 vec4 originalColor = texture2D(original, v_Texcoord);

 float fCoc = decodeFloat(texture2D(coc, v_Texcoord));

 fCoc = abs(fCoc * 2.0 - 1.0);

 float weight = smoothstep(0.0, 1.0, fCoc);
 
#ifdef NEARFIELD_ENABLED
 vec4 nearfieldColor = texture2D(nearfield, v_Texcoord);
 float fNearCoc = decodeFloat(texture2D(nearcoc, v_Texcoord));
 fNearCoc = abs(fNearCoc * 2.0 - 1.0);

 gl_FragColor = encodeHDR(
 mix(
 nearfieldColor, mix(originalColor, blurredColor, weight),
 pow(1.0 - fNearCoc, 4.0)
 )
 );
#else
 gl_FragColor = encodeHDR(mix(originalColor, blurredColor, weight));
#endif

}

@end



@export ecgl.dof.diskBlur

#define POISSON_KERNEL_SIZE 16;

uniform sampler2D texture;
uniform sampler2D coc;
varying vec2 v_Texcoord;

uniform float blurRadius : 10.0;
uniform vec2 textureSize : [512.0, 512.0];

uniform vec2 poissonKernel[POISSON_KERNEL_SIZE];

uniform float percent;

float nrand(const in vec2 n) {
 return fract(sin(dot(n.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

@import clay.util.rgbm
@import clay.util.float


void main()
{
 vec2 offset = blurRadius / textureSize;

 float rnd = 6.28318 * nrand(v_Texcoord + 0.07 * percent );
 float cosa = cos(rnd);
 float sina = sin(rnd);
 vec4 basis = vec4(cosa, -sina, sina, cosa);

#if !defined(BLUR_NEARFIELD) && !defined(BLUR_COC)
 offset *= abs(decodeFloat(texture2D(coc, v_Texcoord)) * 2.0 - 1.0);
#endif

#ifdef BLUR_COC
 float cocSum = 0.0;
#else
 vec4 color = vec4(0.0);
#endif


 float weightSum = 0.0;

 for (int i = 0; i < POISSON_KERNEL_SIZE; i++) {
 vec2 ofs = poissonKernel[i];

 ofs = vec2(dot(ofs, basis.xy), dot(ofs, basis.zw));

 vec2 uv = v_Texcoord + ofs * offset;
 vec4 texel = texture2D(texture, uv);

 float w = 1.0;
#ifdef BLUR_COC
 float fCoc = decodeFloat(texel) * 2.0 - 1.0;
 cocSum += clamp(fCoc, -1.0, 0.0) * w;
#else
 texel = texel;
 #if !defined(BLUR_NEARFIELD)
 float fCoc = decodeFloat(texture2D(coc, uv)) * 2.0 - 1.0;
 w *= abs(fCoc);
 #endif
 texel.rgb *= texel.a;
 color += texel * w;
#endif

 weightSum += w;
 }

#ifdef BLUR_COC
 gl_FragColor = encodeFloat(clamp(cocSum / weightSum, -1.0, 0.0) * 0.5 + 0.5);
#else
 color /= weightSum;
 color.rgb /= (color.a + 0.0001);
 gl_FragColor = color;
#endif
}

@end`},function(F,R,g){R.a=`@export ecgl.edge

uniform sampler2D texture;

uniform sampler2D normalTexture;
uniform sampler2D depthTexture;

uniform mat4 projectionInv;

uniform vec2 textureSize;

uniform vec4 edgeColor: [0,0,0,0.8];

varying vec2 v_Texcoord;

vec3 packColor(vec2 coord) {
 float z = texture2D(depthTexture, coord).r * 2.0 - 1.0;
 vec4 p = vec4(v_Texcoord * 2.0 - 1.0, z, 1.0);
 vec4 p4 = projectionInv * p;

 return vec3(
 texture2D(normalTexture, coord).rg,
 -p4.z / p4.w / 5.0
 );
}

void main() {
 vec2 cc = v_Texcoord;
 vec3 center = packColor(cc);

 float size = clamp(1.0 - (center.z - 10.0) / 100.0, 0.0, 1.0) * 0.5;
 float dx = size / textureSize.x;
 float dy = size / textureSize.y;

 vec2 coord;
 vec3 topLeft = packColor(cc+vec2(-dx, -dy));
 vec3 top = packColor(cc+vec2(0.0, -dy));
 vec3 topRight = packColor(cc+vec2(dx, -dy));
 vec3 left = packColor(cc+vec2(-dx, 0.0));
 vec3 right = packColor(cc+vec2(dx, 0.0));
 vec3 bottomLeft = packColor(cc+vec2(-dx, dy));
 vec3 bottom = packColor(cc+vec2(0.0, dy));
 vec3 bottomRight = packColor(cc+vec2(dx, dy));

 vec3 v = -topLeft-2.0*top-topRight+bottomLeft+2.0*bottom+bottomRight;
 vec3 h = -bottomLeft-2.0*left-topLeft+bottomRight+2.0*right+topRight;

 float edge = sqrt(dot(h, h) + dot(v, v));

 edge = smoothstep(0.8, 1.0, edge);

 gl_FragColor = mix(texture2D(texture, v_Texcoord), vec4(edgeColor.rgb, 1.0), edgeColor.a * edge);
}
@end`},function(F,R,g){var E=g(49),c=g(15),t=g(10),a=g(5),o=g(9),i=g(7);function s(h){for(var r=[],e=0;e<30;e++)r.push([Object(E.a)(e,2),Object(E.a)(e,3)]);this._haltonSequence=r,this._frame=0,this._sourceTex=new a.a,this._sourceFb=new t.a,this._sourceFb.attach(this._sourceTex),this._prevFrameTex=new a.a,this._outputTex=new a.a;var n=this._blendPass=new c.a({fragment:o.a.source("clay.compositor.blend")});n.material.disableTexturesAll(),n.material.enableTexture(["texture1","texture2"]),this._blendFb=new t.a({depthBuffer:!1}),this._outputPass=new c.a({fragment:o.a.source("clay.compositor.output"),blendWithPrevious:!0}),this._outputPass.material.define("fragment","OUTPUT_ALPHA"),this._outputPass.material.blend=function(l){l.blendEquationSeparate(l.FUNC_ADD,l.FUNC_ADD),l.blendFuncSeparate(l.ONE,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA)}}s.prototype={constructor:s,jitterProjection:function(h,r){var e=h.viewport,n=e.devicePixelRatio||h.getDevicePixelRatio(),l=e.width*n,u=e.height*n,_=this._haltonSequence[this._frame%this._haltonSequence.length],f=new i.a;f.array[12]=(_[0]*2-1)/l,f.array[13]=(_[1]*2-1)/u,i.a.mul(r.projectionMatrix,f,r.projectionMatrix),i.a.invert(r.invProjectionMatrix,r.projectionMatrix)},resetFrame:function(){this._frame=0},getFrame:function(){return this._frame},getSourceFrameBuffer:function(){return this._sourceFb},getOutputTexture:function(){return this._outputTex},resize:function(h,r){this._prevFrameTex.width=h,this._prevFrameTex.height=r,this._outputTex.width=h,this._outputTex.height=r,this._sourceTex.width=h,this._sourceTex.height=r,this._prevFrameTex.dirty(),this._outputTex.dirty(),this._sourceTex.dirty()},isFinished:function(){return this._frame>=this._haltonSequence.length},render:function(h,r,e){var n=this._blendPass;this._frame===0?(n.setUniform("weight1",0),n.setUniform("weight2",1)):(n.setUniform("weight1",.9),n.setUniform("weight2",.1)),n.setUniform("texture1",this._prevFrameTex),n.setUniform("texture2",r||this._sourceTex),this._blendFb.attach(this._outputTex),this._blendFb.bind(h),n.render(h),this._blendFb.unbind(h),e||(this._outputPass.setUniform("texture",this._outputTex),this._outputPass.render(h));var l=this._prevFrameTex;this._prevFrameTex=this._outputTex,this._outputTex=l,this._frame++},dispose:function(h){this._sourceFb.dispose(h),this._blendFb.dispose(h),this._prevFrameTex.dispose(h),this._outputTex.dispose(h),this._sourceTex.dispose(h),this._outputPass.dispose(h),this._blendPass.dispose(h)}},R.a=s},function(F,R,g){var E=g(0),c=g.n(E);g(204),g(205),g(97),c.a.registerAction({type:"geo3DChangeCamera",event:"geo3dcamerachanged",update:"series:updateCamera"},function(t,a){a.eachComponent({mainType:"geo3D",query:t},function(o){o.setView(t)})})},function(F,R,g){var E=g(0),c=g.n(E),t=g(44),a=g(28),o=g(29),i=g(31),s=g(95),h=c.a.extendComponentModel({type:"geo3D",layoutMode:"box",coordinateSystem:null,optionUpdated:function(){var r=this.option;r.regions=this.getFilledRegions(r.regions,r.map);var e=c.a.helper.completeDimensions(["value"],r.data,{encodeDef:this.get("encode"),dimsDef:this.get("dimensions")}),n=new c.a.List(e,this);n.initData(r.regions);var l={};n.each(function(u){var _=n.getName(u),f=n.getItemModel(u);l[_]=f}),this._regionModelMap=l,this._data=n},getData:function(){return this._data},getRegionModel:function(r){var e=this.getData().getName(r);return this._regionModelMap[e]||new c.a.Model(null,this)},getRegionPolygonCoords:function(r){var e=this.getData().getName(r),n=this.coordinateSystem.getRegion(e);return n?n.geometries:[]},getFormattedLabel:function(r,e){var n=this._data.getName(r),l=this.getRegionModel(n),u=l.get(e==="normal"?["label","formatter"]:["emphasis","label","formatter"]);u==null&&(u=l.get(["label","formatter"]));var _={name:n};if(typeof u=="function")return _.status=e,u(_);if(typeof u=="string"){var f=_.seriesName;return u.replace("{a}",f!=null?f:"")}else return n},defaultOption:{regions:[]}});c.a.util.merge(h.prototype,s.a),c.a.util.merge(h.prototype,t.a),c.a.util.merge(h.prototype,a.a),c.a.util.merge(h.prototype,o.a),c.a.util.merge(h.prototype,i.a)},function(F,R,g){var E=g(63),c=g(0),t=g.n(c),a=g(1),o=g(45),i=g(30);t.a.extendComponentView({type:"geo3D",__ecgl__:!0,init:function(s,h){this._geo3DBuilder=new E.a(h),this.groupGL=new a.a.Node,this._lightRoot=new a.a.Node,this._sceneHelper=new i.a(this._lightRoot),this._sceneHelper.initLight(this._lightRoot),this._control=new o.a({zr:h.getZr()}),this._control.init()},render:function(s,h,r){this.groupGL.add(this._geo3DBuilder.rootNode);var e=s.coordinateSystem;if(!(!e||!e.viewGL)){e.viewGL.add(this._lightRoot),s.get("show")?e.viewGL.add(this.groupGL):e.viewGL.remove(this.groupGL);var n=this._control;n.setViewGL(e.viewGL);var l=s.getModel("viewControl");n.setFromViewControlModel(l,0),this._sceneHelper.setScene(e.viewGL.scene),this._sceneHelper.updateLight(s),e.viewGL.setPostEffect(s.getModel("postEffect"),r),e.viewGL.setTemporalSuperSampling(s.getModel("temporalSuperSampling")),this._geo3DBuilder.update(s,h,r,0,s.getData().count());var u=e.viewGL.isLinearSpace()?"define":"undefine";this._geo3DBuilder.rootNode.traverse(function(_){_.material&&_.material[u]("fragment","SRGB_DECODE")}),n.off("update"),n.on("update",function(){r.dispatchAction({type:"geo3DChangeCamera",alpha:n.getAlpha(),beta:n.getBeta(),distance:n.getDistance(),center:n.getCenter(),from:this.uid,geo3DId:s.id})}),n.update()}},afterRender:function(s,h,r,e){var n=e.renderer;this._sceneHelper.updateAmbientCubemap(n,s,r),this._sceneHelper.updateSkybox(n,s,r)},dispose:function(){this._control.dispose()}})},function(F,R,g){R.a=E;function E(L,I,w){w=w||2;var b=I&&I.length,B=b?I[0]*w:L.length,U=c(L,0,B,w,!0),W=[];if(!U)return W;var z,G,H,X,Q,j,J;if(b&&(U=r(L,I,U,w)),L.length>80*w){z=H=L[0],G=X=L[1];for(var Y=w;Y<B;Y+=w)Q=L[Y],j=L[Y+1],Q<z&&(z=Q),j<G&&(G=j),Q>H&&(H=Q),j>X&&(X=j);J=Math.max(H-z,X-G)}return a(U,W,w,z,G,J),W}function c(L,I,w,b,B){var U,W;if(B===S(L,I,w,b)>0)for(U=I;U<w;U+=b)W=D(U,L[U],L[U+1],W);else for(U=w-b;U>=I;U-=b)W=D(U,L[U],L[U+1],W);return W&&y(W,W.next)&&(A(W),W=W.next),W}function t(L,I){if(!L)return L;I||(I=L);var w=L,b;do if(b=!1,!w.steiner&&(y(w,w.next)||p(w.prev,w,w.next)===0)){if(A(w),w=I=w.prev,w===w.next)return null;b=!0}else w=w.next;while(b||w!==I);return I}function a(L,I,w,b,B,U,W){if(!!L){!W&&U&&u(L,b,B,U);for(var z=L,G,H;L.prev!==L.next;){if(G=L.prev,H=L.next,U?i(L,b,B,U):o(L)){I.push(G.i/w),I.push(L.i/w),I.push(H.i/w),A(L),L=H.next,z=H.next;continue}if(L=H,L===z){W?W===1?(L=s(L,I,w),a(L,I,w,b,B,U,2)):W===2&&h(L,I,w,b,B,U):a(t(L),I,w,b,B,U,1);break}}}}function o(L){var I=L.prev,w=L,b=L.next;if(p(I,w,b)>=0)return!1;for(var B=L.next.next;B!==L.prev;){if(v(I.x,I.y,w.x,w.y,b.x,b.y,B.x,B.y)&&p(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function i(L,I,w,b){var B=L.prev,U=L,W=L.next;if(p(B,U,W)>=0)return!1;for(var z=B.x<U.x?B.x<W.x?B.x:W.x:U.x<W.x?U.x:W.x,G=B.y<U.y?B.y<W.y?B.y:W.y:U.y<W.y?U.y:W.y,H=B.x>U.x?B.x>W.x?B.x:W.x:U.x>W.x?U.x:W.x,X=B.y>U.y?B.y>W.y?B.y:W.y:U.y>W.y?U.y:W.y,Q=f(z,G,I,w,b),j=f(H,X,I,w,b),J=L.nextZ;J&&J.z<=j;){if(J!==L.prev&&J!==L.next&&v(B.x,B.y,U.x,U.y,W.x,W.y,J.x,J.y)&&p(J.prev,J,J.next)>=0)return!1;J=J.nextZ}for(J=L.prevZ;J&&J.z>=Q;){if(J!==L.prev&&J!==L.next&&v(B.x,B.y,U.x,U.y,W.x,W.y,J.x,J.y)&&p(J.prev,J,J.next)>=0)return!1;J=J.prevZ}return!0}function s(L,I,w){var b=L;do{var B=b.prev,U=b.next.next;!y(B,U)&&x(B,b,b.next,U)&&P(B,U)&&P(U,B)&&(I.push(B.i/w),I.push(b.i/w),I.push(U.i/w),A(b),A(b.next),b=L=U),b=b.next}while(b!==L);return b}function h(L,I,w,b,B,U){var W=L;do{for(var z=W.next.next;z!==W.prev;){if(W.i!==z.i&&m(W,z)){var G=O(W,z);W=t(W,W.next),G=t(G,G.next),a(W,I,w,b,B,U),a(G,I,w,b,B,U);return}z=z.next}W=W.next}while(W!==L)}function r(L,I,w,b){var B=[],U,W,z,G,H;for(U=0,W=I.length;U<W;U++)z=I[U]*b,G=U<W-1?I[U+1]*b:L.length,H=c(L,z,G,b,!1),H===H.next&&(H.steiner=!0),B.push(d(H));for(B.sort(e),U=0;U<B.length;U++)n(B[U],w),w=t(w,w.next);return w}function e(L,I){return L.x-I.x}function n(L,I){if(I=l(L,I),I){var w=O(I,L);t(w,w.next)}}function l(L,I){var w=I,b=L.x,B=L.y,U=-Infinity,W;do{if(B<=w.y&&B>=w.next.y&&w.next.y!==w.y){var z=w.x+(B-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(z<=b&&z>U){if(U=z,z===b){if(B===w.y)return w;if(B===w.next.y)return w.next}W=w.x<w.next.x?w:w.next}}w=w.next}while(w!==I);if(!W)return null;if(b===U)return W.prev;var G=W,H=W.x,X=W.y,Q=Infinity,j;for(w=W.next;w!==G;)b>=w.x&&w.x>=H&&b!==w.x&&v(B<X?b:U,B,H,X,B<X?U:b,B,w.x,w.y)&&(j=Math.abs(B-w.y)/(b-w.x),(j<Q||j===Q&&w.x>W.x)&&P(w,L)&&(W=w,Q=j)),w=w.next;return W}function u(L,I,w,b){var B=L;do B.z===null&&(B.z=f(B.x,B.y,I,w,b)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==L);B.prevZ.nextZ=null,B.prevZ=null,_(B)}function _(L){var I,w,b,B,U,W,z,G,H=1;do{for(w=L,L=null,U=null,W=0;w;){for(W++,b=w,z=0,I=0;I<H&&(z++,b=b.nextZ,!!b);I++);for(G=H;z>0||G>0&&b;)z!==0&&(G===0||!b||w.z<=b.z)?(B=w,w=w.nextZ,z--):(B=b,b=b.nextZ,G--),U?U.nextZ=B:L=B,B.prevZ=U,U=B;w=b}U.nextZ=null,H*=2}while(W>1);return L}function f(L,I,w,b,B){return L=32767*(L-w)/B,I=32767*(I-b)/B,L=(L|L<<8)&16711935,L=(L|L<<4)&252645135,L=(L|L<<2)&858993459,L=(L|L<<1)&1431655765,I=(I|I<<8)&16711935,I=(I|I<<4)&252645135,I=(I|I<<2)&858993459,I=(I|I<<1)&1431655765,L|I<<1}function d(L){var I=L,w=L;do I.x<w.x&&(w=I),I=I.next;while(I!==L);return w}function v(L,I,w,b,B,U,W,z){return(B-W)*(I-z)-(L-W)*(U-z)>=0&&(L-W)*(b-z)-(w-W)*(I-z)>=0&&(w-W)*(U-z)-(B-W)*(b-z)>=0}function m(L,I){return L.next.i!==I.i&&L.prev.i!==I.i&&!M(L,I)&&P(L,I)&&P(I,L)&&T(L,I)}function p(L,I,w){return(I.y-L.y)*(w.x-I.x)-(I.x-L.x)*(w.y-I.y)}function y(L,I){return L.x===I.x&&L.y===I.y}function x(L,I,w,b){return y(L,I)&&y(w,b)||y(L,b)&&y(w,I)?!0:p(L,I,w)>0!=p(L,I,b)>0&&p(w,b,L)>0!=p(w,b,I)>0}function M(L,I){var w=L;do{if(w.i!==L.i&&w.next.i!==L.i&&w.i!==I.i&&w.next.i!==I.i&&x(w,w.next,L,I))return!0;w=w.next}while(w!==L);return!1}function P(L,I){return p(L.prev,L,L.next)<0?p(L,I,L.next)>=0&&p(L,L.prev,I)>=0:p(L,I,L.prev)<0||p(L,L.next,I)<0}function T(L,I){var w=L,b=!1,B=(L.x+I.x)/2,U=(L.y+I.y)/2;do w.y>U!=w.next.y>U&&w.next.y!==w.y&&B<(w.next.x-w.x)*(U-w.y)/(w.next.y-w.y)+w.x&&(b=!b),w=w.next;while(w!==L);return b}function O(L,I){var w=new C(L.i,L.x,L.y),b=new C(I.i,I.x,I.y),B=L.next,U=I.prev;return L.next=I,I.prev=L,w.next=B,B.prev=w,b.next=w,w.prev=b,U.next=b,b.prev=U,b}function D(L,I,w,b){var B=new C(L,I,w);return b?(B.next=b.next,B.prev=b,b.next.prev=B,b.next=B):(B.prev=B,B.next=B),B}function A(L){L.next.prev=L.prev,L.prev.next=L.next,L.prevZ&&(L.prevZ.nextZ=L.nextZ),L.nextZ&&(L.nextZ.prevZ=L.prevZ)}function C(L,I,w){this.i=L,this.x=I,this.y=w,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}E.deviation=function(L,I,w,b){var B=I&&I.length,U=B?I[0]*w:L.length,W=Math.abs(S(L,0,U,w));if(B)for(var z=0,G=I.length;z<G;z++){var H=I[z]*w,X=z<G-1?I[z+1]*w:L.length;W-=Math.abs(S(L,H,X,w))}var Q=0;for(z=0;z<b.length;z+=3){var j=b[z]*w,J=b[z+1]*w,Y=b[z+2]*w;Q+=Math.abs((L[j]-L[Y])*(L[J+1]-L[j+1])-(L[j]-L[J])*(L[Y+1]-L[j+1]))}return W===0&&Q===0?0:Math.abs((Q-W)/W)};function S(L,I,w,b){for(var B=0,U=I,W=w-b;U<w;U+=b)B+=(L[W]-L[U])*(L[U+1]+L[W+1]),W=U;return B}},function(F,R){var g={\u5357\u6D77\u8BF8\u5C9B:[32,80],\u5E7F\u4E1C:[0,-10],\u9999\u6E2F:[10,5],\u6FB3\u95E8:[-10,10],\u5929\u6D25:[5,5]};function E(c,t){if(c==="china"){var a=g[t.name];if(a){var o=t.center;o[0]+=a[0]/10.5,o[1]+=-a[1]/(10.5/.75)}}}F.exports=E},function(F,R){var g={Russia:[100,60],"United States":[-99,38],"United States of America":[-99,38]};function E(c,t){if(c==="world"){var a=g[t.name];if(a){var o=t.center;o[0]=a[0],o[1]=a[1]}}}F.exports=E},function(F,R,g){var E=g(0),c=g.n(E);g(210),g(211),g(213),c.a.registerAction({type:"globeChangeCamera",event:"globecamerachanged",update:"series:updateCamera"},function(t,a){a.eachComponent({mainType:"globe",query:t},function(o){o.setView(t)})}),c.a.registerAction({type:"globeUpdateDisplacment",event:"globedisplacementupdated",update:"update"},function(t,a){})},function(F,R,g){var E=g(0),c=g.n(E),t=g(44),a=g(28),o=g(29),i=g(31);function s(r,e){r.id=r.id||r.name||e+""}var h=c.a.extendComponentModel({type:"globe",layoutMode:"box",coordinateSystem:null,init:function(){h.superApply(this,"init",arguments),c.a.util.each(this.option.layers,function(r,e){c.a.util.merge(r,this.defaultLayerOption),s(r,e)},this)},mergeOption:function(r){var e=this.option.layers;this.option.layers=null,h.superApply(this,"mergeOption",arguments);function n(f){return c.a.util.reduce(f,function(d,v,m){return s(v,m),d[v.id]=v,d},{})}if(e&&e.length){var l=n(r.layers),u=n(e);for(var _ in l)u[_]?c.a.util.merge(u[_],l[_],!0):e.push(r.layers[_]);this.option.layers=e}c.a.util.each(this.option.layers,function(f){c.a.util.merge(f,this.defaultLayerOption)},this)},optionUpdated:function(){this.updateDisplacementHash()},defaultLayerOption:{show:!0,type:"overlay"},defaultOption:{show:!0,zlevel:-10,left:0,top:0,width:"100%",height:"100%",environment:"auto",baseColor:"#fff",baseTexture:"",heightTexture:"",displacementTexture:"",displacementScale:0,displacementQuality:"medium",globeRadius:100,globeOuterRadius:150,shading:"lambert",light:{main:{time:""}},viewControl:{autoRotate:!0,panSensitivity:0,targetCoord:null},layers:[]},setDisplacementData:function(r,e,n){this.displacementData=r,this.displacementWidth=e,this.displacementHeight=n},getDisplacementTexture:function(){return this.get("displacementTexture")||this.get("heightTexture")},getDisplacemenScale:function(){var r=this.getDisplacementTexture(),e=this.get("displacementScale");return(!r||r==="none")&&(e=0),e},hasDisplacement:function(){return this.getDisplacemenScale()>0},_displacementChanged:!0,_displacementScale:0,updateDisplacementHash:function(){var r=this.getDisplacementTexture(),e=this.getDisplacemenScale();this._displacementChanged=this._displacementTexture!==r||this._displacementScale!==e,this._displacementTexture=r,this._displacementScale=e},isDisplacementChanged:function(){return this._displacementChanged}});c.a.util.merge(h.prototype,t.a),c.a.util.merge(h.prototype,a.a),c.a.util.merge(h.prototype,o.a),c.a.util.merge(h.prototype,i.a)},function(F,R,g){var E=g(0),c=g.n(E),t=g(1),a=g(45),o=g(30),i=g(212),s=g(2);c.a.extendComponentView({type:"globe",__ecgl__:!0,_displacementScale:0,init:function(h,r){this.groupGL=new t.a.Node,this._sphereGeometry=new t.a.SphereGeometry({widthSegments:200,heightSegments:100,dynamic:!0}),this._overlayGeometry=new t.a.SphereGeometry({widthSegments:80,heightSegments:40}),this._planeGeometry=new t.a.PlaneGeometry,this._earthMesh=new t.a.Mesh({renderNormal:!0}),this._lightRoot=new t.a.Node,this._sceneHelper=new o.a,this._sceneHelper.initLight(this._lightRoot),this.groupGL.add(this._earthMesh),this._control=new a.a({zr:r.getZr()}),this._control.init(),this._layerMeshes={}},render:function(h,r,e){var n=h.coordinateSystem,l=h.get("shading");n.viewGL.add(this._lightRoot),h.get("show")?n.viewGL.add(this.groupGL):n.viewGL.remove(this.groupGL),this._sceneHelper.setScene(n.viewGL.scene),n.viewGL.setPostEffect(h.getModel("postEffect"),e),n.viewGL.setTemporalSuperSampling(h.getModel("temporalSuperSampling"));var u=this._earthMesh;u.geometry=this._sphereGeometry;var _="ecgl."+l;(!u.material||u.material.shader.name!==_)&&(u.material=t.a.createMaterial(_)),t.a.setMaterialFromModel(l,u.material,h,e),["roughnessMap","metalnessMap","detailMap","normalMap"].forEach(function(m){var p=u.material.get(m);p&&(p.flipY=!1)}),u.material.set("color",t.a.parseColor(h.get("baseColor")));var f=n.radius*.99;u.scale.set(f,f,f);var d=u.material.setTextureImage("diffuseMap",h.get("baseTexture"),e,{flipY:!1,anisotropic:8});d&&d.surface&&d.surface.attachToMesh(u);var v=u.material.setTextureImage("bumpMap",h.get("heightTexture"),e,{flipY:!1,anisotropic:8});v&&v.surface&&v.surface.attachToMesh(u),u.material[h.get("postEffect.enable")?"define":"undefine"]("fragment","SRGB_DECODE"),this._updateLight(h,e),this._displaceVertices(h,e),this._updateViewControl(h,e),this._updateLayers(h,e)},afterRender:function(h,r,e,n){var l=n.renderer;this._sceneHelper.updateAmbientCubemap(l,h,e),this._sceneHelper.updateSkybox(l,h,e)},_updateLayers:function(h,r){var e=h.coordinateSystem,n=h.get("layers"),l=e.radius,u=[],_=[],f=[],d=[];c.a.util.each(n,function(x){var M=new c.a.Model(x),P=M.get("type"),T=t.a.loadTexture(M.get("texture"),r,{flipY:!1,anisotropic:8});if(T.surface&&T.surface.attachToMesh(this._earthMesh),P==="blend"){var O=M.get("blendTo"),D=s.a.firstNotNull(M.get("intensity"),1);O==="emission"?(f.push(T),d.push(D)):(u.push(T),_.push(D))}else{var A=M.get("id"),C=this._layerMeshes[A];C||(C=this._layerMeshes[A]=new t.a.Mesh({geometry:this._overlayGeometry,castShadow:!1,ignorePicking:!0}));var S=M.get("shading");S==="lambert"?(C.material=C.__lambertMaterial||new t.a.Material({autoUpdateTextureStatus:!1,shader:t.a.createShader("ecgl.lambert"),transparent:!0,depthMask:!1}),C.__lambertMaterial=C.material):(C.material=C.__colorMaterial||new t.a.Material({autoUpdateTextureStatus:!1,shader:t.a.createShader("ecgl.color"),transparent:!0,depthMask:!1}),C.__colorMaterial=C.material),C.material.enableTexture("diffuseMap");var L=M.get("distance"),I=l+(L==null?e.radius/100:L);C.scale.set(I,I,I),l=I;var w=this._blankTexture||(this._blankTexture=t.a.createBlankTexture("rgba(255, 255, 255, 0)"));C.material.set("diffuseMap",w),t.a.loadTexture(M.get("texture"),r,{flipY:!1,anisotropic:8},function(b){b.surface&&b.surface.attachToMesh(C),C.material.set("diffuseMap",b),r.getZr().refresh()}),M.get("show")?this.groupGL.add(C):this.groupGL.remove(C)}},this);var v=this._earthMesh.material;v.define("fragment","LAYER_DIFFUSEMAP_COUNT",u.length),v.define("fragment","LAYER_EMISSIVEMAP_COUNT",f.length),v.set("layerDiffuseMap",u),v.set("layerDiffuseIntensity",_),v.set("layerEmissiveMap",f),v.set("layerEmissionIntensity",d);var m=h.getModel("debug.wireframe");if(m.get("show")){v.define("both","WIREFRAME_TRIANGLE");var p=t.a.parseColor(m.get("lineStyle.color")||"rgba(0,0,0,0.5)"),y=s.a.firstNotNull(m.get("lineStyle.width"),1);v.set("wireframeLineWidth",y),v.set("wireframeLineColor",p)}else v.undefine("both","WIREFRAME_TRIANGLE")},_updateViewControl:function(h,r){var e=h.coordinateSystem,n=h.getModel("viewControl");e.viewGL.camera;var l=this;function u(){return{type:"globeChangeCamera",alpha:_.getAlpha(),beta:_.getBeta(),distance:_.getDistance()-e.radius,center:_.getCenter(),from:l.uid,globeId:h.id}}var _=this._control;_.setViewGL(e.viewGL);var f=n.get("targetCoord"),d,v;f!=null&&(v=f[0]+90,d=f[1]),_.setFromViewControlModel(n,{baseDistance:e.radius,alpha:d,beta:v}),_.off("update"),_.on("update",function(){r.dispatchAction(u())})},_displaceVertices:function(h,r){var e=h.get("displacementQuality"),n=h.get("debug.wireframe.show"),l=h.coordinateSystem;if(!(!h.isDisplacementChanged()&&e===this._displacementQuality&&n===this._showDebugWireframe)){this._displacementQuality=e,this._showDebugWireframe=n;var u=this._sphereGeometry,_={low:100,medium:200,high:400,ultra:800}[e]||200,f=_/2;(u.widthSegments!==_||n)&&(u.widthSegments=_,u.heightSegments=f,u.build()),this._doDisplaceVertices(u,l),n&&u.generateBarycentric()}},_doDisplaceVertices:function(h,r){var e=h.attributes.position.value,n=h.attributes.texcoord0.value,l=h.__originalPosition;(!l||l.length!==e.length)&&(l=new Float32Array(e.length),l.set(e),h.__originalPosition=l);for(var u=r.displacementWidth,_=r.displacementHeight,f=r.displacementData,d=0;d<h.vertexCount;d++){var v=d*3,m=d*2,p=l[v+1],y=l[v+2],x=l[v+3],M=n[m++],P=n[m++],T=Math.round(M*(u-1)),O=Math.round(P*(_-1)),D=O*u+T,A=f?f[D]:0;e[v+1]=p+p*A,e[v+2]=y+y*A,e[v+3]=x+x*A}h.generateVertexNormals(),h.dirty(),h.updateBoundingBox()},_updateLight:function(h,r){var e=this._earthMesh;this._sceneHelper.updateLight(h);var n=this._sceneHelper.mainLight,l=h.get("light.main.time")||new Date,u=i.a.getPosition(c.a.number.parseDate(l),0,0),_=Math.cos(u.altitude);n.position.y=-_*Math.cos(u.azimuth),n.position.x=Math.sin(u.altitude),n.position.z=_*Math.sin(u.azimuth),n.lookAt(e.getWorldPosition())},dispose:function(h,r){this.groupGL.removeAll(),this._control.dispose()}})},function(F,R,g){var E=Math.PI,c=Math.sin,t=Math.cos,a=Math.tan,o=Math.asin,i=Math.atan2,s=E/180,h=1e3*60*60*24,r=2440588,e=2451545;function n(P){return P.valueOf()/h-.5+r}function l(P){return n(P)-e}var u=s*23.4397;function _(P,T){return i(c(P)*t(u)-a(T)*c(u),t(P))}function f(P,T){return o(c(T)*t(u)+t(T)*c(u)*c(P))}function d(P,T,O){return i(c(P),t(P)*c(T)-a(O)*t(T))}function v(P,T,O){return o(c(T)*c(O)+t(T)*t(O)*t(P))}function m(P,T){return s*(280.16+360.9856235*P)-T}function p(P){return s*(357.5291+.98560028*P)}function y(P){var T=s*(1.9148*c(P)+.02*c(2*P)+3e-4*c(3*P)),O=s*102.9372;return P+T+O+E}function x(P){var T=p(P),O=y(T);return{dec:f(O,0),ra:_(O,0)}}var M={};M.getPosition=function(P,T,O){var D=s*-O,A=s*T,C=l(P),S=x(C),L=m(C,D)-S.ra;return{azimuth:d(L,A,S.dec),altitude:v(L,A,S.dec)}},R.a=M},function(F,R,g){var E=g(214),c=g(0),t=g.n(c),a=g(47),o=g.n(a),i=g(22),s=g(2),h=g(1);function r(u,_){var f=document.createElement("canvas"),d=f.getContext("2d"),v=u.width,m=u.height;f.width=v,f.height=m,d.drawImage(u,0,0,v,m);for(var p=d.getImageData(0,0,v,m).data,y=new Float32Array(p.length/4),x=0;x<p.length/4;x++){var M=p[x*4];y[x]=M/255*_}return{data:y,width:v,height:m}}function e(u,_){var f=u.getBoxLayoutParams(),d=o.a.getLayoutRect(f,{width:_.getWidth(),height:_.getHeight()});d.y=_.getHeight()-d.y-d.height,this.viewGL.setViewport(d.x,d.y,d.width,d.height,_.getDevicePixelRatio()),this.radius=u.get("globeRadius");var v=u.get("globeOuterRadius");this.altitudeAxis&&this.altitudeAxis.setExtent(0,v-this.radius)}function n(u,_){var f=[Infinity,-Infinity];if(u.eachSeries(function(v){if(v.coordinateSystem===this){var m=v.getData(),p=v.coordDimToDataDim("alt"),y=p&&p[0];if(y){var x=m.getDataExtent(y,!0);f[0]=Math.min(f[0],x[0]),f[1]=Math.max(f[1],x[1])}}},this),f&&isFinite(f[1]-f[0])){var d=t.a.helper.createScale(f,{type:"value",min:"dataMin",max:"dataMax"});this.altitudeAxis=new t.a.Axis("altitude",d),this.resize(this.model,_)}}var l={dimensions:E.a.prototype.dimensions,create:function(u,_){var f=[];return u.eachComponent("globe",function(d){d.__viewGL=d.__viewGL||new i.a;var v=new E.a;v.viewGL=d.__viewGL,d.coordinateSystem=v,v.model=d,f.push(v),v.resize=e,v.resize(d,_),v.update=n}),u.eachSeries(function(d){if(d.get("coordinateSystem")==="globe"){var v=d.getReferringComponents("globe")[0];if(v||(v=u.getComponent("globe")),!v)throw new Error('globe "'+s.a.firstNotNull(d.get("globe3DIndex"),d.get("globe3DId"),0)+'" not found');var m=v.coordinateSystem;d.coordinateSystem=m}}),u.eachComponent("globe",function(d,v){var m=d.coordinateSystem,p=d.getDisplacementTexture(),y=d.getDisplacemenScale();if(d.isDisplacementChanged()){if(d.hasDisplacement()){var x=!0;h.a.loadTexture(p,_,function(M){var P=M.image,T=r(P,y);d.setDisplacementData(T.data,T.width,T.height),x||_.dispatchAction({type:"globeUpdateDisplacment"})}),x=!1}else m.setDisplacementData(null,0,0);m.setDisplacementData(d.displacementData,d.displacementWidth,d.displacementHeight)}}),f}};t.a.registerCoordinateSystem("globe",l)},function(F,R,g){var E=g(6),c=E.a.vec3;function t(a){this.radius=a,this.viewGL=null,this.altitudeAxis,this.displacementData=null,this.displacementWidth,this.displacementHeight}t.prototype={constructor:t,dimensions:["lng","lat","alt"],type:"globe",containPoint:function(){},setDisplacementData:function(a,o,i){this.displacementData=a,this.displacementWidth=o,this.displacementHeight=i},_getDisplacementScale:function(a,o){var i=(a+180)/360*(this.displacementWidth-1),s=(90-o)/180*(this.displacementHeight-1),h=Math.round(i)+Math.round(s)*this.displacementWidth;return this.displacementData[h]},dataToPoint:function(a,o){var i=a[0],s=a[1],h=a[2]||0,r=this.radius;this.displacementData&&(r*=1+this._getDisplacementScale(i,s)),this.altitudeAxis&&(r+=this.altitudeAxis.dataToCoord(h)),i=i*Math.PI/180,s=s*Math.PI/180;var e=Math.cos(s)*r;return o=o||[],o[0]=-e*Math.cos(i+Math.PI),o[1]=Math.sin(s)*r,o[2]=e*Math.sin(i+Math.PI),o},pointToData:function(a,o){var i=a[0],s=a[1],h=a[2],r=c.len(a);i/=r,s/=r,h/=r;var e=Math.asin(s),n=Math.atan2(h,-i);n<0&&(n=Math.PI*2+n);var l=e*180/Math.PI,u=n*180/Math.PI-180;return o=o||[],o[0]=u,o[1]=l,o[2]=r-this.radius,this.altitudeAxis&&(o[2]=this.altitudeAxis.coordToData(o[2])),o}},R.a=t},function(F,R,g){var E=g(0),c=g.n(E);g(216),g(218),g(219),c.a.registerAction({type:"mapbox3DChangeCamera",event:"mapbox3dcamerachanged",update:"mapbox3D:updateCamera"},function(t,a){a.eachComponent({mainType:"mapbox3D",query:t},function(o){o.setMapboxCameraOption(t)})})},function(F,R,g){var E=g(217),c=g(0),t=g.n(c),a=g(100),o=Object(a.a)("mapbox3D",E.a,function(i){i.forEach(function(s){s.setCameraOption(s.model.getMapboxCameraOption())})});t.a.registerCoordinateSystem("mapbox3D",o)},function(F,R,g){var E=g(99);function c(){E.a.apply(this,arguments)}c.prototype=new E.a,c.prototype.constructor=c,c.prototype.type="mapbox3D",R.a=c},function(F,R,g){var E=g(0),c=g.n(E),t=g(28),a=g(29),o=["zoom","center","pitch","bearing"],i=c.a.extendComponentModel({type:"mapbox3D",layoutMode:"box",coordinateSystem:null,defaultOption:{zlevel:-10,style:"mapbox://styles/mapbox/light-v9",center:[0,0],zoom:0,pitch:0,bearing:0,light:{main:{alpha:20,beta:30}},altitudeScale:1,boxHeight:"auto"},getMapboxCameraOption:function(){var s=this;return o.reduce(function(h,r){return h[r]=s.get(r),h},{})},setMapboxCameraOption:function(s){s!=null&&o.forEach(function(h){s[h]!=null&&(this.option[h]=s[h])},this)},getMapbox:function(){return this._mapbox},setMapbox:function(s){this._mapbox=s}});c.a.util.merge(i.prototype,t.a),c.a.util.merge(i.prototype,a.a)},function(F,R,g){var E=g(0),c=g.n(E),t=g(220),a=g(30),o=g(1),i=g(101);o.a.Shader.import(i.a),c.a.extendComponentView({type:"mapbox3D",__ecgl__:!0,init:function(s,h){var r=h.getZr();this._zrLayer=new t.a("mapbox3D",r),r.painter.insertLayer(-1e3,this._zrLayer),this._lightRoot=new o.a.Node,this._sceneHelper=new a.a(this._lightRoot),this._sceneHelper.initLight(this._lightRoot);var e=this._zrLayer.getMapbox(),n=this._dispatchInteractAction.bind(this,h,e);["zoom","rotate","drag","pitch","rotate","move"].forEach(function(l){e.on(l,n)}),this._groundMesh=new o.a.Mesh({geometry:new o.a.PlaneGeometry,material:new o.a.Material({shader:new o.a.Shader({vertex:o.a.Shader.source("ecgl.displayShadow.vertex"),fragment:o.a.Shader.source("ecgl.displayShadow.fragment")}),depthMask:!1}),renderOrder:-100,culling:!1,castShadow:!1,$ignorePicking:!0,renderNormal:!0})},render:function(s,h,r){var e=this._zrLayer.getMapbox(),n=s.get("style"),l=JSON.stringify(n);l!==this._oldStyleStr&&n&&e.setStyle(n),this._oldStyleStr=l,e.setCenter(s.get("center")),e.setZoom(s.get("zoom")),e.setPitch(s.get("pitch")),e.setBearing(s.get("bearing")),s.setMapbox(e);var u=s.coordinateSystem;u.viewGL.scene.add(this._lightRoot),u.viewGL.add(this._groundMesh),this._updateGroundMesh(),this._sceneHelper.setScene(u.viewGL.scene),this._sceneHelper.updateLight(s),u.viewGL.setPostEffect(s.getModel("postEffect"),r),u.viewGL.setTemporalSuperSampling(s.getModel("temporalSuperSampling")),this._mapbox3DModel=s},afterRender:function(s,h,r,e){var n=e.renderer;this._sceneHelper.updateAmbientCubemap(n,s,r),this._sceneHelper.updateSkybox(n,s,r),s.coordinateSystem.viewGL.scene.traverse(function(l){l.material&&(l.material.define("fragment","NORMAL_UP_AXIS",2),l.material.define("fragment","NORMAL_FRONT_AXIS",1))})},updateCamera:function(s,h,r,e){s.coordinateSystem.setCameraOption(e),this._updateGroundMesh(),r.getZr().refresh()},_dispatchInteractAction:function(s,h,r){s.dispatchAction({type:"mapbox3DChangeCamera",pitch:h.getPitch(),zoom:h.getZoom(),center:h.getCenter().toArray(),bearing:h.getBearing(),mapbox3DId:this._mapbox3DModel&&this._mapbox3DModel.id})},_updateGroundMesh:function(){if(this._mapbox3DModel){var s=this._mapbox3DModel.coordinateSystem,h=s.dataToPoint(s.center);this._groundMesh.position.set(h[0],h[1],-.001);var r=new o.a.Plane(new o.a.Vector3(0,0,1),0),e=s.viewGL.camera.castRay(new o.a.Vector2(-1,-1)),n=s.viewGL.camera.castRay(new o.a.Vector2(1,1)),l=e.intersectPlane(r),u=n.intersectPlane(r),_=l.dist(u)/s.viewGL.rootNode.scale.x;this._groundMesh.scale.set(_,_,1)}},dispose:function(s,h){this._zrLayer&&this._zrLayer.dispose(),h.getZr().painter.delLayer(-1e3)}})},function(F,R,g){function E(t,a){if(this.id=t,this.zr=a,this.dom=document.createElement("div"),this.dom.style.cssText="position:absolute;left:0;right:0;top:0;bottom:0;",!mapboxgl)throw new Error("Mapbox GL library must be included. See https://www.mapbox.com/mapbox-gl-js/api/");this._mapbox=new mapboxgl.Map({container:this.dom}),this._initEvents()}E.prototype.resize=function(){this._mapbox.resize()},E.prototype.getMapbox=function(){return this._mapbox},E.prototype.clear=function(){},E.prototype.refresh=function(){this._mapbox.resize()};var c=["mousedown","mouseup","click","dblclick","mousemove","mousewheel","wheel","touchstart","touchend","touchmove","touchcancel"];E.prototype._initEvents=function(){var t=this._mapbox.getCanvasContainer();this._handlers=this._handlers||{contextmenu:function(a){return a.preventDefault(),!1}},c.forEach(function(a){this._handlers[a]=function(o){var i={};for(var s in o)i[s]=o[s];i.bubbles=!1;var h=new o.constructor(o.type,i);t.dispatchEvent(h)},this.zr.dom.addEventListener(a,this._handlers[a])},this),this.zr.dom.addEventListener("contextmenu",this._handlers.contextmenu)},E.prototype.dispose=function(){c.forEach(function(t){this.zr.dom.removeEventListener(t,this._handlers[t])},this)},R.a=E},function(F,R,g){var E=g(0),c=g.n(E);g(222),g(224),g(225),c.a.registerAction({type:"maptalks3DChangeCamera",event:"maptalks3dcamerachanged",update:"maptalks3D:updateCamera"},function(t,a){a.eachComponent({mainType:"maptalks3D",query:t},function(o){o.setMaptalksCameraOption(t)})})},function(F,R,g){var E=g(223),c=g(0),t=g.n(c),a=g(100),o=Object(a.a)("maptalks3D",E.a,function(i){i.forEach(function(s){s.setCameraOption(s.model.getMaptalksCameraOption())})});t.a.registerCoordinateSystem("maptalks3D",o)},function(F,R,g){var E=g(99);function c(){E.a.apply(this,arguments),this.maxPitch=85,this.zoomOffset=1}c.prototype=new E.a,c.prototype.constructor=c,c.prototype.type="maptalks3D",R.a=c},function(F,R,g){var E=g(0),c=g.n(E),t=g(28),a=g(29),o=["zoom","center","pitch","bearing"],i=c.a.extendComponentModel({type:"maptalks3D",layoutMode:"box",coordinateSystem:null,defaultOption:{zlevel:-10,urlTemplate:"http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://osm.org">OpenStreetMap</a> contributors, &copy; <a href="https://carto.com/">CARTO</a>',center:[0,0],zoom:0,pitch:0,bearing:0,light:{main:{alpha:20,beta:30}},altitudeScale:1,boxHeight:"auto"},getMaptalksCameraOption:function(){var s=this;return o.reduce(function(h,r){return h[r]=s.get(r),h},{})},setMaptalksCameraOption:function(s){s!=null&&o.forEach(function(h){s[h]!=null&&(this.option[h]=s[h])},this)},getMaptalks:function(){return this._maptalks},setMaptalks:function(s){this._maptalks=s}});c.a.util.merge(i.prototype,t.a),c.a.util.merge(i.prototype,a.a)},function(F,R,g){var E=g(0),c=g.n(E),t=g(226),a=g(30),o=g(1),i=g(101);o.a.Shader.import(i.a),c.a.extendComponentView({type:"maptalks3D",__ecgl__:!0,init:function(r,e){this._groundMesh=new o.a.Mesh({geometry:new o.a.PlaneGeometry,material:new o.a.Material({shader:new o.a.Shader({vertex:o.a.Shader.source("ecgl.displayShadow.vertex"),fragment:o.a.Shader.source("ecgl.displayShadow.fragment")}),depthMask:!1}),renderOrder:-100,culling:!1,castShadow:!1,$ignorePicking:!0,renderNormal:!0})},_initMaptalksLayer:function(r,e){var n=e.getZr();this._zrLayer=new t.a("maptalks3D",n,r.get("center"),r.get("zoom")),n.painter.insertLayer(-1e3,this._zrLayer),this._lightRoot=new o.a.Node,this._sceneHelper=new a.a(this._lightRoot),this._sceneHelper.initLight(this._lightRoot);var l=this._zrLayer.getMaptalks(),u=this._dispatchInteractAction.bind(this,e,l);["zoomend","zooming","zoomstart","dragrotating","pitch","pitchend","movestart","moving","moveend","resize","touchstart","touchmove","touchend","animating"].forEach(function(_){l.on(_,u)})},render:function(r,e,n){this._zrLayer||this._initMaptalksLayer(r,n);var l=this._zrLayer.getMaptalks(),u=r.get("urlTemplate"),_=l.getBaseLayer();u!==this._oldUrlTemplate&&(_?_.setOptions({urlTemplate:u,attribution:r.get("attribution")}):(_=new maptalks.TileLayer("maptalks-echarts-gl-baselayer",{urlTemplate:u,subdomains:["a","b","c"],attribution:r.get("attribution")}),l.setBaseLayer(_))),this._oldUrlTemplate=u,l.setCenter(r.get("center")),l.setZoom(r.get("zoom"),{animation:!1}),l.setPitch(r.get("pitch")),l.setBearing(r.get("bearing")),r.setMaptalks(l);var f=r.coordinateSystem;f.viewGL.scene.add(this._lightRoot),f.viewGL.add(this._groundMesh),this._updateGroundMesh(),this._sceneHelper.setScene(f.viewGL.scene),this._sceneHelper.updateLight(r),f.viewGL.setPostEffect(r.getModel("postEffect"),n),f.viewGL.setTemporalSuperSampling(r.getModel("temporalSuperSampling")),this._maptalks3DModel=r},afterRender:function(r,e,n,l){var u=l.renderer;this._sceneHelper.updateAmbientCubemap(u,r,n),this._sceneHelper.updateSkybox(u,r,n),r.coordinateSystem.viewGL.scene.traverse(function(_){_.material&&(_.material.define("fragment","NORMAL_UP_AXIS",2),_.material.define("fragment","NORMAL_FRONT_AXIS",1))})},updateCamera:function(r,e,n,l){r.coordinateSystem.setCameraOption(l),this._updateGroundMesh(),n.getZr().refresh()},_dispatchInteractAction:function(r,e,n){r.dispatchAction({type:"maptalks3DChangeCamera",pitch:e.getPitch(),zoom:h(e.getResolution())+1,center:e.getCenter().toArray(),bearing:e.getBearing(),maptalks3DId:this._maptalks3DModel&&this._maptalks3DModel.id})},_updateGroundMesh:function(){if(this._maptalks3DModel){var r=this._maptalks3DModel.coordinateSystem,e=r.dataToPoint(r.center);this._groundMesh.position.set(e[0],e[1],-.001);var n=new o.a.Plane(new o.a.Vector3(0,0,1),0),l=r.viewGL.camera.castRay(new o.a.Vector2(-1,-1)),u=r.viewGL.camera.castRay(new o.a.Vector2(1,1)),_=l.intersectPlane(n),f=u.intersectPlane(n),d=_.dist(f)/r.viewGL.rootNode.scale.x;this._groundMesh.scale.set(d,d,1)}},dispose:function(r,e){this._zrLayer&&this._zrLayer.dispose(),e.getZr().painter.delLayer(-1e3)}});const s=2*6378137*Math.PI/(256*Math.pow(2,20));function h(r){return 19-Math.log(r/s)/Math.LN2}},function(F,R,g){function E(t,a,o,i){if(this.id=t,this.zr=a,this.dom=document.createElement("div"),this.dom.style.cssText="position:absolute;left:0;right:0;top:0;bottom:0;",!maptalks)throw new Error("Maptalks library must be included. See https://maptalks.org");this._maptalks=new maptalks.Map(this.dom,{center:o,zoom:i,doubleClickZoom:!1,fog:!1}),this._initEvents()}E.prototype.resize=function(){this._maptalks.checkSize()},E.prototype.getMaptalks=function(){return this._maptalks},E.prototype.clear=function(){},E.prototype.refresh=function(){this._maptalks.checkSize()};var c=["mousedown","mouseup","click","dblclick","mousemove","mousewheel","DOMMouseScroll","touchstart","touchend","touchmove","touchcancel"];E.prototype._initEvents=function(){var t=this.dom;this._handlers=this._handlers||{contextmenu:function(a){return a.preventDefault(),!1}},c.forEach(function(a){this._handlers[a]=function(o){var i={};for(var s in o)i[s]=o[s];i.bubbles=!1;var h=new o.constructor(o.type,i);a==="mousewheel"||a==="DOMMouseScroll"?t.dispatchEvent(h):t.firstElementChild.dispatchEvent(h)},this.zr.dom.addEventListener(a,this._handlers[a])},this),this.zr.dom.addEventListener("contextmenu",this._handlers.contextmenu)},E.prototype.dispose=function(){c.forEach(function(t){this.zr.dom.removeEventListener(t,this._handlers[t])},this),this._maptalks.remove()},R.a=E},function(F,R,g){var E=g(0),c=g.n(E);g(228),g(231),g(233);var t=g(17);c.a.registerVisual(Object(t.a)("bar3D")),c.a.registerProcessor(function(a,o){a.eachSeriesByType("bar3d",function(i){var s=i.getData();s.filterSelf(function(h){return s.hasValue(h)})})})},function(F,R,g){var E=g(0),c=g.n(E),t=g(3),a=g(6),o=g(229),i=g(230),s=a.a.vec3,h=c.a.helper.dataStack.isDimensionStacked;function r(u,_){var f=u.getData(),d=u.get("minHeight")||0,v=u.get("barSize"),m=["lng","lat","alt"].map(function(M){return u.coordDimToDataDim(M)[0]});if(v==null){var p=_.radius*Math.PI,y=Object(i.a)(f,m[0],m[1]);v=[p/Math.sqrt(f.count()/y),p/Math.sqrt(f.count()/y)]}else c.a.util.isArray(v)||(v=[v,v]);var x=l(f,m);f.each(m,function(M,P,T,O){var D=f.get(x.dimension,O),A=x.isStacked?D-T:_.altitudeAxis.scale.getExtent()[0],C=Math.max(_.altitudeAxis.dataToCoord(T),d),S=_.dataToPoint([M,P,A]),L=_.dataToPoint([M,P,D]),I=s.sub([],L,S);s.normalize(I,I);var w=[v[0],C,v[1]];f.setItemLayout(O,[S,I,w])}),f.setLayout("orient",t.a.UP.array)}function e(u,_){var f=u.getData(),d=u.get("barSize"),v=u.get("minHeight")||0,m=["lng","lat","alt"].map(function(P){return u.coordDimToDataDim(P)[0]});if(d==null){var p=Math.min(_.size[0],_.size[2]),y=Object(i.a)(f,m[0],m[1]);d=[p/Math.sqrt(f.count()/y),p/Math.sqrt(f.count()/y)]}else c.a.util.isArray(d)||(d=[d,d]);var x=[0,1,0],M=l(f,m);f.each(m,function(P,T,O,D){var A=f.get(M.dimension,D),C=M.isStacked?A-O:_.altitudeAxis.scale.getExtent()[0],S=Math.max(_.altitudeAxis.dataToCoord(O),v),L=_.dataToPoint([P,T,C]),I=[d[0],S,d[1]];f.setItemLayout(D,[L,x,I])}),f.setLayout("orient",[1,0,0])}function n(u,_){var f=u.getData(),d=u.coordDimToDataDim("lng")[0],v=u.coordDimToDataDim("lat")[0],m=u.coordDimToDataDim("alt")[0],p=u.get("barSize"),y=u.get("minHeight")||0;if(p==null){var x=f.getDataExtent(d),M=f.getDataExtent(v),P=_.dataToPoint([x[0],M[0]]),T=_.dataToPoint([x[1],M[1]]),O=Math.min(Math.abs(P[0]-T[0]),Math.abs(P[1]-T[1]))||1,D=Object(i.a)(f,d,v);p=[O/Math.sqrt(f.count()/D),O/Math.sqrt(f.count()/D)]}else c.a.util.isArray(p)||(p=[p,p]),p[0]/=_.getScale()/16,p[1]/=_.getScale()/16;var A=[0,0,1],C=[d,v,m],S=l(f,C);f.each(C,function(L,I,w,b){var B=f.get(S.dimension,b),U=S.isStacked?B-w:0,W=_.dataToPoint([L,I,U]),z=_.dataToPoint([L,I,B]),G=Math.max(z[2]-W[2],y),H=[p[0],G,p[1]];f.setItemLayout(b,[W,A,H])}),f.setLayout("orient",[1,0,0])}function l(u,_){var f=h(u,_[2]);return{dimension:f?u.getCalculationInfo("stackResultDimension"):_[2],isStacked:f}}c.a.registerLayout(function(u,_){u.eachSeriesByType("bar3D",function(f){var d=f.coordinateSystem,v=d&&d.type;if(v==="globe")r(f,d);else if(v==="cartesian3D")Object(o.a)(f,d);else if(v==="geo3D")e(f,d);else if(v==="mapbox3D"||v==="maptalks3D")n(f,d);else throw d?new Error("bar3D doesn't support coordinate system "+d.type):new Error("bar3D doesn't have coordinate system.")})})},function(F,R,g){var E=g(0),c=g.n(E),t=g(6),a=t.a.vec3,o=c.a.helper.dataStack.isDimensionStacked;function i(h){var r=h[0],e=h[1];return!(r>0&&e>0||r<0&&e<0)}function s(h,r){var e=h.getData(),n=h.get("barSize");if(n==null){var l=r.size,u,_,f=r.getAxis("x"),d=r.getAxis("y");f.type==="category"?u=f.getBandWidth()*.7:u=Math.round(l[0]/Math.sqrt(e.count()))*.6,d.type==="category"?_=d.getBandWidth()*.7:_=Math.round(l[1]/Math.sqrt(e.count()))*.6,n=[u,_]}else c.a.util.isArray(n)||(n=[n,n]);var v=r.getAxis("z").scale.getExtent(),m=i(v),p=["x","y","z"].map(function(M){return h.coordDimToDataDim(M)[0]}),y=o(e,p[2]),x=y?e.getCalculationInfo("stackResultDimension"):p[2];e.each(p,function(M,P,T,O){var D=e.get(x,O),A=y?D-T:m?0:v[0],C=r.dataToPoint([M,P,A]),S=r.dataToPoint([M,P,D]),L=a.dist(C,S),I=[0,S[1]<C[1]?-1:1,0];Math.abs(L)===0&&(L=.1);var w=[n[0],L,n[1]];e.setItemLayout(O,[C,I,w])}),e.setLayout("orient",[1,0,0])}R.a=s},function(F,R,g){R.a=function(E,c,t){for(var a=E.getDataExtent(c),o=E.getDataExtent(t),i=a[1]-a[0]||a[0],s=o[1]-o[0]||o[0],h=50,r=new Uint8Array(h*h),e=0;e<E.count();e++){var n=E.get(c,e),l=E.get(t,e),u=Math.floor((n-a[0])/i*(h-1)),_=Math.floor((l-o[0])/s*(h-1)),f=_*h+u;r[f]=r[f]||1}for(var d=0,e=0;e<r.length;e++)r[e]&&d++;return d/r.length}},function(F,R,g){var E=g(0),c=g.n(E),t=g(1),a=g(2),o=g(32),i=g(232),s=g(65),h=g(6),r=h.a.vec3;c.a.extendChartView({type:"bar3D",__ecgl__:!0,init:function(e,n){this.groupGL=new t.a.Node,this._api=n,this._labelsBuilder=new s.a(256,256,n);var l=this;this._labelsBuilder.getLabelPosition=function(u,_,f){if(l._data){var d=l._data.getItemLayout(u),v=d[0],m=d[1],p=d[2][1];return r.scaleAndAdd([],v,m,f+p)}else return[0,0]},this._labelsBuilder.getMesh().renderOrder=100},render:function(e,n,l){var u=this._prevBarMesh;this._prevBarMesh=this._barMesh,this._barMesh=u,this._barMesh||(this._barMesh=new t.a.Mesh({geometry:new i.a,shadowDepthMaterial:new t.a.Material({shader:new t.a.Shader(t.a.Shader.source("ecgl.sm.depth.vertex"),t.a.Shader.source("ecgl.sm.depth.fragment"))}),culling:e.coordinateSystem.type==="cartesian3D",renderOrder:10,renderNormal:!0})),this.groupGL.remove(this._prevBarMesh),this.groupGL.add(this._barMesh),this.groupGL.add(this._labelsBuilder.getMesh());var _=e.coordinateSystem;if(this._doRender(e,l),_&&_.viewGL){_.viewGL.add(this.groupGL);var f=_.viewGL.isLinearSpace()?"define":"undefine";this._barMesh.material[f]("fragment","SRGB_DECODE")}this._data=e.getData(),this._labelsBuilder.updateData(this._data),this._labelsBuilder.updateLabels(),this._updateAnimation(e)},_updateAnimation:function(e){t.a.updateVertexAnimation([["prevPosition","position"],["prevNormal","normal"]],this._prevBarMesh,this._barMesh,e)},_doRender:function(e,n){var l=e.getData(),u=e.get("shading"),_=u!=="color",f=this,d=this._barMesh,v="ecgl."+u;(!d.material||d.material.shader.name!==v)&&(d.material=t.a.createMaterial(v,["VERTEX_COLOR"])),t.a.setMaterialFromModel(u,d.material,e,n),d.geometry.enableNormal=_,d.geometry.resetOffset();var m=e.get("bevelSize"),p=e.get("bevelSmoothness");d.geometry.bevelSegments=p,d.geometry.bevelSize=m;var y=[],x=new Float32Array(l.count()*4),M=0,P=0,T=!1;l.each(function(C){if(!!l.hasValue(C)){var S=l.getItemVisual(C,"color"),L=l.getItemVisual(C,"opacity");L==null&&(L=1),t.a.parseColor(S,y),y[3]*=L,x[M++]=y[0],x[M++]=y[1],x[M++]=y[2],x[M++]=y[3],y[3]>0&&(P++,y[3]<.99&&(T=!0))}}),d.geometry.setBarCount(P);var O=l.getLayout("orient"),D=this._barIndexOfData=new Int32Array(l.count()),P=0;l.each(function(C){if(!l.hasValue(C)){D[C]=-1;return}var S=l.getItemLayout(C),L=S[0],I=S[1],w=S[2],b=C*4;y[0]=x[b++],y[1]=x[b++],y[2]=x[b++],y[3]=x[b++],y[3]>0&&(f._barMesh.geometry.addBar(L,I,O,w,y,C),D[C]=P++)}),d.geometry.dirty(),d.geometry.updateBoundingBox();var A=d.material;A.transparent=T,A.depthMask=!T,d.geometry.sortTriangles=T,this._initHandler(e,n)},_initHandler:function(e,n){var l=e.getData(),u=this._barMesh,_=e.coordinateSystem.type==="cartesian3D";u.seriesIndex=e.seriesIndex;var f=-1;u.off("mousemove"),u.off("mouseout"),u.on("mousemove",function(d){var v=u.geometry.getDataIndexOfVertex(d.triangle[0]);v!==f&&(this._downplay(f),this._highlight(v),this._labelsBuilder.updateLabels([v]),_&&n.dispatchAction({type:"grid3DShowAxisPointer",value:[l.get("x",v),l.get("y",v),l.get("z",v,!0)]})),f=v,u.dataIndex=v},this),u.on("mouseout",function(d){this._downplay(f),this._labelsBuilder.updateLabels(),f=-1,u.dataIndex=-1,_&&n.dispatchAction({type:"grid3DHideAxisPointer"})},this)},_highlight:function(e){var n=this._data;if(!!n){var l=this._barIndexOfData[e];if(!(l<0)){var u=n.getItemModel(e),_=u.getModel("emphasis.itemStyle"),f=_.get("color"),d=_.get("opacity");if(f==null){var v=n.getItemVisual(e,"color");f=c.a.color.lift(v,-.4)}d==null&&(d=n.getItemVisual(e,"opacity"));var m=t.a.parseColor(f);m[3]*=d,this._barMesh.geometry.setColor(l,m),this._api.getZr().refresh()}}},_downplay:function(e){var n=this._data;if(!!n){var l=this._barIndexOfData[e];if(!(l<0)){var u=n.getItemVisual(e,"color"),_=n.getItemVisual(e,"opacity"),f=t.a.parseColor(u);f[3]*=_,this._barMesh.geometry.setColor(l,f),this._api.getZr().refresh()}}},highlight:function(e,n,l,u){this._toggleStatus("highlight",e,n,l,u)},downplay:function(e,n,l,u){this._toggleStatus("downplay",e,n,l,u)},_toggleStatus:function(e,n,l,u,_){var f=n.getData(),d=a.a.queryDataIndex(f,_),v=this;d!=null?c.a.util.each(o.a.normalizeToArray(d),function(m){e==="highlight"?this._highlight(m):this._downplay(m)},this):f.each(function(m){e==="highlight"?v._highlight(m):v._downplay(m)})},remove:function(){this.groupGL.removeAll()},dispose:function(){this.groupGL.removeAll()}})},function(F,R,g){var E=g(0),c=g.n(E),t=g(39),a=g(64),o=g(14),i=g(6),s=i.a.vec3,h=i.a.mat3,r=o.a.extend(function(){return{attributes:{position:new o.a.Attribute("position","float",3,"POSITION"),normal:new o.a.Attribute("normal","float",3,"NORMAL"),color:new o.a.Attribute("color","float",4,"COLOR"),prevPosition:new o.a.Attribute("prevPosition","float",3),prevNormal:new o.a.Attribute("prevNormal","float",3)},dynamic:!0,enableNormal:!1,bevelSize:1,bevelSegments:0,_dataIndices:null,_vertexOffset:0,_triangleOffset:0}},{resetOffset:function(){this._vertexOffset=0,this._triangleOffset=0},setBarCount:function(e){var n=this.enableNormal,l=this.getBarVertexCount()*e,u=this.getBarTriangleCount()*e;this.vertexCount!==l&&(this.attributes.position.init(l),n?this.attributes.normal.init(l):this.attributes.normal.value=null,this.attributes.color.init(l)),this.triangleCount!==u&&(this.indices=l>65535?new Uint32Array(u*3):new Uint16Array(u*3),this._dataIndices=new Uint32Array(l))},getBarVertexCount:function(){var e=this.bevelSize>0?this.bevelSegments:0;return e>0?this._getBevelBarVertexCount(e):this.enableNormal?24:8},getBarTriangleCount:function(){var e=this.bevelSize>0?this.bevelSegments:0;return e>0?this._getBevelBarTriangleCount(e):12},_getBevelBarVertexCount:function(e){return(e+1)*4*(e+1)*2},_getBevelBarTriangleCount:function(e){var n=e*4+3,l=e*2+1;return(n+1)*l*2+4},setColor:function(e,n){for(var l=this.getBarVertexCount(),u=l*e,_=l*(e+1),f=u;f<_;f++)this.attributes.color.set(f,n);this.dirtyAttribute("color")},getDataIndexOfVertex:function(e){return this._dataIndices?this._dataIndices[e]:null},addBar:function(){for(var e=s.create,n=s.scaleAndAdd,l=e(),u=e(),_=e(),f=e(),d=e(),v=e(),m=e(),p=[],y=[],x=0;x<8;x++)p[x]=e();for(var M=[[0,1,5,4],[2,3,7,6],[4,5,6,7],[3,2,1,0],[0,4,7,3],[1,2,6,5]],P=[0,1,2,0,2,3],T=[],x=0;x<M.length;x++)for(var O=M[x],D=0;D<2;D++){for(var A=[],C=0;C<3;C++)A.push(O[P[D*3+C]]);T.push(A)}return function(S,L,I,w,b,B){var U=this._vertexOffset;if(this.bevelSize>0&&this.bevelSegments>0)this._addBevelBar(S,L,I,w,this.bevelSize,this.bevelSegments,b);else{s.copy(_,L),s.normalize(_,_),s.cross(f,I,_),s.normalize(f,f),s.cross(u,_,f),s.normalize(f,f),s.negate(d,u),s.negate(v,_),s.negate(m,f),n(p[0],S,u,w[0]/2),n(p[0],p[0],f,w[2]/2),n(p[1],S,u,w[0]/2),n(p[1],p[1],m,w[2]/2),n(p[2],S,d,w[0]/2),n(p[2],p[2],m,w[2]/2),n(p[3],S,d,w[0]/2),n(p[3],p[3],f,w[2]/2),n(l,S,_,w[1]),n(p[4],l,u,w[0]/2),n(p[4],p[4],f,w[2]/2),n(p[5],l,u,w[0]/2),n(p[5],p[5],m,w[2]/2),n(p[6],l,d,w[0]/2),n(p[6],p[6],m,w[2]/2),n(p[7],l,d,w[0]/2),n(p[7],p[7],f,w[2]/2);var W=this.attributes;if(this.enableNormal){y[0]=u,y[1]=d,y[2]=_,y[3]=v,y[4]=f,y[5]=m;for(var z=this._vertexOffset,G=0;G<M.length;G++){for(var H=this._triangleOffset*3,X=0;X<6;X++)this.indices[H++]=z+P[X];z+=4,this._triangleOffset+=2}for(var G=0;G<M.length;G++)for(var Q=y[G],X=0;X<4;X++){var j=M[G][X];W.position.set(this._vertexOffset,p[j]),W.normal.set(this._vertexOffset,Q),W.color.set(this._vertexOffset++,b)}}else{for(var G=0;G<T.length;G++){for(var H=this._triangleOffset*3,X=0;X<3;X++)this.indices[H+X]=T[G][X]+this._vertexOffset;this._triangleOffset++}for(var G=0;G<p.length;G++)W.position.set(this._vertexOffset,p[G]),W.color.set(this._vertexOffset++,b)}}for(var J=this._vertexOffset,G=U;G<J;G++)this._dataIndices[G]=B}}(),_addBevelBar:function(){var e=s.create(),n=s.create(),l=s.create(),u=h.create(),_=[],f=[1,-1,-1,1],d=[1,1,-1,-1],v=[2,0];return function(m,p,y,x,M,P,T){s.copy(n,p),s.normalize(n,n),s.cross(l,y,n),s.normalize(l,l),s.cross(e,n,l),s.normalize(l,l),u[0]=e[0],u[1]=e[1],u[2]=e[2],u[3]=n[0],u[4]=n[1],u[5]=n[2],u[6]=l[0],u[7]=l[1],u[8]=l[2],M=Math.min(x[0],x[2])/2*M;for(var O=0;O<3;O++)_[O]=Math.max(x[O]-M*2,0);for(var D=(x[0]-_[0])/2,A=(x[1]-_[1])/2,C=(x[2]-_[2])/2,S=[],L=[],I=this._vertexOffset,w=[],O=0;O<2;O++){w[O]=w[O]=[];for(var b=0;b<=P;b++)for(var B=0;B<4;B++){(b===0&&O===0||O===1&&b===P)&&w[O].push(I);for(var U=0;U<=P;U++){var W=U/P*Math.PI/2+Math.PI/2*B,z=b/P*Math.PI/2+Math.PI/2*O;L[0]=D*Math.cos(W)*Math.sin(z),L[1]=A*Math.cos(z),L[2]=C*Math.sin(W)*Math.sin(z),S[0]=L[0]+f[B]*_[0]/2,S[1]=L[1]+A+v[O]*_[1]/2,S[2]=L[2]+d[B]*_[2]/2,Math.abs(D-A)<1e-6&&Math.abs(A-C)<1e-6||(L[0]/=D*D,L[1]/=A*A,L[2]/=C*C),s.normalize(L,L),s.transformMat3(S,S,u),s.transformMat3(L,L,u),s.add(S,S,m),this.attributes.position.set(I,S),this.enableNormal&&this.attributes.normal.set(I,L),this.attributes.color.set(I,T),I++}}}for(var G=P*4+3,H=P*2+1,X=G+1,B=0;B<H;B++)for(var O=0;O<=G;O++){var Q=B*X+O+this._vertexOffset,j=B*X+(O+1)%X+this._vertexOffset,J=(B+1)*X+(O+1)%X+this._vertexOffset,Y=(B+1)*X+O+this._vertexOffset;this.setTriangleIndices(this._triangleOffset++,[J,Q,j]),this.setTriangleIndices(this._triangleOffset++,[J,Y,Q])}this.setTriangleIndices(this._triangleOffset++,[w[0][0],w[0][2],w[0][1]]),this.setTriangleIndices(this._triangleOffset++,[w[0][0],w[0][3],w[0][2]]),this.setTriangleIndices(this._triangleOffset++,[w[1][0],w[1][1],w[1][2]]),this.setTriangleIndices(this._triangleOffset++,[w[1][0],w[1][2],w[1][3]]),this._vertexOffset=I}}()});c.a.util.defaults(r.prototype,t.a),c.a.util.defaults(r.prototype,a.a),R.a=r},function(F,R,g){var E=g(0),c=g.n(E),t=g(31),a=g(32),o=g(40),i=g(50),s=c.a.extendSeriesModel({type:"series.bar3D",dependencies:["globe"],visualColorAccessPath:"itemStyle.color",getInitialData:function(h,r){return Object(i.a)(this)},getFormattedLabel:function(h,r,e,n){var l=a.a.getFormattedLabel(this,h,r,e,n);return l==null&&(l=this.getData().get("z",h)),l},formatTooltip:function(h){return Object(o.a)(this,h)},defaultOption:{coordinateSystem:"cartesian3D",globeIndex:0,grid3DIndex:0,zlevel:-10,bevelSize:0,bevelSmoothness:2,onGridPlane:"xy",shading:"color",minHeight:0,itemStyle:{opacity:1},label:{show:!1,distance:2,textStyle:{fontSize:14,color:"#000",backgroundColor:"rgba(255,255,255,0.7)",padding:3,borderRadius:3}},emphasis:{label:{show:!0}},animationDurationUpdate:500}});c.a.util.merge(s.prototype,t.a)},function(F,R,g){var E=g(0),c=g.n(E);g(235),g(236);var t=g(51),a=g.n(t),o=g(17);c.a.registerVisual(a()("line3D","circle",null)),c.a.registerVisual(Object(o.a)("line3D")),c.a.registerLayout(function(i,s){i.eachSeriesByType("line3D",function(h){var r=h.getData(),e=h.coordinateSystem;if(e){if(e.type!=="cartesian3D"){console.error("line3D needs cartesian3D coordinateSystem");return}var n=new Float32Array(r.count()*3),l=[],u=[],_=e.dimensions,f=_.map(function(d){return h.coordDimToDataDim(d)[0]});e&&r.each(f,function(d,v,m,p){l[0]=d,l[1]=v,l[2]=m,e.dataToPoint(l,u),n[p*3]=u[0],n[p*3+1]=u[1],n[p*3+2]=u[2]}),r.setLayout("points",n)}})})},function(F,R,g){var E=g(0),c=g.n(E),t=g(40),a=g(50);c.a.extendSeriesModel({type:"series.line3D",dependencies:["grid3D"],visualColorAccessPath:"lineStyle.color",getInitialData:function(o,i){return Object(a.a)(this)},formatTooltip:function(o){return Object(t.a)(this,o)},defaultOption:{coordinateSystem:"cartesian3D",zlevel:-10,grid3DIndex:0,lineStyle:{width:2},animationDurationUpdate:500}})},function(F,R,g){var E=g(0),c=g.n(E),t=g(1),a=g(2),o=g(25),i=g(7),s=g(3),h=g(237),r=g.n(h),e=g(6),n=g(46),l=e.a.vec3;t.a.Shader.import(n.a),c.a.extendChartView({type:"line3D",__ecgl__:!0,init:function(u,_){this.groupGL=new t.a.Node,this._api=_},render:function(u,_,f){var d=this._prevLine3DMesh;this._prevLine3DMesh=this._line3DMesh,this._line3DMesh=d,this._line3DMesh||(this._line3DMesh=new t.a.Mesh({geometry:new o.a({useNativeLine:!1,sortTriangles:!0}),material:new t.a.Material({shader:t.a.createShader("ecgl.meshLines3D")}),renderOrder:10}),this._line3DMesh.geometry.pick=this._pick.bind(this)),this.groupGL.remove(this._prevLine3DMesh),this.groupGL.add(this._line3DMesh);var v=u.coordinateSystem;if(v&&v.viewGL){v.viewGL.add(this.groupGL);var m=v.viewGL.isLinearSpace()?"define":"undefine";this._line3DMesh.material[m]("fragment","SRGB_DECODE")}this._doRender(u,f),this._data=u.getData(),this._camera=v.viewGL.camera,this.updateCamera(),this._updateAnimation(u)},updateCamera:function(){this._updateNDCPosition()},_doRender:function(u,_){var f=u.getData(),d=this._line3DMesh;d.geometry.resetOffset();var v=f.getLayout("points"),m=[],p=new Float32Array(v.length/3*4),y=0,x=!1;f.each(function(T){var O=f.getItemVisual(T,"color"),D=f.getItemVisual(T,"opacity");D==null&&(D=1),t.a.parseColor(O,m),m[3]*=D,p[y++]=m[0],p[y++]=m[1],p[y++]=m[2],p[y++]=m[3],m[3]<.99&&(x=!0)}),d.geometry.setVertexCount(d.geometry.getPolylineVertexCount(v)),d.geometry.setTriangleCount(d.geometry.getPolylineTriangleCount(v)),d.geometry.addPolyline(v,p,a.a.firstNotNull(u.get("lineStyle.width"),1)),d.geometry.dirty(),d.geometry.updateBoundingBox();var M=d.material;M.transparent=x,M.depthMask=!x;var P=u.getModel("debug.wireframe");P.get("show")?(d.geometry.createAttribute("barycentric","float",3),d.geometry.generateBarycentric(),d.material.set("both","WIREFRAME_TRIANGLE"),d.material.set("wireframeLineColor",t.a.parseColor(P.get("lineStyle.color")||"rgba(0,0,0,0.5)")),d.material.set("wireframeLineWidth",a.a.firstNotNull(P.get("lineStyle.width"),1))):d.material.set("both","WIREFRAME_TRIANGLE"),this._points=v,this._initHandler(u,_)},_updateAnimation:function(u){t.a.updateVertexAnimation([["prevPosition","position"],["prevPositionPrev","positionPrev"],["prevPositionNext","positionNext"]],this._prevLine3DMesh,this._line3DMesh,u)},_initHandler:function(u,_){var f=u.getData(),d=u.coordinateSystem,v=this._line3DMesh,m=-1;v.seriesIndex=u.seriesIndex,v.off("mousemove"),v.off("mouseout"),v.on("mousemove",function(p){var y=d.pointToData(p.point.array),x=f.indicesOfNearest("x",y[0])[0];x!==m&&(_.dispatchAction({type:"grid3DShowAxisPointer",value:[f.get("x",x),f.get("y",x),f.get("z",x)]}),v.dataIndex=x),m=x},this),v.on("mouseout",function(p){m=-1,v.dataIndex=-1,_.dispatchAction({type:"grid3DHideAxisPointer"})},this)},_updateNDCPosition:function(){var u=new i.a,_=this._camera;i.a.multiply(u,_.projectionMatrix,_.viewMatrix);var f=this._positionNDC,d=this._points,v=d.length/3;(!f||f.length/2!==v)&&(f=this._positionNDC=new Float32Array(v*2));for(var m=[],p=0;p<v;p++){var y=p*3,x=p*2;m[0]=d[y],m[1]=d[y+1],m[2]=d[y+2],m[3]=1,l.transformMat4(m,m,u.array),f[x]=m[0]/m[3],f[x+1]=m[1]/m[3]}},_pick:function(u,_,f,d,v,m){var p=this._positionNDC,y=this._data.hostModel,x=y.get("lineStyle.width"),M=-1,P=f.viewport.width,T=f.viewport.height,O=P*.5,D=T*.5;u=(u+1)*O,_=(_+1)*D;for(var A=1;A<p.length/2;A++){var C=(p[(A-1)*2]+1)*O,S=(p[(A-1)*2+1]+1)*D,L=(p[A*2]+1)*O,I=(p[A*2+1]+1)*D;if(r.a.containStroke(C,S,L,I,x,u,_)){var w=(C-u)*(C-u)+(S-_)*(S-_),b=(L-u)*(L-u)+(I-_)*(I-_);M=w<b?A-1:A}}if(M>=0){var B=M*3,U=new s.a(this._points[B],this._points[B+1],this._points[B+2]);m.push({dataIndex:M,point:U,pointWorld:U.clone(),target:this._line3DMesh,distance:this._camera.getWorldPosition().dist(U)})}},remove:function(){this.groupGL.removeAll()},dispose:function(){this.groupGL.removeAll()}})},function(F,R){function g(E,c,t,a,o,i,s){if(o===0)return!1;var h=o,r=0,e=E;if(s>c+h&&s>a+h||s<c-h&&s<a-h||i>E+h&&i>t+h||i<E-h&&i<t-h)return!1;if(E!==t)r=(c-a)/(E-t),e=(E*a-t*c)/(E-t);else return Math.abs(i-E)<=h/2;var n=r*i-s+e,l=n*n/(r*r+1);return l<=h/2*h/2}R.containStroke=g},function(F,R,g){var E=g(0),c=g.n(E);g(239),g(240);var t=g(51),a=g.n(t),o=g(17);c.a.registerVisual(a()("scatter3D","circle",null)),c.a.registerVisual(Object(o.a)("scatter3D")),c.a.registerLayout({seriesType:"scatter3D",reset:function(i){var s=i.coordinateSystem;if(s){var h=s.dimensions;if(h.length<3){console.error("scatter3D needs 3D coordinateSystem");return}var r=h.map(function(l){return i.coordDimToDataDim(l)[0]}),e=[],n=[];return{progress:function(l,u){for(var _=new Float32Array((l.end-l.start)*3),f=l.start;f<l.end;f++){var d=(f-l.start)*3;e[0]=u.get(r[0],f),e[1]=u.get(r[1],f),e[2]=u.get(r[2],f),s.dataToPoint(e,n),_[d]=n[0],_[d+1]=n[1],_[d+2]=n[2]}u.setLayout("points",_)}}}}})},function(F,R,g){var E=g(0),c=g.n(E),t=g(32),a=g(40),o=g(50);c.a.extendSeriesModel({type:"series.scatter3D",dependencies:["globe","grid3D","geo3D"],visualColorAccessPath:"itemStyle.color",getInitialData:function(i,s){return Object(o.a)(this)},getFormattedLabel:function(i,s,h,r){var e=t.a.getFormattedLabel(this,i,s,h,r);if(e==null){var n=this.getData(),l=n.dimensions[n.dimensions.length-1];e=n.get(l,i)}return e},formatTooltip:function(i){return Object(a.a)(this,i)},defaultOption:{coordinateSystem:"cartesian3D",zlevel:-10,progressive:1e5,progressiveThreshold:1e5,grid3DIndex:0,globeIndex:0,symbol:"circle",symbolSize:10,blendMode:"source-over",label:{show:!1,position:"right",distance:5,textStyle:{fontSize:14,color:"#000",backgroundColor:"rgba(255,255,255,0.7)",padding:3,borderRadius:3}},itemStyle:{opacity:.8},emphasis:{label:{show:!0}},animationDurationUpdate:500}})},function(F,R,g){var E=g(0),c=g.n(E),t=g(1),a=g(2),o=g(32),i=g(66);c.a.extendChartView({type:"scatter3D",__ecgl__:!0,init:function(s,h){this.groupGL=new t.a.Node,this._pointsBuilderList=[],this._currentStep=0},render:function(s,h,r){if(this.groupGL.removeAll(),!!s.getData().count()){var e=s.coordinateSystem;if(e&&e.viewGL){e.viewGL.add(this.groupGL),this._camera=e.viewGL.camera;var n=this._pointsBuilderList[0];n||(n=this._pointsBuilderList[0]=new i.a(!1,r)),this._pointsBuilderList.length=1,this.groupGL.add(n.rootNode),n.update(s,h,r),n.updateView(e.viewGL.camera)}else throw new Error("Invalid coordinate system")}},incrementalPrepareRender:function(s,h,r){var e=s.coordinateSystem;if(e&&e.viewGL)e.viewGL.add(this.groupGL),this._camera=e.viewGL.camera;else throw new Error("Invalid coordinate system");this.groupGL.removeAll(),this._currentStep=0},incrementalRender:function(s,h,r,e){if(!(s.end<=s.start)){var n=this._pointsBuilderList[this._currentStep];n||(n=new i.a(!1,e),this._pointsBuilderList[this._currentStep]=n),this.groupGL.add(n.rootNode),n.update(h,r,e,s.start,s.end),n.updateView(h.coordinateSystem.viewGL.camera),this._currentStep++}},updateCamera:function(){this._pointsBuilderList.forEach(function(s){s.updateView(this._camera)},this)},highlight:function(s,h,r,e){this._toggleStatus("highlight",s,h,r,e)},downplay:function(s,h,r,e){this._toggleStatus("downplay",s,h,r,e)},_toggleStatus:function(s,h,r,e,n){var l=h.getData(),u=a.a.queryDataIndex(l,n),_=s==="highlight";u!=null?c.a.util.each(o.a.normalizeToArray(u),function(f){for(var d=0;d<this._pointsBuilderList.length;d++){var v=this._pointsBuilderList[d];_?v.highlight(l,f):v.downplay(l,f)}},this):l.each(function(f){for(var d=0;d<this._pointsBuilderList.length;d++){var v=this._pointsBuilderList[d];_?v.highlight(l,f):v.downplay(l,f)}})},dispose:function(){this.groupGL.removeAll()},remove:function(){this.groupGL.removeAll()}})},function(F,R,g){var E=g(0),c=g.n(E);function t(s,h,r){var h=h||document.createElement("canvas");h.width=s,h.height=s;var e=h.getContext("2d");return r&&r(e),h}function a(s,h,r,e){c.a.util.isArray(h)||(h=[h,h]);var n=i.getMarginByStyle(r,e),l=h[0]+n.left+n.right,u=h[1]+n.top+n.bottom,_=c.a.helper.createSymbol(s,0,0,h[0],h[1]),f=Math.max(l,u);_.position=[n.left,n.top],l>u?_.position[1]+=(f-u)/2:_.position[0]+=(f-l)/2;var d=_.getBoundingRect();return _.position[0]-=d.x,_.position[1]-=d.y,_.setStyle(r),_.update(),_.__size=f,_}function o(s,h,r){var e=h.width,n=h.height,l=s.canvas.width,u=s.canvas.height,_=e/l,f=n/u;function d(T){return T<128?1:-1}function v(T,O){var D=Infinity;T=Math.floor(T*_),O=Math.floor(O*f);for(var A=O*e+T,C=h.data[A*4],S=d(C),L=Math.max(O-r,0);L<Math.min(O+r,n);L++)for(var I=Math.max(T-r,0);I<Math.min(T+r,e);I++){var A=L*e+I,w=h.data[A*4],b=d(w),B=I-T,U=L-O;if(S!==b){var W=B*B+U*U;W<D&&(D=W)}}return S*Math.sqrt(D)}for(var m=s.createImageData(l,u),p=0;p<u;p++)for(var y=0;y<l;y++){var x=v(y,p),M=x/r*.5+.5,P=(p*l+y)*4;m.data[P++]=(1-M)*255,m.data[P++]=(1-M)*255,m.data[P++]=(1-M)*255,m.data[P++]=255}return m}var i={getMarginByStyle:function(s){var h=s.minMargin||0,r=0;s.stroke&&s.stroke!=="none"&&(r=s.lineWidth==null?1:s.lineWidth);var e=s.shadowBlur||0,n=s.shadowOffsetX||0,l=s.shadowOffsetY||0,u={};return u.left=Math.max(r/2,-n+e,h),u.right=Math.max(r/2,n+e,h),u.top=Math.max(r/2,-l+e,h),u.bottom=Math.max(r/2,l+e,h),u},createSymbolSprite:function(s,h,r,e){var n=a(s,h,r),l=i.getMarginByStyle(r);return{image:t(n.__size,e,function(u){n.brush(u)}),margin:l}},createSDFFromCanvas:function(s,h,r,e){return t(h,e,function(n){var l=s.getContext("2d"),u=l.getImageData(0,0,s.width,s.height);n.putImageData(o(n,u,r),0,0)})},createSimpleSprite:function(s,h){return t(s,h,function(r){var e=s/2;r.beginPath(),r.arc(e,e,60,0,Math.PI*2,!1),r.closePath();var n=r.createRadialGradient(e,e,0,e,e,e);n.addColorStop(0,"rgba(255, 255, 255, 1)"),n.addColorStop(.5,"rgba(255, 255, 255, 0.5)"),n.addColorStop(1,"rgba(255, 255, 255, 0)"),r.fillStyle=n,r.fill()})}};R.a=i},function(F,R,g){var E=g(1),c=g(243),t=g(0),a=g.n(t),o=g(6),i=g(244),s=o.a.vec4;E.a.Shader.import(i.a);var h=E.a.Mesh.extend(function(){var r=new E.a.Geometry({dynamic:!0,attributes:{color:new E.a.Geometry.Attribute("color","float",4,"COLOR"),position:new E.a.Geometry.Attribute("position","float",3,"POSITION"),size:new E.a.Geometry.Attribute("size","float",1),prevPosition:new E.a.Geometry.Attribute("prevPosition","float",3),prevSize:new E.a.Geometry.Attribute("prevSize","float",1)}});a.a.util.extend(r,c.a);var e=new E.a.Material({shader:E.a.createShader("ecgl.sdfSprite"),transparent:!0,depthMask:!1});e.enableTexture("sprite"),e.define("both","VERTEX_COLOR"),e.define("both","VERTEX_SIZE");var n=new E.a.Texture2D({image:document.createElement("canvas"),flipY:!1});return e.set("sprite",n),r.pick=this._pick.bind(this),{geometry:r,material:e,mode:E.a.Mesh.POINTS,sizeScale:1}},{_pick:function(r,e,n,l,u,_){var f=this._positionNDC;if(!!f)for(var d=n.viewport,v=2/d.width,m=2/d.height,p=this.geometry.vertexCount-1;p>=0;p--){var y;this.geometry.indices?y=this.geometry.indices[p]:y=p;var x=f[y*2],M=f[y*2+1],P=this.geometry.attributes.size.get(y)/this.sizeScale,T=P/2;if(r>x-T*v&&r<x+T*v&&e>M-T*m&&e<M+T*m){var O=new E.a.Vector3,D=new E.a.Vector3;this.geometry.attributes.position.get(y,O.array),E.a.Vector3.transformMat4(D,O,this.worldTransform),_.push({vertexIndex:y,point:O,pointWorld:D,target:this,distance:D.distance(l.getWorldPosition())})}}},updateNDCPosition:function(r,e,n){var l=this._positionNDC,u=this.geometry;(!l||l.length/2!==u.vertexCount)&&(l=this._positionNDC=new Float32Array(u.vertexCount*2));for(var _=s.create(),f=0;f<u.vertexCount;f++)u.attributes.position.get(f,_),_[3]=1,s.transformMat4(_,_,r.array),s.scale(_,_,1/_[3]),l[f*2]=_[0],l[f*2+1]=_[1]}});R.a=h},function(F,R,g){var E=g(96),c=g(6),t=c.a.vec3;R.a={needsSortVertices:function(){return this.sortVertices},needsSortVerticesProgressively:function(){return this.needsSortVertices()&&this.vertexCount>=2e4},doSortVertices:function(a,o){var i=this.indices,s=t.create();if(!i){i=this.indices=this.vertexCount>65535?new Uint32Array(this.vertexCount):new Uint16Array(this.vertexCount);for(var h=0;h<i.length;h++)i[h]=h}if(o===0){var r=this.attributes.position,a=a.array,e=0;(!this._zList||this._zList.length!==this.vertexCount)&&(this._zList=new Float32Array(this.vertexCount));for(var n,h=0;h<this.vertexCount;h++){r.get(h,s);var l=t.sqrDist(s,a);isNaN(l)&&(l=1e7,e++),h===0?(n=l,l=0):l=l-n,this._zList[h]=l}this._noneCount=e}if(this.vertexCount<2e4)o===0&&this._simpleSort(this._noneCount/this.vertexCount>.05);else for(var h=0;h<3;h++)this._progressiveQuickSort(o*3+h);this.dirtyIndices()},_simpleSort:function(a){var o=this._zList,i=this.indices;function s(h,r){return o[r]-o[h]}a?Array.prototype.sort.call(i,s):E.a.sort(i,s,0,i.length-1)},_progressiveQuickSort:function(a){var o=this._zList,i=this.indices;this._quickSort=this._quickSort||new E.a,this._quickSort.step(i,function(s,h){return o[h]-o[s]},a)}}},function(F,R,g){R.a=`@export ecgl.sdfSprite.vertex

uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;
uniform float elapsedTime : 0;

attribute vec3 position : POSITION;

#ifdef VERTEX_SIZE
attribute float size;
#else
uniform float u_Size;
#endif

#ifdef VERTEX_COLOR
attribute vec4 a_FillColor: COLOR;
varying vec4 v_Color;
#endif

#ifdef VERTEX_ANIMATION
attribute vec3 prevPosition;
attribute float prevSize;
uniform float percent : 1.0;
#endif


#ifdef POSITIONTEXTURE_ENABLED
uniform sampler2D positionTexture;
#endif

varying float v_Size;

void main()
{

#ifdef POSITIONTEXTURE_ENABLED
 gl_Position = worldViewProjection * vec4(texture2D(positionTexture, position.xy).xy, -10.0, 1.0);
#else

 #ifdef VERTEX_ANIMATION
 vec3 pos = mix(prevPosition, position, percent);
 #else
 vec3 pos = position;
 #endif
 gl_Position = worldViewProjection * vec4(pos, 1.0);
#endif

#ifdef VERTEX_SIZE
#ifdef VERTEX_ANIMATION
 v_Size = mix(prevSize, size, percent);
#else
 v_Size = size;
#endif
#else
 v_Size = u_Size;
#endif

#ifdef VERTEX_COLOR
 v_Color = a_FillColor;
 #endif

 gl_PointSize = v_Size;
}

@end

@export ecgl.sdfSprite.fragment

uniform vec4 color: [1, 1, 1, 1];
uniform vec4 strokeColor: [1, 1, 1, 1];
uniform float smoothing: 0.07;

uniform float lineWidth: 0.0;

#ifdef VERTEX_COLOR
varying vec4 v_Color;
#endif

varying float v_Size;

uniform sampler2D sprite;

@import clay.util.srgb

void main()
{
 gl_FragColor = color;

 vec4 _strokeColor = strokeColor;

#ifdef VERTEX_COLOR
 gl_FragColor *= v_Color;
 #endif

#ifdef SPRITE_ENABLED
 float d = texture2D(sprite, gl_PointCoord).r;
 gl_FragColor.a *= smoothstep(0.5 - smoothing, 0.5 + smoothing, d);

 if (lineWidth > 0.0) {
 float sLineWidth = lineWidth / 2.0;

 float outlineMaxValue0 = 0.5 + sLineWidth;
 float outlineMaxValue1 = 0.5 + sLineWidth + smoothing;
 float outlineMinValue0 = 0.5 - sLineWidth - smoothing;
 float outlineMinValue1 = 0.5 - sLineWidth;

 if (d <= outlineMaxValue1 && d >= outlineMinValue0) {
 float a = _strokeColor.a;
 if (d <= outlineMinValue1) {
 a = a * smoothstep(outlineMinValue0, outlineMinValue1, d);
 }
 else {
 a = a * smoothstep(outlineMaxValue1, outlineMaxValue0, d);
 }
 gl_FragColor.rgb = mix(gl_FragColor.rgb * gl_FragColor.a, _strokeColor.rgb, a);
 gl_FragColor.a = gl_FragColor.a * (1.0 - a) + a;
 }
 }
#endif

#ifdef SRGB_DECODE
 gl_FragColor = sRGBToLinear(gl_FragColor);
#endif
}
@end`},function(F,R,g){var E=g(0),c=g.n(E);g(246),g(247),g(250);var t=g(17);c.a.registerVisual(Object(t.a)("lines3D")),c.a.registerAction({type:"lines3DPauseEffect",event:"lines3deffectpaused",update:"series.lines3D:pauseEffect"},function(){}),c.a.registerAction({type:"lines3DResumeEffect",event:"lines3deffectresumed",update:"series.lines3D:resumeEffect"},function(){}),c.a.registerAction({type:"lines3DToggleEffect",event:"lines3deffectchanged",update:"series.lines3D:toggleEffect"},function(){})},function(F,R,g){var E=g(0),c=g.n(E),t=g(6),a=t.a.vec3,o=t.a.vec2,i=a.normalize,s=a.cross,h=a.sub,r=a.add,e=a.create,n=e(),l=e(),u=e(),_=e(),f=[],d=[];function v(P,T){o.copy(f,P[0]),o.copy(d,P[1]);var O=[],D=O[0]=e(),A=O[1]=e(),C=O[2]=e(),S=O[3]=e();T.dataToPoint(f,D),T.dataToPoint(d,S),i(n,D),h(l,S,D),i(l,l),s(u,l,n),i(u,u),s(l,n,u),r(A,n,l),i(A,A),i(n,S),h(l,D,S),i(l,l),s(u,l,n),i(u,u),s(l,n,u),r(C,n,l),i(C,C),r(_,D,S),i(_,_);var L=a.dot(D,_),I=a.dot(_,A),w=(Math.max(a.len(D),a.len(S))-L)/I*2;return a.scaleAndAdd(A,D,A,w),a.scaleAndAdd(C,S,C,w),O}function m(P,T,O){var D=[],A=D[0]=a.create(),C=D[1]=a.create(),S=D[2]=a.create(),L=D[3]=a.create();T.dataToPoint(P[0],A),T.dataToPoint(P[1],L);var I=a.dist(A,L);return a.lerp(C,A,L,.3),a.lerp(S,A,L,.3),a.scaleAndAdd(C,C,O,Math.min(I*.1,10)),a.scaleAndAdd(S,S,O,Math.min(I*.1,10)),D}function p(P,T){for(var O=new Float32Array(P.length*3),D=0,A=[],C=0;C<P.length;C++)T.dataToPoint(P[C],A),O[D++]=A[0],O[D++]=A[1],O[D++]=A[2];return O}function y(P){var T=[];return P.each(function(O){var D=P.getItemModel(O),A=D.option instanceof Array?D.option:D.getShallow("coords",!0);if(!(A instanceof Array&&A.length>0&&A[0]instanceof Array))throw new Error("Invalid coords "+JSON.stringify(A)+". Lines must have 2d coords array in data item.");T.push(A)}),{coordsList:T}}function x(P,T){var O=P.getData(),D=P.get("polyline");O.setLayout("lineType",D?"polyline":"cubicBezier");var A=y(O);O.each(function(C){var S=A.coordsList[C],L=D?p:v;O.setItemLayout(C,L(S,T))})}function M(P,T,O){var D=P.getData(),A=P.get("polyline"),C=y(D);D.setLayout("lineType",A?"polyline":"cubicBezier"),D.each(function(S){var L=C.coordsList[S],I=A?p(L,T):m(L,T,O);D.setItemLayout(S,I)})}c.a.registerLayout(function(P,T){P.eachSeriesByType("lines3D",function(O){var D=O.coordinateSystem;D.type==="globe"?x(O,D):D.type==="geo3D"?M(O,D,[0,1,0]):(D.type==="mapbox3D"||D.type==="maptalks3D")&&M(O,D,[0,0,1])})})},function(F,R,g){var E=g(0),c=g.n(E),t=g(1),a=g(25),o=g(248),i=g(46);t.a.Shader.import(i.a);function s(h){return h.radius!=null?h.radius:h.size!=null?Math.max(h.size[0],h.size[1],h.size[2]):100}c.a.extendChartView({type:"lines3D",__ecgl__:!0,init:function(h,r){this.groupGL=new t.a.Node,this._meshLinesMaterial=new t.a.Material({shader:t.a.createShader("ecgl.meshLines3D"),transparent:!0,depthMask:!1}),this._linesMesh=new t.a.Mesh({geometry:new a.a,material:this._meshLinesMaterial,$ignorePicking:!0}),this._trailMesh=new o.a},render:function(h,r,e){this.groupGL.add(this._linesMesh);var n=h.coordinateSystem,l=h.getData();if(n&&n.viewGL){var u=n.viewGL;u.add(this.groupGL),this._updateLines(h,r,e);var _=n.viewGL.isLinearSpace()?"define":"undefine";this._linesMesh.material[_]("fragment","SRGB_DECODE"),this._trailMesh.material[_]("fragment","SRGB_DECODE")}var f=this._trailMesh;if(f.stopAnimation(),h.get("effect.show")){this.groupGL.add(f),f.updateData(l,e,this._linesMesh.geometry),f.__time=f.__time||0;var d=3600*1e3;this._curveEffectsAnimator=f.animate("",{loop:!0}).when(d,{__time:d}).during(function(){f.setAnimationTime(f.__time)}).start()}else this.groupGL.remove(f),this._curveEffectsAnimator=null;this._linesMesh.material.blend=this._trailMesh.material.blend=h.get("blendMode")==="lighter"?t.a.additiveBlend:null},pauseEffect:function(){this._curveEffectsAnimator&&this._curveEffectsAnimator.pause()},resumeEffect:function(){this._curveEffectsAnimator&&this._curveEffectsAnimator.resume()},toggleEffect:function(){var h=this._curveEffectsAnimator;h&&(h.isPaused()?h.resume():h.pause())},_updateLines:function(h,r,e){var n=h.getData(),l=h.coordinateSystem,u=this._linesMesh.geometry,_=h.get("polyline");u.expandLine=!0;var f=s(l);u.segmentScale=f/20;var d="lineStyle.width".split("."),v=e.getDevicePixelRatio();n.each(function(x){var M=n.getItemModel(x),P=M.get(d);P==null&&(P=1),n.setItemVisual(x,"lineWidth",P)}),u.useNativeLine=!1;var m=0,p=0;n.each(function(x){var M=n.getItemLayout(x);_?(m+=u.getPolylineVertexCount(M),p+=u.getPolylineTriangleCount(M)):(m+=u.getCubicCurveVertexCount(M[0],M[1],M[2],M[3]),p+=u.getCubicCurveTriangleCount(M[0],M[1],M[2],M[3]))}),u.setVertexCount(m),u.setTriangleCount(p),u.resetOffset();var y=[];n.each(function(x){var M=n.getItemLayout(x),P=n.getItemVisual(x,"color"),T=n.getItemVisual(x,"opacity"),O=n.getItemVisual(x,"lineWidth")*v;T==null&&(T=1),y=t.a.parseColor(P,y),y[3]*=T,_?u.addPolyline(M,y,O):u.addCubicCurve(M[0],M[1],M[2],M[3],y,O)}),u.dirty()},remove:function(){this.groupGL.removeAll()},dispose:function(){this.groupGL.removeAll()}})},function(F,R,g){var E=g(0);g.n(E);var c=g(1),t=g(6),a=g(25),o=g(249),i=t.a.vec3;function s(h){return h>0?1:-1}c.a.Shader.import(o.a),R.a=c.a.Mesh.extend(function(){var h=new c.a.Material({shader:new c.a.Shader(c.a.Shader.source("ecgl.trail2.vertex"),c.a.Shader.source("ecgl.trail2.fragment")),transparent:!0,depthMask:!1}),r=new a.a({dynamic:!0});return r.createAttribute("dist","float",1),r.createAttribute("distAll","float",1),r.createAttribute("start","float",1),{geometry:r,material:h,culling:!1,$ignorePicking:!0}},{updateData:function(h,r,e){var n=h.hostModel,l=this.geometry,u=n.getModel("effect"),_=u.get("trailWidth")*r.getDevicePixelRatio(),f=u.get("trailLength"),d=n.get("effect.constantSpeed"),v=n.get("effect.period")*1e3,m=d!=null;this.getScene()||console.error("TrailMesh must been add to scene before updateData"),m?this.material.set("speed",d/1e3):this.material.set("period",v),this.material[m?"define":"undefine"]("vertex","CONSTANT_SPEED");var p=n.get("polyline");l.trailLength=f,this.material.set("trailLength",f),l.resetOffset(),["position","positionPrev","positionNext"].forEach(function(I){l.attributes[I].value=e.attributes[I].value});var y=["dist","distAll","start","offset","color"];y.forEach(function(I){l.attributes[I].init(l.vertexCount)}),l.indices=e.indices;var x=[],M=u.get("trailColor"),P=u.get("trailOpacity"),T=M!=null,O=P!=null;this.updateWorldTransform();var D=this.worldTransform.x.len(),A=this.worldTransform.y.len(),C=this.worldTransform.z.len(),S=0,L=0;h.each(function(I){var w=h.getItemLayout(I),b=O?P:h.getItemVisual(I,"opacity"),B=h.getItemVisual(I,"color");b==null&&(b=1),x=c.a.parseColor(T?M:B,x),x[3]*=b;for(var U=p?e.getPolylineVertexCount(w):e.getCubicCurveVertexCount(w[0],w[1],w[2],w[3]),W=0,z=[],G=[],H=S;H<S+U;H++)l.attributes.position.get(H,z),z[0]*=D,z[1]*=A,z[2]*=C,H>S&&(W+=i.dist(z,G)),l.attributes.dist.set(H,W),i.copy(G,z);L=Math.max(L,W);for(var X=Math.random()*(m?W:v),H=S;H<S+U;H++)l.attributes.distAll.set(H,W),l.attributes.start.set(H,X),l.attributes.offset.set(H,s(e.attributes.offset.get(H))*_/2),l.attributes.color.set(H,x);S+=U}),this.material.set("spotSize",L*.1*f),this.material.set("spotIntensity",u.get("spotIntensity")),l.dirty()},setAnimationTime:function(h){this.material.set("time",h)}})},function(F,R,g){R.a=`@export ecgl.trail2.vertex
attribute vec3 position: POSITION;
attribute vec3 positionPrev;
attribute vec3 positionNext;
attribute float offset;
attribute float dist;
attribute float distAll;
attribute float start;

attribute vec4 a_Color : COLOR;

uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;
uniform vec4 viewport : VIEWPORT;
uniform float near : NEAR;

uniform float speed : 0;
uniform float trailLength: 0.3;
uniform float time;
uniform float period: 1000;

uniform float spotSize: 1;

varying vec4 v_Color;
varying float v_Percent;
varying float v_SpotPercent;

@import ecgl.common.wireframe.vertexHeader

@import ecgl.lines3D.clipNear

void main()
{
 @import ecgl.lines3D.expandLine

 gl_Position = currProj;

 v_Color = a_Color;

 @import ecgl.common.wireframe.vertexMain

#ifdef CONSTANT_SPEED
 float t = mod((speed * time + start) / distAll, 1. + trailLength) - trailLength;
#else
 float t = mod((time + start) / period, 1. + trailLength) - trailLength;
#endif

 float trailLen = distAll * trailLength;

 v_Percent = (dist - t * distAll) / trailLen;

 v_SpotPercent = spotSize / distAll;

 }
@end


@export ecgl.trail2.fragment

uniform vec4 color : [1.0, 1.0, 1.0, 1.0];
uniform float spotIntensity: 5;

varying vec4 v_Color;
varying float v_Percent;
varying float v_SpotPercent;

@import ecgl.common.wireframe.fragmentHeader

@import clay.util.srgb

void main()
{
 if (v_Percent > 1.0 || v_Percent < 0.0) {
 discard;
 }

 float fade = v_Percent;

#ifdef SRGB_DECODE
 gl_FragColor = sRGBToLinear(color * v_Color);
#else
 gl_FragColor = color * v_Color;
#endif

 @import ecgl.common.wireframe.fragmentMain

 if (v_Percent > (1.0 - v_SpotPercent)) {
 gl_FragColor.rgb *= spotIntensity;
 }

 gl_FragColor.a *= fade;
}

@end`},function(F,R,g){var E=g(0),c=g.n(E);c.a.extendSeriesModel({type:"series.lines3D",dependencies:["globe"],visualColorAccessPath:"lineStyle.color",getInitialData:function(t,a){var o=new c.a.List(["value"],this);return o.hasItemOption=!1,o.initData(t.data,[],function(i,s,h,r){if(i instanceof Array)return NaN;o.hasItemOption=!0;var e=i.value;if(e!=null)return e instanceof Array?e[r]:e}),o},defaultOption:{coordinateSystem:"globe",globeIndex:0,geo3DIndex:0,zlevel:-10,polyline:!1,effect:{show:!1,period:4,trailWidth:4,trailLength:.2,spotIntensity:6},silent:!0,blendMode:"source-over",lineStyle:{width:1,opacity:.5}}})},function(F,R,g){var E=g(0),c=g.n(E);g(252),g(253);var t=g(17);c.a.registerVisual(Object(t.a)("polygons3D"))},function(F,R,g){var E=g(0),c=g.n(E),t=g(31);function a(i,s){for(var h=[],r=0;r<s.length;r++)h.push(i.dataToPoint(s[r]));return h}var o=c.a.extendSeriesModel({type:"series.polygons3D",getRegionModel:function(i){return this.getData().getItemModel(i)},getRegionPolygonCoords:function(i){var s=this.coordinateSystem,h=this.getData().getItemModel(i),r=h.option instanceof Array?h.option:h.getShallow("coords");h.get("multiPolygon")||(r=[r]);for(var e=[],n=0;n<r.length;n++){for(var l=[],u=1;u<r[n].length;u++)l.push(a(s,r[n][u]));e.push({exterior:a(s,r[n][0]),interiors:l})}return e},getInitialData:function(i){var s=new c.a.List(["value"],this);return s.hasItemOption=!1,s.initData(i.data,[],function(h,r,e,n){if(h instanceof Array)return NaN;s.hasItemOption=!0;var l=h.value;if(l!=null)return l instanceof Array?l[n]:l}),s},defaultOption:{show:!0,data:null,multiPolygon:!1,progressiveThreshold:1e3,progressive:1e3,zlevel:-10,label:{show:!1,distance:2,textStyle:{fontSize:20,color:"#000",backgroundColor:"rgba(255,255,255,0.7)",padding:3,borderRadius:4}},itemStyle:{color:"#fff",borderWidth:0,borderColor:"#333"},emphasis:{itemStyle:{color:"#639fc0"},label:{show:!0}}}});c.a.util.merge(o.prototype,t.a)},function(F,R,g){var E=g(0),c=g.n(E),t=g(63),a=g(1);c.a.extendChartView({type:"polygons3D",__ecgl__:!0,init:function(o,i){this.groupGL=new a.a.Node,this._geo3DBuilderList=[],this._currentStep=0},render:function(o,i,s){this.groupGL.removeAll();var h=o.coordinateSystem;h&&h.viewGL&&h.viewGL.add(this.groupGL);var r=this._geo3DBuilderList[0];r||(r=new t.a(s),r.extrudeY=h.type!=="mapbox3D"&&h.type!=="maptalks3D",this._geo3DBuilderList[0]=r),this._updateShaderDefines(h,r),r.update(o,i,s),this._geo3DBuilderList.length=1,this.groupGL.add(r.rootNode)},incrementalPrepareRender:function(o,i,s){this.groupGL.removeAll();var h=o.coordinateSystem;h&&h.viewGL&&h.viewGL.add(this.groupGL),this._currentStep=0},incrementalRender:function(o,i,s,h){var r=this._geo3DBuilderList[this._currentStep],e=i.coordinateSystem;r||(r=new t.a(h),r.extrudeY=e.type!=="mapbox3D"&&e.type!=="maptalks3D",this._geo3DBuilderList[this._currentStep]=r),r.update(i,s,h,o.start,o.end),this.groupGL.add(r.rootNode),this._updateShaderDefines(e,r),this._currentStep++},_updateShaderDefines:function(o,i){var s=o.viewGL.isLinearSpace()?"define":"undefine";i.rootNode.traverse(function(h){h.material&&(h.material[s]("fragment","SRGB_DECODE"),(o.type==="mapbox3D"||o.type==="maptalks3D")&&(h.material.define("fragment","NORMAL_UP_AXIS",2),h.material.define("fragment","NORMAL_FRONT_AXIS",1)))})},remove:function(){this.groupGL.removeAll()},dispose:function(){this.groupGL.removeAll()}})},function(F,R,g){var E=g(0),c=g.n(E);g(255),g(256),g(257);var t=g(17);c.a.registerVisual(Object(t.a)("surface"))},function(F,R,g){var E=g(0),c=g.n(E),t=g(31),a=g(40),o=g(50),i=c.a.extendSeriesModel({type:"series.surface",dependencies:["globe","grid3D","geo3D"],visualColorAccessPath:"itemStyle.color",formatTooltip:function(s){return Object(a.a)(this,s)},getInitialData:function(s,h){var r=s.data;function e(X){return!(isNaN(X.min)||isNaN(X.max)||isNaN(X.step))}function n(X){var Q=c.a.number.getPrecisionSafe;return Math.max(Q(X.min),Q(X.max),Q(X.step))+1}if(!r)if(s.parametric){var A=s.parametricEquation||{},C=A.u||{},S=A.v||{};["u","v"].forEach(function(Q){if(!e(A[Q])){console.error("Invalid parametricEquation.%s",Q);return}}),["x","y","z"].forEach(function(Q){if(typeof A[Q]!="function"){console.error("parametricEquation.%s needs to be function",Q);return}});var L=Math.floor((C.max+C.step-C.min)/C.step),I=Math.floor((S.max+S.step-S.min)/S.step);r=new Float32Array(L*I*5);for(var w=n(C),b=n(S),p=0,y=0;y<I;y++)for(var x=0;x<L;x++){var B=x*C.step+C.min,U=y*S.step+S.min,W=c.a.number.round(Math.min(B,C.max),w),z=c.a.number.round(Math.min(U,S.max),b),M=A.x(W,z),P=A.y(W,z),D=A.z(W,z);r[p++]=M,r[p++]=P,r[p++]=D,r[p++]=W,r[p++]=z}}else{var l=s.equation||{},u=l.x||{},_=l.y||{};if(["x","y"].forEach(function(X){if(!e(l[X])){console.error("Invalid equation.%s",X);return}}),typeof l.z!="function"){console.error("equation.z needs to be function");return}var f=Math.floor((u.max+u.step-u.min)/u.step),d=Math.floor((_.max+_.step-_.min)/_.step);r=new Float32Array(f*d*3);for(var v=n(u),m=n(_),p=0,y=0;y<d;y++)for(var x=0;x<f;x++){var M=x*u.step+u.min,P=y*_.step+_.min,T=c.a.number.round(Math.min(M,u.max),v),O=c.a.number.round(Math.min(P,_.max),m),D=l.z(T,O);r[p++]=T,r[p++]=O,r[p++]=D}}var G=["x","y","z"];s.parametric&&G.push("u","v");var H=Object(o.a)(this,G,r);return H},defaultOption:{coordinateSystem:"cartesian3D",zlevel:-10,grid3DIndex:0,shading:"lambert",parametric:!1,wireframe:{show:!0,lineStyle:{color:"rgba(0,0,0,0.5)",width:1}},equation:{x:{min:-1,max:1,step:.1},y:{min:-1,max:1,step:.1},z:null},parametricEquation:{u:{min:-1,max:1,step:.1},v:{min:-1,max:1,step:.1},x:null,y:null,z:null},dataShape:null,itemStyle:{},animationDurationUpdate:500}});c.a.util.merge(i.prototype,t.a)},function(F,R,g){var E=g(0),c=g.n(E),t=g(1);g(2);var a=g(6),o=g(64),i=a.a.vec3;function s(h){return isNaN(h[0])||isNaN(h[1])||isNaN(h[2])}c.a.extendChartView({type:"surface",__ecgl__:!0,init:function(h,r){this.groupGL=new t.a.Node},render:function(h,r,e){var n=this._prevSurfaceMesh;this._prevSurfaceMesh=this._surfaceMesh,this._surfaceMesh=n,this._surfaceMesh||(this._surfaceMesh=this._createSurfaceMesh()),this.groupGL.remove(this._prevSurfaceMesh),this.groupGL.add(this._surfaceMesh);var l=h.coordinateSystem,u=h.get("shading"),_=h.getData(),f="ecgl."+u;if((!this._surfaceMesh.material||this._surfaceMesh.material.shader.name!==f)&&(this._surfaceMesh.material=t.a.createMaterial(f,["VERTEX_COLOR","DOUBLE_SIDED"])),t.a.setMaterialFromModel(u,this._surfaceMesh.material,h,e),l&&l.viewGL){l.viewGL.add(this.groupGL);var d=l.viewGL.isLinearSpace()?"define":"undefine";this._surfaceMesh.material[d]("fragment","SRGB_DECODE")}var v=h.get("parametric"),m=h.get("dataShape");m||(m=this._getDataShape(_,v),h.get("data")&&console.warn("dataShape is not provided. Guess it is ",m));var p=h.getModel("wireframe"),y=p.get("lineStyle.width"),x=p.get("show")&&y>0;this._updateSurfaceMesh(this._surfaceMesh,h,m,x);var M=this._surfaceMesh.material;x?(M.define("WIREFRAME_QUAD"),M.set("wireframeLineWidth",y),M.set("wireframeLineColor",t.a.parseColor(p.get("lineStyle.color")))):M.undefine("WIREFRAME_QUAD"),this._initHandler(h,e),this._updateAnimation(h)},_updateAnimation:function(h){t.a.updateVertexAnimation([["prevPosition","position"],["prevNormal","normal"]],this._prevSurfaceMesh,this._surfaceMesh,h)},_createSurfaceMesh:function(){var h=new t.a.Mesh({geometry:new t.a.Geometry({dynamic:!0,sortTriangles:!0}),shadowDepthMaterial:new t.a.Material({shader:new t.a.Shader(t.a.Shader.source("ecgl.sm.depth.vertex"),t.a.Shader.source("ecgl.sm.depth.fragment"))}),culling:!1,renderOrder:10,renderNormal:!0});return h.geometry.createAttribute("barycentric","float",4),h.geometry.createAttribute("prevPosition","float",3),h.geometry.createAttribute("prevNormal","float",3),c.a.util.extend(h.geometry,o.a),h},_initHandler:function(h,r){var e=h.getData(),n=this._surfaceMesh,l=h.coordinateSystem;function u(f,d){for(var v=Infinity,m=-1,p=[],y=0;y<f.length;y++){n.geometry.attributes.position.get(f[y],p);var x=i.dist(d.array,p);x<v&&(v=x,m=f[y])}return m}n.seriesIndex=h.seriesIndex;var _=-1;n.off("mousemove"),n.off("mouseout"),n.on("mousemove",function(f){var d=u(f.triangle,f.point);if(d>=0){var v=[];n.geometry.attributes.position.get(d,v);for(var m=l.pointToData(v),p=Infinity,y=-1,x=[],M=0;M<e.count();M++){x[0]=e.get("x",M),x[1]=e.get("y",M),x[2]=e.get("z",M);var P=i.squaredDistance(x,m);P<p&&(y=M,p=P)}y!==_&&r.dispatchAction({type:"grid3DShowAxisPointer",value:m}),_=y,n.dataIndex=y}else n.dataIndex=-1},this),n.on("mouseout",function(f){_=-1,n.dataIndex=-1,r.dispatchAction({type:"grid3DHideAxisPointer"})},this)},_updateSurfaceMesh:function(h,r,e,n){var l=h.geometry,u=r.getData(),_=u.getLayout("points"),f=0;u.each(function(rt){u.hasValue(rt)||f++});var d=f||n,v=l.attributes.position,m=l.attributes.normal,p=l.attributes.texcoord0,y=l.attributes.barycentric,x=l.attributes.color,M=e[0],P=e[1],T=r.get("shading"),O=T!=="color";if(d){var D=(M-1)*(P-1)*4;v.init(D),n&&y.init(D)}else v.value=new Float32Array(_);x.init(l.vertexCount),p.init(l.vertexCount);var A=[0,3,1,1,3,2],C=[[1,1,0,0],[0,1,0,1],[1,0,0,1],[1,0,1,0]],S=l.indices=new(l.vertexCount>65535?Uint32Array:Uint16Array)((M-1)*(P-1)*6),L=function(rt,nt,q){q[1]=rt*P+nt,q[0]=rt*P+nt+1,q[3]=(rt+1)*P+nt+1,q[2]=(rt+1)*P+nt},I=!1;if(d){var w=[],b=[],B=0;O?m.init(l.vertexCount):m.value=null;for(var U=[[],[],[]],W=[],z=[],G=i.create(),H=function(rt,nt,q){var tt=nt*3;return q[0]=rt[tt],q[1]=rt[tt+1],q[2]=rt[tt+2],q},X=new Float32Array(_.length),Q=new Float32Array(_.length/3*4),j=0;j<u.count();j++)if(u.hasValue(j)){var Z=t.a.parseColor(u.getItemVisual(j,"color")),J=u.getItemVisual(j,"opacity");Z[3]*=J,Z[3]<.99&&(I=!0);for(var Y=0;Y<4;Y++)Q[j*4+Y]=Z[Y]}for(var at=[1e7,1e7,1e7],j=0;j<M-1;j++)for(var ot=0;ot<P-1;ot++){var ut=j*(P-1)+ot,et=ut*4;L(j,ot,w);for(var ht=!1,Y=0;Y<4;Y++)H(_,w[Y],b),s(b)&&(ht=!0);for(var Y=0;Y<4;Y++)ht?v.set(et+Y,at):(H(_,w[Y],b),v.set(et+Y,b)),n&&y.set(et+Y,C[Y]);for(var Y=0;Y<6;Y++)S[B++]=A[Y]+et;if(O&&!ht)for(var Y=0;Y<2;Y++){for(var ft=Y*3,it=0;it<3;it++){var N=w[A[ft]+it];H(_,N,U[it])}i.sub(W,U[0],U[1]),i.sub(z,U[1],U[2]),i.cross(G,W,z);for(var it=0;it<3;it++){var K=w[A[ft]+it]*3;X[K]=X[K]+G[0],X[K+1]=X[K+1]+G[1],X[K+2]=X[K+2]+G[2]}}}if(O)for(var j=0;j<X.length/3;j++)H(X,j,G),i.normalize(G,G),X[j*3]=G[0],X[j*3+1]=G[1],X[j*3+2]=G[2];for(var Z=[],V=[],j=0;j<M-1;j++)for(var ot=0;ot<P-1;ot++){var ut=j*(P-1)+ot,et=ut*4;L(j,ot,w);for(var Y=0;Y<4;Y++){for(var it=0;it<4;it++)Z[it]=Q[w[Y]*4+it];x.set(et+Y,Z),O&&(H(X,w[Y],G),m.set(et+Y,G));var N=w[Y];V[0]=N%P/(P-1),V[1]=Math.floor(N/P)/(M-1),p.set(et+Y,V)}ut++}}else{for(var V=[],j=0;j<u.count();j++){V[0]=j%P/(P-1),V[1]=Math.floor(j/P)/(M-1);var Z=t.a.parseColor(u.getItemVisual(j,"color")),J=u.getItemVisual(j,"opacity");Z[3]*=J,Z[3]<.99&&(I=!0),x.set(j,Z),p.set(j,V)}for(var w=[],k=0,j=0;j<M-1;j++)for(var ot=0;ot<P-1;ot++){L(j,ot,w);for(var Y=0;Y<6;Y++)S[k++]=w[A[Y]]}O?l.generateVertexNormals():m.value=null}h.material.get("normalMap")&&l.generateTangents(),l.updateBoundingBox(),l.dirty(),h.material.transparent=I,h.material.depthMask=!I},_getDataShape:function(h,r){for(var e=-Infinity,n=0,l=0,u=0,_=!1,f=r?"u":"x",d=h.count(),v=0;v<d;v++){var m=h.get(f,v);m<e&&(u&&u!==l&&(_=!0),u=l,l=0,n++),e=m,l++}if((!n||l===1)&&(_=!0),!_)return[n+1,l];for(var p=Math.floor(Math.sqrt(d));p>0;){if(Math.floor(d/p)===d/p)return[p,d/p];p--}return p=Math.floor(Math.sqrt(d)),[p,p]},dispose:function(){this.groupGL.removeAll()},remove:function(){this.groupGL.removeAll()}})},function(F,R,g){var E=g(0),c=g.n(E);c.a.registerLayout(function(t,a){t.eachSeriesByType("surface",function(o){var i=o.coordinateSystem;(!i||i.type!=="cartesian3D")&&console.error("Surface chart only support cartesian3D coordinateSystem");var s=o.getData(),h=new Float32Array(3*s.count()),r=[NaN,NaN,NaN];if(i&&i.type==="cartesian3D"){var e=i.dimensions,n=e.map(function(l){return o.coordDimToDataDim(l)[0]});s.each(n,function(l,u,_,f){var d;s.hasValue(f)?d=i.dataToPoint([l,u,_]):d=r,h[f*3]=d[0],h[f*3+1]=d[1],h[f*3+2]=d[2]})}s.setLayout("points",h)})})},function(F,R,g){var E=g(0),c=g.n(E);g(98),g(259),g(260);var t=g(17);c.a.registerVisual(Object(t.a)("map3D")),c.a.registerAction({type:"map3DChangeCamera",event:"map3dcamerachanged",update:"series:updateCamera"},function(a,o){o.eachComponent({mainType:"series",subType:"map3D",query:a},function(i){i.setView(a)})})},function(F,R,g){var E=g(0),c=g.n(E),t=g(44),a=g(28),o=g(29),i=g(31),s=g(95),h=g(32),r=g(40),e=g(97);function n(u,_){for(var f=[],d=0;d<_.length;d++)f.push(u.dataToPoint(_[d]));return f}var l=c.a.extendSeriesModel({type:"series.map3D",layoutMode:"box",coordinateSystem:null,visualColorAccessPath:"itemStyle.color",optionUpdated:function(u){u=u||{};var _=this.get("coordinateSystem");if(!(_==null||_==="geo3D")){{var f=["left","top","width","height","boxWidth","boxDepth","boxHeight","light","viewControl","postEffect","temporalSuperSampling","environment","groundPlane"],d=[];f.forEach(function(v){u[v]!=null&&d.push(v)}),d.length&&console.warn("Property %s in map3D series will be ignored if coordinate system is %s",d.join(", "),_)}this.get("groundPlane.show")&&(this.option.groundPlane.show=!1),this._geo=null}},getInitialData:function(u){u.data=this.getFilledRegions(u.data,u.map);var _=c.a.helper.completeDimensions(["value"],u.data),f=new c.a.List(_,this);f.initData(u.data);var d={};return f.each(function(v){var m=f.getName(v),p=f.getItemModel(v);d[m]=p}),this._regionModelMap=d,f},formatTooltip:function(u){return Object(r.a)(this,u)},getRegionModel:function(u){var _=this.getData().getName(u);return this._regionModelMap[_]||new c.a.Model(null,this)},getRegionPolygonCoords:function(u){var _=this.coordinateSystem,f=this.getData().getName(u);if(_.transform){var d=_.getRegion(f);return d?d.geometries:[]}else{this._geo||(this._geo=e.a.createGeo3D(this));for(var d=this._geo.getRegion(f),v=[],m=0;m<d.geometries.length;m++){var p=d.geometries[m],y=[],x=n(_,p.exterior);if(y&&y.length)for(var M=0;M<p.interiors.length;M++)y.push(n(_,y[M]));v.push({interiors:y,exterior:x})}return v}},getFormattedLabel:function(u,_){var f=h.a.getFormattedLabel(this,u,_);return f==null&&(f=this.getData().getName(u)),f},defaultOption:{coordinateSystem:"geo3D",data:null}});c.a.util.merge(l.prototype,s.a),c.a.util.merge(l.prototype,t.a),c.a.util.merge(l.prototype,a.a),c.a.util.merge(l.prototype,o.a),c.a.util.merge(l.prototype,i.a)},function(F,R,g){var E=g(0),c=g.n(E),t=g(1),a=g(45),o=g(30),i=g(63);c.a.extendChartView({type:"map3D",__ecgl__:!0,init:function(s,h){this._geo3DBuilder=new i.a(h),this.groupGL=new t.a.Node},render:function(s,h,r){var e=s.coordinateSystem;if(!(!e||!e.viewGL)){if(this.groupGL.add(this._geo3DBuilder.rootNode),e.viewGL.add(this.groupGL),e.type==="geo3D"){this._sceneHelper||(this._sceneHelper=new o.a,this._sceneHelper.initLight(this.groupGL)),this._sceneHelper.setScene(e.viewGL.scene),this._sceneHelper.updateLight(s),e.viewGL.setPostEffect(s.getModel("postEffect"),r),e.viewGL.setTemporalSuperSampling(s.getModel("temporalSuperSampling"));var n=this._control;n||(n=this._control=new a.a({zr:r.getZr()}),this._control.init());var l=s.getModel("viewControl");n.setViewGL(e.viewGL),n.setFromViewControlModel(l,0),n.off("update"),n.on("update",function(){r.dispatchAction({type:"map3DChangeCamera",alpha:n.getAlpha(),beta:n.getBeta(),distance:n.getDistance(),from:this.uid,map3DId:s.id})}),this._geo3DBuilder.extrudeY=!0}else this._control&&(this._control.dispose(),this._control=null),this._sceneHelper&&(this._sceneHelper.dispose(),this._sceneHelper=null),s.getData().getLayout("geo3D"),this._geo3DBuilder.extrudeY=!1;this._geo3DBuilder.update(s,h,r,0,s.getData().count());var u=e.viewGL.isLinearSpace()?"define":"undefine";this._geo3DBuilder.rootNode.traverse(function(_){_.material&&_.material[u]("fragment","SRGB_DECODE")})}},afterRender:function(s,h,r,e){var n=e.renderer,l=s.coordinateSystem;l&&l.type==="geo3D"&&(this._sceneHelper.updateAmbientCubemap(n,s,r),this._sceneHelper.updateSkybox(n,s,r))},dispose:function(){this.groupGL.removeAll(),this._control.dispose()}})},function(F,R,g){var E=g(0),c=g.n(E);g(262),g(263);var t=g(51),a=g.n(t),o=g(17);c.a.registerVisual(a()("scatterGL","circle",null)),c.a.registerVisual(Object(o.a)("scatterGL")),c.a.registerLayout({seriesType:"scatterGL",reset:function(i){var s=i.coordinateSystem,h;if(s){var r=s.dimensions,e=[];r.length===1?h=function(n,l){for(var u=new Float32Array((n.end-n.start)*2),_=n.start;_<n.end;_++){var f=(_-n.start)*2,d=l.get(r[0],_),v=s.dataToPoint(d);u[f]=v[0],u[f+1]=v[1]}l.setLayout("points",u)}:r.length===2&&(h=function(n,l){for(var u=new Float32Array((n.end-n.start)*2),_=n.start;_<n.end;_++){var f=(_-n.start)*2,d=l.get(r[0],_),v=l.get(r[1],_);e[0]=d,e[1]=v,e=s.dataToPoint(e),u[f]=e[0],u[f+1]=e[1]}l.setLayout("points",u)})}return{progress:h}}})},function(F,R,g){var E=g(0),c=g.n(E);c.a.extendSeriesModel({type:"series.scatterGL",dependencies:["grid","polar","geo","singleAxis"],visualColorAccessPath:"itemStyle.color",getInitialData:function(){return c.a.helper.createList(this)},defaultOption:{coordinateSystem:"cartesian2d",zlevel:10,progressive:1e5,progressiveThreshold:1e5,large:!1,symbol:"circle",symbolSize:10,zoomScale:0,blendMode:"source-over",itemStyle:{opacity:.8},postEffect:{enable:!1,colorCorrection:{exposure:0,brightness:0,contrast:1,saturation:1,enable:!0}}}})},function(F,R,g){var E=g(0),c=g.n(E),t=g(1),a=g(22),o=g(66),i=g(102);g(2),c.a.extendChartView({type:"scatterGL",__ecgl__:!0,init:function(s,h){this.groupGL=new t.a.Node,this.viewGL=new a.a("orthographic"),this.viewGL.add(this.groupGL),this._pointsBuilderList=[],this._currentStep=0,this._sizeScale=1,this._glViewHelper=new i.a(this.viewGL)},render:function(s,h,r){if(this.groupGL.removeAll(),this._glViewHelper.reset(s,r),!!s.getData().count()){var e=this._pointsBuilderList[0];e||(e=this._pointsBuilderList[0]=new o.a(!0,r)),this._pointsBuilderList.length=1,this.groupGL.add(e.rootNode),this._removeTransformInPoints(s.getData().getLayout("points")),e.update(s,h,r),this.viewGL.setPostEffect(s.getModel("postEffect"),r)}},incrementalPrepareRender:function(s,h,r){this.groupGL.removeAll(),this._glViewHelper.reset(s,r),this._currentStep=0,this.viewGL.setPostEffect(s.getModel("postEffect"),r)},incrementalRender:function(s,h,r,e){if(!(s.end<=s.start)){var n=this._pointsBuilderList[this._currentStep];n||(n=new o.a(!0,e),this._pointsBuilderList[this._currentStep]=n),this.groupGL.add(n.rootNode),this._removeTransformInPoints(h.getData().getLayout("points")),n.setSizeScale(this._sizeScale),n.update(h,r,e,s.start,s.end),e.getZr().refresh(),this._currentStep++}},updateTransform:function(s,h,r){if(s.coordinateSystem.getRoamTransform){this._glViewHelper.updateTransform(s,r);var e=this._glViewHelper.getZoom(),n=Math.max((s.get("zoomScale")||0)*(e-1)+1,0);this._sizeScale=n,this._pointsBuilderList.forEach(function(l){l.setSizeScale(n)})}},_removeTransformInPoints:function(s){if(!!s)for(var h=[],r=0;r<s.length;r+=2)h[0]=s[r],h[1]=s[r+1],this._glViewHelper.removeTransformInPoint(h),s[r]=h[0],s[r+1]=h[1]},dispose:function(){this.groupGL.removeAll()},remove:function(){this.groupGL.removeAll()}})},function(F,R){var g=typeof Float32Array=="undefined"?Array:Float32Array;function E(){var e=new g(6);return c(e),e}function c(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function t(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e}function a(e,n,l){var u=n[0]*l[0]+n[2]*l[1],_=n[1]*l[0]+n[3]*l[1],f=n[0]*l[2]+n[2]*l[3],d=n[1]*l[2]+n[3]*l[3],v=n[0]*l[4]+n[2]*l[5]+n[4],m=n[1]*l[4]+n[3]*l[5]+n[5];return e[0]=u,e[1]=_,e[2]=f,e[3]=d,e[4]=v,e[5]=m,e}function o(e,n,l){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4]+l[0],e[5]=n[5]+l[1],e}function i(e,n,l){var u=n[0],_=n[2],f=n[4],d=n[1],v=n[3],m=n[5],p=Math.sin(l),y=Math.cos(l);return e[0]=u*y+d*p,e[1]=-u*p+d*y,e[2]=_*y+v*p,e[3]=-_*p+y*v,e[4]=y*f+p*m,e[5]=y*m-p*f,e}function s(e,n,l){var u=l[0],_=l[1];return e[0]=n[0]*u,e[1]=n[1]*_,e[2]=n[2]*u,e[3]=n[3]*_,e[4]=n[4]*u,e[5]=n[5]*_,e}function h(e,n){var l=n[0],u=n[2],_=n[4],f=n[1],d=n[3],v=n[5],m=l*d-f*u;return m?(m=1/m,e[0]=d*m,e[1]=-f*m,e[2]=-u*m,e[3]=l*m,e[4]=(u*v-d*_)*m,e[5]=(f*_-l*v)*m,e):null}function r(e){var n=E();return t(n,e),n}R.create=E,R.identity=c,R.copy=t,R.mul=a,R.translate=o,R.rotate=i,R.scale=s,R.invert=h,R.clone=r},function(F,R){var g=typeof Float32Array=="undefined"?Array:Float32Array;function E(D,A){var C=new g(2);return D==null&&(D=0),A==null&&(A=0),C[0]=D,C[1]=A,C}function c(D,A){return D[0]=A[0],D[1]=A[1],D}function t(D){var A=new g(2);return A[0]=D[0],A[1]=D[1],A}function a(D,A,C){return D[0]=A,D[1]=C,D}function o(D,A,C){return D[0]=A[0]+C[0],D[1]=A[1]+C[1],D}function i(D,A,C,S){return D[0]=A[0]+C[0]*S,D[1]=A[1]+C[1]*S,D}function s(D,A,C){return D[0]=A[0]-C[0],D[1]=A[1]-C[1],D}function h(D){return Math.sqrt(e(D))}var r=h;function e(D){return D[0]*D[0]+D[1]*D[1]}var n=e;function l(D,A,C){return D[0]=A[0]*C[0],D[1]=A[1]*C[1],D}function u(D,A,C){return D[0]=A[0]/C[0],D[1]=A[1]/C[1],D}function _(D,A){return D[0]*A[0]+D[1]*A[1]}function f(D,A,C){return D[0]=A[0]*C,D[1]=A[1]*C,D}function d(D,A){var C=h(A);return C===0?(D[0]=0,D[1]=0):(D[0]=A[0]/C,D[1]=A[1]/C),D}function v(D,A){return Math.sqrt((D[0]-A[0])*(D[0]-A[0])+(D[1]-A[1])*(D[1]-A[1]))}var m=v;function p(D,A){return(D[0]-A[0])*(D[0]-A[0])+(D[1]-A[1])*(D[1]-A[1])}var y=p;function x(D,A){return D[0]=-A[0],D[1]=-A[1],D}function M(D,A,C,S){return D[0]=A[0]+S*(C[0]-A[0]),D[1]=A[1]+S*(C[1]-A[1]),D}function P(D,A,C){var S=A[0],L=A[1];return D[0]=C[0]*S+C[2]*L+C[4],D[1]=C[1]*S+C[3]*L+C[5],D}function T(D,A,C){return D[0]=Math.min(A[0],C[0]),D[1]=Math.min(A[1],C[1]),D}function O(D,A,C){return D[0]=Math.max(A[0],C[0]),D[1]=Math.max(A[1],C[1]),D}R.create=E,R.copy=c,R.clone=t,R.set=a,R.add=o,R.scaleAndAdd=i,R.sub=s,R.len=h,R.length=r,R.lenSquare=e,R.lengthSquare=n,R.mul=l,R.div=u,R.dot=_,R.scale=f,R.normalize=d,R.distance=v,R.dist=m,R.distanceSquare=p,R.distSquare=y,R.negate=x,R.lerp=M,R.applyTransform=P,R.min=T,R.max=O},function(F,R,g){var E=g(0),c=g.n(E);g(267),g(272);var t=g(51),a=g.n(t),o=g(17);c.a.registerVisual(a()("graphGL","circle",null)),c.a.registerVisual(Object(o.a)("graphGL")),c.a.registerVisual(function(s){var h={};s.eachSeriesByType("graphGL",function(r){var e=r.getCategoriesData(),n=r.getData(),l={};e.each(function(u){var _=e.getName(u);l[_]=u;var f=e.getItemModel(u),d=f.get("itemStyle.color")||r.getColorFromPalette(_,h);e.setItemVisual(u,"color",d)}),e.count()&&n.each(function(u){var _=n.getItemModel(u),f=_.getShallow("category");f!=null&&(typeof f=="string"&&(f=l[f]),n.getItemVisual(u,"color",!0)||n.setItemVisual(u,"color",e.getItemVisual(f,"color")))})})}),c.a.registerVisual(function(s){s.eachSeriesByType("graphGL",function(h){var r=h.getGraph(),e=h.getEdgeData(),n="lineStyle.color".split("."),l="lineStyle.opacity".split(".");e.setVisual("color",h.get(n)),e.setVisual("opacity",h.get(l)),e.each(function(u){var _=e.getItemModel(u),f=r.getEdgeByIndex(u),d=_.get(n),v=_.get(l);switch(d){case"source":d=f.node1.getVisual("color");break;case"target":d=f.node2.getVisual("color");break}f.setVisual("color",d),f.setVisual("opacity",v)})})}),c.a.registerAction({type:"graphGLRoam",event:"graphglroam",update:"series.graphGL:roam"},function(s,h){h.eachComponent({mainType:"series",query:s},function(r){r.setView(s)})});function i(){}c.a.registerAction({type:"graphGLStartLayout",event:"graphgllayoutstarted",update:"series.graphGL:startLayout"},i),c.a.registerAction({type:"graphGLStopLayout",event:"graphgllayoutstopped",update:"series.graphGL:stopLayout"},i),c.a.registerAction({type:"graphGLFocusNodeAdjacency",event:"graphGLFocusNodeAdjacency",update:"series.graphGL:focusNodeAdjacency"},i),c.a.registerAction({type:"graphGLUnfocusNodeAdjacency",event:"graphGLUnfocusNodeAdjacency",update:"series.graphGL:unfocusNodeAdjacency"},i)},function(F,R,g){var E=g(0),c=g.n(E),t=g(268),a=g(32),o=c.a.extendSeriesModel({type:"series.graphGL",visualColorAccessPath:"itemStyle.color",init:function(i){o.superApply(this,"init",arguments),this.legendDataProvider=function(){return this._categoriesData},this._updateCategoriesData()},mergeOption:function(i){o.superApply(this,"mergeOption",arguments),this._updateCategoriesData()},getFormattedLabel:function(i,s,h,r){var e=a.a.getFormattedLabel(this,i,s,h,r);if(e==null){var n=this.getData(),l=n.dimensions[n.dimensions.length-1];e=n.get(l,i)}return e},getInitialData:function(i,s){var h=i.edges||i.links||[],r=i.data||i.nodes||[],e=this;if(r&&h)return Object(t.a)(r,h,this,!0,n).data;function n(l,u){l.wrapMethod("getItemModel",function(v){var m=e._categoriesModels,p=v.getShallow("category"),y=m[p];return y&&(y.parentModel=v.parentModel,v.parentModel=y),v});var _=e.getModel("edgeLabel"),f=new c.a.Model({label:_.option},_.parentModel,s);u.wrapMethod("getItemModel",function(v){return v.customizeGetParent(d),v});function d(v){return v=this.parsePath(v),v&&v[0]==="label"?f:this.parentModel}}},getGraph:function(){return this.getData().graph},getEdgeData:function(){return this.getGraph().edgeData},getCategoriesData:function(){return this._categoriesData},formatTooltip:function(i,s,h){if(h==="edge"){var r=this.getData(),e=this.getDataParams(i,h),n=r.graph.getEdgeByIndex(i),l=r.getName(n.node1.dataIndex),u=r.getName(n.node2.dataIndex),_=[];return l!=null&&_.push(l),u!=null&&_.push(u),_=c.a.format.encodeHTML(_.join(" > ")),e.value&&(_+=" : "+c.a.format.encodeHTML(e.value)),_}else return o.superApply(this,"formatTooltip",arguments)},_updateCategoriesData:function(){var i=(this.option.categories||[]).map(function(h){return h.value!=null?h:c.a.util.extend({value:0},h)}),s=new c.a.List(["value"],this);s.initData(i),this._categoriesData=s,this._categoriesModels=s.mapArray(function(h){return s.getItemModel(h,!0)})},setView:function(i){i.zoom!=null&&(this.option.zoom=i.zoom),i.offset!=null&&(this.option.offset=i.offset)},setNodePosition:function(i){for(var s=0;s<i.length/2;s++){var h=i[s*2],r=i[s*2+1],e=this.getData().getRawDataItem(s);e.x=h,e.y=r}},isAnimationEnabled:function(){return o.superCall(this,"isAnimationEnabled")&&!(this.get("layout")==="force"&&this.get("force.layoutAnimation"))},defaultOption:{zlevel:10,z:2,legendHoverLink:!0,layout:"forceAtlas2",forceAtlas2:{initLayout:null,GPU:!0,steps:1,maxSteps:1e3,repulsionByDegree:!0,linLogMode:!1,strongGravityMode:!1,gravity:1,edgeWeightInfluence:1,edgeWeight:[1,4],nodeWeight:[1,4],preventOverlap:!1,gravityCenter:null},focusNodeAdjacency:!0,focusNodeAdjacencyOn:"mouseover",left:"center",top:"center",symbol:"circle",symbolSize:5,roam:!1,center:null,zoom:1,label:{show:!1,formatter:"{b}",position:"right",distance:5,textStyle:{fontSize:14}},itemStyle:{},lineStyle:{color:"#aaa",width:1,opacity:.5},emphasis:{label:{show:!0}},animation:!1}})},function(F,R,g){var E=g(0),c=g.n(E),t=g(269),a=g.n(t),o=g(271),i=g.n(o),s=g(2);R.a=function(h,r,e,n,l){for(var u=new a.a(n),_=0;_<h.length;_++)u.addNode(s.a.firstNotNull(h[_].id,h[_].name,_),_);for(var f=[],d=[],v=0,_=0;_<r.length;_++){var m=r[_],p=m.source,y=m.target;u.addEdge(p,y,v)&&(d.push(m),f.push(s.a.firstNotNull(m.id,p+" > "+y)),v++)}var x,M=c.a.helper.completeDimensions(["value"],h);x=new c.a.List(M,e),x.initData(h);var P=new c.a.List(["value"],e);return P.initData(d,f),l&&l(x,P),i()({mainData:x,struct:u,structAttr:"graph",datas:{node:x,edge:P},datasAttr:{node:"data",edge:"edgeData"}}),u.update(),u}},function(F,R,g){var E=g(103);E.__DEV__;var c=g(16),t=g(270),a=t.enableClassCheck;function o(l){return"_EC_"+l}var i=function(l){this._directed=l||!1,this.nodes=[],this.edges=[],this._nodesMap={},this._edgesMap={},this.data,this.edgeData},s=i.prototype;s.type="graph",s.isDirected=function(){return this._directed},s.addNode=function(l,u){l=l==null?""+u:""+l;var _=this._nodesMap;if(!_[o(l)]){var f=new h(l,u);return f.hostGraph=this,this.nodes.push(f),_[o(l)]=f,f}},s.getNodeByIndex=function(l){var u=this.data.getRawIndex(l);return this.nodes[u]},s.getNodeById=function(l){return this._nodesMap[o(l)]},s.addEdge=function(l,u,_){var f=this._nodesMap,d=this._edgesMap;if(typeof l=="number"&&(l=this.nodes[l]),typeof u=="number"&&(u=this.nodes[u]),h.isInstance(l)||(l=f[o(l)]),h.isInstance(u)||(u=f[o(u)]),!(!l||!u)){var v=l.id+"-"+u.id;if(!d[v]){var m=new r(l,u,_);return m.hostGraph=this,this._directed&&(l.outEdges.push(m),u.inEdges.push(m)),l.edges.push(m),l!==u&&u.edges.push(m),this.edges.push(m),d[v]=m,m}}},s.getEdgeByIndex=function(l){var u=this.edgeData.getRawIndex(l);return this.edges[u]},s.getEdge=function(l,u){h.isInstance(l)&&(l=l.id),h.isInstance(u)&&(u=u.id);var _=this._edgesMap;return this._directed?_[l+"-"+u]:_[l+"-"+u]||_[u+"-"+l]},s.eachNode=function(l,u){for(var _=this.nodes,f=_.length,d=0;d<f;d++)_[d].dataIndex>=0&&l.call(u,_[d],d)},s.eachEdge=function(l,u){for(var _=this.edges,f=_.length,d=0;d<f;d++)_[d].dataIndex>=0&&_[d].node1.dataIndex>=0&&_[d].node2.dataIndex>=0&&l.call(u,_[d],d)},s.breadthFirstTraverse=function(l,u,_,f){if(h.isInstance(u)||(u=this._nodesMap[o(u)]),!!u){for(var d=_==="out"?"outEdges":_==="in"?"inEdges":"edges",v=0;v<this.nodes.length;v++)this.nodes[v].__visited=!1;if(!l.call(f,u,null))for(var m=[u];m.length;)for(var p=m.shift(),y=p[d],v=0;v<y.length;v++){var x=y[v],M=x.node1===p?x.node2:x.node1;if(!M.__visited){if(l.call(f,M,p))return;m.push(M),M.__visited=!0}}}},s.update=function(){for(var l=this.data,u=this.edgeData,_=this.nodes,f=this.edges,d=0,v=_.length;d<v;d++)_[d].dataIndex=-1;for(var d=0,v=l.count();d<v;d++)_[l.getRawIndex(d)].dataIndex=d;u.filterSelf(function(m){var p=f[u.getRawIndex(m)];return p.node1.dataIndex>=0&&p.node2.dataIndex>=0});for(var d=0,v=f.length;d<v;d++)f[d].dataIndex=-1;for(var d=0,v=u.count();d<v;d++)f[u.getRawIndex(d)].dataIndex=d},s.clone=function(){for(var l=new i(this._directed),u=this.nodes,_=this.edges,f=0;f<u.length;f++)l.addNode(u[f].id,u[f].dataIndex);for(var f=0;f<_.length;f++){var d=_[f];l.addEdge(d.node1.id,d.node2.id,d.dataIndex)}return l};function h(l,u){this.id=l==null?"":l,this.inEdges=[],this.outEdges=[],this.edges=[],this.hostGraph,this.dataIndex=u==null?-1:u}h.prototype={constructor:h,degree:function(){return this.edges.length},inDegree:function(){return this.inEdges.length},outDegree:function(){return this.outEdges.length},getModel:function(l){if(!(this.dataIndex<0)){var u=this.hostGraph,_=u.data.getItemModel(this.dataIndex);return _.getModel(l)}}};function r(l,u,_){this.node1=l,this.node2=u,this.dataIndex=_==null?-1:_}r.prototype.getModel=function(l){if(!(this.dataIndex<0)){var u=this.hostGraph,_=u.edgeData.getItemModel(this.dataIndex);return _.getModel(l)}};var e=function(l,u){return{getValue:function(_){var f=this[l][u];return f.get(f.getDimension(_||"value"),this.dataIndex)},setVisual:function(_,f){this.dataIndex>=0&&this[l][u].setItemVisual(this.dataIndex,_,f)},getVisual:function(_,f){return this[l][u].getItemVisual(this.dataIndex,_,f)},setLayout:function(_,f){this.dataIndex>=0&&this[l][u].setItemLayout(this.dataIndex,_,f)},getLayout:function(){return this[l][u].getItemLayout(this.dataIndex)},getGraphicEl:function(){return this[l][u].getItemGraphicEl(this.dataIndex)},getRawIndex:function(){return this[l][u].getRawIndex(this.dataIndex)}}};c.mixin(h,e("hostGraph","data")),c.mixin(r,e("hostGraph","edgeData")),i.Node=h,i.Edge=r,a(h),a(r);var n=i;F.exports=n},function(F,R,g){var E=g(103);E.__DEV__;var c=g(16),t=".",a="___EC__COMPONENT__CONTAINER___";function o(_){var f={main:"",sub:""};return _&&(_=_.split(t),f.main=_[0]||"",f.sub=_[1]||""),f}function i(_){c.assert(/^[a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)?$/.test(_),'componentType "'+_+'" illegal')}function s(_,f){_.$constructor=_,_.extend=function(d){var v=this,m=function(){d.$constructor?d.$constructor.apply(this,arguments):v.apply(this,arguments)};return c.extend(m.prototype,d),m.extend=this.extend,m.superCall=e,m.superApply=n,c.inherits(m,this),m.superClass=v,m}}var h=0;function r(_){var f=["__\0is_clz",h++,Math.random().toFixed(3)].join("_");_.prototype[f]=!0,_.isInstance=function(d){return!!(d&&d[f])}}function e(_,f){var d=c.slice(arguments,2);return this.superClass.prototype[f].apply(_,d)}function n(_,f,d){return this.superClass.prototype[f].apply(_,d)}function l(_,f){f=f||{};var d={};_.registerClass=function(p,y){if(y){if(i(y),y=o(y),!y.sub)d[y.main]=p;else if(y.sub!==a){var x=v(y);x[y.sub]=p}}return p},_.getClass=function(p,y,x){var M=d[p];if(M&&M[a]&&(M=y?M[y]:null),x&&!M)throw new Error(y?"Component "+p+"."+(y||"")+" not exists. Load it first.":p+".type should be specified.");return M},_.getClassesByMainType=function(p){p=o(p);var y=[],x=d[p.main];return x&&x[a]?c.each(x,function(M,P){P!==a&&y.push(M)}):y.push(x),y},_.hasClass=function(p){return p=o(p),!!d[p.main]},_.getAllClassMainTypes=function(){var p=[];return c.each(d,function(y,x){p.push(x)}),p},_.hasSubTypes=function(p){p=o(p);var y=d[p.main];return y&&y[a]},_.parseClassType=o;function v(p){var y=d[p.main];return(!y||!y[a])&&(y=d[p.main]={},y[a]=!0),y}if(f.registerWhenExtend){var m=_.extend;m&&(_.extend=function(p){var y=m.call(this,p);return _.registerClass(y,p.type)})}return _}function u(_,f){}R.parseClassType=o,R.enableClassExtend=s,R.enableClassCheck=r,R.enableClassManagement=l,R.setReadOnly=u},function(F,R,g){var E=g(16),c=E.each,t="\0__link_datas",a="\0__link_mainData";function o(_){var f=_.mainData,d=_.datas;d||(d={main:f},_.datasAttr={main:"data"}),_.datas=_.mainData=null,n(f,d,_),c(d,function(v){c(f.TRANSFERABLE_METHODS,function(m){v.wrapMethod(m,E.curry(i,_))})}),f.wrapMethod("cloneShallow",E.curry(h,_)),c(f.CHANGABLE_METHODS,function(v){f.wrapMethod(v,E.curry(s,_))}),E.assert(d[f.dataType]===f)}function i(_,f){if(e(this)){var d=E.extend({},this[t]);d[this.dataType]=f,n(f,d,_)}else l(f,this.dataType,this[a],_);return f}function s(_,f){return _.struct&&_.struct.update(this),f}function h(_,f){return c(f[t],function(d,v){d!==f&&l(d.cloneShallow(),v,f,_)}),f}function r(_){var f=this[a];return _==null||f==null?f:f[t][_]}function e(_){return _[a]===_}function n(_,f,d){_[t]={},c(f,function(v,m){l(v,m,_,d)})}function l(_,f,d,v){d[t][f]=_,_[a]=d,_.dataType=f,v.struct&&(_[v.structAttr]=v.struct,v.struct[v.datasAttr[f]]=_),_.getLinkedData=r}var u=o;F.exports=u},function(F,R,g){var E=g(0),c=g.n(E),t=g(47),a=g.n(t),o=g(1),i=g(22),s=g(104),h=g(2),r=g(273),e=g(275),n=g(81),l=g.n(n),u=g(6),_=g(277),f=g(66),d=g(278),v=u.a.vec2;o.a.Shader.import(d.a);var m=1;c.a.extendChartView({type:"graphGL",__ecgl__:!0,init:function(p,y){this.groupGL=new o.a.Node,this.viewGL=new i.a("orthographic"),this.viewGL.camera.left=this.viewGL.camera.right=0,this.viewGL.add(this.groupGL),this._pointsBuilder=new f.a(!0,y),this._forceEdgesMesh=new o.a.Mesh({material:new o.a.Material({shader:o.a.createShader("ecgl.forceAtlas2.edges"),transparent:!0,depthMask:!1,depthTest:!1}),$ignorePicking:!0,geometry:new o.a.Geometry({attributes:{node:new o.a.Geometry.Attribute("node","float",2),color:new o.a.Geometry.Attribute("color","float",4,"COLOR")},dynamic:!0,mainAttribute:"node"}),renderOrder:-1,mode:o.a.Mesh.LINES}),this._edgesMesh=new o.a.Mesh({material:new o.a.Material({shader:o.a.createShader("ecgl.meshLines2D"),transparent:!0,depthMask:!1,depthTest:!1}),$ignorePicking:!0,geometry:new s.a({useNativeLine:!1,dynamic:!0}),renderOrder:-1,culling:!1}),this._layoutId=0,this._control=new _.a({zr:y.getZr(),viewGL:this.viewGL}),this._control.setTarget(this.groupGL),this._control.init(),this._clickHandler=this._clickHandler.bind(this)},render:function(p,y,x){this.groupGL.add(this._pointsBuilder.rootNode),this._model=p,this._api=x,this._initLayout(p,y,x),this._pointsBuilder.update(p,y,x),this._forceLayoutInstance instanceof r.a||this.groupGL.remove(this._forceEdgesMesh),this._updateCamera(p,x),this._control.off("update"),this._control.on("update",function(){x.dispatchAction({type:"graphGLRoam",seriesId:p.id,zoom:this._control.getZoom(),offset:this._control.getOffset()}),this._pointsBuilder.updateView(this.viewGL.camera)},this),this._control.setZoom(h.a.firstNotNull(p.get("zoom"),1)),this._control.setOffset(p.get("offset")||[0,0]);var M=this._pointsBuilder.getPointsMesh();if(M.off("mousemove",this._mousemoveHandler),M.off("mouseout",this._mouseOutHandler,this),x.getZr().off("click",this._clickHandler),this._pointsBuilder.highlightOnMouseover=!0,p.get("focusNodeAdjacency")){var P=p.get("focusNodeAdjacencyOn");P==="click"?x.getZr().on("click",this._clickHandler):P==="mouseover"?(M.on("mousemove",this._mousemoveHandler,this),M.on("mouseout",this._mouseOutHandler,this),this._pointsBuilder.highlightOnMouseover=!1):console.warn("Unkown focusNodeAdjacencyOn value s"+P)}this._lastMouseOverDataIndex=-1},_clickHandler:function(p){if(!this._layouting){var y=this._pointsBuilder.getPointsMesh().dataIndex;y>=0?this._api.dispatchAction({type:"graphGLFocusNodeAdjacency",seriesId:this._model.id,dataIndex:y}):this._api.dispatchAction({type:"graphGLUnfocusNodeAdjacency",seriesId:this._model.id})}},_mousemoveHandler:function(p){if(!this._layouting){var y=this._pointsBuilder.getPointsMesh().dataIndex;y>=0?y!==this._lastMouseOverDataIndex&&this._api.dispatchAction({type:"graphGLFocusNodeAdjacency",seriesId:this._model.id,dataIndex:y}):this._mouseOutHandler(p),this._lastMouseOverDataIndex=y}},_mouseOutHandler:function(p){this._layouting||(this._api.dispatchAction({type:"graphGLUnfocusNodeAdjacency",seriesId:this._model.id}),this._lastMouseOverDataIndex=-1)},_updateForceEdgesGeometry:function(p,y){var x=this._forceEdgesMesh.geometry,M=y.getEdgeData(),P=0,T=this._forceLayoutInstance,O=M.count()*2;x.attributes.node.init(O),x.attributes.color.init(O),M.each(function(D){var A=p[D];x.attributes.node.set(P,T.getNodeUV(A.node1)),x.attributes.node.set(P+1,T.getNodeUV(A.node2));var C=M.getItemVisual(A.dataIndex,"color"),S=o.a.parseColor(C);S[3]*=h.a.firstNotNull(M.getItemVisual(A.dataIndex,"opacity"),1),x.attributes.color.set(P,S),x.attributes.color.set(P+1,S),P+=2}),x.dirty()},_updateMeshLinesGeometry:function(){var p=this._model.getEdgeData(),y=this._edgesMesh.geometry,p=this._model.getEdgeData(),x=this._model.getData().getLayout("points");y.resetOffset(),y.setVertexCount(p.count()*y.getLineVertexCount()),y.setTriangleCount(p.count()*y.getLineTriangleCount());var M=[],P=[],T=["lineStyle","width"];this._originalEdgeColors=new Float32Array(p.count()*4),this._edgeIndicesMap=new Float32Array(p.count()),p.each(function(O){var D=p.graph.getEdgeByIndex(O),A=D.node1.dataIndex*2,C=D.node2.dataIndex*2;M[0]=x[A],M[1]=x[A+1],P[0]=x[C],P[1]=x[C+1];var S=p.getItemVisual(D.dataIndex,"color"),L=o.a.parseColor(S);L[3]*=h.a.firstNotNull(p.getItemVisual(D.dataIndex,"opacity"),1);var I=p.getItemModel(D.dataIndex),w=h.a.firstNotNull(I.get(T),1)*this._api.getDevicePixelRatio();y.addLine(M,P,L,w);for(var b=0;b<4;b++)this._originalEdgeColors[D.dataIndex*4+b]=L[b];this._edgeIndicesMap[D.dataIndex]=O},this),y.dirty()},_updateForceNodesGeometry:function(p){for(var y=this._pointsBuilder.getPointsMesh(),x=[],M=0;M<p.count();M++)this._forceLayoutInstance.getNodeUV(M,x),y.geometry.attributes.position.set(M,x);y.geometry.dirty("position")},_initLayout:function(p,y,x){var M=p.get("layout"),P=p.getGraph(),T=p.getBoxLayoutParams(),O=a.a.getLayoutRect(T,{width:x.getWidth(),height:x.getHeight()});M==="force"&&(console.warn("Currently only forceAtlas2 layout supported."),M="forceAtlas2"),this.stopLayout(p,y,x,{beforeLayout:!0});var D=p.getData(),A=p.getData();if(M==="forceAtlas2"){var C=p.getModel("forceAtlas2"),S=this._forceLayoutInstance,L=[],I=[],w=D.getDataExtent("value"),b=A.getDataExtent("value"),B=h.a.firstNotNull(C.get("edgeWeight"),1),U=h.a.firstNotNull(C.get("nodeWeight"),1);typeof B=="number"&&(B=[B,B]),typeof U=="number"&&(U=[U,U]);var W=0,z={},G=new Float32Array(D.count()*2);if(P.eachNode(function(X){var Q=X.dataIndex,j=D.get("value",Q),J,Y;if(D.hasItemOption){var at=D.getItemModel(Q);J=at.get("x"),Y=at.get("y")}J==null&&(J=O.x+Math.random()*O.width,Y=O.y+Math.random()*O.height),G[W*2]=J,G[W*2+1]=Y,z[X.id]=W++;var ot=c.a.number.linearMap(j,w,U);isNaN(ot)&&(isNaN(U[0])?ot=1:ot=U[0]),L.push({x:J,y:Y,mass:ot,size:D.getItemVisual(Q,"symbolSize")})}),D.setLayout("points",G),P.eachEdge(function(X){var Q=X.dataIndex,j=D.get("value",Q),J=c.a.number.linearMap(j,b,B);isNaN(J)&&(isNaN(B[0])?J=1:J=B[0]),I.push({node1:z[X.node1.id],node2:z[X.node2.id],weight:J,dataIndex:Q})}),!S){var H=C.get("GPU");this._forceLayoutInstance&&(H&&!(this._forceLayoutInstance instanceof r.a)||!H&&!(this._forceLayoutInstance instanceof e.a))&&(this._forceLayoutInstanceToDispose=this._forceLayoutInstance),S=this._forceLayoutInstance=H?new r.a:new e.a}S.initData(L,I),S.updateOption(C.option),this._updateForceEdgesGeometry(S.getEdges(),p),this._updatePositionTexture(),x.dispatchAction({type:"graphGLStartLayout",from:this.uid})}else{var G=new Float32Array(D.count()*2),W=0;P.eachNode(function(j){var J=j.dataIndex,Y,at;if(D.hasItemOption){var ot=D.getItemModel(J);Y=ot.get("x"),at=ot.get("y")}G[W++]=Y,G[W++]=at}),D.setLayout("points",G),this._updateAfterLayout(p,y,x)}},_updatePositionTexture:function(){var p=this._forceLayoutInstance.getNodePositionTexture();this._pointsBuilder.setPositionTexture(p),this._forceEdgesMesh.material.set("positionTex",p)},startLayout:function(p,y,x,M){if(!(M&&M.from!=null&&M.from!==this.uid)){var P=this.viewGL,x=this._api,T=this._forceLayoutInstance,O=this._model.getData(),D=this._model.getModel("forceAtlas2");if(!T){console.error("None layout don't have startLayout action");return}if(this.groupGL.remove(this._edgesMesh),this.groupGL.add(this._forceEdgesMesh),!!this._forceLayoutInstance){this._updateForceNodesGeometry(p.getData()),this._pointsBuilder.hideLabels();var A=this,C=this._layoutId=m++,S=D.getShallow("maxSteps"),L=D.getShallow("steps"),I=0,w=Math.max(L*2,20),b=function(B){if(B===A._layoutId){if(T.isFinished(S)){x.dispatchAction({type:"graphGLStopLayout",from:A.uid}),x.dispatchAction({type:"graphGLFinishLayout",points:O.getLayout("points"),from:A.uid});return}T.update(P.layer.renderer,L,function(){A._updatePositionTexture(),I+=L,I>=w&&(A._syncNodePosition(p),I=0),x.getZr().refresh(),l()(function(){b(B)})})}};l()(function(){A._forceLayoutInstanceToDispose&&(A._forceLayoutInstanceToDispose.dispose(P.layer.renderer),A._forceLayoutInstanceToDispose=null),b(C)}),this._layouting=!0}}},stopLayout:function(p,y,x,M){M&&M.from!=null&&M.from!==this.uid||(this._layoutId=0,this.groupGL.remove(this._forceEdgesMesh),this.groupGL.add(this._edgesMesh),!!this._forceLayoutInstance&&(!this.viewGL.layer||(M&&M.beforeLayout||(this._syncNodePosition(p),this._updateAfterLayout(p,y,x)),this._api.getZr().refresh(),this._layouting=!1)))},_syncNodePosition:function(p){var y=this._forceLayoutInstance.getNodePosition(this.viewGL.layer.renderer);p.getData().setLayout("points",y),p.setNodePosition(y)},_updateAfterLayout:function(p,y,x){this._updateMeshLinesGeometry(),this._pointsBuilder.removePositionTexture(),this._pointsBuilder.updateLayout(p,y,x),this._pointsBuilder.updateView(this.viewGL.camera),this._pointsBuilder.updateLabels(),this._pointsBuilder.showLabels()},focusNodeAdjacency:function(p,y,x,M){var P=this._model.getData();this._downplayAll();var T=M.dataIndex,O=P.graph,D=[],A=O.getNodeByIndex(T);D.push(A),A.edges.forEach(function(S){S.dataIndex<0||(S.node1!==A&&D.push(S.node1),S.node2!==A&&D.push(S.node2))},this),this._pointsBuilder.fadeOutAll(.05),this._fadeOutEdgesAll(.05),D.forEach(function(S){this._pointsBuilder.highlight(P,S.dataIndex)},this),this._pointsBuilder.updateLabels(D.map(function(S){return S.dataIndex}));var C=[];A.edges.forEach(function(S){S.dataIndex>=0&&(this._highlightEdge(S.dataIndex),C.push(S))},this),this._focusNodes=D,this._focusEdges=C},unfocusNodeAdjacency:function(p,y,x,M){this._downplayAll(),this._pointsBuilder.fadeInAll(),this._fadeInEdgesAll(),this._pointsBuilder.updateLabels()},_highlightEdge:function(p){var y=this._model.getEdgeData().getItemModel(p),x=o.a.parseColor(y.get("emphasis.lineStyle.color")||y.get("lineStyle.color")),M=h.a.firstNotNull(y.get("emphasis.lineStyle.opacity"),y.get("lineStyle.opacity"),1);x[3]*=M,this._edgesMesh.geometry.setItemColor(this._edgeIndicesMap[p],x)},_downplayAll:function(){this._focusNodes&&this._focusNodes.forEach(function(p){this._pointsBuilder.downplay(this._model.getData(),p.dataIndex)},this),this._focusEdges&&this._focusEdges.forEach(function(p){this._downplayEdge(p.dataIndex)},this)},_downplayEdge:function(p){var y=this._getColor(p,[]);this._edgesMesh.geometry.setItemColor(this._edgeIndicesMap[p],y)},_setEdgeFade:function(){var p=[];return function(y,x){this._getColor(y,p),p[3]*=x,this._edgesMesh.geometry.setItemColor(this._edgeIndicesMap[y],p)}}(),_getColor:function(p,y){for(var x=0;x<4;x++)y[x]=this._originalEdgeColors[p*4+x];return y},_fadeOutEdgesAll:function(p){var y=this._model.getData().graph;y.eachEdge(function(x){this._setEdgeFade(x.dataIndex,p)},this)},_fadeInEdgesAll:function(){this._fadeOutEdgesAll(1)},_updateCamera:function(p,y){this.viewGL.setViewport(0,0,y.getWidth(),y.getHeight(),y.getDevicePixelRatio());for(var x=this.viewGL.camera,M=p.getData(),P=M.getLayout("points"),T=v.create(Infinity,Infinity),O=v.create(-Infinity,-Infinity),D=[],A=0;A<P.length;)D[0]=P[A++],D[1]=P[A++],v.min(T,T,D),v.max(O,O,D);var C=(O[1]+T[1])/2,S=(O[0]+T[0])/2;if(!(S>x.left&&S<x.right&&C<x.bottom&&C>x.top)){var L=Math.max(O[0]-T[0],10),I=L/y.getWidth()*y.getHeight();L*=1.4,I*=1.4,T[0]-=L*.2,x.left=T[0],x.top=C-I/2,x.bottom=C+I/2,x.right=L+T[0],x.near=0,x.far=100}},dispose:function(){var p=this.viewGL.layer.renderer;this._forceLayoutInstance&&this._forceLayoutInstance.dispose(p),this.groupGL.removeAll(),this._layoutId=-1},remove:function(){this.groupGL.removeAll(),this._control.dispose()}})},function(F,R,g){var E=g(0),c=g.n(E),t=g(1),a=g(15),o=g(10),i=g(274);t.a.Shader.import(i.a);var s={repulsionByDegree:!0,linLogMode:!1,strongGravityMode:!1,gravity:1,scaling:1,edgeWeightInfluence:1,jitterTolerence:.1,preventOverlap:!1,dissuadeHubs:!1,gravityCenter:null};function h(r){var e={type:t.a.Texture.FLOAT,minFilter:t.a.Texture.NEAREST,magFilter:t.a.Texture.NEAREST};this._positionSourceTex=new t.a.Texture2D(e),this._positionSourceTex.flipY=!1,this._positionTex=new t.a.Texture2D(e),this._positionPrevTex=new t.a.Texture2D(e),this._forceTex=new t.a.Texture2D(e),this._forcePrevTex=new t.a.Texture2D(e),this._weightedSumTex=new t.a.Texture2D(e),this._weightedSumTex.width=this._weightedSumTex.height=1,this._globalSpeedTex=new t.a.Texture2D(e),this._globalSpeedPrevTex=new t.a.Texture2D(e),this._globalSpeedTex.width=this._globalSpeedTex.height=1,this._globalSpeedPrevTex.width=this._globalSpeedPrevTex.height=1,this._nodeRepulsionPass=new a.a({fragment:t.a.Shader.source("ecgl.forceAtlas2.updateNodeRepulsion")}),this._positionPass=new a.a({fragment:t.a.Shader.source("ecgl.forceAtlas2.updatePosition")}),this._globalSpeedPass=new a.a({fragment:t.a.Shader.source("ecgl.forceAtlas2.calcGlobalSpeed")}),this._copyPass=new a.a({fragment:t.a.Shader.source("clay.compositor.output")});var n=function(l){l.blendEquation(l.FUNC_ADD),l.blendFunc(l.ONE,l.ONE)};this._edgeForceMesh=new t.a.Mesh({geometry:new t.a.Geometry({attributes:{node1:new t.a.Geometry.Attribute("node1","float",2),node2:new t.a.Geometry.Attribute("node2","float",2),weight:new t.a.Geometry.Attribute("weight","float",1)},dynamic:!0,mainAttribute:"node1"}),material:new t.a.Material({transparent:!0,shader:t.a.createShader("ecgl.forceAtlas2.updateEdgeAttraction"),blend:n,depthMask:!1,depthText:!1}),mode:t.a.Mesh.POINTS}),this._weightedSumMesh=new t.a.Mesh({geometry:new t.a.Geometry({attributes:{node:new t.a.Geometry.Attribute("node","float",2)},dynamic:!0,mainAttribute:"node"}),material:new t.a.Material({transparent:!0,shader:t.a.createShader("ecgl.forceAtlas2.calcWeightedSum"),blend:n,depthMask:!1,depthText:!1}),mode:t.a.Mesh.POINTS}),this._framebuffer=new o.a({depthBuffer:!1}),this._dummyCamera=new t.a.OrthographicCamera({left:-1,right:1,top:1,bottom:-1,near:0,far:100}),this._globalSpeed=0}h.prototype.updateOption=function(r){for(var e in s)this[e]=s[e];var n=this._nodes.length;if(n>5e4?this.jitterTolerence=10:n>5e3?this.jitterTolerence=1:this.jitterTolerence=.1,n>100?this.scaling=2:this.scaling=10,r)for(var e in s)r[e]!=null&&(this[e]=r[e]);if(this.repulsionByDegree)for(var l=this._positionSourceTex.pixels,u=0;u<this._nodes.length;u++)l[u*4+2]=(this._nodes[u].degree||0)+1},h.prototype._updateGravityCenter=function(r){var e=this._nodes,n=this._edges;if(this.gravityCenter)this._gravityCenter=this.gravityCenter;else{for(var l=[Infinity,Infinity],u=[-Infinity,-Infinity],_=0;_<e.length;_++)l[0]=Math.min(e[_].x,l[0]),l[1]=Math.min(e[_].y,l[1]),u[0]=Math.max(e[_].x,u[0]),u[1]=Math.max(e[_].y,u[1]);this._gravityCenter=[(l[0]+u[0])*.5,(l[1]+u[1])*.5]}for(var _=0;_<n.length;_++){var f=n[_].node1,d=n[_].node2;e[f].degree=(e[f].degree||0)+1,e[d].degree=(e[d].degree||0)+1}},h.prototype.initData=function(r,e){this._nodes=r,this._edges=e,this._updateGravityCenter();var n=Math.ceil(Math.sqrt(r.length)),l=n,u=new Float32Array(n*l*4);this._resize(n,l);for(var _=0,f=0;f<r.length;f++){var d=r[f];u[_++]=d.x||0,u[_++]=d.y||0,u[_++]=d.mass||1,u[_++]=d.size||1}this._positionSourceTex.pixels=u;var v=this._edgeForceMesh.geometry,m=e.length;v.attributes.node1.init(m*2),v.attributes.node2.init(m*2),v.attributes.weight.init(m*2);for(var p=[],f=0;f<e.length;f++){var y=v.attributes,x=e[f].weight;x==null&&(x=1),y.node1.set(f,this.getNodeUV(e[f].node1,p)),y.node2.set(f,this.getNodeUV(e[f].node2,p)),y.weight.set(f,x),y.node1.set(f+m,this.getNodeUV(e[f].node2,p)),y.node2.set(f+m,this.getNodeUV(e[f].node1,p)),y.weight.set(f+m,x)}var M=this._weightedSumMesh.geometry;M.attributes.node.init(r.length);for(var f=0;f<r.length;f++)M.attributes.node.set(f,this.getNodeUV(f,p));v.dirty(),M.dirty(),this._nodeRepulsionPass.material.define("fragment","NODE_COUNT",r.length),this._nodeRepulsionPass.material.setUniform("textureSize",[n,l]),this._inited=!1,this._frame=0},h.prototype.getNodes=function(){return this._nodes},h.prototype.getEdges=function(){return this._edges},h.prototype.step=function(r){this._inited||(this._initFromSource(r),this._inited=!0),this._frame++,this._framebuffer.attach(this._forceTex),this._framebuffer.bind(r);var e=this._nodeRepulsionPass;e.setUniform("strongGravityMode",this.strongGravityMode),e.setUniform("gravity",this.gravity),e.setUniform("gravityCenter",this._gravityCenter),e.setUniform("scaling",this.scaling),e.setUniform("preventOverlap",this.preventOverlap),e.setUniform("positionTex",this._positionPrevTex),e.render(r);var n=this._edgeForceMesh;n.material.set("linLogMode",this.linLogMode),n.material.set("edgeWeightInfluence",this.edgeWeightInfluence),n.material.set("preventOverlap",this.preventOverlap),n.material.set("positionTex",this._positionPrevTex),r.gl.enable(r.gl.BLEND),r.renderPass([n],this._dummyCamera),this._framebuffer.attach(this._weightedSumTex),r.gl.clearColor(0,0,0,0),r.gl.clear(r.gl.COLOR_BUFFER_BIT),r.gl.enable(r.gl.BLEND);var l=this._weightedSumMesh;l.material.set("positionTex",this._positionPrevTex),l.material.set("forceTex",this._forceTex),l.material.set("forcePrevTex",this._forcePrevTex),r.renderPass([l],this._dummyCamera),this._framebuffer.attach(this._globalSpeedTex);var u=this._globalSpeedPass;u.setUniform("globalSpeedPrevTex",this._globalSpeedPrevTex),u.setUniform("weightedSumTex",this._weightedSumTex),u.setUniform("jitterTolerence",this.jitterTolerence),r.gl.disable(r.gl.BLEND),u.render(r);var _=this._positionPass;this._framebuffer.attach(this._positionTex),_.setUniform("globalSpeedTex",this._globalSpeedTex),_.setUniform("positionTex",this._positionPrevTex),_.setUniform("forceTex",this._forceTex),_.setUniform("forcePrevTex",this._forcePrevTex),_.render(r),this._framebuffer.unbind(r),this._swapTexture()},h.prototype.update=function(r,e,n){e==null&&(e=1),e=Math.max(e,1);for(var l=0;l<e;l++)this.step(r);n&&n()},h.prototype.getNodePositionTexture=function(){return this._inited?this._positionPrevTex:this._positionSourceTex},h.prototype.getNodeUV=function(r,e){e=e||[];var n=this._positionTex.width,l=this._positionTex.height;return e[0]=r%n/(n-1),e[1]=Math.floor(r/n)/(l-1)||0,e},h.prototype.getNodePosition=function(r,e){var n=this._positionArr,l=this._positionTex.width,u=this._positionTex.height,_=l*u;(!n||n.length!==_*4)&&(n=this._positionArr=new Float32Array(_*4)),this._framebuffer.bind(r),this._framebuffer.attach(this._positionPrevTex),r.gl.readPixels(0,0,l,u,r.gl.RGBA,r.gl.FLOAT,n),this._framebuffer.unbind(r),e||(e=new Float32Array(this._nodes.length*2));for(var f=0;f<this._nodes.length;f++)e[f*2]=n[f*4],e[f*2+1]=n[f*4+1];return e},h.prototype.getTextureData=function(r,e){var n=this["_"+e+"Tex"],l=n.width,u=n.height;this._framebuffer.bind(r),this._framebuffer.attach(n);var _=new Float32Array(l*u*4);return r.gl.readPixels(0,0,l,u,r.gl.RGBA,r.gl.FLOAT,_),this._framebuffer.unbind(r),_},h.prototype.getTextureSize=function(){return{width:this._positionTex.width,height:this._positionTex.height}},h.prototype.isFinished=function(r){return this._frame>r},h.prototype._swapTexture=function(){var r=this._positionPrevTex;this._positionPrevTex=this._positionTex,this._positionTex=r;var r=this._forcePrevTex;this._forcePrevTex=this._forceTex,this._forceTex=r;var r=this._globalSpeedPrevTex;this._globalSpeedPrevTex=this._globalSpeedTex,this._globalSpeedTex=r},h.prototype._initFromSource=function(r){this._framebuffer.attach(this._positionPrevTex),this._framebuffer.bind(r),this._copyPass.setUniform("texture",this._positionSourceTex),this._copyPass.render(r),r.gl.clearColor(0,0,0,0),this._framebuffer.attach(this._forcePrevTex),r.gl.clear(r.gl.COLOR_BUFFER_BIT),this._framebuffer.attach(this._globalSpeedPrevTex),r.gl.clear(r.gl.COLOR_BUFFER_BIT),this._framebuffer.unbind(r)},h.prototype._resize=function(r,e){["_positionSourceTex","_positionTex","_positionPrevTex","_forceTex","_forcePrevTex"].forEach(function(n){this[n].width=r,this[n].height=e,this[n].dirty()},this)},h.prototype.dispose=function(r){this._framebuffer.dispose(r),this._copyPass.dispose(r),this._nodeRepulsionPass.dispose(r),this._positionPass.dispose(r),this._globalSpeedPass.dispose(r),this._edgeForceMesh.geometry.dispose(r),this._weightedSumMesh.geometry.dispose(r),this._positionSourceTex.dispose(r),this._positionTex.dispose(r),this._positionPrevTex.dispose(r),this._forceTex.dispose(r),this._forcePrevTex.dispose(r),this._weightedSumTex.dispose(r),this._globalSpeedTex.dispose(r),this._globalSpeedPrevTex.dispose(r)},c.a.ForceAtlas2GPU=h,R.a=h},function(F,R,g){R.a=`@export ecgl.forceAtlas2.updateNodeRepulsion

#define NODE_COUNT 0

uniform sampler2D positionTex;

uniform vec2 textureSize;
uniform float gravity;
uniform float scaling;
uniform vec2 gravityCenter;

uniform bool strongGravityMode;
uniform bool preventOverlap;

varying vec2 v_Texcoord;

void main() {

 vec4 n0 = texture2D(positionTex, v_Texcoord);

 vec2 force = vec2(0.0);
 for (int i = 0; i < NODE_COUNT; i++) {
 vec2 uv = vec2(
 mod(float(i), textureSize.x) / (textureSize.x - 1.0),
 floor(float(i) / textureSize.x) / (textureSize.y - 1.0)
 );
 vec4 n1 = texture2D(positionTex, uv);

 vec2 dir = n0.xy - n1.xy;
 float d2 = dot(dir, dir);

 if (d2 > 0.0) {
 float factor = 0.0;
 if (preventOverlap) {
 float d = sqrt(d2);
 d = d - n0.w - n1.w;
 if (d > 0.0) {
 factor = scaling * n0.z * n1.z / (d * d);
 }
 else if (d < 0.0) {
 factor = scaling * 100.0 * n0.z * n1.z;
 }
 }
 else {
 factor = scaling * n0.z * n1.z / d2;
 }
 force += dir * factor;
 }
 }

 vec2 dir = gravityCenter - n0.xy;
 float d = 1.0;
 if (!strongGravityMode) {
 d = length(dir);
 }

 force += dir * n0.z * gravity / (d + 1.0);

 gl_FragColor = vec4(force, 0.0, 1.0);
}
@end

@export ecgl.forceAtlas2.updateEdgeAttraction.vertex

attribute vec2 node1;
attribute vec2 node2;
attribute float weight;

uniform sampler2D positionTex;
uniform float edgeWeightInfluence;
uniform bool preventOverlap;
uniform bool linLogMode;

uniform vec2 windowSize: WINDOW_SIZE;

varying vec2 v_Force;

void main() {

 vec4 n0 = texture2D(positionTex, node1);
 vec4 n1 = texture2D(positionTex, node2);

 vec2 dir = n1.xy - n0.xy;
 float d = length(dir);
 float w;
 if (edgeWeightInfluence == 0.0) {
 w = 1.0;
 }
 else if (edgeWeightInfluence == 1.0) {
 w = weight;
 }
 else {
 w = pow(weight, edgeWeightInfluence);
 }
 vec2 offset = vec2(1.0 / windowSize.x, 1.0 / windowSize.y);
 vec2 scale = vec2((windowSize.x - 1.0) / windowSize.x, (windowSize.y - 1.0) / windowSize.y);
 vec2 pos = node1 * scale * 2.0 - 1.0;
 gl_Position = vec4(pos + offset, 0.0, 1.0);
 gl_PointSize = 1.0;

 float factor;
 if (preventOverlap) {
 d = d - n1.w - n0.w;
 }
 if (d <= 0.0) {
 v_Force = vec2(0.0);
 return;
 }

 if (linLogMode) {
 factor = w * log(d) / d;
 }
 else {
 factor = w;
 }
 v_Force = dir * factor;
}
@end

@export ecgl.forceAtlas2.updateEdgeAttraction.fragment

varying vec2 v_Force;

void main() {
 gl_FragColor = vec4(v_Force, 0.0, 0.0);
}
@end

@export ecgl.forceAtlas2.calcWeightedSum.vertex

attribute vec2 node;

varying vec2 v_NodeUv;

void main() {

 v_NodeUv = node;
 gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
 gl_PointSize = 1.0;
}
@end

@export ecgl.forceAtlas2.calcWeightedSum.fragment

varying vec2 v_NodeUv;

uniform sampler2D positionTex;
uniform sampler2D forceTex;
uniform sampler2D forcePrevTex;

void main() {
 vec2 force = texture2D(forceTex, v_NodeUv).rg;
 vec2 forcePrev = texture2D(forcePrevTex, v_NodeUv).rg;

 float mass = texture2D(positionTex, v_NodeUv).z;
 float swing = length(force - forcePrev) * mass;
 float traction = length(force + forcePrev) * 0.5 * mass;

 gl_FragColor = vec4(swing, traction, 0.0, 0.0);
}
@end

@export ecgl.forceAtlas2.calcGlobalSpeed

uniform sampler2D globalSpeedPrevTex;
uniform sampler2D weightedSumTex;
uniform float jitterTolerence;

void main() {
 vec2 weightedSum = texture2D(weightedSumTex, vec2(0.5)).xy;
 float prevGlobalSpeed = texture2D(globalSpeedPrevTex, vec2(0.5)).x;
 float globalSpeed = jitterTolerence * jitterTolerence
 * weightedSum.y / weightedSum.x;
 if (prevGlobalSpeed > 0.0) {
 globalSpeed = min(globalSpeed / prevGlobalSpeed, 1.5) * prevGlobalSpeed;
 }
 gl_FragColor = vec4(globalSpeed, 0.0, 0.0, 1.0);
}
@end

@export ecgl.forceAtlas2.updatePosition

uniform sampler2D forceTex;
uniform sampler2D forcePrevTex;
uniform sampler2D positionTex;
uniform sampler2D globalSpeedTex;

varying vec2 v_Texcoord;

void main() {
 vec2 force = texture2D(forceTex, v_Texcoord).xy;
 vec2 forcePrev = texture2D(forcePrevTex, v_Texcoord).xy;
 vec4 node = texture2D(positionTex, v_Texcoord);

 float globalSpeed = texture2D(globalSpeedTex, vec2(0.5)).r;
 float swing = length(force - forcePrev);
 float speed = 0.1 * globalSpeed / (0.1 + globalSpeed * sqrt(swing));

 float df = length(force);
 if (df > 0.0) {
 speed = min(df * speed, 10.0) / df;

 gl_FragColor = vec4(node.xy + speed * force, node.zw);
 }
 else {
 gl_FragColor = node;
 }
}
@end

@export ecgl.forceAtlas2.edges.vertex
uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;

attribute vec2 node;
attribute vec4 a_Color : COLOR;
varying vec4 v_Color;

uniform sampler2D positionTex;

void main()
{
 gl_Position = worldViewProjection * vec4(
 texture2D(positionTex, node).xy, -10.0, 1.0
 );
 v_Color = a_Color;
}
@end

@export ecgl.forceAtlas2.edges.fragment
uniform vec4 color : [1.0, 1.0, 1.0, 1.0];
varying vec4 v_Color;
void main() {
 gl_FragColor = color * v_Color;
}
@end`},function(F,R,g){var E=g(5),c=g(4),t=g(276),a=t.a.toString();a=a.slice(a.indexOf("{")+1,a.lastIndexOf("}"));var o={barnesHutOptimize:!0,barnesHutTheta:1.5,repulsionByDegree:!0,linLogMode:!1,strongGravityMode:!1,gravity:1,scaling:1,edgeWeightInfluence:1,jitterTolerence:.1,preventOverlap:!1,dissuadeHubs:!1,gravityCenter:null},i=function(s){for(var h in o)this[h]=o[h];if(s)for(var h in s)this[h]=s[h];this._nodes=[],this._edges=[],this._disposed=!1,this._positionTex=new E.a({type:c.a.FLOAT,flipY:!1,minFilter:c.a.NEAREST,magFilter:c.a.NEAREST})};i.prototype.initData=function(s,h){var r=new Blob([a]),e=window.URL.createObjectURL(r);this._worker=new Worker(e),this._worker.onmessage=this._$onupdate.bind(this),this._nodes=s,this._edges=h,this._frame=0;for(var n=s.length,l=h.length,u=new Float32Array(n*2),_=new Float32Array(n),f=new Float32Array(n),d=new Float32Array(l*2),v=new Float32Array(l),m=0;m<s.length;m++){var p=s[m];u[m*2]=p.x,u[m*2+1]=p.y,_[m]=p.mass==null?1:p.mass,f[m]=p.size==null?1:p.size}for(var m=0;m<h.length;m++){var y=h[m],x=y.node1,M=y.node2;d[m*2]=x,d[m*2+1]=M,v[m]=y.weight==null?1:y.weight}var P=Math.ceil(Math.sqrt(s.length)),T=P,O=new Float32Array(P*T*4),D=this._positionTex;D.width=P,D.height=T,D.pixels=O,this._worker.postMessage({cmd:"init",nodesPosition:u,nodesMass:_,nodesSize:f,edges:d,edgesWeight:v}),this._globalSpeed=Infinity},i.prototype.updateOption=function(s){var h={};for(var r in o)h[r]=o[r];var e=this._nodes,n=this._edges,l=e.length;if(l>5e4?h.jitterTolerence=10:l>5e3?h.jitterTolerence=1:h.jitterTolerence=.1,l>100?h.scaling=2:h.scaling=10,l>1e3?h.barnesHutOptimize=!0:h.barnesHutOptimize=!1,s)for(var r in o)s[r]!=null&&(h[r]=s[r]);if(!h.gravityCenter){for(var u=[Infinity,Infinity],_=[-Infinity,-Infinity],f=0;f<e.length;f++)u[0]=Math.min(e[f].x,u[0]),u[1]=Math.min(e[f].y,u[1]),_[0]=Math.max(e[f].x,_[0]),_[1]=Math.max(e[f].y,_[1]);h.gravityCenter=[(u[0]+_[0])*.5,(u[1]+_[1])*.5]}for(var f=0;f<n.length;f++){var d=n[f].node1,v=n[f].node2;e[d].degree=(e[d].degree||0)+1,e[v].degree=(e[v].degree||0)+1}this._worker&&this._worker.postMessage({cmd:"updateConfig",config:h})},i.prototype.update=function(s,h,r){h==null&&(h=1),h=Math.max(h,1),this._frame+=h,this._onupdate=r,this._worker&&this._worker.postMessage({cmd:"update",steps:Math.round(h)})},i.prototype._$onupdate=function(s){if(!this._disposed){var h=new Float32Array(s.data.buffer);this._globalSpeed=s.data.globalSpeed,this._positionArr=h,this._updateTexture(h),this._onupdate&&this._onupdate()}},i.prototype.getNodePositionTexture=function(){return this._positionTex},i.prototype.getNodeUV=function(s,h){h=h||[];var r=this._positionTex.width,e=this._positionTex.height;return h[0]=s%r/(r-1),h[1]=Math.floor(s/r)/(e-1),h},i.prototype.getNodes=function(){return this._nodes},i.prototype.getEdges=function(){return this._edges},i.prototype.isFinished=function(s){return this._frame>s},i.prototype.getNodePosition=function(s,h){if(h||(h=new Float32Array(this._nodes.length*2)),this._positionArr)for(var r=0;r<this._positionArr.length;r++)h[r]=this._positionArr[r];return h},i.prototype._updateTexture=function(s){for(var h=this._positionTex.pixels,r=0,e=0;e<s.length;)h[r++]=s[e++],h[r++]=s[e++],h[r++]=1,h[r++]=1;this._positionTex.dirty()},i.prototype.dispose=function(s){this._disposed=!0,this._worker=null},R.a=i},function(F,R,g){function E(){var c={create:function(){return new Float32Array(2)},dist:function(e,n){var l=n[0]-e[0],u=n[1]-e[1];return Math.sqrt(l*l+u*u)},len:function(e){var n=e[0],l=e[1];return Math.sqrt(n*n+l*l)},scaleAndAdd:function(e,n,l,u){return e[0]=n[0]+l[0]*u,e[1]=n[1]+l[1]*u,e},scale:function(e,n,l){return e[0]=n[0]*l,e[1]=n[1]*l,e},add:function(e,n,l){return e[0]=n[0]+l[0],e[1]=n[1]+l[1],e},sub:function(e,n,l){return e[0]=n[0]-l[0],e[1]=n[1]-l[1],e},normalize:function(e,n){var l=n[0],u=n[1],_=l*l+u*u;return _>0&&(_=1/Math.sqrt(_),e[0]=n[0]*_,e[1]=n[1]*_),e},negate:function(e,n){return e[0]=-n[0],e[1]=-n[1],e},copy:function(e,n){return e[0]=n[0],e[1]=n[1],e},set:function(e,n,l){return e[0]=n,e[1]=l,e}};function t(){this.subRegions=[],this.nSubRegions=0,this.node=null,this.mass=0,this.centerOfMass=null,this.bbox=new Float32Array(4),this.size=0}var a=t.prototype;a.beforeUpdate=function(){for(var e=0;e<this.nSubRegions;e++)this.subRegions[e].beforeUpdate();this.mass=0,this.centerOfMass&&(this.centerOfMass[0]=0,this.centerOfMass[1]=0),this.nSubRegions=0,this.node=null},a.afterUpdate=function(){this.subRegions.length=this.nSubRegions;for(var e=0;e<this.nSubRegions;e++)this.subRegions[e].afterUpdate()},a.addNode=function(e){if(this.nSubRegions===0)if(this.node==null){this.node=e;return}else this._addNodeToSubRegion(this.node),this.node=null;this._addNodeToSubRegion(e),this._updateCenterOfMass(e)},a.findSubRegion=function(e,n){for(var l=0;l<this.nSubRegions;l++){var u=this.subRegions[l];if(u.contain(e,n))return u}},a.contain=function(e,n){return this.bbox[0]<=e&&this.bbox[2]>=e&&this.bbox[1]<=n&&this.bbox[3]>=n},a.setBBox=function(e,n,l,u){this.bbox[0]=e,this.bbox[1]=n,this.bbox[2]=l,this.bbox[3]=u,this.size=(l-e+u-n)/2},a._newSubRegion=function(){var e=this.subRegions[this.nSubRegions];return e||(e=new t,this.subRegions[this.nSubRegions]=e),this.nSubRegions++,e},a._addNodeToSubRegion=function(e){var n=this.findSubRegion(e.position[0],e.position[1]),l=this.bbox;if(!n){var u=(l[0]+l[2])/2,_=(l[1]+l[3])/2,f=(l[2]-l[0])/2,d=(l[3]-l[1])/2,v=e.position[0]>=u?1:0,m=e.position[1]>=_?1:0,n=this._newSubRegion();n.setBBox(v*f+l[0],m*d+l[1],(v+1)*f+l[0],(m+1)*d+l[1])}n.addNode(e)},a._updateCenterOfMass=function(e){this.centerOfMass==null&&(this.centerOfMass=new Float32Array(2));var n=this.centerOfMass[0]*this.mass,l=this.centerOfMass[1]*this.mass;n+=e.position[0]*e.mass,l+=e.position[1]*e.mass,this.mass+=e.mass,this.centerOfMass[0]=n/this.mass,this.centerOfMass[1]=l/this.mass};function o(){this.position=new Float32Array(2),this.force=c.create(),this.forcePrev=c.create(),this.mass=1,this.inDegree=0,this.outDegree=0}function i(e,n){this.source=e,this.target=n,this.weight=1}function s(){this.autoSettings=!0,this.barnesHutOptimize=!0,this.barnesHutTheta=1.5,this.repulsionByDegree=!0,this.linLogMode=!1,this.strongGravityMode=!1,this.gravity=1,this.scaling=1,this.edgeWeightInfluence=1,this.jitterTolerence=.1,this.preventOverlap=!1,this.dissuadeHubs=!1,this.rootRegion=new t,this.rootRegion.centerOfMass=c.create(),this.nodes=[],this.edges=[],this.bbox=new Float32Array(4),this.gravityCenter=null,this._massArr=null,this._swingingArr=null,this._sizeArr=null,this._globalSpeed=0}var h=s.prototype;h.initNodes=function(e,n,l){var u=n.length;this.nodes.length=0;for(var _=typeof l!="undefined",f=0;f<u;f++){var d=new o;d.position[0]=e[f*2],d.position[1]=e[f*2+1],d.mass=n[f],_&&(d.size=l[f]),this.nodes.push(d)}this._massArr=n,this._swingingArr=new Float32Array(u),_&&(this._sizeArr=l)},h.initEdges=function(e,n){var l=e.length/2;this.edges.length=0;for(var u=0;u<l;u++){var _=e[u*2],f=e[u*2+1],d=this.nodes[_],v=this.nodes[f];if(!d||!v){console.error("Node not exists, try initNodes before initEdges");return}d.outDegree++,v.inDegree++;var m=new i(d,v);n&&(m.weight=n[u]),this.edges.push(m)}},h.updateSettings=function(){if(this.repulsionByDegree)for(var e=0;e<this.nodes.length;e++){var n=this.nodes[e];n.mass=n.inDegree+n.outDegree+1}else for(var e=0;e<this.nodes.length;e++){var n=this.nodes[e];n.mass=this._massArr[e]}},h.update=function(){var e=this.nodes.length;if(this.updateSettings(),this.updateBBox(),this.barnesHutOptimize){this.rootRegion.setBBox(this.bbox[0],this.bbox[1],this.bbox[2],this.bbox[3]),this.rootRegion.beforeUpdate();for(var n=0;n<e;n++)this.rootRegion.addNode(this.nodes[n]);this.rootRegion.afterUpdate()}for(var n=0;n<e;n++){var l=this.nodes[n];c.copy(l.forcePrev,l.force),c.set(l.force,0,0)}for(var n=0;n<e;n++){var u=this.nodes[n];if(this.barnesHutOptimize)this.applyRegionToNodeRepulsion(this.rootRegion,u);else for(var _=n+1;_<e;_++){var f=this.nodes[_];this.applyNodeToNodeRepulsion(u,f,!1)}this.gravity>0&&(this.strongGravityMode?this.applyNodeStrongGravity(u):this.applyNodeGravity(u))}for(var n=0;n<this.edges.length;n++)this.applyEdgeAttraction(this.edges[n]);for(var d=0,v=0,m=c.create(),n=0;n<e;n++){var l=this.nodes[n],p=c.dist(l.force,l.forcePrev);d+=p*l.mass,c.add(m,l.force,l.forcePrev);var y=c.len(m)*.5;v+=y*l.mass,this._swingingArr[n]=p}var x=this.jitterTolerence*this.jitterTolerence*v/d;this._globalSpeed>0&&(x=Math.min(x/this._globalSpeed,1.5)*this._globalSpeed),this._globalSpeed=x;for(var n=0;n<e;n++){var l=this.nodes[n],p=this._swingingArr[n],M=.1*x/(1+x*Math.sqrt(p)),P=c.len(l.force);P>0&&(M=Math.min(P*M,10)/P,c.scaleAndAdd(l.position,l.position,l.force,M))}},h.applyRegionToNodeRepulsion=function(){var e=c.create();return function(l,u){if(l.node)this.applyNodeToNodeRepulsion(l.node,u,!0);else{c.sub(e,u.position,l.centerOfMass);var _=e[0]*e[0]+e[1]*e[1];if(_>this.barnesHutTheta*l.size*l.size){var f=this.scaling*u.mass*l.mass/_;c.scaleAndAdd(u.force,u.force,e,f)}else for(var d=0;d<l.nSubRegions;d++)this.applyRegionToNodeRepulsion(l.subRegions[d],u)}}}(),h.applyNodeToNodeRepulsion=function(){var e=c.create();return function(l,u,_){if(l!=u){c.sub(e,l.position,u.position);var f=e[0]*e[0]+e[1]*e[1];if(f!==0){var d;if(this.preventOverlap){var v=Math.sqrt(f);if(v=v-l.size-u.size,v>0)d=this.scaling*l.mass*u.mass/(v*v);else if(v<0)d=this.scaling*100*l.mass*u.mass;else return}else d=this.scaling*l.mass*u.mass/f;c.scaleAndAdd(l.force,l.force,e,d),c.scaleAndAdd(u.force,u.force,e,-d)}}}}(),h.applyEdgeAttraction=function(){var e=c.create();return function(l){var u=l.source,_=l.target;c.sub(e,u.position,_.position);var f=c.len(e),d;this.edgeWeightInfluence===0?d=1:this.edgeWeightInfluence===1?d=l.weight:d=Math.pow(l.weight,this.edgeWeightInfluence);var v;this.preventOverlap&&(f=f-u.size-_.size,f<=0)||(this.linLogMode?v=-d*Math.log(f+1)/(f+1):v=-d,c.scaleAndAdd(u.force,u.force,e,v),c.scaleAndAdd(_.force,_.force,e,-v))}}(),h.applyNodeGravity=function(){var e=c.create();return function(n){c.sub(e,this.gravityCenter,n.position);var l=c.len(e);c.scaleAndAdd(n.force,n.force,e,this.gravity*n.mass/(l+1))}}(),h.applyNodeStrongGravity=function(){var e=c.create();return function(n){c.sub(e,this.gravityCenter,n.position),c.scaleAndAdd(n.force,n.force,e,this.gravity*n.mass)}}(),h.updateBBox=function(){for(var e=Infinity,n=Infinity,l=-Infinity,u=-Infinity,_=0;_<this.nodes.length;_++){var f=this.nodes[_].position;e=Math.min(e,f[0]),n=Math.min(n,f[1]),l=Math.max(l,f[0]),u=Math.max(u,f[1])}this.bbox[0]=e,this.bbox[1]=n,this.bbox[2]=l,this.bbox[3]=u},h.getGlobalSpeed=function(){return this._globalSpeed};var r=null;self.onmessage=function(e){switch(e.data.cmd){case"init":r=new s,r.initNodes(e.data.nodesPosition,e.data.nodesMass,e.data.nodesSize),r.initEdges(e.data.edges,e.data.edgesWeight);break;case"updateConfig":if(r)for(var n in e.data.config)r[n]=e.data.config[n];break;case"update":var l=e.data.steps;if(r){for(var u=0;u<l;u++)r.update();for(var _=r.nodes.length,f=new Float32Array(_*2),u=0;u<_;u++){var d=r.nodes[u];f[u*2]=d.position[0],f[u*2+1]=d.position[1]}self.postMessage({buffer:f.buffer,globalSpeed:r.getGlobalSpeed()},[f.buffer])}else{var v=new Float32Array;self.postMessage({buffer:v.buffer,globalSpeed:r.getGlobalSpeed()},[v.buffer])}break}}}R.a=E},function(F,R,g){var E=g(8);g(2);var c=E.a.extend(function(){return{zr:null,viewGL:null,minZoom:.2,maxZoom:5,_needsUpdate:!1,_dx:0,_dy:0,_zoom:1}},function(){this._mouseDownHandler=this._mouseDownHandler.bind(this),this._mouseWheelHandler=this._mouseWheelHandler.bind(this),this._mouseMoveHandler=this._mouseMoveHandler.bind(this),this._mouseUpHandler=this._mouseUpHandler.bind(this),this._update=this._update.bind(this)},{init:function(){var t=this.zr;t.on("mousedown",this._mouseDownHandler),t.on("mousewheel",this._mouseWheelHandler),t.on("globalout",this._mouseUpHandler),t.animation.on("frame",this._update)},setTarget:function(t){this._target=t},setZoom:function(t){this._zoom=Math.max(Math.min(t,this.maxZoom),this.minZoom),this._needsUpdate=!0},setOffset:function(t){this._dx=t[0],this._dy=t[1],this._needsUpdate=!0},getZoom:function(){return this._zoom},getOffset:function(){return[this._dx,this._dy]},_update:function(){if(!!this._target&&!!this._needsUpdate){var t=this._target,a=this._zoom;t.position.x=this._dx,t.position.y=this._dy,t.scale.set(a,a,a),this.zr.refresh(),this._needsUpdate=!1,this.trigger("update")}},_mouseDownHandler:function(t){if(!t.target){var a=t.offsetX,o=t.offsetY;if(!(this.viewGL&&!this.viewGL.containPoint(a,o))){this.zr.on("mousemove",this._mouseMoveHandler),this.zr.on("mouseup",this._mouseUpHandler);var i=this._convertPos(a,o);this._x=i.x,this._y=i.y}}},_convertPos:function(t,a){var o=this.viewGL.camera,i=this.viewGL.viewport;return{x:(t-i.x)/i.width*(o.right-o.left)+o.left,y:(a-i.y)/i.height*(o.bottom-o.top)+o.top}},_mouseMoveHandler:function(t){var a=this._convertPos(t.offsetX,t.offsetY);this._dx+=a.x-this._x,this._dy+=a.y-this._y,this._x=a.x,this._y=a.y,this._needsUpdate=!0},_mouseUpHandler:function(t){this.zr.off("mousemove",this._mouseMoveHandler),this.zr.off("mouseup",this._mouseUpHandler)},_mouseWheelHandler:function(t){t=t.event;var a=t.wheelDelta||-t.detail;if(a!==0){var o=t.offsetX,i=t.offsetY;if(!(this.viewGL&&!this.viewGL.containPoint(o,i))){var s=a>0?1.1:.9,h=Math.max(Math.min(this._zoom*s,this.maxZoom),this.minZoom);s=h/this._zoom;var r=this._convertPos(o,i),e=(r.x-this._dx)*(s-1),n=(r.y-this._dy)*(s-1);this._dx-=e,this._dy-=n,this._zoom=h,this._needsUpdate=!0}}},dispose:function(){var t=this.zr;t.off("mousedown",this._mouseDownHandler),t.off("mousemove",this._mouseMoveHandler),t.off("mouseup",this._mouseUpHandler),t.off("mousewheel",this._mouseWheelHandler),t.off("globalout",this._mouseUpHandler),t.animation.off("frame",this._update)}});R.a=c},function(F,R,g){R.a=`@export ecgl.lines2D.vertex

uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;

attribute vec2 position: POSITION;
attribute vec4 a_Color : COLOR;
varying vec4 v_Color;

#ifdef POSITIONTEXTURE_ENABLED
uniform sampler2D positionTexture;
#endif

void main()
{
 gl_Position = worldViewProjection * vec4(position, -10.0, 1.0);

 v_Color = a_Color;
}

@end

@export ecgl.lines2D.fragment

uniform vec4 color : [1.0, 1.0, 1.0, 1.0];

varying vec4 v_Color;

void main()
{
 gl_FragColor = color * v_Color;
}
@end


@export ecgl.meshLines2D.vertex

attribute vec2 position: POSITION;
attribute vec2 normal;
attribute float offset;
attribute vec4 a_Color : COLOR;

uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;
uniform vec4 viewport : VIEWPORT;

varying vec4 v_Color;
varying float v_Miter;

void main()
{
 vec4 p2 = worldViewProjection * vec4(position + normal, -10.0, 1.0);
 gl_Position = worldViewProjection * vec4(position, -10.0, 1.0);

 p2.xy /= p2.w;
 gl_Position.xy /= gl_Position.w;

 vec2 N = normalize(p2.xy - gl_Position.xy);
 gl_Position.xy += N * offset / viewport.zw * 2.0;

 gl_Position.xy *= gl_Position.w;

 v_Color = a_Color;
}
@end


@export ecgl.meshLines2D.fragment

uniform vec4 color : [1.0, 1.0, 1.0, 1.0];

varying vec4 v_Color;
varying float v_Miter;

void main()
{
 gl_FragColor = color * v_Color;
}

@end`},function(F,R,g){var E=g(0);g.n(E),g(280),g(284)},function(F,R,g){var E=g(0),c=g.n(E),t=g(1),a=g(2),o=g(22),i=g(281);c.a.extendChartView({type:"flowGL",__ecgl__:!0,init:function(s,h){this.viewGL=new o.a("orthographic"),this.groupGL=new t.a.Node,this.viewGL.add(this.groupGL),this._particleSurface=new i.a;var r=new t.a.Mesh({geometry:new t.a.PlaneGeometry,material:new t.a.Material({shader:new t.a.Shader({vertex:t.a.Shader.source("ecgl.color.vertex"),fragment:t.a.Shader.source("ecgl.color.fragment")}),transparent:!0})});r.material.enableTexture("diffuseMap"),this.groupGL.add(r),this._planeMesh=r},render:function(s,h,r){var e=this._particleSurface;e.setParticleType(s.get("particleType")),e.setSupersampling(s.get("supersampling")),this._updateData(s,r),this._updateCamera(r.getWidth(),r.getHeight(),r.getDevicePixelRatio());var n=a.a.firstNotNull(s.get("particleDensity"),128);e.setParticleDensity(n,n);var l=this._planeMesh,u=+new Date,_=this,f=!0;l.__percent=0,l.stopAnimation(),l.animate("",{loop:!0}).when(1e5,{__percent:1}).during(function(){var m=+new Date,p=Math.min(m-u,20);u=u+p,_._renderer&&(e.update(_._renderer,r,p/1e3,f),l.material.set("diffuseMap",e.getSurfaceTexture())),f=!1}).start();var d=s.getModel("itemStyle"),v=t.a.parseColor(d.get("color"));v[3]*=a.a.firstNotNull(d.get("opacity"),1),l.material.set("color",v),e.setColorTextureImage(s.get("colorTexture"),r),e.setParticleSize(s.get("particleSize")),e.particleSpeedScaling=s.get("particleSpeed"),e.motionBlurFactor=1-Math.pow(.1,s.get("particleTrail"))},updateTransform:function(s,h,r){this._updateData(s,r)},afterRender:function(s,h,r,e){var n=e.renderer;this._renderer=n},_updateData:function(s,h){var r=s.coordinateSystem,e=r.dimensions.map(function(O){return s.coordDimToDataDim(O)[0]}),n=s.getData(),l=n.getDataExtent(e[0]),u=n.getDataExtent(e[1]),_=s.get("gridWidth"),f=s.get("gridHeight");if(_==null||_==="auto"){var d=(l[1]-l[0])/(u[1]-u[0]);_=Math.round(Math.sqrt(d*n.count()))}(f==null||f==="auto")&&(f=Math.ceil(n.count()/_));var v=this._particleSurface.vectorFieldTexture,m=v.pixels;if(!m||m.length!==f*_*4)m=v.pixels=new Float32Array(_*f*4);else for(var p=0;p<m.length;p++)m[p]=0;var y=0,x=Infinity,M=new Float32Array(n.count()*2),P=0,T=[[Infinity,Infinity],[-Infinity,-Infinity]];n.each([e[0],e[1],"vx","vy"],function(O,D,A,C){var S=r.dataToPoint([O,D]);M[P++]=S[0],M[P++]=S[1],T[0][0]=Math.min(S[0],T[0][0]),T[0][1]=Math.min(S[1],T[0][1]),T[1][0]=Math.max(S[0],T[1][0]),T[1][1]=Math.max(S[1],T[1][1]);var L=Math.sqrt(A*A+C*C);y=Math.max(y,L),x=Math.min(x,L)}),n.each(["vx","vy"],function(O,D,A){var C=Math.round((M[A*2]-T[0][0])/(T[1][0]-T[0][0])*(_-1)),S=f-1-Math.round((M[A*2+1]-T[0][1])/(T[1][1]-T[0][1])*(f-1)),L=(S*_+C)*4;m[L]=O/y*.5+.5,m[L+1]=D/y*.5+.5,m[L+3]=1}),v.width=_,v.height=f,s.get("coordinateSystem")==="bmap"&&this._fillEmptyPixels(v),v.dirty(),this._updatePlanePosition(T[0],T[1],s,h),this._updateGradientTexture(n.getVisual("visualMeta"),[x,y])},_fillEmptyPixels:function(s){var h=s.pixels,r=s.width,e=s.height;function n(M,P,T){M=Math.max(Math.min(M,r-1),0),P=Math.max(Math.min(P,e-1),0);var O=(P*(r-1)+M)*4;return h[O+3]===0?!1:(T[0]=h[O],T[1]=h[O+1],!0)}function l(M,P,T){T[0]=M[0]+P[0],T[1]=M[1]+P[1]}for(var u=[],_=[],f=[],d=[],v=[],m=0,p=0;p<e;p++)for(var y=0;y<r;y++){var x=(p*(r-1)+y)*4;h[x+3]===0&&(m=u[0]=u[1]=0,n(y-1,p,_)&&(m++,l(_,u,u)),n(y+1,p,f)&&(m++,l(f,u,u)),n(y,p-1,d)&&(m++,l(d,u,u)),n(y,p+1,v)&&(m++,l(v,u,u)),u[0]/=m,u[1]/=m,h[x]=u[0],h[x+1]=u[1]),h[x+3]=1}},_updateGradientTexture:function(s,h){if(!s||!s.length){this._particleSurface.setGradientTexture(null);return}this._gradientTexture=this._gradientTexture||new t.a.Texture2D({image:document.createElement("canvas")});var r=this._gradientTexture,e=r.image;e.width=200,e.height=1;var n=e.getContext("2d"),l=n.createLinearGradient(0,.5,e.width,.5);s[0].stops.forEach(function(u){var _;h[1]===h[0]?_=0:(_=u.value/h[1],_=Math.min(Math.max(_,0),1)),l.addColorStop(_,u.color)}),n.fillStyle=l,n.fillRect(0,0,e.width,e.height),r.dirty(),this._particleSurface.setGradientTexture(this._gradientTexture)},_updatePlanePosition:function(s,h,r,e){var n=this._limitInViewportAndFullFill(s,h,r,e);s=n.leftTop,h=n.rightBottom,this._particleSurface.setRegion(n.region),this._planeMesh.position.set((s[0]+h[0])/2,e.getHeight()-(s[1]+h[1])/2,0);var l=h[0]-s[0],u=h[1]-s[1];this._planeMesh.scale.set(l/2,u/2,1),this._particleSurface.resize(Math.max(Math.min(l,2048),1),Math.max(Math.min(u,2048),1)),this._renderer&&this._particleSurface.clearFrame(this._renderer)},_limitInViewportAndFullFill:function(s,h,r,e){var n=[Math.max(s[0],0),Math.max(s[1],0)],l=[Math.min(h[0],e.getWidth()),Math.min(h[1],e.getHeight())];if(r.get("coordinateSystem")==="bmap"){var u=r.getData().getDataExtent(r.coordDimToDataDim("lng")[0]),_=Math.floor(u[1]-u[0])>=359;_&&(n[0]>0&&(n[0]=0),l[0]<e.getWidth()&&(l[0]=e.getWidth()))}var f=h[0]-s[0],d=h[1]-s[1],v=l[0]-n[0],m=l[1]-n[1],p=[(n[0]-s[0])/f,1-m/d-(n[1]-s[1])/d,v/f,m/d];return{leftTop:n,rightBottom:l,region:p}},_updateCamera:function(s,h,r){this.viewGL.setViewport(0,0,s,h,r);var e=this.viewGL.camera;e.left=e.bottom=0,e.top=h,e.right=s,e.near=0,e.far=100,e.position.z=10},remove:function(){this._planeMesh.stopAnimation(),this.groupGL.removeAll()},dispose:function(){this._renderer&&this._particleSurface.dispose(this._renderer),this.groupGL.removeAll()}})},function(F,R,g){var E=g(15),c=g(14),t=g(41),a=g(19),o=g(9),i=g(5),s=g(4),h=g(38),r=g(43),e=g(10),n=g(282),l=g(283);o.a.import(l.a);function u(f){var d=document.createElement("canvas");d.width=d.height=f;var v=d.getContext("2d");return v.fillStyle="#fff",v.arc(f/2,f/2,f/2,0,Math.PI*2),v.fill(),d}var _=function(){this.motionBlurFactor=.99,this.vectorFieldTexture=new i.a({type:s.a.FLOAT,flipY:!1}),this.particleLife=[5,20],this._particleType="point",this._particleSize=1,this.particleColor=[1,1,1,1],this.particleSpeedScaling=1,this._thisFrameTexture=null,this._particlePass=null,this._spawnTexture=null,this._particleTexture0=null,this._particleTexture1=null,this._particlePointsMesh=null,this._surfaceFrameBuffer=null,this._elapsedTime=0,this._scene=null,this._camera=null,this._lastFrameTexture=null,this._supersampling=1,this._downsampleTextures=[],this._width=512,this._height=512,this.init()};_.prototype={constructor:_,init:function(){var f={type:s.a.FLOAT,minFilter:s.a.NEAREST,magFilter:s.a.NEAREST,useMipmap:!1};this._spawnTexture=new i.a(f),this._particleTexture0=new i.a(f),this._particleTexture1=new i.a(f),this._frameBuffer=new e.a({depthBuffer:!1}),this._particlePass=new E.a({fragment:o.a.source("ecgl.vfParticle.particle.fragment")}),this._particlePass.setUniform("velocityTexture",this.vectorFieldTexture),this._particlePass.setUniform("spawnTexture",this._spawnTexture),this._downsamplePass=new E.a({fragment:o.a.source("clay.compositor.downsample")});var d=new t.a({renderOrder:10,material:new a.a({shader:new o.a(o.a.source("ecgl.vfParticle.renderPoints.vertex"),o.a.source("ecgl.vfParticle.renderPoints.fragment"))}),mode:t.a.POINTS,geometry:new c.a({dynamic:!0,mainAttribute:"texcoord0"})}),v=new t.a({renderOrder:10,material:new a.a({shader:new o.a(o.a.source("ecgl.vfParticle.renderLines.vertex"),o.a.source("ecgl.vfParticle.renderLines.fragment"))}),geometry:new n.a,culling:!1}),m=new t.a({material:new a.a({shader:new o.a(o.a.source("ecgl.color.vertex"),o.a.source("ecgl.color.fragment"))}),geometry:new r.a});m.material.enableTexture("diffuseMap"),this._particlePointsMesh=d,this._particleLinesMesh=v,this._lastFrameFullQuadMesh=m,this._camera=new h.a,this._thisFrameTexture=new i.a,this._lastFrameTexture=new i.a},setParticleDensity:function(f,d){for(var v=f*d,m=new Float32Array(v*4),p=0,y=this.particleLife,x=0;x<f;x++)for(var M=0;M<d;M++,p++){m[p*4]=Math.random(),m[p*4+1]=Math.random(),m[p*4+2]=Math.random();var P=(y[1]-y[0])*Math.random()+y[0];m[p*4+3]=P}this._particleType==="line"?this._setLineGeometry(f,d):this._setPointsGeometry(f,d),this._spawnTexture.width=f,this._spawnTexture.height=d,this._spawnTexture.pixels=m,this._particleTexture0.width=this._particleTexture1.width=f,this._particleTexture0.height=this._particleTexture1.height=d,this._particlePass.setUniform("textureSize",[f,d])},_setPointsGeometry:function(f,d){var v=f*d,m=this._particlePointsMesh.geometry,p=m.attributes;p.texcoord0.init(v);for(var y=0,x=0;x<f;x++)for(var M=0;M<d;M++,y++)p.texcoord0.value[y*2]=x/f,p.texcoord0.value[y*2+1]=M/d;m.dirty()},_setLineGeometry:function(f,d){var v=f*d,m=this._getParticleMesh().geometry;m.setLineCount(v),m.resetOffset();for(var p=0;p<f;p++)for(var y=0;y<d;y++)m.addLine([p/f,y/d]);m.dirty()},_getParticleMesh:function(){return this._particleType==="line"?this._particleLinesMesh:this._particlePointsMesh},update:function(f,d,v,m){var p=this._getParticleMesh(),y=this._frameBuffer,x=this._particlePass;m&&this._updateDownsampleTextures(f,d),p.material.set("size",this._particleSize*this._supersampling),p.material.set("color",this.particleColor),x.setUniform("speedScaling",this.particleSpeedScaling),y.attach(this._particleTexture1),x.setUniform("firstFrameTime",m?(this.particleLife[1]+this.particleLife[0])/2:0),x.setUniform("particleTexture",this._particleTexture0),x.setUniform("deltaTime",v),x.setUniform("elapsedTime",this._elapsedTime),x.render(f,y),p.material.set("particleTexture",this._particleTexture1),p.material.set("prevParticleTexture",this._particleTexture0),y.attach(this._thisFrameTexture),y.bind(f),f.gl.clear(f.gl.DEPTH_BUFFER_BIT|f.gl.COLOR_BUFFER_BIT);var M=this._lastFrameFullQuadMesh;M.material.set("diffuseMap",this._lastFrameTexture),M.material.set("color",[1,1,1,this.motionBlurFactor]),this._camera.update(!0),f.renderPass([M,p],this._camera),y.unbind(f),this._downsample(f),this._swapTexture(),this._elapsedTime+=v},_downsample:function(f){var d=this._downsampleTextures;if(d.length!==0)for(var v=0,m=this._thisFrameTexture,p=d[v];p;)this._frameBuffer.attach(p),this._downsamplePass.setUniform("texture",m),this._downsamplePass.setUniform("textureSize",[m.width,m.height]),this._downsamplePass.render(f,this._frameBuffer),m=p,p=d[++v]},getSurfaceTexture:function(){var f=this._downsampleTextures;return f.length>0?f[f.length-1]:this._lastFrameTexture},setRegion:function(f){this._particlePass.setUniform("region",f)},resize:function(f,d){this._lastFrameTexture.width=f*this._supersampling,this._lastFrameTexture.height=d*this._supersampling,this._thisFrameTexture.width=f*this._supersampling,this._thisFrameTexture.height=d*this._supersampling,this._width=f,this._height=d},setParticleSize:function(f){var d=this._getParticleMesh();if(f<=2){d.material.disableTexture("spriteTexture"),d.material.transparent=!1;return}this._spriteTexture||(this._spriteTexture=new i.a),(!this._spriteTexture.image||this._spriteTexture.image.width!==f)&&(this._spriteTexture.image=u(f),this._spriteTexture.dirty()),d.material.transparent=!0,d.material.enableTexture("spriteTexture"),d.material.set("spriteTexture",this._spriteTexture),this._particleSize=f},setGradientTexture:function(f){var d=this._getParticleMesh().material;d[f?"enableTexture":"disableTexture"]("gradientTexture"),d.setUniform("gradientTexture",f)},setColorTextureImage:function(f,d){var v=this._getParticleMesh().material;v.setTextureImage("colorTexture",f,d,{flipY:!0})},setParticleType:function(f){this._particleType=f},clearFrame:function(f){var d=this._frameBuffer;d.attach(this._lastFrameTexture),d.bind(f),f.gl.clear(f.gl.DEPTH_BUFFER_BIT|f.gl.COLOR_BUFFER_BIT),d.unbind(f)},setSupersampling:function(f){this._supersampling=f,this.resize(this._width,this._height)},_updateDownsampleTextures:function(f,d){for(var v=this._downsampleTextures,m=Math.max(Math.floor(Math.log(this._supersampling/d.getDevicePixelRatio())/Math.log(2)),0),p=2,y=this._width*this._supersampling,x=this._height*this._supersampling,M=0;M<m;M++)v[M]=v[M]||new i.a,v[M].width=y/p,v[M].height=x/p,p*=2;for(;M<v.length;M++)v[M].dispose(f);v.length=m},_swapTexture:function(){var f=this._particleTexture0;this._particleTexture0=this._particleTexture1,this._particleTexture1=f;var f=this._thisFrameTexture;this._thisFrameTexture=this._lastFrameTexture,this._lastFrameTexture=f},dispose:function(f){f.disposeFrameBuffer(this._frameBuffer),f.disposeTexture(this.vectorFieldTexture),f.disposeTexture(this._spawnTexture),f.disposeTexture(this._particleTexture0),f.disposeTexture(this._particleTexture1),f.disposeTexture(this._thisFrameTexture),f.disposeTexture(this._lastFrameTexture),f.disposeGeometry(this._particleLinesMesh.geometry),f.disposeGeometry(this._particlePointsMesh.geometry),f.disposeGeometry(this._lastFrameFullQuadMesh.geometry),this._spriteTexture&&f.disposeTexture(this._spriteTexture),this._particlePass.dispose(f),this._downsamplePass.dispose(f),this._downsampleTextures.forEach(function(d){d.dispose(f)})}},R.a=_},function(F,R,g){var E=g(14),c=g(0);g.n(c);var t=E.a.extend(function(){return{dynamic:!0,attributes:{position:new E.a.Attribute("position","float",3,"POSITION")}}},{resetOffset:function(){this._vertexOffset=0,this._faceOffset=0},setLineCount:function(a){var o=this.attributes,i=4*a,s=2*a;this.vertexCount!==i&&o.position.init(i),this.triangleCount!==s&&(s===0?this.indices=null:this.indices=this.vertexCount>65535?new Uint32Array(s*3):new Uint16Array(s*3))},addLine:function(a){var o=this._vertexOffset;this.attributes.position.set(o,[a[0],a[1],1]),this.attributes.position.set(o+1,[a[0],a[1],-1]),this.attributes.position.set(o+2,[a[0],a[1],2]),this.attributes.position.set(o+3,[a[0],a[1],-2]),this.setTriangleIndices(this._faceOffset++,[o,o+1,o+2]),this.setTriangleIndices(this._faceOffset++,[o+1,o+2,o+3]),this._vertexOffset+=4}});R.a=t},function(F,R,g){R.a=`@export ecgl.vfParticle.particle.fragment

uniform sampler2D particleTexture;
uniform sampler2D spawnTexture;
uniform sampler2D velocityTexture;

uniform float deltaTime;
uniform float elapsedTime;

uniform float speedScaling : 1.0;

uniform vec2 textureSize;
uniform vec4 region : [0, 0, 1, 1];
uniform float firstFrameTime;

varying vec2 v_Texcoord;


void main()
{
 vec4 p = texture2D(particleTexture, v_Texcoord);
 bool spawn = false;
 if (p.w <= 0.0) {
 p = texture2D(spawnTexture, fract(v_Texcoord + elapsedTime / 10.0));
 p.w -= firstFrameTime;
 spawn = true;
 }
 vec2 v = texture2D(velocityTexture, fract(p.xy * region.zw + region.xy)).xy;
 v = (v - 0.5) * 2.0;
 p.z = length(v);
 p.xy += v * deltaTime / 10.0 * speedScaling;
 p.w -= deltaTime;

 if (spawn || p.xy != fract(p.xy)) {
 p.z = 0.0;
 }
 p.xy = fract(p.xy);

 gl_FragColor = p;
}
@end

@export ecgl.vfParticle.renderPoints.vertex

#define PI 3.1415926

attribute vec2 texcoord : TEXCOORD_0;

uniform sampler2D particleTexture;
uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;

uniform float size : 1.0;

varying float v_Mag;
varying vec2 v_Uv;

void main()
{
 vec4 p = texture2D(particleTexture, texcoord);

 if (p.w > 0.0 && p.z > 1e-5) {
 gl_Position = worldViewProjection * vec4(p.xy * 2.0 - 1.0, 0.0, 1.0);
 }
 else {
 gl_Position = vec4(100000.0, 100000.0, 100000.0, 1.0);
 }

 v_Mag = p.z;
 v_Uv = p.xy;

 gl_PointSize = size;
}

@end

@export ecgl.vfParticle.renderPoints.fragment

uniform vec4 color : [1.0, 1.0, 1.0, 1.0];
uniform sampler2D gradientTexture;
uniform sampler2D colorTexture;
uniform sampler2D spriteTexture;

varying float v_Mag;
varying vec2 v_Uv;

void main()
{
 gl_FragColor = color;
#ifdef SPRITETEXTURE_ENABLED
 gl_FragColor *= texture2D(spriteTexture, gl_PointCoord);
 if (color.a == 0.0) {
 discard;
 }
#endif
#ifdef GRADIENTTEXTURE_ENABLED
 gl_FragColor *= texture2D(gradientTexture, vec2(v_Mag, 0.5));
#endif
#ifdef COLORTEXTURE_ENABLED
 gl_FragColor *= texture2D(colorTexture, v_Uv);
#endif
}

@end

@export ecgl.vfParticle.renderLines.vertex

#define PI 3.1415926

attribute vec3 position : POSITION;

uniform sampler2D particleTexture;
uniform sampler2D prevParticleTexture;

uniform float size : 1.0;
uniform vec4 vp: VIEWPORT;
uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;

varying float v_Mag;
varying vec2 v_Uv;

@import clay.util.rand

void main()
{
 vec4 p = texture2D(particleTexture, position.xy);
 vec4 p2 = texture2D(prevParticleTexture, position.xy);

 p.xy = p.xy * 2.0 - 1.0;
 p2.xy = p2.xy * 2.0 - 1.0;

 if (p.w > 0.0 && p.z > 1e-5) {
 vec2 dir = normalize(p.xy - p2.xy);
 vec2 norm = vec2(dir.y / vp.z, -dir.x / vp.w) * sign(position.z) * size;
 if (abs(position.z) == 2.0) {
 gl_Position = vec4(p.xy + norm, 0.0, 1.0);
 v_Uv = p.xy;
 v_Mag = p.z;
 }
 else {
 gl_Position = vec4(p2.xy + norm, 0.0, 1.0);
 v_Mag = p2.z;
 v_Uv = p2.xy;
 }
 gl_Position = worldViewProjection * gl_Position;
 }
 else {
 gl_Position = vec4(100000.0, 100000.0, 100000.0, 1.0);
 }
}

@end

@export ecgl.vfParticle.renderLines.fragment

uniform vec4 color : [1.0, 1.0, 1.0, 1.0];
uniform sampler2D gradientTexture;
uniform sampler2D colorTexture;

varying float v_Mag;
varying vec2 v_Uv;

void main()
{
 gl_FragColor = color;
 #ifdef GRADIENTTEXTURE_ENABLED
 gl_FragColor *= texture2D(gradientTexture, vec2(v_Mag, 0.5));
#endif
#ifdef COLORTEXTURE_ENABLED
 gl_FragColor *= texture2D(colorTexture, v_Uv);
#endif
}

@end
`},function(F,R,g){var E=g(0),c=g.n(E);c.a.extendSeriesModel({type:"series.flowGL",dependencies:["geo","grid","bmap"],visualColorAccessPath:"itemStyle.color",getInitialData:function(t,a){var o=c.a.getCoordinateSystemDimensions(this.get("coordinateSystem"))||["x","y"];if(o.length>2)throw new Error("flowGL can only be used on 2d coordinate systems.");o.push("vx","vy");var i=c.a.helper.completeDimensions(o,this.getSource(),{encodeDef:this.get("encode"),dimsDef:this.get("dimensions")}),s=new c.a.List(i,this);return s.initData(this.getSource()),s},defaultOption:{coordinateSystem:"cartesian2d",zlevel:10,supersampling:1,particleType:"point",particleDensity:128,particleSize:1,particleSpeed:1,particleTrail:2,colorTexture:null,gridWidth:"auto",gridHeight:"auto",itemStyle:{color:"#fff",opacity:.8}}})},function(F,R,g){var E=g(0),c=g.n(E);g(286),g(287);var t=g(17);c.a.registerVisual(Object(t.a)("linesGL"))},function(F,R,g){var E=g(0),c=g.n(E),t=g(80);g.n(t);var a=c.a.extendSeriesModel({type:"series.linesGL",dependencies:["grid","geo"],visualColorAccessPath:"lineStyle.color",streamEnabled:!0,init:function(o){var i=this._processFlatCoordsArray(o.data);this._flatCoords=i.flatCoords,this._flatCoordsOffset=i.flatCoordsOffset,i.flatCoords&&(o.data=new Float32Array(i.count)),a.superApply(this,"init",arguments)},mergeOption:function(o){var i=this._processFlatCoordsArray(o.data);this._flatCoords=i.flatCoords,this._flatCoordsOffset=i.flatCoordsOffset,i.flatCoords&&(o.data=new Float32Array(i.count)),a.superApply(this,"mergeOption",arguments)},appendData:function(o){var i=this._processFlatCoordsArray(o.data);i.flatCoords&&(this._flatCoords?(this._flatCoords=Object(t.concatArray)(this._flatCoords,i.flatCoords),this._flatCoordsOffset=Object(t.concatArray)(this._flatCoordsOffset,i.flatCoordsOffset)):(this._flatCoords=i.flatCoords,this._flatCoordsOffset=i.flatCoordsOffset),o.data=new Float32Array(i.count)),this.getRawData().appendData(o.data)},_getCoordsFromItemModel:function(o){var i=this.getData().getItemModel(o),s=i.option instanceof Array?i.option:i.getShallow("coords");if(!(s instanceof Array&&s.length>0&&s[0]instanceof Array))throw new Error("Invalid coords "+JSON.stringify(s)+". Lines must have 2d coords array in data item.");return s},getLineCoordsCount:function(o){return this._flatCoordsOffset?this._flatCoordsOffset[o*2+1]:this._getCoordsFromItemModel(o).length},getLineCoords:function(o,i){if(this._flatCoordsOffset){for(var s=this._flatCoordsOffset[o*2],h=this._flatCoordsOffset[o*2+1],r=0;r<h;r++)i[r]=i[r]||[],i[r][0]=this._flatCoords[s+r*2],i[r][1]=this._flatCoords[s+r*2+1];return h}else{for(var e=this._getCoordsFromItemModel(o),r=0;r<e.length;r++)i[r]=i[r]||[],i[r][0]=e[r][0],i[r][1]=e[r][1];return e.length}},_processFlatCoordsArray:function(o){var i=0;if(this._flatCoords&&(i=this._flatCoords.length),typeof o[0]=="number"){for(var s=o.length,h=new Uint32Array(s),r=new Float64Array(s),e=0,n=0,l=0,u=0;u<s;){l++;var _=o[u++];h[n++]=e+i,h[n++]=_;for(var f=0;f<_;f++){var d=o[u++],v=o[u++];if(r[e++]=d,r[e++]=v,u>s)throw new Error("Invalid data format.")}}return{flatCoordsOffset:new Uint32Array(h.buffer,0,n),flatCoords:r,count:l}}return{flatCoordsOffset:null,flatCoords:null,count:o.length}},getInitialData:function(o,i){var s=new c.a.List(["value"],this);return s.hasItemOption=!1,s.initData(o.data,[],function(h,r,e,n){if(h instanceof Array)return NaN;s.hasItemOption=!0;var l=h.value;if(l!=null)return l instanceof Array?l[n]:l}),s},defaultOption:{coordinateSystem:"geo",zlevel:10,progressive:1e4,progressiveThreshold:5e4,blendMode:"source-over",lineStyle:{opacity:.8},postEffect:{enable:!1,colorCorrection:{exposure:0,brightness:0,contrast:1,saturation:1,enable:!0}}}})},function(F,R,g){var E=g(0),c=g.n(E),t=g(1),a=g(22),o=g(104),i=g(102),s=g(2);c.a.extendChartView({type:"linesGL",__ecgl__:!0,init:function(h,r){this.groupGL=new t.a.Node,this.viewGL=new a.a("orthographic"),this.viewGL.add(this.groupGL),this._glViewHelper=new i.a(this.viewGL),this._nativeLinesShader=t.a.createShader("ecgl.lines3D"),this._meshLinesShader=t.a.createShader("ecgl.meshLines3D"),this._linesMeshes=[],this._currentStep=0},render:function(h,r,e){this.groupGL.removeAll(),this._glViewHelper.reset(h,e);var n=this._linesMeshes[0];n||(n=this._linesMeshes[0]=this._createLinesMesh(h)),this._linesMeshes.length=1,this.groupGL.add(n),this._updateLinesMesh(h,n,0,h.getData().count()),this.viewGL.setPostEffect(h.getModel("postEffect"),e)},incrementalPrepareRender:function(h,r,e){this.groupGL.removeAll(),this._glViewHelper.reset(h,e),this._currentStep=0,this.viewGL.setPostEffect(h.getModel("postEffect"),e)},incrementalRender:function(h,r,e,n){var l=this._linesMeshes[this._currentStep];l||(l=this._createLinesMesh(r),this._linesMeshes[this._currentStep]=l),this._updateLinesMesh(r,l,h.start,h.end),this.groupGL.add(l),n.getZr().refresh(),this._currentStep++},updateTransform:function(h,r,e){h.coordinateSystem.getRoamTransform&&this._glViewHelper.updateTransform(h,e)},_createLinesMesh:function(h){var r=new t.a.Mesh({$ignorePicking:!0,material:new t.a.Material({shader:t.a.createShader("ecgl.lines3D"),transparent:!0,depthMask:!1,depthTest:!1}),geometry:new o.a({segmentScale:10,useNativeLine:!0,dynamic:!1}),mode:t.a.Mesh.LINES,culling:!1});return r},_updateLinesMesh:function(h,r,e,n){var l=h.getData();r.material.blend=h.get("blendMode")==="lighter"?t.a.additiveBlend:null;var u=h.get("lineStyle.curveness")||0,_=h.get("polyline"),f=r.geometry,d=h.coordinateSystem,v=s.a.firstNotNull(h.get("lineStyle.width"),1);v>1?(r.material.shader!==this._meshLinesShader&&r.material.attachShader(this._meshLinesShader),r.mode=t.a.Mesh.TRIANGLES):(r.material.shader!==this._nativeLinesShader&&r.material.attachShader(this._nativeLinesShader),r.mode=t.a.Mesh.LINES),e=e||0,n=n||l.count(),f.resetOffset();var m=0,p=0,y=[],x=[],M=[],P=[],T=[],O=.3,D=.7;function A(){x[0]=y[0]*D+P[0]*O-(y[1]-P[1])*u,x[1]=y[1]*D+P[1]*O-(P[0]-y[0])*u,M[0]=y[0]*O+P[0]*D-(y[1]-P[1])*u,M[1]=y[1]*O+P[1]*D-(P[0]-y[0])*u}if(_||u!==0)for(var C=e;C<n;C++)if(_){var S=h.getLineCoordsCount(C);m+=f.getPolylineVertexCount(S),p+=f.getPolylineTriangleCount(S)}else h.getLineCoords(C,T),this._glViewHelper.dataToPoint(d,T[0],y),this._glViewHelper.dataToPoint(d,T[1],P),A(),m+=f.getCubicCurveVertexCount(y,x,M,P),p+=f.getCubicCurveTriangleCount(y,x,M,P);else{var L=n-e;m+=L*f.getLineVertexCount(),p+=L*f.getLineVertexCount()}f.setVertexCount(m),f.setTriangleCount(p);for(var I=e,w=[],C=e;C<n;C++){t.a.parseColor(l.getItemVisual(I,"color"),w);var b=s.a.firstNotNull(l.getItemVisual(I,"opacity"),1);w[3]*=b;for(var S=h.getLineCoords(C,T),B=0;B<S;B++)this._glViewHelper.dataToPoint(d,T[B],T[B]);_?f.addPolyline(T,w,v,0,S):u!==0?(y=T[0],P=T[1],A(),f.addCubicCurve(y,x,M,P,w,v)):f.addPolyline(T,w,v,0,2),I++}},dispose:function(){this.groupGL.removeAll()},remove:function(){this.groupGL.removeAll()}})}])})}),Rt=At($),St=$.$override,It=$.DEFAULT_FONT,wt=$.HV_NAMES,bt=$.LOCATION_PARAMS,Bt=$.MAX_SAFE_INTEGER,Nt=$.__DEV__,Ut=$.add,Wt=$.addCommas,Ft=$.adjustTextPositionOnRect,Gt=$.adjustTextX,zt=$.adjustTextY,Kt=$.applyTransform,Ht=$.asc,Vt=$.assert,Xt=$.bind,jt=$.box,Zt=$.calculateTextPosition,Yt=$.capitalFirst,Qt=$.clone,Jt=$.concatArray,$t=$.containStroke,kt=$.copy,qt=$.copyLayoutParams,te=$.create,ee=$.createCanvas,re=$.createHashMap,ae=$.createOrUpdateImage,ne=$.curry;export default Rt;var ie=$.defaults,oe=$.dist,se=$.distSquare,le=$.distance,ue=$.distanceSquare,he=$.div,_e=$.dot,fe=$.each,ce=$.enableClassCheck,de=$.enableClassExtend,ve=$.enableClassManagement,me=$.encodeHTML,ge=$.eqNaN,pe=$.extend,Ee=$.fastLerp,ye=$.fastMapToColor,xe=$.filter,Te=$.find,Me=$.findExistImage,De=$.formatTime,Pe=$.formatTpl,Ae=$.formatTplSimple,Oe=$.getAvailableSize,Ce=$.getBoundingRect,Le=$.getContext,Re=$.getLayoutParams,Se=$.getLayoutRect,Ie=$.getLineHeight,we=$.getPercentWithPrecision,be=$.getPixelPrecision,Be=$.getPrecision,Ne=$.getPrecisionSafe,Ue=$.getTextBoundingRect,We=$.getTextRect,Fe=$.getTooltipMarker,Ge=$.getWidth,ze=$.hbox,Ke=$.identity,He=$.indexOf,Ve=$.inherits,Xe=$.invert,je=$.isArray,Ze=$.isArrayLike,Ye=$.isBuiltInObject,Qe=$.isDom,Je=$.isFunction,$e=$.isImageReady,ke=$.isNumeric,qe=$.isObject,tr=$.isPrimitive,er=$.isRadianAroundZero,rr=$.isString,ar=$.isTypedArray,nr=$.len,ir=$.lenSquare,or=$.length,sr=$.lengthSquare,lr=$.lerp,ur=$.lift,hr=$.linearMap,_r=$.makeFont,fr=$.map,cr=$.mapToColor,dr=$.max,vr=$.measureText,mr=$.merge,gr=$.mergeAll,pr=$.mergeLayoutParam,Er=$.min,yr=$.mixin,xr=$.modifyAlpha,Tr=$.modifyHSL,Mr=$.mul,Dr=$.negate,Pr=$.nice,Ar=$.noop,Or=$.normalize,Cr=$.normalizeCssArray,Lr=$.parse,Rr=$.parseClassType,Sr=$.parseDate,Ir=$.parsePercent,wr=$.parsePlainText,br=$.parseRichText,Br=$.positionElement,Nr=$.quantile,Ur=$.quantity,Wr=$.reduce,Fr=$.reformIntervals,Gr=$.remRadian,zr=$.retrieve,Kr=$.retrieve2,Hr=$.retrieve3,Vr=$.rotate,Xr=$.round,jr=$.scale,Zr=$.scaleAndAdd,Yr=$.set,Qr=$.setAsPrimitive,Jr=$.setReadOnly,$r=$.sizeCalculable,kr=$.slice,qr=$.stringify,ta=$.sub,ea=$.toCamelCase,ra=$.toHex,aa=$.translate,na=$.trim,ia=$.truncateText,oa=$.vbox;export{St as $override,It as DEFAULT_FONT,wt as HV_NAMES,bt as LOCATION_PARAMS,Bt as MAX_SAFE_INTEGER,Nt as __DEV__,$ as __moduleExports,Ut as add,Wt as addCommas,Ft as adjustTextPositionOnRect,Gt as adjustTextX,zt as adjustTextY,Kt as applyTransform,Ht as asc,Vt as assert,Xt as bind,jt as box,Zt as calculateTextPosition,Yt as capitalFirst,Qt as clone,Jt as concatArray,$t as containStroke,kt as copy,qt as copyLayoutParams,te as create,ee as createCanvas,re as createHashMap,ae as createOrUpdateImage,ne as curry,ie as defaults,oe as dist,se as distSquare,le as distance,ue as distanceSquare,he as div,_e as dot,fe as each,ce as enableClassCheck,de as enableClassExtend,ve as enableClassManagement,me as encodeHTML,ge as eqNaN,pe as extend,Ee as fastLerp,ye as fastMapToColor,xe as filter,Te as find,Me as findExistImage,De as formatTime,Pe as formatTpl,Ae as formatTplSimple,Oe as getAvailableSize,Ce as getBoundingRect,Le as getContext,Re as getLayoutParams,Se as getLayoutRect,Ie as getLineHeight,we as getPercentWithPrecision,be as getPixelPrecision,Be as getPrecision,Ne as getPrecisionSafe,Ue as getTextBoundingRect,We as getTextRect,Fe as getTooltipMarker,Ge as getWidth,ze as hbox,Ke as identity,He as indexOf,Ve as inherits,Xe as invert,je as isArray,Ze as isArrayLike,Ye as isBuiltInObject,Qe as isDom,Je as isFunction,$e as isImageReady,ke as isNumeric,qe as isObject,tr as isPrimitive,er as isRadianAroundZero,rr as isString,ar as isTypedArray,nr as len,ir as lenSquare,or as length,sr as lengthSquare,lr as lerp,ur as lift,hr as linearMap,_r as makeFont,fr as map,cr as mapToColor,dr as max,vr as measureText,mr as merge,gr as mergeAll,pr as mergeLayoutParam,Er as min,yr as mixin,xr as modifyAlpha,Tr as modifyHSL,Mr as mul,Dr as negate,Pr as nice,Ar as noop,Or as normalize,Cr as normalizeCssArray,Lr as parse,Rr as parseClassType,Sr as parseDate,Ir as parsePercent,wr as parsePlainText,br as parseRichText,Br as positionElement,Nr as quantile,Ur as quantity,Wr as reduce,Fr as reformIntervals,Gr as remRadian,zr as retrieve,Kr as retrieve2,Hr as retrieve3,Vr as rotate,Xr as round,jr as scale,Zr as scaleAndAdd,Yr as set,Qr as setAsPrimitive,Jr as setReadOnly,$r as sizeCalculable,kr as slice,qr as stringify,ta as sub,ea as toCamelCase,ra as toHex,aa as translate,na as trim,ia as truncateText,oa as vbox};
