import t,{useCallback as f,useEffect as p,useLayoutEffect as ee,useMemo as te,useRef as q,useState as s}from"../../../web_modules/react.js";import{em as R,headerHeight as z,primaryColor as ne,rem as m,zIndexes as re}from"../../utils/style.js";import ie from"../../../web_modules/react-spinners/GridLoader.js";import u from"../Icon.js";import oe from"../RangeSlider.js";import N from"../../../web_modules/styled-components.js";import{useTranslation as le}from"../../../web_modules/react-i18next.js";const ae=N.div.withConfig({displayName:"ImagePreviewer__Wrapper",componentId:"sc-1n154z7-0"})(["position:fixed;top:0;left:0;z-index:",";height:100vh;width:100vw;background-color:var(--dark-mask-color);"],re.dialog),se=N.div.withConfig({displayName:"ImagePreviewer__Header",componentId:"sc-1n154z7-1"})(["position:relative;height:",";width:100%;background-color:var(--model-header-background-color);display:flex;justify-content:space-between;align-items:center;.step-slider{display:flex;align-items:center;flex-grow:1;margin:0 ",";.slider{width:31.7213115%;margin:0 ",";}.step-buttons{margin-left:",";display:flex;flex-direction:column;font-size:",";> a{display:inline-block;line-height:1;height:",";&:hover{color:var(--text-lighter-color);}> i{display:inline-block;height:100%;> svg{vertical-align:top;}}}}}.buttons{display:flex;align-items:center;font-size:",";> *{margin-right:",";}> a{height:",";overflow:hidden;}> span{width:1px;height:",";background-color:var(--border-color);}}"],z,m(20),m(12),R(10),R(10),R(14),m(24),m(30),m(24),m(30)),ce=N.div.withConfig({displayName:"ImagePreviewer__Container",componentId:"sc-1n154z7-2"})(["display:flex;justify-content:center;align-items:center;position:absolute;height:calc(100% - ",");width:100%;top:",";left:0;overflow:hidden;> img{cursor:",";}"],z,z,v=>v.grabbing?"grabbing":"grab"),x=3,L=.1,de=({data:v,loading:H,error:U,steps:g,step:c,onClose:W,onChange:E,onChangeComplete:F})=>{const{t:j}=le("sample"),[l,A]=s(c!=null?c:0);p(()=>A(c!=null?c:0),[c]);const h=f(e=>{A(e),E==null||E(e)},[E]),J=f(()=>{l>0&&h(l-1)},[l,h]),K=f(()=>{l<g.length-1&&h(l+1)},[l,g,h]),[d,Q]=s("");ee(()=>{if(v){let e=null;return e=URL.createObjectURL(v.data),Q(e),()=>{e&&URL.revokeObjectURL(e)}}},[v]);const k=q(null),G=q(null),[M,w]=s(0),[P,b]=s(0);p(()=>{if(d){const e=new Image;e.src=d,e.onload=()=>{var r;const n=(r=k.current)===null||r===void 0?void 0:r.getBoundingClientRect();if(n){const a=n.width/n.height,i=e.naturalWidth/e.naturalHeight;a>=i&&e.naturalHeight>n.height*.9?(b(n.height*.9),w(i*n.height*.9)):i>=a&&e.naturalWidth>n.width*.9?(w(n.width*.9),b(i*n.width*.9)):(w(e.naturalWidth),b(e.naturalHeight))}}}return()=>{w(0),b(0)}},[d]);const[X,C]=s(1),Y=f(e=>C(r=>r+e>x?x:r+e<L?L:r+e),[]);p(()=>{const e=k.current,r=n=>{n.preventDefault(),C(a=>{const i=a-n.deltaY*.007;return i>x?x:i<L?L:i})};return e==null||e.addEventListener("wheel",r),()=>{e==null||e.removeEventListener("wheel",r)}},[]);const[V,S]=s(!1),[$,D]=s(0),[O,B]=s(0);p(()=>{const e=G.current;let r=!1,n=0,a=0;const i=o=>{o.preventDefault(),S(!0),r=!0,n=o.clientX,a=o.clientY},T=o=>{o.preventDefault(),r&&(D(_=>_+(o.clientX-n)),B(_=>_+(o.clientY-a)),n=o.clientX,a=o.clientY)},y=()=>{S(!1),r=!1};return e==null||e.addEventListener("mousedown",i),e==null||e.addEventListener("mousemove",T),e==null||e.addEventListener("mouseup",y),e==null||e.addEventListener("mouseout",y),()=>{e==null||e.removeEventListener("mousedown",i),e==null||e.removeEventListener("mousemove",T),e==null||e.removeEventListener("mouseup",y),e==null||e.removeEventListener("mouseout",y)}},[d]);const I=f(()=>{C(1),D(0),B(0)},[]);p(()=>I,[d,I]);const Z=te(()=>H?t.createElement(ie,{color:ne,size:"10px"}):U?t.createElement("div",null,j("common:error")):t.createElement("img",{src:d,ref:G,onClick:e=>e.stopPropagation(),style:{width:M,height:P,transform:`translate(${$}px, ${O}px) scale(${X})`}}),[d,H,U,M,P,$,O,X,j]);return t.createElement(ae,null,t.createElement(se,null,t.createElement("div",{className:"step-slider"},t.createElement("span",null,j("sample:step")),t.createElement(oe,{className:"slider",min:0,max:g.length?g.length-1:0,step:1,value:l,onChange:h,onChangeComplete:F}),t.createElement("span",null,g[l]),t.createElement("div",{className:"step-buttons"},t.createElement("a",{href:"javascript:void(0)",onClick:J},t.createElement(u,{type:"chevron-up"})),t.createElement("a",{href:"javascript:void(0)",onClick:K},t.createElement(u,{type:"chevron-down"})))),t.createElement("div",{className:"buttons"},t.createElement("a",{href:"javascript:void(0)",onClick:()=>Y(.1)},t.createElement(u,{type:"plus-circle"})),t.createElement("a",{href:"javascript:void(0)",onClick:()=>Y(-.1)},t.createElement(u,{type:"minus-circle"})),t.createElement("a",{href:"javascript:void(0)",onClick:I},t.createElement(u,{type:"restore-circle"})),t.createElement("span",null),t.createElement("a",{href:"javascript:void(0)",onClick:W},t.createElement(u,{type:"close"})))),t.createElement(ce,{ref:k,onClick:W,grabbing:V},Z))};export default de;
