function de(t,s){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(t,d).enumerable})),n.push.apply(n,a)}return n}function me(t){for(var s=1;s<arguments.length;s++){var n=arguments[s]!=null?arguments[s]:{};s%2?de(Object(n),!0).forEach(function(a){Oe(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):de(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}function Oe(t,s,n){return s in t?Object.defineProperty(t,s,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[s]=n,t}function fe(t,s){if(t==null)return{};var n=we(t,s),a,d;if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(t);for(d=0;d<y.length;d++)a=y[d],!(s.indexOf(a)>=0)&&(!Object.prototype.propertyIsEnumerable.call(t,a)||(n[a]=t[a]))}return n}function we(t,s){if(t==null)return{};var n={},a=Object.keys(t),d,y;for(y=0;y<a.length;y++)d=a[y],!(s.indexOf(d)>=0)&&(n[d]=t[d]);return n}import*as J from"../utils/chart.js";import T,{useCallback as b,useEffect as Y,useImperativeHandle as ke,useMemo as Q,useRef as U,useState as V}from"../../web_modules/react.js";import{primaryColor as Ee,transitionProps as Te}from"../utils/style.js";import De,{Wrapper as Ie,useChartTheme as Le}from"../hooks/useECharts.js";import Se from"../../web_modules/react-spinners/GridLoader.js";import ze from"../../web_modules/lodash/defaultsDeep.js";import Ye from"../../web_modules/styled-components.js";import Ne from"../hooks/useThrottleFn.js";const Ze=Ye.div.withConfig({displayName:"StackChart__Tooltip",componentId:"sc-1xrpgve-0"})(["position:absolute;z-index:1;background-color:var(--tooltip-background-color);color:var(--tooltip-text-color);border-radius:4px;padding:5px;display:none;",""],Te(["color","background-color"])),Ae=T.forwardRef(({options:t,data:s,title:n,loading:a,zoom:d,className:y,onInit:N},pe)=>{var F,R;const _=s!=null?s:{minZ:0,maxZ:0,minY:0,maxY:0,minX:0,maxX:0,data:null},{minZ:X,maxZ:$,minY:h,maxY:P,minX:ee,maxX:te}=_,oe=fe(_,["minZ","maxZ","minY","maxY","minX","maxX"]),j=Q(()=>{var e;return(e=oe.data)!==null&&e!==void 0?e:[]},[oe.data]),O=Q(()=>h===0&&P===0?-.4:h-(P-h)*.4,[h,P]),w=b((e,o,l,i)=>{const r=i([e,o]);return r?(r[1]-=(l-X)/($-X)*(i([0,h])[1]-i([0,O])[1]),r):[0,0]},[X,$,h,O]),Z=b((e,o,l)=>{const i=[];let r=0;for(;j[e]&&r<j[e].length;){const u=o(r++),v=o(r++),p=o(r++);p!==1&&r===3&&i.push(w(u,v,1,l)),i.push(w(u,v,p,l)),p!==1&&r===j[e].length&&i.push(w(u,v,1,l))}return i},[w,j]),re=b((e,o)=>{var l,i;const r=Z(e.dataIndex,o.value,o.coord);return{type:"polygon",silent:!0,z:(l=o.value)===null||l===void 0?void 0:l.call(o,1),shape:{points:r},style:(i=o.style)===null||i===void 0?void 0:i.call(o,{stroke:J.xAxis.axisLine.lineStyle.color,lineWidth:1})}},[Z]),[x,ne]=V(null),[k,W]=V([]),g=U(null),[ve,ie]=V(""),M=U(x),le=U(k);Y(()=>{M.current=x},[x]),Y(()=>{le.current=k},[k]);const D=t==null||(F=t.axisPointer)===null||F===void 0||(R=F.label)===null||R===void 0?void 0:R.formatter,se=b(e=>!D||M.current==null?"":typeof D=="string"?D:D(e,le.current[M.current]),[D]),ae=Le(),f=Q(()=>{const{color:e,colorAlt:o,toolbox:l,series:i}=J,r=fe(J,["color","colorAlt","toolbox","series"]);return ze({title:{text:n!=null?n:""},visualMap:{min:h,max:P},axisPointer:{label:{formatter:se}},xAxis:{min:ee,max:te,axisPointer:{type:"none"}},yAxis:{inverse:!0,position:"right",min:O,max:P,axisLine:{onZero:!1},axisLabel:{formatter:u=>u<h?"":u+""},axisPointer:{type:"none"}},grid:{left:r.grid.right,right:r.grid.left},tooltip:{trigger:"none",showContent:!1,axisPointer:{axis:"y",snap:!1}},series:[me(me({},i),{},{type:"custom",silent:!0,data:j,renderItem:re})]},t,ae,r)},[t,n,ae,j,ee,te,h,P,O,re,se]),I=b(()=>{var e;ne(null),W([]),(e=f.tooltip)!==null&&e!==void 0&&e.formatter&&(ie(""),g.current&&(g.current.style.display="none"))},[f.tooltip]),ye=b((e,o)=>{try{var l,i,r,u;if(!e||!o)return;const{offsetX:E,offsetY:H}=o;if((l=H<O+f.grid.top)!==null&&l!==void 0?l:0){I();return}const[Pe,je]=e.convertFromPixel("grid",[E,H]),G=(i=(r=e.getOption().series)===null||r===void 0?void 0:r[0].data)!==null&&i!==void 0?i:[],K=G.map(m=>m[1]).sort((m,S)=>m-S);let q=0,L=null;for(;q<K.length;)if(je<=K[q++]){L=K[q-1];break}const B=L==null?null:G.findIndex(m=>m[1]===L);ne(B);let C=[];if(L==null||(C=G.map(m=>{const S=[m[0],m[1],m[2]];let ue=Number.POSITIVE_INFINITY;for(let z=0;z<m.length;z+=3){const ce=Math.abs(m[z]-Pe);ce<ue&&(ue=ce,S[0]=m[z],S[2]=m[z+2])}return S})),W(C),(u=f.tooltip)!==null&&u!==void 0&&u.formatter){var v,p;ie(B==null?"":(v=f.tooltip)===null||v===void 0||(p=v.formatter)===null||p===void 0?void 0:p.call(v,C[B])),g.current&&(L==null?g.current.style.display="none":(g.current.style.left=`${E+10}px`,g.current.style.top=`${H+10}px`,g.current.style.display="block"))}}catch(E){I()}},[I,O,f.grid,f.tooltip]),A=Ne(ye,{wait:200}),he=b(e=>{try{const o=e.getZr();o&&(o.on("mousemove",l=>A.run(e,l)),o.on("mouseout",()=>{A.cancel(),I()}))}catch(o){A.cancel()}N==null||N(e)},[N,A,I]),{ref:ge,echart:c,wrapper:xe,saveAsImage:be}=De({loading:!!a,zoom:d,autoFit:!0,onInit:he});return ke(pe,()=>({saveAsImage:()=>{be(n)}})),Y(()=>{c==null||c.setOption(f,{notMerge:!0})},[c,f]),Y(()=>{if(c)try{if(x==null)c.setOption({graphic:{elements:[{id:"highlight",type:"polyline",$action:"remove"}]}});else{var e,o;const l=(e=(o=c.getOption().series)===null||o===void 0?void 0:o[0].data)!==null&&e!==void 0?e:[],i=u=>c.convertToPixel("grid",u),r=u=>l[x][u];c.setOption({graphic:{elements:[{id:"highlight",type:"polyline",$action:"replace",silent:!0,cursor:"default",zlevel:1,z:1,shape:{points:Z(x,r,i)}}]}})}}catch(l){}},[x,c,Z]),Y(()=>{if(c)try{if(k.length){const r=u=>c.convertToPixel("grid",u);c.setOption({graphic:{elements:k.map((u,v)=>{var p;const E=w(u[0],u[1],u[2],r);return{type:"circle",id:`dot${v}`,$action:"replace",cursor:"default",zlevel:1,z:2,shape:{cx:E[0],cy:E[1],r:3},style:{fill:"#fff",stroke:(p=f.color)===null||p===void 0?void 0:p[0],lineWidth:2}}})}})}else{var e,o,l,i;c.setOption({graphic:{elements:(e=c.getOption())===null||e===void 0||(o=e.graphic)===null||o===void 0||(l=o[0])===null||l===void 0||(i=l.elements)===null||i===void 0?void 0:i.filter(r=>r.id.startsWith("dot")).map(r=>({id:r.id,type:"circle",$action:"remove"}))}})}}catch(r){}},[k,c,f.color,w]),T.createElement(Ie,{ref:xe,className:y},!c&&T.createElement("div",{className:"loading"},T.createElement(Se,{color:Ee,size:"10px"})),T.createElement("div",{className:"echarts",ref:ge}),T.createElement(Ze,{className:"tooltip",ref:g,dangerouslySetInnerHTML:{__html:ve}}))});export default Ae;
