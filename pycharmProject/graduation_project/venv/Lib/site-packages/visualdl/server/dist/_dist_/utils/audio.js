function h(s,t){var e=Object.keys(s);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),e.push.apply(e,i)}return e}function f(s){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?h(Object(e),!0).forEach(function(i){r(s,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(e)):h(Object(e)).forEach(function(i){Object.defineProperty(s,i,Object.getOwnPropertyDescriptor(e,i))})}return s}function r(s,t,e){return t in s?Object.defineProperty(s,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):s[t]=e,s}export class AudioPlayer{get current(){return this.playing?this.context.currentTime-this.startAt+this.offset:this.offset}get duration(){return this.buffer?this.buffer.duration:Number.NaN}get sampleRate(){return this.buffer?this.decodedSampleRate:Number.NaN}get volume(){return this.gain.gain.value*100}set volume(t){t>100?t=100:t<0&&(t=0),this.gain.gain.value=t/100}constructor(t){var e;r(this,"context",void 0),r(this,"gain",void 0),r(this,"source",null),r(this,"buffer",null),r(this,"decodedSampleRate",Number.NaN),r(this,"contextFromOptions",void 0),r(this,"startAt",0),r(this,"stopAt",0),r(this,"offset",0),r(this,"toggleVolume",100),r(this,"playing",!1),r(this,"options",void 0),this.options=f({context:(e=t==null?void 0:t.context)!==null&&e!==void 0?e:new AudioContext,volume:100,onplay:()=>{},onstop:()=>{}},t),this.contextFromOptions=!!(t!=null&&t.context),this.context=this.options.context,this.gain=this.context.createGain(),this.volume=this.options.volume}reset(){if(this.buffer){if(this.playing){var t;(t=this.source)===null||t===void 0||t.stop(0)}this.startAt=0,this.stopAt=0,this.offset=0,this.buffer=null}}static getWavSampleRate(t){const i=new Int8Array(t).slice(24,28);return i[0]&255|(i[1]&255)<<8|(i[2]&255)<<16|(i[3]&255)<<24}static getMp3SampleRate(t){let e=new Uint8Array(t);if(String.fromCharCode.apply(null,Array.from(e.slice(0,3)))==="ID3"){e=e.slice(10);let l=0;for(;e[l]!==0;){const a=e[l+4]*4294967296+e[l+5]*65536+e[l+6]*256+e[l+7];l+=10+a}}let i=0;for(;e[i++]!==255;);i--;const n=e.slice(i,i+4),u=(n[1]&24)>>3,o=(n[2]&12)>>2;if(u===3){if(o===0)return 44100;if(o===1)return 48e3;if(o===2)return 32e3}else if(u===2){if(o===0)return 22050;if(o===1)return 24e3;if(o===2)return 16e3}else if(u===0){if(o===0)return 11025;if(o===1)return 12e3;if(o===2)return 8e3}return Number.NaN}load(t,e){return this.reset(),e==="wav"?this.decodedSampleRate=AudioPlayer.getWavSampleRate(t):e==="mpga"||e==="mp3"?this.decodedSampleRate=AudioPlayer.getMp3SampleRate(t):this.decodedSampleRate=Number.NaN,new Promise((i,n)=>{this.context.decodeAudioData(t,u=>{this.buffer=u,i()},n)})}play(){if(!this.buffer)throw new Error("No audio loaded");this.source=this.context.createBufferSource(),this.source.buffer=this.buffer,this.source.connect(this.gain).connect(this.context.destination),this.source.addEventListener("ended",()=>{this.stopAt=this.context.currentTime,this.offset+=this.stopAt-this.startAt,this.playing=!1,this.options.onstop(),this.source=null}),this.offset>=this.duration&&(this.offset=0),this.source.start(0,this.offset),this.startAt=this.context.currentTime,this.playing=!0,this.options.onplay()}pause(){var t;if(!this.buffer)throw new Error("No audio loaded");(t=this.source)===null||t===void 0||t.stop(0)}toggle(){this.playing?this.pause():this.play()}stop(){this.pause(),this.startAt=0,this.stopAt=0,this.offset=0}seek(t){if(t!=null&&(t<0||t>this.duration))throw new Error("Invalid offset");this.offset=t}toggleMute(){this.volume===0?this.volume=this.toggleVolume||100:(this.toggleVolume=this.volume,this.volume=0)}dispose(){this.reset(),this.contextFromOptions||this.context.close(),this.source=null,this.buffer=null}}
