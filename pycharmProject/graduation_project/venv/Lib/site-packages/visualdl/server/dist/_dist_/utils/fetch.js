import m from"../../__snowpack__/env.js";import.meta.env=m;function y(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),o.push.apply(o,t)}return o}function h(e){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?y(Object(o),!0).forEach(function(t){g(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):y(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function g(e,n,o){return n in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}function _(e,n){if(e==null)return{};var o=P(e,n),t,a;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],!(n.indexOf(t)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,t)||(o[t]=e[t]))}return o}function P(e,n){if(e==null)return{};var o={},t=Object.keys(e),a,r;for(r=0;r<t.length;r++)a=t[r],!(n.indexOf(a)>=0)&&(o[a]=e[a]);return o}import b from"../../web_modules/i18next.js";import E from"../../web_modules/query-string.js";const p=import.meta.env.SNOWPACK_PUBLIC_API_TOKEN_KEY,v=import.meta.env.SNOWPACK_PUBLIC_API_URL,O="X-VisualDL-Instance-ID",l=p?E.parse(window.location.search)[p]:"";export function getApiToken(){return l!=null?l:null}function j(e){const n=getApiToken();if(!p||!n)return e;const o=e||{},{headers:t}=o,a=_(o,["headers"]),r=new Headers(t);return Array.isArray(n)?n.forEach(i=>r.append(O,i)):r.append(O,n),h(h({},a),{},{headers:r})}function A(){return new Promise(e=>{b.changeLanguage(void 0).then(n=>e(n))})}function f(e){return import.meta.env.MODE==="development"&&console.error(e),A()}export async function fetcher(e,n){var o;let t;try{t=await fetch(v+e,j(n))}catch(r){const i=await f(r);throw new Error(i("errors:network-error"))}if(!t.ok){const r=await f(t);throw new Error(r([`errors:response-error.${t.status}`,"errors:response-error.unknown"]))}const a=(o=t.headers.get("content-type"))!==null&&o!==void 0?o:"";if(a.includes("application/json")){let r;try{r=await t.json()}catch(i){const c=await f(i);throw new Error(c("errors:parse-error"))}if(r&&"status"in r)if(r.status!==0){const i=await f(r);throw new Error(r.msg||i("errors:error"))}else return r.data;return r}else if(a.startsWith("text/")){let r;try{r=await t.text()}catch(i){const c=await f(i);throw new Error(c("errors:parse-error"))}return r}else{let r;try{r=await t.blob()}catch(s){const u=await f(s);throw new Error(u("errors:parse-error"))}const i=t.headers.get("Content-Disposition");r.arrayBuffer||(r.arrayBuffer=async()=>new Promise((s,u)=>{const w=new FileReader;w.addEventListener("load",d=>d.target?s(d.target.result):u()),w.readAsArrayBuffer(r)}));let c=null;if(i&&i.indexOf("attachment")!==-1){const s=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(i);s!=null&&s[1]&&(c=s[1].replace(/['"]/g,""))}return{data:r,type:t.headers.get("Content-Type"),filename:c}}}export const cycleFetcher=async(e,n)=>await Promise.all(e.map(o=>fetcher(o,n)));
