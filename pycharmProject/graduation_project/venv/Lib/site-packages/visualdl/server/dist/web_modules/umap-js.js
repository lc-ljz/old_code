import{c as lt,a as K}from"./common/_commonjsHelpers-4f955397.js";var wt=lt(function(i,e){var r=K&&K.__values||function(b){var v=typeof Symbol=="function"&&b[Symbol.iterator],f=0;return v?v.call(b):{next:function(){return b&&f>=b.length&&(b=void 0),{value:b&&b[f++],done:!b}}}};Object.defineProperty(e,"__esModule",{value:!0});function t(b,v){return Math.floor(v()*b)}e.tauRandInt=t;function n(b){return b()}e.tauRand=n;function o(b){var v,f,g=0;try{for(var m=r(b),w=m.next();!w.done;w=m.next()){var j=w.value;g+=Math.pow(j,2)}}catch(V){v={error:V}}finally{try{w&&!w.done&&(f=m.return)&&f.call(m)}finally{if(v)throw v.error}}return Math.sqrt(g)}e.norm=o;function u(b){for(var v=[],f=0;f<b;f++)v.push(void 0);return v}e.empty=u;function c(b){return u(b).map(function(v,f){return f})}e.range=c;function p(b,v){return u(b).map(function(){return v})}e.filled=p;function y(b){return p(b,0)}e.zeros=y;function k(b){return p(b,1)}e.ones=k;function I(b,v,f){return u(f).map(function(g,m){return b+m*((v-b)/(f-1))})}e.linear=I;function d(b){return b.reduce(function(v,f){return v+f})}e.sum=d;function F(b){return d(b)/b.length}e.mean=F;function M(b){for(var v=0,f=0;f<b.length;f++)v=b[f]>v?b[f]:v;return v}e.max=M;function E(b){for(var v=0,f=0;f<b.length;f++)for(var g=0;g<b[f].length;g++)v=b[f][g]>v?b[f][g]:v;return v}e.max2d=E;function _(b,v,f){for(var g=y(b),m=0;m<b;m++)for(var w=!0;w;){for(var j=t(v,f),V=!1,s=0;s<m;s++)if(j===g[s]){V=!0;break}V||(w=!1),g[m]=j}return g}e.rejectionSample=_;function z(b,v,f){var g=[],m=0;if(b.length!==v*f)throw new Error("Array dimensions must match input length.");for(var w=0;w<v;w++){for(var j=[],V=0;V<f;V++)j.push(b[m]),m+=1;g.push(j)}return g}e.reshape2d=z}),jt=lt(function(i,e){var r=K&&K.__importStar||function(d){if(d&&d.__esModule)return d;var F={};if(d!=null)for(var M in d)Object.hasOwnProperty.call(d,M)&&(F[M]=d[M]);return F.default=d,F};Object.defineProperty(e,"__esModule",{value:!0});var t=r(wt);function n(d,F){var M=function(_){return t.empty(d).map(function(){return t.filled(F,_)})},E=[];return E.push(M(-1)),E.push(M(Infinity)),E.push(M(0)),E}e.makeHeap=n;function o(d,F,M){for(var E=t.zeros(d),_=0;_<d;_++){for(var z=!0,b=0;z;){b=t.tauRandInt(F,M);for(var v=!1,f=0;f<_;f++)if(b===E[f]){v=!0;break}v||(z=!1)}E[_]=b}return E}e.rejectionSample=o;function u(d,F,M,E,_){F=Math.floor(F);var z=d[0][F],b=d[1][F];if(d[2][F],M>=b[0])return 0;for(var v=0;v<z.length;v++)if(E===z[v])return 0;return c(d,F,M,E,_)}e.heapPush=u;function c(d,F,M,E,_){var z=d[0][F],b=d[1][F],v=d[2][F];if(M>=b[0])return 0;b[0]=M,z[0]=E,v[0]=_;for(var f=0,g=0;;){var m=2*f+1,w=m+1,j=d[0][0].length;if(m>=j)break;if(w>=j)if(b[m]>M)g=m;else break;else if(b[m]>=b[w])if(M<b[m])g=m;else break;else if(M<b[w])g=w;else break;b[f]=b[g],z[f]=z[g],v[f]=v[g],f=g}return b[f]=M,z[f]=E,v[f]=_,1}e.uncheckedHeapPush=c;function p(d,F,M,E,_){for(var z=n(F,E),b=0;b<F;b++)for(var v=0;v<M;v++)if(!(d[0][b][v]<0)){var f=d[0][b][v],g=d[2][b][v],m=t.tauRand(_);u(z,b,m,f,g),u(z,f,m,b,g),d[2][b][v]=0}return z}e.buildCandidates=p;function y(d){for(var F=d[0],M=d[1],E=0;E<F.length;E++)for(var _=F[E],z=M[E],b=0;b<_.length-1;b++){var v=_.length-b-1,f=z.length-b-1,g=_[0];_[0]=_[v],_[v]=g;var m=z[0];z[0]=z[f],z[f]=m,k(z,_,f,0)}return{indices:F,weights:M}}e.deheapSort=y;function k(d,F,M,E){for(;E*2+1<M;){var _=E*2+1,z=_+1,b=E;if(d[b]<d[_]&&(b=_),z<M&&d[b]<d[z]&&(b=z),b===E)break;var v=d[E];d[E]=d[b],d[b]=v;var f=F[E];F[E]=F[b],F[b]=f,E=b}}function I(d,F){for(var M=d[0][F],E=d[1][F],_=d[2][F],z=Infinity,b=-1,v=0;v>M.length;v++)_[v]===1&&E[v]<z&&(z=E[v],b=v);return b>=0?(_[b]=0,Math.floor(M[b])):-1}e.smallestFlagged=I}),kt=lt(function(i,e){var r=K&&K.__read||function(f,g){var m=typeof Symbol=="function"&&f[Symbol.iterator];if(!m)return f;var w=m.call(f),j,V=[],s;try{for(;(g===void 0||g-- >0)&&!(j=w.next()).done;)V.push(j.value)}catch(l){s={error:l}}finally{try{j&&!j.done&&(m=w.return)&&m.call(w)}finally{if(s)throw s.error}}return V},t=K&&K.__values||function(f){var g=typeof Symbol=="function"&&f[Symbol.iterator],m=0;return g?g.call(f):{next:function(){return f&&m>=f.length&&(f=void 0),{value:f&&f[m++],done:!f}}}},n=K&&K.__importStar||function(f){if(f&&f.__esModule)return f;var g={};if(f!=null)for(var m in f)Object.hasOwnProperty.call(f,m)&&(g[m]=f[m]);return g.default=f,g};Object.defineProperty(e,"__esModule",{value:!0});var o,u=n(wt),c=function(){function f(g,m,w,j){if(this.entries=new Map,this.nRows=0,this.nCols=0,g.length!==m.length||g.length!==w.length)throw new Error("rows, cols and values arrays must all have the same length");this.nRows=j[0],this.nCols=j[1];for(var V=0;V<w.length;V++){var s=g[V],l=m[V];this.checkDims(s,l);var a=this.makeKey(s,l);this.entries.set(a,{value:w[V],row:s,col:l})}}return f.prototype.makeKey=function(g,m){return g+":"+m},f.prototype.checkDims=function(g,m){var w=g<this.nRows&&m<this.nCols;if(!w)throw new Error("row and/or col specified outside of matrix dimensions")},f.prototype.set=function(g,m,w){this.checkDims(g,m);var j=this.makeKey(g,m);this.entries.has(j)?this.entries.get(j).value=w:this.entries.set(j,{value:w,row:g,col:m})},f.prototype.get=function(g,m,w){w===void 0&&(w=0),this.checkDims(g,m);var j=this.makeKey(g,m);return this.entries.has(j)?this.entries.get(j).value:w},f.prototype.getAll=function(g){g===void 0&&(g=!0);var m=[];return this.entries.forEach(function(w){m.push(w)}),g&&m.sort(function(w,j){return w.row===j.row?w.col-j.col:w.row-j.row}),m},f.prototype.getDims=function(){return[this.nRows,this.nCols]},f.prototype.getRows=function(){return Array.from(this.entries,function(g){var m=r(g,2);m[0];var w=m[1];return w.row})},f.prototype.getCols=function(){return Array.from(this.entries,function(g){var m=r(g,2);m[0];var w=m[1];return w.col})},f.prototype.getValues=function(){return Array.from(this.entries,function(g){var m=r(g,2);m[0];var w=m[1];return w.value})},f.prototype.forEach=function(g){this.entries.forEach(function(m){return g(m.value,m.row,m.col)})},f.prototype.map=function(g){var m=[];this.entries.forEach(function(j){m.push(g(j.value,j.row,j.col))});var w=[this.nRows,this.nCols];return new f(this.getRows(),this.getCols(),m,w)},f.prototype.toArray=function(){var g=this,m=u.empty(this.nRows),w=m.map(function(){return u.zeros(g.nCols)});return this.entries.forEach(function(j){w[j.row][j.col]=j.value}),w},f}();e.SparseMatrix=c;function p(f){var g=[],m=[],w=[];f.forEach(function(V,s,l){g.push(s),m.push(l),w.push(V)});var j=[f.nCols,f.nRows];return new c(m,g,w,j)}e.transpose=p;function y(f){for(var g=r(f,1),m=g[0],w=new c([],[],[],f),j=0;j<m;j++)w.set(j,j,1);return w}e.identity=y;function k(f,g){return b(f,g,function(m,w){return m*w})}e.pairwiseMultiply=k;function I(f,g){return b(f,g,function(m,w){return m+w})}e.add=I;function d(f,g){return b(f,g,function(m,w){return m-w})}e.subtract=d;function F(f,g){return b(f,g,function(m,w){return m>w?m:w})}e.maximum=F;function M(f,g){return f.map(function(m){return m*g})}e.multiplyScalar=M;function E(f){for(var g=new Set,m=f.getValues(),w=f.getRows(),j=f.getCols(),V=0;V<m.length;V++)m[V]===0&&g.add(V);var s=function(N,S){return!g.has(S)},l=m.filter(s),a=w.filter(s),h=j.filter(s);return new c(a,h,l,f.getDims())}e.eliminateZeros=E;function _(f,g){g===void 0&&(g="l2");var m,w,j=z[g],V=new Map;f.forEach(function(S,R,T){var O=V.get(R)||[];O.push(T),V.set(R,O)});var s=new c([],[],[],f.getDims()),l=function(S){for(var R=V.get(S).sort(),T=R.map(function(L){return f.get(S,L)}),O=j(T),P=0;P<O.length;P++)s.set(S,R[P],O[P])};try{for(var a=t(V.keys()),h=a.next();!h.done;h=a.next()){var N=h.value;l(N)}}catch(S){m={error:S}}finally{try{h&&!h.done&&(w=a.return)&&w.call(a)}finally{if(m)throw m.error}}return s}e.normalize=_;var z=(o={},o.max=function(f){for(var g=-Infinity,m=0;m<f.length;m++)g=f[m]>g?f[m]:g;return f.map(function(w){return w/g})},o.l1=function(f){for(var g=0,m=0;m<f.length;m++)g+=f[m];return f.map(function(w){return w/g})},o.l2=function(f){for(var g=0,m=0;m<f.length;m++)g+=Math.pow(f[m],2);return f.map(function(w){return Math.sqrt(Math.pow(w,2)/g)})},o);function b(f,g,m){for(var w=new Set,j=[],V=[],s=[],l=function($,q){j.push($),V.push(q);var W=m(f.get($,q),g.get($,q));s.push(W)},a=f.getValues(),h=f.getRows(),N=f.getCols(),S=0;S<a.length;S++){var R=h[S],T=N[S],O=R+":"+T;w.add(O),l(R,T)}for(var P=g.getValues(),L=g.getRows(),C=g.getCols(),S=0;S<P.length;S++){var R=L[S],T=C[S],O=R+":"+T;w.has(O)||l(R,T)}var U=[f.nRows,f.nCols];return new c(j,V,s,U)}function v(f){var g=[];f.forEach(function(S,R,T){g.push({value:S,row:R,col:T})}),g.sort(function(S,R){return S.row===R.row?S.col-R.col:S.row-R.row});for(var m=[],w=[],j=[],V=-1,s=0;s<g.length;s++){var l=g[s],a=l.row,h=l.col,N=l.value;a!==V&&(V=a,j.push(s)),m.push(h),w.push(N)}return{indices:m,values:w,indptr:j}}e.getCSR=v}),Rt=lt(function(i,e){var r=K&&K.__read||function(v,f){var g=typeof Symbol=="function"&&v[Symbol.iterator];if(!g)return v;var m=g.call(v),w,j=[],V;try{for(;(f===void 0||f-- >0)&&!(w=m.next()).done;)j.push(w.value)}catch(s){V={error:s}}finally{try{w&&!w.done&&(g=m.return)&&g.call(m)}finally{if(V)throw V.error}}return j},t=K&&K.__spread||function(){for(var v=[],f=0;f<arguments.length;f++)v=v.concat(r(arguments[f]));return v},n=K&&K.__values||function(v){var f=typeof Symbol=="function"&&v[Symbol.iterator],g=0;return f?f.call(v):{next:function(){return v&&g>=v.length&&(v=void 0),{value:v&&v[g++],done:!v}}}},o=K&&K.__importStar||function(v){if(v&&v.__esModule)return v;var f={};if(v!=null)for(var g in v)Object.hasOwnProperty.call(v,g)&&(f[g]=v[g]);return f.default=v,f};Object.defineProperty(e,"__esModule",{value:!0});var u=o(wt),c=function(){function v(f,g,m,w){this.hyperplanes=f,this.offsets=g,this.children=m,this.indices=w}return v}();e.FlatTree=c;function p(v,f,g,m){var w=Math.max(10,f),j=u.range(g).map(function(s,l){return y(v,w,l,m)}),V=j.map(function(s){return d(s,w)});return V}e.makeForest=p;function y(v,f,g,m){f===void 0&&(f=30);var w=u.range(v.length),j=k(v,w,f,g,m);return j}function k(v,f,g,m,w){if(g===void 0&&(g=30),f.length>g){var j=I(v,f,w),V=j.indicesLeft,s=j.indicesRight,l=j.hyperplane,a=j.offset,h=k(v,V,g,m+1,w),N=k(v,s,g,m+1,w),S={leftChild:h,rightChild:N,isLeaf:!1,hyperplane:l,offset:a};return S}else{var S={indices:f,isLeaf:!0};return S}}function I(v,f,g){var m=v[0].length,w=u.tauRandInt(f.length,g),j=u.tauRandInt(f.length,g);j+=w===j?1:0,j=j%f.length;for(var V=f[w],s=f[j],l=0,a=u.zeros(m),h=0;h<a.length;h++)a[h]=v[V][h]-v[s][h],l-=a[h]*(v[V][h]+v[s][h])/2;for(var N=0,S=0,R=u.zeros(f.length),h=0;h<f.length;h++){for(var T=l,O=0;O<m;O++)T+=a[O]*v[f[h]][O];T===0?(R[h]=u.tauRandInt(2,g),R[h]===0?N+=1:S+=1):T>0?(R[h]=0,N+=1):(R[h]=1,S+=1)}var P=u.zeros(N),L=u.zeros(S);N=0,S=0;for(var h=0;h<R.length;h++)R[h]===0?(P[N]=f[h],N+=1):(L[S]=f[h],S+=1);return{indicesLeft:P,indicesRight:L,hyperplane:a,offset:l}}function d(v,f){var g=M(v),m=E(v),w=u.range(g).map(function(){return u.zeros(v.hyperplane?v.hyperplane.length:0)}),j=u.zeros(g),V=u.range(g).map(function(){return[-1,-1]}),s=u.range(m).map(function(){return u.range(f).map(function(){return-1})});return F(v,w,j,V,s,0,0),new c(w,j,V,s)}function F(v,f,g,m,w,j,V){var s;if(v.isLeaf)return m[j][0]=-V,(s=w[V]).splice.apply(s,t([0,v.indices.length],v.indices)),V+=1,{nodeNum:j,leafNum:V};f[j]=v.hyperplane,g[j]=v.offset,m[j][0]=j+1;var l=j,a=F(v.leftChild,f,g,m,w,j+1,V);return j=a.nodeNum,V=a.leafNum,m[l][1]=j+1,a=F(v.rightChild,f,g,m,w,j+1,V),{nodeNum:a.nodeNum,leafNum:a.leafNum}}function M(v){return v.isLeaf?1:1+M(v.leftChild)+M(v.rightChild)}function E(v){return v.isLeaf?1:E(v.leftChild)+E(v.rightChild)}function _(v){var f,g;if(v.length>0){var m=[];try{for(var w=n(v),j=w.next();!j.done;j=w.next()){var V=j.value;m.push.apply(m,t(V.indices))}}catch(s){f={error:s}}finally{try{j&&!j.done&&(g=w.return)&&g.call(w)}finally{if(f)throw f.error}}return m}else return[[-1]]}e.makeLeafArray=_;function z(v,f,g,m){for(var w=f,j=0;j<g.length;j++)w+=v[j]*g[j];if(w===0){var V=u.tauRandInt(2,m);return V}else return w>0?0:1}function b(v,f,g){for(var m=0;f.children[m][0]>0;){var w=z(f.hyperplanes[m],f.offsets[m],v,g);w===0?m=f.children[m][0]:m=f.children[m][1]}var j=-1*f.children[m][0];return f.indices[j]}e.searchFlatTree=b}),Tt=lt(function(i,e){var r=K&&K.__values||function(d){var F=typeof Symbol=="function"&&d[Symbol.iterator],M=0;return F?F.call(d):{next:function(){return d&&M>=d.length&&(d=void 0),{value:d&&d[M++],done:!d}}}},t=K&&K.__importStar||function(d){if(d&&d.__esModule)return d;var F={};if(d!=null)for(var M in d)Object.hasOwnProperty.call(d,M)&&(F[M]=d[M]);return F.default=d,F};Object.defineProperty(e,"__esModule",{value:!0});var n=t(jt),o=t(kt),u=t(Rt),c=t(wt);function p(d,F){return function(E,_,z,b,v,f,g,m){b===void 0&&(b=10),v===void 0&&(v=50),f===void 0&&(f=.001),g===void 0&&(g=.5),m===void 0&&(m=!0);for(var w=E.length,j=n.makeHeap(E.length,z),V=0;V<E.length;V++)for(var s=n.rejectionSample(z,E.length,F),l=0;l<s.length;l++){var a=d(E[V],E[s[l]]);n.heapPush(j,V,a,s[l],1),n.heapPush(j,s[l],a,V,1)}if(m)for(var h=0;h<_.length;h++)for(var V=0;V<_[h].length&&!(_[h][V]<0);V++)for(var l=V+1;l<_[h].length&&!(_[h][l]<0);l++){var a=d(E[_[h][V]],E[_[h][l]]);n.heapPush(j,_[h][V],a,_[h][l],1),n.heapPush(j,_[h][l],a,_[h][V],1)}for(var h=0;h<b;h++){for(var N=n.buildCandidates(j,w,z,v,F),S=0,V=0;V<w;V++)for(var l=0;l<v;l++){var R=Math.floor(N[0][V][l]);if(!(R<0||c.tauRand(F)<g))for(var T=0;T<v;T++){var O=Math.floor(N[0][V][T]),P=N[2][V][l],L=N[2][V][T];if(!(O<0||!P&&!L)){var a=d(E[R],E[O]);S+=n.heapPush(j,R,a,O,1),S+=n.heapPush(j,O,a,R,1)}}}if(S<=f*z*E.length)break}var C=n.deheapSort(j);return C}}e.makeNNDescent=p;function y(d){function F(E,_,z,b,v){for(var f=0;f<z.length;f++)for(var g=c.rejectionSample(E,_.length,v),m=0;m<g.length;m++)if(!(g[m]<0)){var w=d(_[g[m]],z[f]);n.heapPush(b,f,w,g[m],1)}}function M(E,_,z,b,v){for(var f=0;f<z.length;f++)for(var g=u.searchFlatTree(z[f],E,v),m=0;m<g.length;m++){if(g[m]<0)return;var w=d(_[g[m]],z[f]);n.heapPush(b,f,w,g[m],1)}}return{initFromRandom:F,initFromTree:M}}e.makeInitializations=y;function k(d){return function(M,E,_,z){for(var b,v,f=o.getCSR(E),g=f.indices,m=f.indptr,w=0;w<z.length;w++)for(var j=new Set(_[0][w]);;){var V=n.smallestFlagged(_,w);if(V===-1)break;var s=g.slice(m[V],m[V+1]);try{for(var l=r(s),a=l.next();!a.done;a=l.next()){var h=a.value;if(!(h===V||h===-1||j.has(h))){var N=d(M[h],z[w]);n.uncheckedHeapPush(_,w,N,h,1),j.add(h)}}}catch(S){b={error:S}}finally{try{a&&!a.done&&(v=l.return)&&v.call(l)}finally{if(b)throw b.error}}}return _}}e.makeInitializedNNSearch=k;function I(d,F,M,E,_,z,b){var v,f,g=n.makeHeap(M.length,E);if(_(E,F,M,g,b),d)try{for(var m=r(d),w=m.next();!w.done;w=m.next()){var j=w.value;z(j,F,M,g,b)}}catch(V){v={error:V}}finally{try{w&&!w.done&&(f=m.return)&&f.call(m)}finally{if(v)throw v.error}}return g}e.initializeSearch=I});const Ot=Object.prototype.toString;function ht(i){return Ot.call(i).endsWith("Array]")}function Nt(i,e,r){let t=0;const n=r(e);for(let o=0;o<i.x.length;o++)t+=Math.abs(i.y[o]-n(i.x[o]));return t}function Lt(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!ht(i))throw new TypeError("input must be an array");if(i.length===0)throw new TypeError("input must not be empty");var r=e.fromIndex,t=r===void 0?0:r,n=e.toIndex,o=n===void 0?i.length:n;if(t<0||t>=i.length||!Number.isInteger(t))throw new Error("fromIndex must be a positive integer smaller than length");if(o<=t||o>i.length||!Number.isInteger(o))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var u=i[t],c=t+1;c<o;c++)i[c]>u&&(u=i[c]);return u}function $t(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!ht(i))throw new TypeError("input must be an array");if(i.length===0)throw new TypeError("input must not be empty");var r=e.fromIndex,t=r===void 0?0:r,n=e.toIndex,o=n===void 0?i.length:n;if(t<0||t>=i.length||!Number.isInteger(t))throw new Error("fromIndex must be a positive integer smaller than length");if(o<=t||o>i.length||!Number.isInteger(o))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var u=i[t],c=t+1;c<o;c++)i[c]<u&&(u=i[c]);return u}function _t(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(ht(i)){if(i.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var r;if(e.output!==void 0){if(!ht(e.output))throw new TypeError("output option must be an array if specified");r=e.output}else r=new Array(i.length);var t=$t(i),n=Lt(i);if(t===n)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var o=e.min,u=o===void 0?e.autoMinMax?t:0:o,c=e.max,p=c===void 0?e.autoMinMax?n:1:c;if(u>=p)throw new RangeError("min option must be smaller than max option");for(var y=(p-u)/(n-t),k=0;k<i.length;k++)r[k]=(i[k]-t)*y+u;return r}const yt=" ".repeat(2),zt=" ".repeat(4);function Ct(){return Pt(this)}function Pt(i,e={}){const{maxRows:r=15,maxColumns:t=10,maxNumSize:n=8}=e;return`${i.constructor.name} {
${yt}[
${zt}${Dt(i,r,t,n)}
${yt}]
${yt}rows: ${i.rows}
${yt}columns: ${i.columns}
}`}function Dt(i,e,r,t){const{rows:n,columns:o}=i,u=Math.min(n,e),c=Math.min(o,r),p=[];for(let y=0;y<u;y++){let k=[];for(let I=0;I<c;I++)k.push(qt(i.get(y,I),t));p.push(`${k.join(" ")}`)}return c!==o&&(p[p.length-1]+=` ... ${o-r} more columns`),u!==n&&p.push(`... ${n-e} more rows`),p.join(`
${zt}`)}function qt(i,e){const r=String(i);if(r.length<=e)return r.padEnd(e," ");const t=i.toPrecision(e-2);if(t.length<=e)return t;const n=i.toExponential(e-2),o=n.indexOf("e"),u=n.slice(o);return n.slice(0,e-u.length)+u}function Ut(i,e){i.prototype.add=function(t){return typeof t=="number"?this.addS(t):this.addM(t)},i.prototype.addS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)+t);return this},i.prototype.addM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)+t.get(n,o));return this},i.add=function(t,n){return new e(t).add(n)},i.prototype.sub=function(t){return typeof t=="number"?this.subS(t):this.subM(t)},i.prototype.subS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)-t);return this},i.prototype.subM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)-t.get(n,o));return this},i.sub=function(t,n){return new e(t).sub(n)},i.prototype.subtract=i.prototype.sub,i.prototype.subtractS=i.prototype.subS,i.prototype.subtractM=i.prototype.subM,i.subtract=i.sub,i.prototype.mul=function(t){return typeof t=="number"?this.mulS(t):this.mulM(t)},i.prototype.mulS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)*t);return this},i.prototype.mulM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)*t.get(n,o));return this},i.mul=function(t,n){return new e(t).mul(n)},i.prototype.multiply=i.prototype.mul,i.prototype.multiplyS=i.prototype.mulS,i.prototype.multiplyM=i.prototype.mulM,i.multiply=i.mul,i.prototype.div=function(t){return typeof t=="number"?this.divS(t):this.divM(t)},i.prototype.divS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)/t);return this},i.prototype.divM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)/t.get(n,o));return this},i.div=function(t,n){return new e(t).div(n)},i.prototype.divide=i.prototype.div,i.prototype.divideS=i.prototype.divS,i.prototype.divideM=i.prototype.divM,i.divide=i.div,i.prototype.mod=function(t){return typeof t=="number"?this.modS(t):this.modM(t)},i.prototype.modS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)%t);return this},i.prototype.modM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)%t.get(n,o));return this},i.mod=function(t,n){return new e(t).mod(n)},i.prototype.modulus=i.prototype.mod,i.prototype.modulusS=i.prototype.modS,i.prototype.modulusM=i.prototype.modM,i.modulus=i.mod,i.prototype.and=function(t){return typeof t=="number"?this.andS(t):this.andM(t)},i.prototype.andS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)&t);return this},i.prototype.andM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)&t.get(n,o));return this},i.and=function(t,n){return new e(t).and(n)},i.prototype.or=function(t){return typeof t=="number"?this.orS(t):this.orM(t)},i.prototype.orS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)|t);return this},i.prototype.orM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)|t.get(n,o));return this},i.or=function(t,n){return new e(t).or(n)},i.prototype.xor=function(t){return typeof t=="number"?this.xorS(t):this.xorM(t)},i.prototype.xorS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)^t);return this},i.prototype.xorM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)^t.get(n,o));return this},i.xor=function(t,n){return new e(t).xor(n)},i.prototype.leftShift=function(t){return typeof t=="number"?this.leftShiftS(t):this.leftShiftM(t)},i.prototype.leftShiftS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)<<t);return this},i.prototype.leftShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)<<t.get(n,o));return this},i.leftShift=function(t,n){return new e(t).leftShift(n)},i.prototype.signPropagatingRightShift=function(t){return typeof t=="number"?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},i.prototype.signPropagatingRightShiftS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)>>t);return this},i.prototype.signPropagatingRightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)>>t.get(n,o));return this},i.signPropagatingRightShift=function(t,n){return new e(t).signPropagatingRightShift(n)},i.prototype.rightShift=function(t){return typeof t=="number"?this.rightShiftS(t):this.rightShiftM(t)},i.prototype.rightShiftS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)>>>t);return this},i.prototype.rightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)>>>t.get(n,o));return this},i.rightShift=function(t,n){return new e(t).rightShift(n)},i.prototype.zeroFillRightShift=i.prototype.rightShift,i.prototype.zeroFillRightShiftS=i.prototype.rightShiftS,i.prototype.zeroFillRightShiftM=i.prototype.rightShiftM,i.zeroFillRightShift=i.rightShift,i.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,~this.get(t,n));return this},i.not=function(t){return new e(t).not()},i.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.abs(this.get(t,n)));return this},i.abs=function(t){return new e(t).abs()},i.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.acos(this.get(t,n)));return this},i.acos=function(t){return new e(t).acos()},i.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.acosh(this.get(t,n)));return this},i.acosh=function(t){return new e(t).acosh()},i.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.asin(this.get(t,n)));return this},i.asin=function(t){return new e(t).asin()},i.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.asinh(this.get(t,n)));return this},i.asinh=function(t){return new e(t).asinh()},i.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.atan(this.get(t,n)));return this},i.atan=function(t){return new e(t).atan()},i.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.atanh(this.get(t,n)));return this},i.atanh=function(t){return new e(t).atanh()},i.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.cbrt(this.get(t,n)));return this},i.cbrt=function(t){return new e(t).cbrt()},i.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.ceil(this.get(t,n)));return this},i.ceil=function(t){return new e(t).ceil()},i.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.clz32(this.get(t,n)));return this},i.clz32=function(t){return new e(t).clz32()},i.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.cos(this.get(t,n)));return this},i.cos=function(t){return new e(t).cos()},i.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.cosh(this.get(t,n)));return this},i.cosh=function(t){return new e(t).cosh()},i.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.exp(this.get(t,n)));return this},i.exp=function(t){return new e(t).exp()},i.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.expm1(this.get(t,n)));return this},i.expm1=function(t){return new e(t).expm1()},i.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.floor(this.get(t,n)));return this},i.floor=function(t){return new e(t).floor()},i.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.fround(this.get(t,n)));return this},i.fround=function(t){return new e(t).fround()},i.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log(this.get(t,n)));return this},i.log=function(t){return new e(t).log()},i.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log1p(this.get(t,n)));return this},i.log1p=function(t){return new e(t).log1p()},i.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log10(this.get(t,n)));return this},i.log10=function(t){return new e(t).log10()},i.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log2(this.get(t,n)));return this},i.log2=function(t){return new e(t).log2()},i.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.round(this.get(t,n)));return this},i.round=function(t){return new e(t).round()},i.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sign(this.get(t,n)));return this},i.sign=function(t){return new e(t).sign()},i.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sin(this.get(t,n)));return this},i.sin=function(t){return new e(t).sin()},i.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sinh(this.get(t,n)));return this},i.sinh=function(t){return new e(t).sinh()},i.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sqrt(this.get(t,n)));return this},i.sqrt=function(t){return new e(t).sqrt()},i.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.tan(this.get(t,n)));return this},i.tan=function(t){return new e(t).tan()},i.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.tanh(this.get(t,n)));return this},i.tanh=function(t){return new e(t).tanh()},i.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.trunc(this.get(t,n)));return this},i.trunc=function(t){return new e(t).trunc()},i.pow=function(t,n){return new e(t).pow(n)},i.prototype.pow=function(t){return typeof t=="number"?this.powS(t):this.powM(t)},i.prototype.powS=function(t){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.pow(this.get(n,o),t));return this},i.prototype.powM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.pow(this.get(n,o),t.get(n,o)));return this}}function et(i,e,r){let t=r?i.rows:i.rows-1;if(e<0||e>t)throw new RangeError("Row index out of range")}function rt(i,e,r){let t=r?i.columns:i.columns-1;if(e<0||e>t)throw new RangeError("Column index out of range")}function at(i,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==i.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function ft(i,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==i.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function Bt(i,e,r){return{row:Wt(i,e),column:Kt(i,r)}}function Wt(i,e){if(typeof e!="object")throw new TypeError("unexpected type for row indices");if(e.some(t=>t<0||t>=i.rows))throw new RangeError("row indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function Kt(i,e){if(typeof e!="object")throw new TypeError("unexpected type for column indices");if(e.some(t=>t<0||t>=i.columns))throw new RangeError("column indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function It(i,e,r,t,n){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(Mt("startRow",e),Mt("endRow",r),Mt("startColumn",t),Mt("endColumn",n),e>r||t>n||e<0||e>=i.rows||r<0||r>=i.rows||t<0||t>=i.columns||n<0||n>=i.columns)throw new RangeError("Submatrix indices are out of range")}function St(i,e=0){let r=[];for(let t=0;t<i;t++)r.push(e);return r}function Mt(i,e){if(typeof e!="number")throw new TypeError(`${i} must be a number`)}function ct(i){if(i.isEmpty())throw new Error("Empty matrix has no elements to index")}function Gt(i){let e=St(i.rows);for(let r=0;r<i.rows;++r)for(let t=0;t<i.columns;++t)e[r]+=i.get(r,t);return e}function Qt(i){let e=St(i.columns);for(let r=0;r<i.rows;++r)for(let t=0;t<i.columns;++t)e[t]+=i.get(r,t);return e}function Yt(i){let e=0;for(let r=0;r<i.rows;r++)for(let t=0;t<i.columns;t++)e+=i.get(r,t);return e}function Xt(i){let e=St(i.rows,1);for(let r=0;r<i.rows;++r)for(let t=0;t<i.columns;++t)e[r]*=i.get(r,t);return e}function Jt(i){let e=St(i.columns,1);for(let r=0;r<i.rows;++r)for(let t=0;t<i.columns;++t)e[t]*=i.get(r,t);return e}function Zt(i){let e=1;for(let r=0;r<i.rows;r++)for(let t=0;t<i.columns;t++)e*=i.get(r,t);return e}function Ht(i,e,r){const t=i.rows,n=i.columns,o=[];for(let u=0;u<t;u++){let c=0,p=0,y=0;for(let k=0;k<n;k++)y=i.get(u,k)-r[u],c+=y,p+=y*y;e?o.push((p-c*c/n)/(n-1)):o.push((p-c*c/n)/n)}return o}function xt(i,e,r){const t=i.rows,n=i.columns,o=[];for(let u=0;u<n;u++){let c=0,p=0,y=0;for(let k=0;k<t;k++)y=i.get(k,u)-r[u],c+=y,p+=y*y;e?o.push((p-c*c/t)/(t-1)):o.push((p-c*c/t)/t)}return o}function At(i,e,r){const t=i.rows,n=i.columns,o=t*n;let u=0,c=0,p=0;for(let y=0;y<t;y++)for(let k=0;k<n;k++)p=i.get(y,k)-r,u+=p,c+=p*p;return e?(c-u*u/o)/(o-1):(c-u*u/o)/o}function te(i,e){for(let r=0;r<i.rows;r++)for(let t=0;t<i.columns;t++)i.set(r,t,i.get(r,t)-e[r])}function ee(i,e){for(let r=0;r<i.rows;r++)for(let t=0;t<i.columns;t++)i.set(r,t,i.get(r,t)-e[t])}function re(i,e){for(let r=0;r<i.rows;r++)for(let t=0;t<i.columns;t++)i.set(r,t,i.get(r,t)-e)}function ne(i){const e=[];for(let r=0;r<i.rows;r++){let t=0;for(let n=0;n<i.columns;n++)t+=Math.pow(i.get(r,n),2)/(i.columns-1);e.push(Math.sqrt(t))}return e}function oe(i,e){for(let r=0;r<i.rows;r++)for(let t=0;t<i.columns;t++)i.set(r,t,i.get(r,t)/e[r])}function ie(i){const e=[];for(let r=0;r<i.columns;r++){let t=0;for(let n=0;n<i.rows;n++)t+=Math.pow(i.get(n,r),2)/(i.rows-1);e.push(Math.sqrt(t))}return e}function se(i,e){for(let r=0;r<i.rows;r++)for(let t=0;t<i.columns;t++)i.set(r,t,i.get(r,t)/e[t])}function le(i){const e=i.size-1;let r=0;for(let t=0;t<i.columns;t++)for(let n=0;n<i.rows;n++)r+=Math.pow(i.get(n,t),2)/e;return Math.sqrt(r)}function he(i,e){for(let r=0;r<i.rows;r++)for(let t=0;t<i.columns;t++)i.set(r,t,i.get(r,t)/e)}class B{static from1DArray(e,r,t){if(e*r!==t.length)throw new RangeError("data length does not match given dimensions");let o=new D(e,r);for(let u=0;u<e;u++)for(let c=0;c<r;c++)o.set(u,c,t[u*r+c]);return o}static rowVector(e){let r=new D(1,e.length);for(let t=0;t<e.length;t++)r.set(0,t,e[t]);return r}static columnVector(e){let r=new D(e.length,1);for(let t=0;t<e.length;t++)r.set(t,0,e[t]);return r}static zeros(e,r){return new D(e,r)}static ones(e,r){return new D(e,r).fill(1)}static rand(e,r,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{random:n=Math.random}=t;let o=new D(e,r);for(let u=0;u<e;u++)for(let c=0;c<r;c++)o.set(u,c,n());return o}static randInt(e,r,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:n=0,max:o=1e3,random:u=Math.random}=t;if(!Number.isInteger(n))throw new TypeError("min must be an integer");if(!Number.isInteger(o))throw new TypeError("max must be an integer");if(n>=o)throw new RangeError("min must be smaller than max");let c=o-n,p=new D(e,r);for(let y=0;y<e;y++)for(let k=0;k<r;k++){let I=n+Math.round(u()*c);p.set(y,k,I)}return p}static eye(e,r,t){r===void 0&&(r=e),t===void 0&&(t=1);let n=Math.min(e,r),o=this.zeros(e,r);for(let u=0;u<n;u++)o.set(u,u,t);return o}static diag(e,r,t){let n=e.length;r===void 0&&(r=n),t===void 0&&(t=r);let o=Math.min(n,r,t),u=this.zeros(r,t);for(let c=0;c<o;c++)u.set(c,c,e[c]);return u}static min(e,r){e=this.checkMatrix(e),r=this.checkMatrix(r);let t=e.rows,n=e.columns,o=new D(t,n);for(let u=0;u<t;u++)for(let c=0;c<n;c++)o.set(u,c,Math.min(e.get(u,c),r.get(u,c)));return o}static max(e,r){e=this.checkMatrix(e),r=this.checkMatrix(r);let t=e.rows,n=e.columns,o=new this(t,n);for(let u=0;u<t;u++)for(let c=0;c<n;c++)o.set(u,c,Math.max(e.get(u,c),r.get(u,c)));return o}static checkMatrix(e){return B.isMatrix(e)?e:new D(e)}static isMatrix(e){return e!=null&&e.klass==="Matrix"}get size(){return this.rows*this.columns}apply(e){if(typeof e!="function")throw new TypeError("callback must be a function");for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e.call(this,r,t);return this}to1DArray(){let e=[];for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e.push(this.get(r,t));return e}to2DArray(){let e=[];for(let r=0;r<this.rows;r++){e.push([]);for(let t=0;t<this.columns;t++)e[r].push(this.get(r,t))}return e}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let e=0;e<this.rows;e++)for(let r=0;r<=e;r++)if(this.get(e,r)!==this.get(r,e))return!1;return!0}return!1}isEchelonForm(){let e=0,r=0,t=-1,n=!0,o=!1;for(;e<this.rows&&n;){for(r=0,o=!1;r<this.columns&&o===!1;)this.get(e,r)===0?r++:this.get(e,r)===1&&r>t?(o=!0,t=r):(n=!1,o=!0);e++}return n}isReducedEchelonForm(){let e=0,r=0,t=-1,n=!0,o=!1;for(;e<this.rows&&n;){for(r=0,o=!1;r<this.columns&&o===!1;)this.get(e,r)===0?r++:this.get(e,r)===1&&r>t?(o=!0,t=r):(n=!1,o=!0);for(let u=r+1;u<this.rows;u++)this.get(e,u)!==0&&(n=!1);e++}return n}echelonForm(){let e=this.clone(),r=0,t=0;for(;r<e.rows&&t<e.columns;){let n=r;for(let o=r;o<e.rows;o++)e.get(o,t)>e.get(n,t)&&(n=o);if(e.get(n,t)===0)t++;else{e.swapRows(r,n);let o=e.get(r,t);for(let u=t;u<e.columns;u++)e.set(r,u,e.get(r,u)/o);for(let u=r+1;u<e.rows;u++){let c=e.get(u,t)/e.get(r,t);e.set(u,t,0);for(let p=t+1;p<e.columns;p++)e.set(u,p,e.get(u,p)-e.get(r,p)*c)}r++,t++}}return e}reducedEchelonForm(){let e=this.echelonForm(),r=e.columns,t=e.rows,n=t-1;for(;n>=0;)if(e.maxRow(n)===0)n--;else{let o=0,u=!1;for(;o<t&&u===!1;)e.get(n,o)===1?u=!0:o++;for(let c=0;c<n;c++){let p=e.get(c,o);for(let y=o;y<r;y++){let k=e.get(c,y)-p*e.get(n,y);e.set(c,y,k)}}n--}return e}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{rows:r=1,columns:t=1}=e;if(!Number.isInteger(r)||r<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(t)||t<=0)throw new TypeError("columns must be a positive integer");let n=new D(this.rows*r,this.columns*t);for(let o=0;o<r;o++)for(let u=0;u<t;u++)n.setSubMatrix(this,this.rows*o,this.columns*u);return n}fill(e){for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,e);return this}neg(){return this.mulS(-1)}getRow(e){et(this,e);let r=[];for(let t=0;t<this.columns;t++)r.push(this.get(e,t));return r}getRowVector(e){return D.rowVector(this.getRow(e))}setRow(e,r){et(this,e),r=at(this,r);for(let t=0;t<this.columns;t++)this.set(e,t,r[t]);return this}swapRows(e,r){et(this,e),et(this,r);for(let t=0;t<this.columns;t++){let n=this.get(e,t);this.set(e,t,this.get(r,t)),this.set(r,t,n)}return this}getColumn(e){rt(this,e);let r=[];for(let t=0;t<this.rows;t++)r.push(this.get(t,e));return r}getColumnVector(e){return D.columnVector(this.getColumn(e))}setColumn(e,r){rt(this,e),r=ft(this,r);for(let t=0;t<this.rows;t++)this.set(t,e,r[t]);return this}swapColumns(e,r){rt(this,e),rt(this,r);for(let t=0;t<this.rows;t++){let n=this.get(t,e);this.set(t,e,this.get(t,r)),this.set(t,r,n)}return this}addRowVector(e){e=at(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)+e[t]);return this}subRowVector(e){e=at(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)-e[t]);return this}mulRowVector(e){e=at(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)*e[t]);return this}divRowVector(e){e=at(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)/e[t]);return this}addColumnVector(e){e=ft(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)+e[r]);return this}subColumnVector(e){e=ft(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)-e[r]);return this}mulColumnVector(e){e=ft(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)*e[r]);return this}divColumnVector(e){e=ft(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)/e[r]);return this}mulRow(e,r){et(this,e);for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)*r);return this}mulColumn(e,r){rt(this,e);for(let t=0;t<this.rows;t++)this.set(t,e,this.get(t,e)*r);return this}max(){if(this.isEmpty())return NaN;let e=this.get(0,0);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.get(r,t)>e&&(e=this.get(r,t));return e}maxIndex(){ct(this);let e=this.get(0,0),r=[0,0];for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)>e&&(e=this.get(t,n),r[0]=t,r[1]=n);return r}min(){if(this.isEmpty())return NaN;let e=this.get(0,0);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.get(r,t)<e&&(e=this.get(r,t));return e}minIndex(){ct(this);let e=this.get(0,0),r=[0,0];for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)<e&&(e=this.get(t,n),r[0]=t,r[1]=n);return r}maxRow(e){if(et(this,e),this.isEmpty())return NaN;let r=this.get(e,0);for(let t=1;t<this.columns;t++)this.get(e,t)>r&&(r=this.get(e,t));return r}maxRowIndex(e){et(this,e),ct(this);let r=this.get(e,0),t=[e,0];for(let n=1;n<this.columns;n++)this.get(e,n)>r&&(r=this.get(e,n),t[1]=n);return t}minRow(e){if(et(this,e),this.isEmpty())return NaN;let r=this.get(e,0);for(let t=1;t<this.columns;t++)this.get(e,t)<r&&(r=this.get(e,t));return r}minRowIndex(e){et(this,e),ct(this);let r=this.get(e,0),t=[e,0];for(let n=1;n<this.columns;n++)this.get(e,n)<r&&(r=this.get(e,n),t[1]=n);return t}maxColumn(e){if(rt(this,e),this.isEmpty())return NaN;let r=this.get(0,e);for(let t=1;t<this.rows;t++)this.get(t,e)>r&&(r=this.get(t,e));return r}maxColumnIndex(e){rt(this,e),ct(this);let r=this.get(0,e),t=[0,e];for(let n=1;n<this.rows;n++)this.get(n,e)>r&&(r=this.get(n,e),t[0]=n);return t}minColumn(e){if(rt(this,e),this.isEmpty())return NaN;let r=this.get(0,e);for(let t=1;t<this.rows;t++)this.get(t,e)<r&&(r=this.get(t,e));return r}minColumnIndex(e){rt(this,e),ct(this);let r=this.get(0,e),t=[0,e];for(let n=1;n<this.rows;n++)this.get(n,e)<r&&(r=this.get(n,e),t[0]=n);return t}diag(){let e=Math.min(this.rows,this.columns),r=[];for(let t=0;t<e;t++)r.push(this.get(t,t));return r}norm(e="frobenius"){let r=0;if(e==="max")return this.max();if(e==="frobenius"){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)r=r+this.get(t,n)*this.get(t,n);return Math.sqrt(r)}else throw new RangeError(`unknown norm type: ${e}`)}cumulativeSum(){let e=0;for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e+=this.get(r,t),this.set(r,t,e);return this}dot(e){B.isMatrix(e)&&(e=e.to1DArray());let r=this.to1DArray();if(r.length!==e.length)throw new RangeError("vectors do not have the same size");let t=0;for(let n=0;n<r.length;n++)t+=r[n]*e[n];return t}mmul(e){e=D.checkMatrix(e);let r=this.rows,t=this.columns,n=e.columns,o=new D(r,n),u=new Float64Array(t);for(let c=0;c<n;c++){for(let p=0;p<t;p++)u[p]=e.get(p,c);for(let p=0;p<r;p++){let y=0;for(let k=0;k<t;k++)y+=this.get(p,k)*u[k];o.set(p,c,y)}}return o}strassen2x2(e){e=D.checkMatrix(e);let r=new D(2,2);const t=this.get(0,0),n=e.get(0,0),o=this.get(0,1),u=e.get(0,1),c=this.get(1,0),p=e.get(1,0),y=this.get(1,1),k=e.get(1,1),I=(t+y)*(n+k),d=(c+y)*n,F=t*(u-k),M=y*(p-n),E=(t+o)*k,_=(c-t)*(n+u),z=(o-y)*(p+k),b=I+M-E+z,v=F+E,f=d+M,g=I-d+F+_;return r.set(0,0,b),r.set(0,1,v),r.set(1,0,f),r.set(1,1,g),r}strassen3x3(e){e=D.checkMatrix(e);let r=new D(3,3);const t=this.get(0,0),n=this.get(0,1),o=this.get(0,2),u=this.get(1,0),c=this.get(1,1),p=this.get(1,2),y=this.get(2,0),k=this.get(2,1),I=this.get(2,2),d=e.get(0,0),F=e.get(0,1),M=e.get(0,2),E=e.get(1,0),_=e.get(1,1),z=e.get(1,2),b=e.get(2,0),v=e.get(2,1),f=e.get(2,2),g=(t+n+o-u-c-k-I)*_,m=(t-u)*(-F+_),w=c*(-d+F+E-_-z-b+f),j=(-t+u+c)*(d-F+_),V=(u+c)*(-d+F),s=t*d,l=(-t+y+k)*(d-M+z),a=(-t+y)*(M-z),h=(y+k)*(-d+M),N=(t+n+o-c-p-y-k)*z,S=k*(-d+M+E-_-z-b+v),R=(-o+k+I)*(_+b-v),T=(o-I)*(_-v),O=o*b,P=(k+I)*(-b+v),L=(-o+c+p)*(z+b-f),C=(o-p)*(z-f),U=(c+p)*(-b+f),$=n*E,q=p*v,W=u*M,G=y*F,Q=I*f,J=s+O+$,Y=g+j+V+s+R+O+P,H=s+l+h+N+O+L+U,X=m+w+j+s+O+L+C,x=m+j+V+s+q,nt=O+L+C+U+W,A=s+l+a+S+R+T+O,it=R+T+O+P+G,ot=s+l+a+h+Q;return r.set(0,0,J),r.set(0,1,Y),r.set(0,2,H),r.set(1,0,X),r.set(1,1,x),r.set(1,2,nt),r.set(2,0,A),r.set(2,1,it),r.set(2,2,ot),r}mmulStrassen(e){e=D.checkMatrix(e);let r=this.clone(),t=r.rows,n=r.columns,o=e.rows,u=e.columns;n!==o&&console.warn(`Multiplying ${t} x ${n} and ${o} x ${u} matrix: dimensions do not match.`);function c(I,d,F){let M=I.rows,E=I.columns;if(M===d&&E===F)return I;{let _=B.zeros(d,F);return _=_.setSubMatrix(I,0,0),_}}let p=Math.max(t,o),y=Math.max(n,u);r=c(r,p,y),e=c(e,p,y);function k(I,d,F,M){if(F<=512||M<=512)return I.mmul(d);F%2==1&&M%2==1?(I=c(I,F+1,M+1),d=c(d,F+1,M+1)):F%2==1?(I=c(I,F+1,M),d=c(d,F+1,M)):M%2==1&&(I=c(I,F,M+1),d=c(d,F,M+1));let E=parseInt(I.rows/2,10),_=parseInt(I.columns/2,10),z=I.subMatrix(0,E-1,0,_-1),b=d.subMatrix(0,E-1,0,_-1),v=I.subMatrix(0,E-1,_,I.columns-1),f=d.subMatrix(0,E-1,_,d.columns-1),g=I.subMatrix(E,I.rows-1,0,_-1),m=d.subMatrix(E,d.rows-1,0,_-1),w=I.subMatrix(E,I.rows-1,_,I.columns-1),j=d.subMatrix(E,d.rows-1,_,d.columns-1),V=k(B.add(z,w),B.add(b,j),E,_),s=k(B.add(g,w),b,E,_),l=k(z,B.sub(f,j),E,_),a=k(w,B.sub(m,b),E,_),h=k(B.add(z,v),j,E,_),N=k(B.sub(g,z),B.add(b,f),E,_),S=k(B.sub(v,w),B.add(m,j),E,_),R=B.add(V,a);R.sub(h),R.add(S);let T=B.add(l,h),O=B.add(s,a),P=B.sub(V,s);P.add(l),P.add(N);let L=B.zeros(2*R.rows,2*R.columns);return L=L.setSubMatrix(R,0,0),L=L.setSubMatrix(T,R.rows,0),L=L.setSubMatrix(O,0,R.columns),L=L.setSubMatrix(P,R.rows,R.columns),L.subMatrix(0,F-1,0,M-1)}return k(r,e,p,y)}scaleRows(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:r=0,max:t=1}=e;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(r>=t)throw new RangeError("min must be smaller than max");let n=new D(this.rows,this.columns);for(let o=0;o<this.rows;o++){const u=this.getRow(o);u.length>0&&_t(u,{min:r,max:t,output:u}),n.setRow(o,u)}return n}scaleColumns(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:r=0,max:t=1}=e;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(r>=t)throw new RangeError("min must be smaller than max");let n=new D(this.rows,this.columns);for(let o=0;o<this.columns;o++){const u=this.getColumn(o);u.length&&_t(u,{min:r,max:t,output:u}),n.setColumn(o,u)}return n}flipRows(){const e=Math.ceil(this.columns/2);for(let r=0;r<this.rows;r++)for(let t=0;t<e;t++){let n=this.get(r,t),o=this.get(r,this.columns-1-t);this.set(r,t,o),this.set(r,this.columns-1-t,n)}return this}flipColumns(){const e=Math.ceil(this.rows/2);for(let r=0;r<this.columns;r++)for(let t=0;t<e;t++){let n=this.get(t,r),o=this.get(this.rows-1-t,r);this.set(t,r,o),this.set(this.rows-1-t,r,n)}return this}kroneckerProduct(e){e=D.checkMatrix(e);let r=this.rows,t=this.columns,n=e.rows,o=e.columns,u=new D(r*n,t*o);for(let c=0;c<r;c++)for(let p=0;p<t;p++)for(let y=0;y<n;y++)for(let k=0;k<o;k++)u.set(n*c+y,o*p+k,this.get(c,p)*e.get(y,k));return u}transpose(){let e=new D(this.columns,this.rows);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e.set(t,r,this.get(r,t));return e}sortRows(e=Ft){for(let r=0;r<this.rows;r++)this.setRow(r,this.getRow(r).sort(e));return this}sortColumns(e=Ft){for(let r=0;r<this.columns;r++)this.setColumn(r,this.getColumn(r).sort(e));return this}subMatrix(e,r,t,n){It(this,e,r,t,n);let o=new D(r-e+1,n-t+1);for(let u=e;u<=r;u++)for(let c=t;c<=n;c++)o.set(u-e,c-t,this.get(u,c));return o}subMatrixRow(e,r,t){if(r===void 0&&(r=0),t===void 0&&(t=this.columns-1),r>t||r<0||r>=this.columns||t<0||t>=this.columns)throw new RangeError("Argument out of range");let n=new D(e.length,t-r+1);for(let o=0;o<e.length;o++)for(let u=r;u<=t;u++){if(e[o]<0||e[o]>=this.rows)throw new RangeError(`Row index out of range: ${e[o]}`);n.set(o,u-r,this.get(e[o],u))}return n}subMatrixColumn(e,r,t){if(r===void 0&&(r=0),t===void 0&&(t=this.rows-1),r>t||r<0||r>=this.rows||t<0||t>=this.rows)throw new RangeError("Argument out of range");let n=new D(t-r+1,e.length);for(let o=0;o<e.length;o++)for(let u=r;u<=t;u++){if(e[o]<0||e[o]>=this.columns)throw new RangeError(`Column index out of range: ${e[o]}`);n.set(u-r,o,this.get(u,e[o]))}return n}setSubMatrix(e,r,t){if(e=D.checkMatrix(e),e.isEmpty())return this;let n=r+e.rows-1,o=t+e.columns-1;It(this,r,n,t,o);for(let u=0;u<e.rows;u++)for(let c=0;c<e.columns;c++)this.set(r+u,t+c,e.get(u,c));return this}selection(e,r){let t=Bt(this,e,r),n=new D(e.length,r.length);for(let o=0;o<t.row.length;o++){let u=t.row[o];for(let c=0;c<t.column.length;c++){let p=t.column[c];n.set(o,c,this.get(u,p))}}return n}trace(){let e=Math.min(this.rows,this.columns),r=0;for(let t=0;t<e;t++)r+=this.get(t,t);return r}clone(){let e=new D(this.rows,this.columns);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e.set(r,t,this.get(r,t));return e}sum(e){switch(e){case"row":return Gt(this);case"column":return Qt(this);case void 0:return Yt(this);default:throw new Error(`invalid option: ${e}`)}}product(e){switch(e){case"row":return Xt(this);case"column":return Jt(this);case void 0:return Zt(this);default:throw new Error(`invalid option: ${e}`)}}mean(e){const r=this.sum(e);switch(e){case"row":{for(let t=0;t<this.rows;t++)r[t]/=this.columns;return r}case"column":{for(let t=0;t<this.columns;t++)r[t]/=this.rows;return r}case void 0:return r/this.size;default:throw new Error(`invalid option: ${e}`)}}variance(e,r={}){if(typeof e=="object"&&(r=e,e=void 0),typeof r!="object")throw new TypeError("options must be an object");const{unbiased:t=!0,mean:n=this.mean(e)}=r;if(typeof t!="boolean")throw new TypeError("unbiased must be a boolean");switch(e){case"row":{if(!Array.isArray(n))throw new TypeError("mean must be an array");return Ht(this,t,n)}case"column":{if(!Array.isArray(n))throw new TypeError("mean must be an array");return xt(this,t,n)}case void 0:{if(typeof n!="number")throw new TypeError("mean must be a number");return At(this,t,n)}default:throw new Error(`invalid option: ${e}`)}}standardDeviation(e,r){typeof e=="object"&&(r=e,e=void 0);const t=this.variance(e,r);if(e===void 0)return Math.sqrt(t);for(let n=0;n<t.length;n++)t[n]=Math.sqrt(t[n]);return t}center(e,r={}){if(typeof e=="object"&&(r=e,e=void 0),typeof r!="object")throw new TypeError("options must be an object");const{center:t=this.mean(e)}=r;switch(e){case"row":{if(!Array.isArray(t))throw new TypeError("center must be an array");return te(this,t),this}case"column":{if(!Array.isArray(t))throw new TypeError("center must be an array");return ee(this,t),this}case void 0:{if(typeof t!="number")throw new TypeError("center must be a number");return re(this,t),this}default:throw new Error(`invalid option: ${e}`)}}scale(e,r={}){if(typeof e=="object"&&(r=e,e=void 0),typeof r!="object")throw new TypeError("options must be an object");let t=r.scale;switch(e){case"row":{if(t===void 0)t=ne(this);else if(!Array.isArray(t))throw new TypeError("scale must be an array");return oe(this,t),this}case"column":{if(t===void 0)t=ie(this);else if(!Array.isArray(t))throw new TypeError("scale must be an array");return se(this,t),this}case void 0:{if(t===void 0)t=le(this);else if(typeof t!="number")throw new TypeError("scale must be a number");return he(this,t),this}default:throw new Error(`invalid option: ${e}`)}}toString(e){return Pt(this,e)}}B.prototype.klass="Matrix",typeof Symbol!="undefined"&&(B.prototype[Symbol.for("nodejs.util.inspect.custom")]=Ct);function Ft(i,e){return i-e}B.random=B.rand,B.randomInt=B.randInt,B.diagonal=B.diag,B.prototype.diagonal=B.prototype.diag,B.identity=B.eye,B.prototype.negate=B.prototype.neg,B.prototype.tensorProduct=B.prototype.kroneckerProduct;class D extends B{constructor(e,r){super();if(D.isMatrix(e))return e.clone();if(Number.isInteger(e)&&e>=0)if(this.data=[],Number.isInteger(r)&&r>=0)for(let t=0;t<e;t++)this.data.push(new Float64Array(r));else throw new TypeError("nColumns must be a positive integer");else if(Array.isArray(e)){const t=e;if(e=t.length,r=e?t[0].length:0,typeof r!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let n=0;n<e;n++){if(t[n].length!==r)throw new RangeError("Inconsistent array dimensions");this.data.push(Float64Array.from(t[n]))}}else throw new TypeError("First argument must be a positive number or an array");this.rows=e,this.columns=r}set(e,r,t){return this.data[e][r]=t,this}get(e,r){return this.data[e][r]}removeRow(e){return et(this,e),this.data.splice(e,1),this.rows-=1,this}addRow(e,r){return r===void 0&&(r=e,e=this.rows),et(this,e,!0),r=Float64Array.from(at(this,r)),this.data.splice(e,0,r),this.rows+=1,this}removeColumn(e){rt(this,e);for(let r=0;r<this.rows;r++){const t=new Float64Array(this.columns-1);for(let n=0;n<e;n++)t[n]=this.data[r][n];for(let n=e+1;n<this.columns;n++)t[n-1]=this.data[r][n];this.data[r]=t}return this.columns-=1,this}addColumn(e,r){typeof r=="undefined"&&(r=e,e=this.columns),rt(this,e,!0),r=ft(this,r);for(let t=0;t<this.rows;t++){const n=new Float64Array(this.columns+1);let o=0;for(;o<e;o++)n[o]=this.data[t][o];for(n[o++]=r[t];o<this.columns+1;o++)n[o]=this.data[t][o-1];this.data[t]=n}return this.columns+=1,this}}Ut(B,D);class gt extends B{constructor(e){super();this.data=e,this.rows=e.length,this.columns=e[0].length}set(e,r,t){return this.data[e][r]=t,this}get(e,r){return this.data[e][r]}}class ue{constructor(e){e=gt.checkMatrix(e);let r=e.clone(),t=r.rows,n=r.columns,o=new Float64Array(t),u=1,c,p,y,k,I,d,F,M,E;for(c=0;c<t;c++)o[c]=c;for(M=new Float64Array(t),p=0;p<n;p++){for(c=0;c<t;c++)M[c]=r.get(c,p);for(c=0;c<t;c++){for(E=Math.min(c,p),I=0,y=0;y<E;y++)I+=r.get(c,y)*M[y];M[c]-=I,r.set(c,p,M[c])}for(k=p,c=p+1;c<t;c++)Math.abs(M[c])>Math.abs(M[k])&&(k=c);if(k!==p){for(y=0;y<n;y++)d=r.get(k,y),r.set(k,y,r.get(p,y)),r.set(p,y,d);F=o[k],o[k]=o[p],o[p]=F,u=-u}if(p<t&&r.get(p,p)!==0)for(c=p+1;c<t;c++)r.set(c,p,r.get(c,p)/r.get(p,p))}this.LU=r,this.pivotVector=o,this.pivotSign=u}isSingular(){let e=this.LU,r=e.columns;for(let t=0;t<r;t++)if(e.get(t,t)===0)return!0;return!1}solve(e){e=D.checkMatrix(e);let r=this.LU;if(r.rows!==e.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let n=e.columns,o=e.subMatrixRow(this.pivotVector,0,n-1),u=r.columns,c,p,y;for(y=0;y<u;y++)for(c=y+1;c<u;c++)for(p=0;p<n;p++)o.set(c,p,o.get(c,p)-o.get(y,p)*r.get(c,y));for(y=u-1;y>=0;y--){for(p=0;p<n;p++)o.set(y,p,o.get(y,p)/r.get(y,y));for(c=0;c<y;c++)for(p=0;p<n;p++)o.set(c,p,o.get(c,p)-o.get(y,p)*r.get(c,y))}return o}get determinant(){let e=this.LU;if(!e.isSquare())throw new Error("Matrix must be square");let r=this.pivotSign,t=e.columns;for(let n=0;n<t;n++)r*=e.get(n,n);return r}get lowerTriangularMatrix(){let e=this.LU,r=e.rows,t=e.columns,n=new D(r,t);for(let o=0;o<r;o++)for(let u=0;u<t;u++)o>u?n.set(o,u,e.get(o,u)):o===u?n.set(o,u,1):n.set(o,u,0);return n}get upperTriangularMatrix(){let e=this.LU,r=e.rows,t=e.columns,n=new D(r,t);for(let o=0;o<r;o++)for(let u=0;u<t;u++)o<=u?n.set(o,u,e.get(o,u)):n.set(o,u,0);return n}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function ut(i,e){let r=0;return Math.abs(i)>Math.abs(e)?(r=e/i,Math.abs(i)*Math.sqrt(1+r*r)):e!==0?(r=i/e,Math.abs(e)*Math.sqrt(1+r*r)):0}class ae{constructor(e){e=gt.checkMatrix(e);let r=e.clone(),t=e.rows,n=e.columns,o=new Float64Array(n),u,c,p,y;for(p=0;p<n;p++){let k=0;for(u=p;u<t;u++)k=ut(k,r.get(u,p));if(k!==0){for(r.get(p,p)<0&&(k=-k),u=p;u<t;u++)r.set(u,p,r.get(u,p)/k);for(r.set(p,p,r.get(p,p)+1),c=p+1;c<n;c++){for(y=0,u=p;u<t;u++)y+=r.get(u,p)*r.get(u,c);for(y=-y/r.get(p,p),u=p;u<t;u++)r.set(u,c,r.get(u,c)+y*r.get(u,p))}}o[p]=-k}this.QR=r,this.Rdiag=o}solve(e){e=D.checkMatrix(e);let r=this.QR,t=r.rows;if(e.rows!==t)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let n=e.columns,o=e.clone(),u=r.columns,c,p,y,k;for(y=0;y<u;y++)for(p=0;p<n;p++){for(k=0,c=y;c<t;c++)k+=r.get(c,y)*o.get(c,p);for(k=-k/r.get(y,y),c=y;c<t;c++)o.set(c,p,o.get(c,p)+k*r.get(c,y))}for(y=u-1;y>=0;y--){for(p=0;p<n;p++)o.set(y,p,o.get(y,p)/this.Rdiag[y]);for(c=0;c<y;c++)for(p=0;p<n;p++)o.set(c,p,o.get(c,p)-o.get(y,p)*r.get(c,y))}return o.subMatrix(0,u-1,0,n-1)}isFullRank(){let e=this.QR.columns;for(let r=0;r<e;r++)if(this.Rdiag[r]===0)return!1;return!0}get upperTriangularMatrix(){let e=this.QR,r=e.columns,t=new D(r,r),n,o;for(n=0;n<r;n++)for(o=0;o<r;o++)n<o?t.set(n,o,e.get(n,o)):n===o?t.set(n,o,this.Rdiag[n]):t.set(n,o,0);return t}get orthogonalMatrix(){let e=this.QR,r=e.rows,t=e.columns,n=new D(r,t),o,u,c,p;for(c=t-1;c>=0;c--){for(o=0;o<r;o++)n.set(o,c,0);for(n.set(c,c,1),u=c;u<t;u++)if(e.get(c,c)!==0){for(p=0,o=c;o<r;o++)p+=e.get(o,c)*n.get(o,u);for(p=-p/e.get(c,c),o=c;o<r;o++)n.set(o,u,n.get(o,u)+p*e.get(o,c))}}return n}}class Vt{constructor(e,r={}){if(e=gt.checkMatrix(e),e.isEmpty())throw new Error("Matrix must be non-empty");let t=e.rows,n=e.columns;const{computeLeftSingularVectors:o=!0,computeRightSingularVectors:u=!0,autoTranspose:c=!1}=r;let p=Boolean(o),y=Boolean(u),k=!1,I;if(t<n)if(!c)I=e.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{I=e.transpose(),t=I.rows,n=I.columns,k=!0;let s=p;p=y,y=s}else I=e.clone();let d=Math.min(t,n),F=Math.min(t+1,n),M=new Float64Array(F),E=new D(t,d),_=new D(n,n),z=new Float64Array(n),b=new Float64Array(t),v=new Float64Array(F);for(let s=0;s<F;s++)v[s]=s;let f=Math.min(t-1,n),g=Math.max(0,Math.min(n-2,t)),m=Math.max(f,g);for(let s=0;s<m;s++){if(s<f){M[s]=0;for(let l=s;l<t;l++)M[s]=ut(M[s],I.get(l,s));if(M[s]!==0){I.get(s,s)<0&&(M[s]=-M[s]);for(let l=s;l<t;l++)I.set(l,s,I.get(l,s)/M[s]);I.set(s,s,I.get(s,s)+1)}M[s]=-M[s]}for(let l=s+1;l<n;l++){if(s<f&&M[s]!==0){let a=0;for(let h=s;h<t;h++)a+=I.get(h,s)*I.get(h,l);a=-a/I.get(s,s);for(let h=s;h<t;h++)I.set(h,l,I.get(h,l)+a*I.get(h,s))}z[l]=I.get(s,l)}if(p&&s<f)for(let l=s;l<t;l++)E.set(l,s,I.get(l,s));if(s<g){z[s]=0;for(let l=s+1;l<n;l++)z[s]=ut(z[s],z[l]);if(z[s]!==0){z[s+1]<0&&(z[s]=0-z[s]);for(let l=s+1;l<n;l++)z[l]/=z[s];z[s+1]+=1}if(z[s]=-z[s],s+1<t&&z[s]!==0){for(let l=s+1;l<t;l++)b[l]=0;for(let l=s+1;l<t;l++)for(let a=s+1;a<n;a++)b[l]+=z[a]*I.get(l,a);for(let l=s+1;l<n;l++){let a=-z[l]/z[s+1];for(let h=s+1;h<t;h++)I.set(h,l,I.get(h,l)+a*b[h])}}if(y)for(let l=s+1;l<n;l++)_.set(l,s,z[l])}}let w=Math.min(n,t+1);if(f<n&&(M[f]=I.get(f,f)),t<w&&(M[w-1]=0),g+1<w&&(z[g]=I.get(g,w-1)),z[w-1]=0,p){for(let s=f;s<d;s++){for(let l=0;l<t;l++)E.set(l,s,0);E.set(s,s,1)}for(let s=f-1;s>=0;s--)if(M[s]!==0){for(let l=s+1;l<d;l++){let a=0;for(let h=s;h<t;h++)a+=E.get(h,s)*E.get(h,l);a=-a/E.get(s,s);for(let h=s;h<t;h++)E.set(h,l,E.get(h,l)+a*E.get(h,s))}for(let l=s;l<t;l++)E.set(l,s,-E.get(l,s));E.set(s,s,1+E.get(s,s));for(let l=0;l<s-1;l++)E.set(l,s,0)}else{for(let l=0;l<t;l++)E.set(l,s,0);E.set(s,s,1)}}if(y)for(let s=n-1;s>=0;s--){if(s<g&&z[s]!==0)for(let l=s+1;l<n;l++){let a=0;for(let h=s+1;h<n;h++)a+=_.get(h,s)*_.get(h,l);a=-a/_.get(s+1,s);for(let h=s+1;h<n;h++)_.set(h,l,_.get(h,l)+a*_.get(h,s))}for(let l=0;l<n;l++)_.set(l,s,0);_.set(s,s,1)}let j=w-1,V=Number.EPSILON;for(;w>0;){let s,l;for(s=w-2;s>=-1&&s!==-1;s--){const a=Number.MIN_VALUE+V*Math.abs(M[s]+Math.abs(M[s+1]));if(Math.abs(z[s])<=a||Number.isNaN(z[s])){z[s]=0;break}}if(s===w-2)l=4;else{let a;for(a=w-1;a>=s&&a!==s;a--){let h=(a!==w?Math.abs(z[a]):0)+(a!==s+1?Math.abs(z[a-1]):0);if(Math.abs(M[a])<=V*h){M[a]=0;break}}a===s?l=3:a===w-1?l=1:(l=2,s=a)}switch(s++,l){case 1:{let a=z[w-2];z[w-2]=0;for(let h=w-2;h>=s;h--){let N=ut(M[h],a),S=M[h]/N,R=a/N;if(M[h]=N,h!==s&&(a=-R*z[h-1],z[h-1]=S*z[h-1]),y)for(let T=0;T<n;T++)N=S*_.get(T,h)+R*_.get(T,w-1),_.set(T,w-1,-R*_.get(T,h)+S*_.get(T,w-1)),_.set(T,h,N)}break}case 2:{let a=z[s-1];z[s-1]=0;for(let h=s;h<w;h++){let N=ut(M[h],a),S=M[h]/N,R=a/N;if(M[h]=N,a=-R*z[h],z[h]=S*z[h],p)for(let T=0;T<t;T++)N=S*E.get(T,h)+R*E.get(T,s-1),E.set(T,s-1,-R*E.get(T,h)+S*E.get(T,s-1)),E.set(T,h,N)}break}case 3:{const a=Math.max(Math.abs(M[w-1]),Math.abs(M[w-2]),Math.abs(z[w-2]),Math.abs(M[s]),Math.abs(z[s])),h=M[w-1]/a,N=M[w-2]/a,S=z[w-2]/a,R=M[s]/a,T=z[s]/a,O=((N+h)*(N-h)+S*S)/2,P=h*S*(h*S);let L=0;(O!==0||P!==0)&&(O<0?L=0-Math.sqrt(O*O+P):L=Math.sqrt(O*O+P),L=P/(O+L));let C=(R+h)*(R-h)+L,U=R*T;for(let $=s;$<w-1;$++){let q=ut(C,U);q===0&&(q=Number.MIN_VALUE);let W=C/q,G=U/q;if($!==s&&(z[$-1]=q),C=W*M[$]+G*z[$],z[$]=W*z[$]-G*M[$],U=G*M[$+1],M[$+1]=W*M[$+1],y)for(let Q=0;Q<n;Q++)q=W*_.get(Q,$)+G*_.get(Q,$+1),_.set(Q,$+1,-G*_.get(Q,$)+W*_.get(Q,$+1)),_.set(Q,$,q);if(q=ut(C,U),q===0&&(q=Number.MIN_VALUE),W=C/q,G=U/q,M[$]=q,C=W*z[$]+G*M[$+1],M[$+1]=-G*z[$]+W*M[$+1],U=G*z[$+1],z[$+1]=W*z[$+1],p&&$<t-1)for(let Q=0;Q<t;Q++)q=W*E.get(Q,$)+G*E.get(Q,$+1),E.set(Q,$+1,-G*E.get(Q,$)+W*E.get(Q,$+1)),E.set(Q,$,q)}z[w-2]=C;break}case 4:{if(M[s]<=0&&(M[s]=M[s]<0?-M[s]:0,y))for(let a=0;a<=j;a++)_.set(a,s,-_.get(a,s));for(;s<j&&!(M[s]>=M[s+1]);){let a=M[s];if(M[s]=M[s+1],M[s+1]=a,y&&s<n-1)for(let h=0;h<n;h++)a=_.get(h,s+1),_.set(h,s+1,_.get(h,s)),_.set(h,s,a);if(p&&s<t-1)for(let h=0;h<t;h++)a=E.get(h,s+1),E.set(h,s+1,E.get(h,s)),E.set(h,s,a);s++}w--;break}}}if(k){let s=_;_=E,E=s}this.m=t,this.n=n,this.s=M,this.U=E,this.V=_}solve(e){let r=e,t=this.threshold,n=this.s.length,o=D.zeros(n,n);for(let d=0;d<n;d++)Math.abs(this.s[d])<=t?o.set(d,d,0):o.set(d,d,1/this.s[d]);let u=this.U,c=this.rightSingularVectors,p=c.mmul(o),y=c.rows,k=u.rows,I=D.zeros(y,k);for(let d=0;d<y;d++)for(let F=0;F<k;F++){let M=0;for(let E=0;E<n;E++)M+=p.get(d,E)*u.get(F,E);I.set(d,F,M)}return I.mmul(r)}solveForDiagonal(e){return this.solve(D.diag(e))}inverse(){let e=this.V,r=this.threshold,t=e.rows,n=e.columns,o=new D(t,this.s.length);for(let k=0;k<t;k++)for(let I=0;I<n;I++)Math.abs(this.s[I])>r&&o.set(k,I,e.get(k,I)/this.s[I]);let u=this.U,c=u.rows,p=u.columns,y=new D(t,c);for(let k=0;k<t;k++)for(let I=0;I<c;I++){let d=0;for(let F=0;F<p;F++)d+=o.get(k,F)*u.get(I,F);y.set(k,I,d)}return y}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let e=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,r=0,t=this.s;for(let n=0,o=t.length;n<o;n++)t[n]>e&&r++;return r}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return D.diag(this.s)}}function fe(i,e=!1){return i=gt.checkMatrix(i),e?new Vt(i).inverse():ce(i,D.eye(i.rows))}function ce(i,e,r=!1){return i=gt.checkMatrix(i),e=gt.checkMatrix(e),r?new Vt(i).solve(e):i.isSquare()?new ue(i).solve(e):new ae(i).solve(e)}function ge(i,e,r,t,n){const o=r.length,u=i.x.length;let c=new Array(o);for(let p=0;p<o;p++){c[p]=new Array(u);let y=r.slice();y[p]+=t;let k=n(y);for(let I=0;I<u;I++)c[p][I]=e[I]-k(i.x[I])}return new D(c)}function me(i,e){const r=i.x.length;let t=new Array(r);for(let n=0;n<r;n++)t[n]=[i.y[n]-e[n]];return new D(t)}function pe(i,e,r,t,n){let o=r*t*t,u=D.eye(e.length,e.length,o);const c=n(e);let p=new Float64Array(i.x.length);for(let d=0;d<i.x.length;d++)p[d]=c(i.x[d]);let y=ge(i,p,e,t,n),k=me(i,p),I=fe(u.add(y.mmul(y.transpose())));return e=new D([e]),e=e.sub(I.mmul(y).mmul(k).mul(t).transpose()),e.to1DArray()}function we(i,e,r={}){let{maxIterations:t=100,gradientDifference:n=.1,damping:o=0,errorTolerance:u=.01,minValues:c,maxValues:p,initialValues:y}=r;if(o<=0)throw new Error("The damping option must be a positive number");if(!i.x||!i.y)throw new Error("The data parameter must have x and y elements");if(!ht(i.x)||i.x.length<2||!ht(i.y)||i.y.length<2)throw new Error("The data parameter elements must be an array with more than 2 points");if(i.x.length!==i.y.length)throw new Error("The data parameter elements must have the same size");let k=y||new Array(e.length).fill(1),I=k.length;if(p=p||new Array(I).fill(Number.MAX_SAFE_INTEGER),c=c||new Array(I).fill(Number.MIN_SAFE_INTEGER),p.length!==c.length)throw new Error("minValues and maxValues must be the same size");if(!ht(k))throw new Error("initialValues must be an array");let d=Nt(i,k,e),F=d<=u,M;for(M=0;M<t&&!F;M++){k=pe(i,k,o,n,e);for(let E=0;E<I;E++)k[E]=Math.min(Math.max(c[E],k[E]),p[E]);if(d=Nt(i,k,e),isNaN(d))break;F=d<=u}return{parameterValues:k,parameterError:d,iterations:M}}var ve=lt(function(i,e){var r=K&&K.__awaiter||function(s,l,a,h){return new(a||(a=Promise))(function(N,S){function R(P){try{O(h.next(P))}catch(L){S(L)}}function T(P){try{O(h.throw(P))}catch(L){S(L)}}function O(P){P.done?N(P.value):new a(function(L){L(P.value)}).then(R,T)}O((h=h.apply(s,l||[])).next())})},t=K&&K.__generator||function(s,l){var a={label:0,sent:function(){if(S[0]&1)throw S[1];return S[1]},trys:[],ops:[]},h,N,S,R;return R={next:T(0),throw:T(1),return:T(2)},typeof Symbol=="function"&&(R[Symbol.iterator]=function(){return this}),R;function T(P){return function(L){return O([P,L])}}function O(P){if(h)throw new TypeError("Generator is already executing.");for(;a;)try{if(h=1,N&&(S=P[0]&2?N.return:P[0]?N.throw||((S=N.return)&&S.call(N),0):N.next)&&!(S=S.call(N,P[1])).done)return S;switch(N=0,S&&(P=[P[0]&2,S.value]),P[0]){case 0:case 1:S=P;break;case 4:return a.label++,{value:P[1],done:!1};case 5:a.label++,N=P[1],P=[0];continue;case 7:P=a.ops.pop(),a.trys.pop();continue;default:if(S=a.trys,!(S=S.length>0&&S[S.length-1])&&(P[0]===6||P[0]===2)){a=0;continue}if(P[0]===3&&(!S||P[1]>S[0]&&P[1]<S[3])){a.label=P[1];break}if(P[0]===6&&a.label<S[1]){a.label=S[1],S=P;break}if(S&&a.label<S[2]){a.label=S[2],a.ops.push(P);break}S[2]&&a.ops.pop(),a.trys.pop();continue}P=l.call(s,a)}catch(L){P=[6,L],N=0}finally{h=S=0}if(P[0]&5)throw P[1];return{value:P[0]?P[1]:void 0,done:!0}}},n=K&&K.__read||function(s,l){var a=typeof Symbol=="function"&&s[Symbol.iterator];if(!a)return s;var h=a.call(s),N,S=[],R;try{for(;(l===void 0||l-- >0)&&!(N=h.next()).done;)S.push(N.value)}catch(T){R={error:T}}finally{try{N&&!N.done&&(a=h.return)&&a.call(h)}finally{if(R)throw R.error}}return S},o=K&&K.__spread||function(){for(var s=[],l=0;l<arguments.length;l++)s=s.concat(n(arguments[l]));return s},u=K&&K.__importStar||function(s){if(s&&s.__esModule)return s;var l={};if(s!=null)for(var a in s)Object.hasOwnProperty.call(s,a)&&(l[a]=s[a]);return l.default=s,l},c=K&&K.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(e,"__esModule",{value:!0});var p=u(jt),y=u(kt),k=u(Tt),I=u(Rt),d=u(wt),F=c(we),M=1e-5,E=.001,_=function(){function s(l){l===void 0&&(l={});var a=this;this.learningRate=1,this.localConnectivity=1,this.minDist=.1,this.nComponents=2,this.nEpochs=0,this.nNeighbors=15,this.negativeSampleRate=5,this.random=Math.random,this.repulsionStrength=1,this.setOpMixRatio=1,this.spread=1,this.transformQueueSize=4,this.targetMetric="categorical",this.targetWeight=.5,this.targetNNeighbors=this.nNeighbors,this.distanceFn=z,this.isInitialized=!1,this.rpForest=[],this.embedding=[],this.optimizationState=new v;var h=function(N){l[N]!==void 0&&(a[N]=l[N])};h("distanceFn"),h("learningRate"),h("localConnectivity"),h("minDist"),h("nComponents"),h("nEpochs"),h("nNeighbors"),h("negativeSampleRate"),h("random"),h("repulsionStrength"),h("setOpMixRatio"),h("spread"),h("transformQueueSize")}return s.prototype.fit=function(l){return this.initializeFit(l),this.optimizeLayout(),this.embedding},s.prototype.fitAsync=function(l,a){return a===void 0&&(a=function(){return!0}),r(this,void 0,void 0,function(){return t(this,function(h){switch(h.label){case 0:return this.initializeFit(l),[4,this.optimizeLayoutAsync(a)];case 1:return h.sent(),[2,this.embedding]}})})},s.prototype.setSupervisedProjection=function(l,a){a===void 0&&(a={}),this.Y=l,this.targetMetric=a.targetMetric||this.targetMetric,this.targetWeight=a.targetWeight||this.targetWeight,this.targetNNeighbors=a.targetNNeighbors||this.targetNNeighbors},s.prototype.setPrecomputedKNN=function(l,a){this.knnIndices=l,this.knnDistances=a},s.prototype.initializeFit=function(l){if(l.length<=this.nNeighbors)throw new Error("Not enough data points ("+l.length+") to create nNeighbors: "+this.nNeighbors+".  Add more data points or adjust the configuration.");if(this.X===l&&this.isInitialized)return this.getNEpochs();if(this.X=l,!this.knnIndices&&!this.knnDistances){var a=this.nearestNeighbors(l);this.knnIndices=a.knnIndices,this.knnDistances=a.knnDistances}this.graph=this.fuzzySimplicialSet(l,this.nNeighbors,this.setOpMixRatio),this.makeSearchFns(),this.searchGraph=this.makeSearchGraph(l),this.processGraphForSupervisedProjection();var h=this.initializeSimplicialSetEmbedding(),N=h.head,S=h.tail,R=h.epochsPerSample;return this.optimizationState.head=N,this.optimizationState.tail=S,this.optimizationState.epochsPerSample=R,this.initializeOptimization(),this.prepareForOptimizationLoop(),this.isInitialized=!0,this.getNEpochs()},s.prototype.makeSearchFns=function(){var l=k.makeInitializations(this.distanceFn),a=l.initFromTree,h=l.initFromRandom;this.initFromTree=a,this.initFromRandom=h,this.search=k.makeInitializedNNSearch(this.distanceFn)},s.prototype.makeSearchGraph=function(l){for(var a=this.knnIndices,h=this.knnDistances,N=[l.length,l.length],S=new y.SparseMatrix([],[],[],N),R=0;R<a.length;R++)for(var T=a[R],O=h[R],P=0;P<T.length;P++){var L=T[P],C=O[P];C>0&&S.set(R,L,C)}var U=y.transpose(S);return y.maximum(S,U)},s.prototype.transform=function(l){var a=this,h=this.X;if(h===void 0||h.length===0)throw new Error("No data has been fit.");var N=Math.floor(this.nNeighbors*this.transformQueueSize);N=Math.min(h.length,N);var S=k.initializeSearch(this.rpForest,h,l,N,this.initFromRandom,this.initFromTree,this.random),R=this.search(h,this.searchGraph,S,l),T=p.deheapSort(R),O=T.indices,P=T.weights;O=O.map(function(tt){return tt.slice(0,a.nNeighbors)}),P=P.map(function(tt){return tt.slice(0,a.nNeighbors)});var L=Math.max(0,this.localConnectivity-1),C=this.smoothKNNDistance(P,this.nNeighbors,L),U=C.sigmas,$=C.rhos,q=this.computeMembershipStrengths(O,P,U,$),W=q.rows,G=q.cols,Q=q.vals,J=[l.length,h.length],Y=new y.SparseMatrix(W,G,Q,J),H=y.normalize(Y,"l1"),X=y.getCSR(H),x=l.length,nt=d.reshape2d(X.indices,x,this.nNeighbors),A=d.reshape2d(X.values,x,this.nNeighbors),it=V(nt,A,this.embedding),ot=this.nEpochs?this.nEpochs/3:Y.nRows<=1e4?100:30,mt=Y.getValues().reduce(function(tt,pt){return pt>tt?pt:tt},0);Y=Y.map(function(tt){return tt<mt/ot?0:tt}),Y=y.eliminateZeros(Y);var Z=this.makeEpochsPerSample(Y.getValues(),ot),st=Y.getRows(),vt=Y.getCols();return this.assignOptimizationStateParameters({headEmbedding:it,tailEmbedding:this.embedding,head:st,tail:vt,currentEpoch:0,nEpochs:ot,nVertices:Y.getDims()[1],epochsPerSample:Z}),this.prepareForOptimizationLoop(),this.optimizeLayout()},s.prototype.processGraphForSupervisedProjection=function(){var l=this,a=l.Y,h=l.X;if(a){if(a.length!==h.length)throw new Error("Length of X and y must be equal");if(this.targetMetric==="categorical"){var N=this.targetWeight<1,S=N?2.5*(1/(1-this.targetWeight)):1e12;this.graph=this.categoricalSimplicialSetIntersection(this.graph,a,S)}}},s.prototype.step=function(){var l=this.optimizationState.currentEpoch;return l<this.getNEpochs()&&this.optimizeLayoutStep(l),this.optimizationState.currentEpoch},s.prototype.getEmbedding=function(){return this.embedding},s.prototype.nearestNeighbors=function(l){var a=this,h=a.distanceFn,N=a.nNeighbors,S=function(q){return Math.log(q)/Math.log(2)},R=k.makeNNDescent(h,this.random),T=function(q){return q===.5?0:Math.round(q)},O=5+Math.floor(T(Math.pow(l.length,.5)/20)),P=Math.max(5,Math.floor(Math.round(S(l.length))));this.rpForest=I.makeForest(l,N,O,this.random);var L=I.makeLeafArray(this.rpForest),C=R(l,L,N,P),U=C.indices,$=C.weights;return{knnIndices:U,knnDistances:$}},s.prototype.fuzzySimplicialSet=function(l,a,h){h===void 0&&(h=1);var N=this,S=N.knnIndices,R=S===void 0?[]:S,T=N.knnDistances,O=T===void 0?[]:T,P=N.localConnectivity,L=this.smoothKNNDistance(O,a,P),C=L.sigmas,U=L.rhos,$=this.computeMembershipStrengths(R,O,C,U),q=$.rows,W=$.cols,G=$.vals,Q=[l.length,l.length],J=new y.SparseMatrix(q,W,G,Q),Y=y.transpose(J),H=y.pairwiseMultiply(J,Y),X=y.subtract(y.add(J,Y),H),x=y.multiplyScalar(X,h),nt=y.multiplyScalar(H,1-h),A=y.add(x,nt);return A},s.prototype.categoricalSimplicialSetIntersection=function(l,a,h,N){N===void 0&&(N=1);var S=w(l,a,N,h);return S=y.eliminateZeros(S),j(S)},s.prototype.smoothKNNDistance=function(l,a,h,N,S){h===void 0&&(h=1),N===void 0&&(N=64),S===void 0&&(S=1);for(var R=Math.log(a)/Math.log(2)*S,T=d.zeros(l.length),O=d.zeros(l.length),P=0;P<l.length;P++){var L=0,C=Infinity,U=1,$=l[P],q=$.filter(function(nt){return nt>0});if(q.length>=h){var W=Math.floor(h),G=h-W;W>0?(T[P]=q[W-1],G>M&&(T[P]+=G*(q[W]-q[W-1]))):T[P]=G*q[0]}else q.length>0&&(T[P]=d.max(q));for(var Q=0;Q<N;Q++){for(var J=0,Y=1;Y<l[P].length;Y++){var H=l[P][Y]-T[P];H>0?J+=Math.exp(-(H/U)):J+=1}if(Math.abs(J-R)<M)break;J>R?(C=U,U=(L+C)/2):(L=U,C===Infinity?U*=2:U=(L+C)/2)}if(O[P]=U,T[P]>0){var X=d.mean($);O[P]<E*X&&(O[P]=E*X)}else{var x=d.mean(l.map(d.mean));O[P]<E*x&&(O[P]=E*x)}}return{sigmas:O,rhos:T}},s.prototype.computeMembershipStrengths=function(l,a,h,N){for(var S=l.length,R=l[0].length,T=d.zeros(S*R),O=d.zeros(S*R),P=d.zeros(S*R),L=0;L<S;L++)for(var C=0;C<R;C++){var U=0;l[L][C]!==-1&&(l[L][C]===L?U=0:a[L][C]-N[L]<=0?U=1:U=Math.exp(-((a[L][C]-N[L])/h[L])),T[L*R+C]=L,O[L*R+C]=l[L][C],P[L*R+C]=U)}return{rows:T,cols:O,vals:P}},s.prototype.initializeSimplicialSetEmbedding=function(){for(var l=this,a=this.getNEpochs(),h=this.nComponents,N=this.graph.getValues(),S=0,R=0;R<N.length;R++){var T=N[R];S<N[R]&&(S=T)}var O=this.graph.map(function(W){return W<S/a?0:W});this.embedding=d.zeros(O.nRows).map(function(){return d.zeros(h).map(function(){return d.tauRand(l.random)*20+-10})});for(var P=[],L=[],C=[],U=O.getAll(),R=0;R<U.length;R++){var $=U[R];$.value&&(P.push($.value),C.push($.row),L.push($.col))}var q=this.makeEpochsPerSample(P,a);return{head:L,tail:C,epochsPerSample:q}},s.prototype.makeEpochsPerSample=function(l,a){var h=d.filled(l.length,-1),N=d.max(l),S=l.map(function(R){return R/N*a});return S.forEach(function(R,T){R>0&&(h[T]=a/S[T])}),h},s.prototype.assignOptimizationStateParameters=function(l){Object.assign(this.optimizationState,l)},s.prototype.prepareForOptimizationLoop=function(){var l=this,a=l.repulsionStrength,h=l.learningRate,N=l.negativeSampleRate,S=this.optimizationState,R=S.epochsPerSample,T=S.headEmbedding,O=S.tailEmbedding,P=T[0].length,L=T.length===O.length,C=R.map(function(q){return q/N}),U=o(C),$=o(R);this.assignOptimizationStateParameters({epochOfNextSample:$,epochOfNextNegativeSample:U,epochsPerNegativeSample:C,moveOther:L,initialAlpha:h,alpha:h,gamma:a,dim:P})},s.prototype.initializeOptimization=function(){var l=this.embedding,a=this.embedding,h=this.optimizationState,N=h.head,S=h.tail,R=h.epochsPerSample,T=this.getNEpochs(),O=this.graph.nCols,P=m(this.spread,this.minDist),L=P.a,C=P.b;this.assignOptimizationStateParameters({headEmbedding:l,tailEmbedding:a,head:N,tail:S,epochsPerSample:R,a:L,b:C,nEpochs:T,nVertices:O})},s.prototype.optimizeLayoutStep=function(l){for(var a=this.optimizationState,h=a.head,N=a.tail,S=a.headEmbedding,R=a.tailEmbedding,T=a.epochsPerSample,O=a.epochOfNextSample,P=a.epochOfNextNegativeSample,L=a.epochsPerNegativeSample,C=a.moveOther,U=a.initialAlpha,$=a.alpha,q=a.gamma,W=a.a,G=a.b,Q=a.dim,J=a.nEpochs,Y=a.nVertices,H=4,X=0;X<T.length;X++)if(!(O[X]>l)){var x=h[X],nt=N[X],A=S[x],it=R[nt],ot=g(A,it),mt=0;ot>0&&(mt=-2*W*G*Math.pow(ot,G-1),mt/=W*Math.pow(ot,G)+1);for(var Z=0;Z<Q;Z++){var st=f(mt*(A[Z]-it[Z]),H);A[Z]+=st*$,C&&(it[Z]+=-st*$)}O[X]+=T[X];for(var vt=Math.floor((l-P[X])/L[X]),tt=0;tt<vt;tt++){var pt=d.tauRandInt(Y,this.random),bt=R[pt],Et=g(A,bt),dt=0;if(Et>0)dt=2*q*G,dt/=(.001+Et)*(W*Math.pow(Et,G)+1);else if(x===pt)continue;for(var Z=0;Z<Q;Z++){var st=4;dt>0&&(st=f(dt*(A[Z]-bt[Z]),H)),A[Z]+=st*$}}P[X]+=vt*L[X]}return a.alpha=U*(1-l/J),a.currentEpoch+=1,S},s.prototype.optimizeLayoutAsync=function(l){var a=this;return l===void 0&&(l=function(){return!0}),new Promise(function(h,N){var S=function(){return r(a,void 0,void 0,function(){var R,T,O,P,L,C;return t(this,function(U){try{if(R=this.optimizationState,T=R.nEpochs,O=R.currentEpoch,this.embedding=this.optimizeLayoutStep(O),P=this.optimizationState.currentEpoch,L=l(P)===!1,C=P===T,!L&&!C)setTimeout(function(){return S()},0);else return[2,h(C)]}catch($){N($)}return[2]})})};setTimeout(function(){return S()},0)})},s.prototype.optimizeLayout=function(l){l===void 0&&(l=function(){return!0});for(var a=!1,h=[];!a;){var N=this.optimizationState,S=N.nEpochs,R=N.currentEpoch;h=this.optimizeLayoutStep(R);var T=this.optimizationState.currentEpoch,O=l(T)===!1;a=T===S||O}return h},s.prototype.getNEpochs=function(){var l=this.graph;if(this.nEpochs>0)return this.nEpochs;var a=l.nRows;return a<=2500?500:a<=5e3?400:a<=7500?300:200},s}();e.UMAP=_;function z(s,l){for(var a=0,h=0;h<s.length;h++)a+=Math.pow(s[h]-l[h],2);return Math.sqrt(a)}e.euclidean=z;function b(s,l){for(var a=0,h=0,N=0,S=0;S<s.length;S++)a+=s[S]*l[S],h+=Math.pow(s[S],2),N+=Math.pow(l[S],2);return h===0&&N===0?0:h===0||N===0?1:1-a/Math.sqrt(h*N)}e.cosine=b;var v=function(){function s(){this.currentEpoch=0,this.headEmbedding=[],this.tailEmbedding=[],this.head=[],this.tail=[],this.epochsPerSample=[],this.epochOfNextSample=[],this.epochOfNextNegativeSample=[],this.epochsPerNegativeSample=[],this.moveOther=!0,this.initialAlpha=1,this.alpha=1,this.gamma=1,this.a=1.5769434603113077,this.b=.8950608779109733,this.dim=2,this.nEpochs=500,this.nVertices=0}return s}();function f(s,l){return s>l?l:s<-l?-l:s}function g(s,l){for(var a=0,h=0;h<s.length;h++)a+=Math.pow(s[h]-l[h],2);return a}function m(s,l){var a=function(U){var $=n(U,2),q=$[0],W=$[1];return function(G){return 1/(1+q*Math.pow(G,2*W))}},h=d.linear(0,s*3,300).map(function(U){return U<l?1:U}),N=d.zeros(h.length).map(function(U,$){var q=h[$]>=l;return q?Math.exp(-(h[$]-l)/s):U}),S=[.5,.5],R={x:h,y:N},T={damping:1.5,initialValues:S,gradientDifference:.1,maxIterations:100,errorTolerance:.01},O=F.default(R,a,T).parameterValues,P=n(O,2),L=P[0],C=P[1];return{a:L,b:C}}e.findABParams=m;function w(s,l,a,h){return a===void 0&&(a=1),h===void 0&&(h=5),s.map(function(N,S,R){return l[S]===-1||l[R]===-1?N*Math.exp(-a):l[S]!==l[R]?N*Math.exp(-h):N})}e.fastIntersection=w;function j(s){s=y.normalize(s,"max");var l=y.transpose(s),a=y.pairwiseMultiply(l,s);return s=y.add(s,y.subtract(l,a)),y.eliminateZeros(s)}e.resetLocalConnectivity=j;function V(s,l,a){for(var h=d.zeros(s.length).map(function(O){return d.zeros(a[0].length)}),N=0;N<s.length;N++)for(var S=0;S<s[0].length;S++)for(var R=0;R<a[0].length;R++){var T=s[N][S];h[N][R]+=l[N][S]*a[T][R]}return h}e.initTransform=V}),de=lt(function(i,e){Object.defineProperty(e,"__esModule",{value:!0}),e.UMAP=ve.UMAP}),ye=de.UMAP;export{ye as UMAP};
