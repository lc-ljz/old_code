function x(n,i){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);i&&(o=o.filter(function(m){return Object.getOwnPropertyDescriptor(n,m).enumerable})),r.push.apply(r,o)}return r}function N(n){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?x(Object(r),!0).forEach(function(o){J(n,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(r,o))})}return n}function J(n,i,r){return i in n?Object.defineProperty(n,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[i]=r,n}import a,{useCallback as c,useEffect as _,useImperativeHandle as Q,useLayoutEffect as V,useMemo as X,useRef as S,useState as R}from"../../../web_modules/react.js";import Y from"../ScatterChart/index.js";import Z from"./ChartOperations.js";import{rem as ee}from"../../utils/style.js";import P from"../../../web_modules/styled-components.js";import{useTranslation as te}from"../../../web_modules/react-i18next.js";import ne from"../../hooks/useWorker.js";const re=P.div.withConfig({displayName:"HighDimensionalChart__Wrapper",componentId:"sc-179pidq-0"})(["height:100%;display:flex;flex-direction:column;justify-content:stretch;align-items:stretch;"]),ie=P.div.withConfig({displayName:"HighDimensionalChart__Toolbar",componentId:"sc-179pidq-1"})(["display:flex;justify-content:space-between;align-items:center;margin-bottom:",";> .info{color:var(--text-light-color);> .sep{display:inline-block;width:1px;background-color:var(--border-color);margin:0 1em;height:1em;vertical-align:middle;}}"],ee(20)),oe=P.div.withConfig({displayName:"HighDimensionalChart__Chart",componentId:"sc-179pidq-2"})(["width:100%;height:100%;overflow:hidden;font-size:0;*{outline:none;}"]),k=a.forwardRef(({vectors:n,labels:i,shape:r,dim:o,is3D:m,reduction:t,perplexity:f,learningRate:p,neighbors:C,focusedIndices:q,highlightIndices:A,onCalculate:h,onCalculated:v,onError:g,className:W},L)=>{var I;const{t:b}=te(["high-dimensional","common"]),T=S(null),D=S(null),[U,z]=R(0),[M,$]=R(0);V(()=>{const s=T.current;if(s){let j=null;const F=new ResizeObserver(()=>{j!=null&&(cancelAnimationFrame(j),j=null),j=requestAnimationFrame(()=>{const H=s.getBoundingClientRect();z(H.width),$(H.height)})});return F.observe(s),()=>F.unobserve(s)}},[]);const B=X(()=>{const s={input:n,dim:o,n:m?3:2};switch(t){case"pca":return{reduction:t,params:N({},s)};case"tsne":return{reduction:t,params:N({perplexity:f,epsilon:p},s)};case"umap":return{reduction:t,params:N({neighbors:C},s)};default:return null}},[o,m,p,C,f,t,n]),{data:l,error:E,worker:e}=ne("high-dimensional/calculate",B),w=S(null),O=c(()=>{e==null||e.emit("INFO",{type:"step"})},[e]),y=c(()=>{w.current=requestAnimationFrame(O)},[O]),u=c(()=>{t==="tsne"&&(e==null||e.on("RESULT",y),O())},[t,e,y,O]),d=c(()=>{t==="tsne"&&(w.current&&(cancelAnimationFrame(w.current),w.current=null),e==null||e.off("RESULT",y))},[t,e,y]),K=c(()=>{t==="tsne"&&(d(),e==null||e.emit("INFO",{type:"reset"}),e==null||e.once("RESULT",()=>u()))},[t,u,d,e]);_(()=>{if(t==="tsne")return u(),()=>{d()}},[t,u,d]),_(()=>{t==="tsne"&&(e==null||e.emit("INFO",{type:"params",data:{perplexity:f,epsilon:p}}))},[t,f,p,e]);const G=c(()=>{t==="umap"&&(e==null||e.emit("INFO"))},[t,e]);return _(()=>{E?g==null||g(E):l?v==null||v(l):h==null||h()},[l,E,h,v,g]),Q(L,()=>({pauseTSNE:d,resumeTSNE:u,rerunTSNE:K,rerunUMAP:G})),a.createElement(re,{className:W},a.createElement(ie,null,a.createElement("div",{className:"info"},b("high-dimensional:points"),b("common:colon"),r[0],a.createElement("span",{className:"sep"}),b("high-dimensional:data-dimension"),b("common:colon"),r[1]),a.createElement(Z,{onReset:()=>{var s;return(s=D.current)===null||s===void 0?void 0:s.reset()}})),a.createElement(oe,{ref:T},a.createElement(Y,{ref:D,width:U,height:M,data:(I=l==null?void 0:l.vectors)!==null&&I!==void 0?I:[],labels:i,is3D:m,rotate:t!=="tsne",focusedIndices:q,highlightIndices:A})))});k.displayName="HighDimensionalChart";export default k;
