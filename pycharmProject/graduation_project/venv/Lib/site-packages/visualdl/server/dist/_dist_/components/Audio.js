import t,{useCallback as n,useEffect as A,useMemo as U,useRef as M,useState as a}from"../../web_modules/react.js";import{primaryColor as W,rem as r,size as h,transitionProps as c}from"../utils/style.js";import{AudioPlayer as Y}from"../utils/audio.js";import N from"./Icon.js";import Z from"../../web_modules/react-spinners/PuffLoader.js";import L from"./RangeSlider.js";import ee from"../../web_modules/react-rangeslider.js";import re from"../../web_modules/react-spinners/SyncLoader.js";import oe from"../../web_modules/@tippyjs/react.js";import te from"../../web_modules/mime-types.js";import ne from"../../web_modules/moment.js";import R from"../../web_modules/styled-components.js";import{useTranslation as le}from"../../web_modules/react-i18next.js";const ae=R.div.withConfig({displayName:"Audio__Container",componentId:"sc-6r7be3-0"})(["background-color:var(--audio-background-color);border-radius:",";display:flex;align-items:center;justify-content:space-between;padding:0 ",";"," > .control{font-size:",";"," line-height:1;margin:0 ",";color:var(--primary-color);cursor:pointer;"," &.volume{font-size:",";","}&.disabled{color:var(--text-light-color);cursor:not-allowed;}&:hover{color:var(--primary-focused-color);}&:active{color:var(--primary-active-color);}}> .slider{flex-grow:1;padding:0 ",";}> .time{color:var(--text-lighter-color);font-size:",";margin:0 ",";","}"],r(8),r(20),c("background-color"),r(16),h(r(16),r(16)),r(10),c("color"),r(20),h(r(20),r(20)),r(10),r(12),r(5),c("color")),ie=R(ee).withConfig({displayName:"Audio__VolumeSlider",componentId:"sc-6r7be3-1"})(["margin:"," ",";width:",";height:",";cursor:pointer;position:relative;background-color:#dbdeeb;outline:none;border-radius:",";user-select:none;"," --color:var(--primary-color);&:hover{--color:var(--primary-focused-color);}&:active{--color:var(--primary-active-color);}.rangeslider__fill{background-color:var(--color);position:absolute;bottom:0;width:100%;border-bottom-left-radius:",";border-bottom-right-radius:",";border-top:"," solid var(--color);box-sizing:content-box;","}.rangeslider__handle{background-color:var(--color);"," position:absolute;left:-",";border-radius:50%;outline:none;"," .rangeslider__handle-tooltip,.rangeslider__handle-label{display:none;}}.rangeslider__labels{display:none;}"],r(15),r(18),r(4),r(100),r(2),c("color"),r(2),r(2),r(4),c(["background-color","color"]),h(r(8),r(8)),r(2),c("background-color")),w=100;function P(u){const l=ne.duration(u,"seconds");return String(Math.floor(l.asMinutes())).padStart(2,"0")+":"+String(l.seconds()).padStart(2,"0")}const ce=({audioContext:u,data:l,loading:V,error:D,onLoading:d,onLoad:m,className:T})=>{const{t:$}=le("common"),p=M(null),o=M(null),[O,v]=a(0),[f,g]=a(0),[B,S]=a("00:00"),[b,k]=a(!1),[y,_]=a(!1),[i,j]=a(100),[E,X]=a(!1),x=n(()=>{var e;return(e=o.current)===null||e===void 0?void 0:e.play()},[]),C=n(()=>{var e;return(e=o.current)===null||e===void 0?void 0:e.pause()},[]),q=n(()=>{var e;return(e=o.current)===null||e===void 0?void 0:e.toggle()},[]),F=n(e=>{!o.current||(g(e/w*o.current.duration),v(e))},[]),G=n(()=>{X(y),C()},[y,C]),H=n(()=>{!o.current||(o.current.seek(f),E&&f<o.current.duration&&x())},[x,f,E]),J=n(()=>{o.current&&(o.current.toggleMute(),j(o.current.volume))},[]),s=n(()=>{if(o.current){const e=o.current.current;g(e),v(Math.floor(e/o.current.duration*w))}},[]),I=n(()=>{s(),p.current=window.setInterval(s,250)},[s]),z=n(()=>{o.current&&o.current.current>=o.current.duration&&s(),p.current&&(window.clearInterval(p.current),p.current=null)},[s]);A(()=>{o.current&&(o.current.volume=i)},[i]),A(()=>{let e=null;return l&&(async()=>{k(!0),d==null||d(),g(0),v(0),S("00:00"),e=new Y({context:u,onplay:()=>{_(!0),I()},onstop:()=>{_(!1),z()}});const Q=await l.data.arrayBuffer();await e.load(Q,l.type!=null&&te.extension(l.type)||void 0),k(!1),S(P(e.duration)),m==null||m({sampleRate:e.sampleRate,duration:e.duration}),o.current=e})(),()=>{e&&(_(!1),e.dispose(),o.current=null)}},[l,I,z,d,m,u]);const K=U(()=>i===0?"mute":i<=50?"volume-low":"volume",[i]);return V?t.createElement(re,{color:W,size:"15px"}):D?t.createElement("div",null,$("common:error")):t.createElement(ae,{className:T},t.createElement("a",{className:`control ${b?"disabled":""}`,onClick:q},b?t.createElement(Z,{size:"16px"}):t.createElement(N,{type:y?"pause":"play"})),t.createElement("div",{className:"slider"},t.createElement(L,{min:0,max:w,step:1,value:O,disabled:b,onChange:F,onChangeStart:G,onChangeComplete:H})),t.createElement("span",{className:"time"},P(f),"/",B),t.createElement(oe,{placement:"top",animation:"shift-away-subtle",interactive:!0,hideOnClick:!1,content:t.createElement(ie,{value:i,min:0,max:100,step:1,onChange:j,orientation:"vertical"})},t.createElement("a",{className:"control volume",onClick:J},t.createElement(N,{type:K}))))};export default ce;
