import N,{AsideSection as c}from"../components/Aside.js";import ce from"../components/GraphPage/Graph.js";import e,{useCallback as a,useEffect as O,useMemo as D,useRef as J,useState as r}from"../../web_modules/react.js";import ie from"../components/Select.js";import{actions as me,selectors as pe}from"../store/index.js";import{primaryColor as de,rem as i,size as ue}from"../utils/style.js";import{useDispatch as he,useSelector as ge}from"../../web_modules/react-redux.js";import G from"../components/Button.js";import F from"../components/Checkbox.js";import fe from"../components/Content.js";import w from"../components/Field.js";import ve from"../../web_modules/react-spinners/HashLoader.js";import Ee from"../components/GraphPage/ModelPropertiesDialog.js";import we from"../components/GraphPage/NodeDocumentationSidebar.js";import Se from"../components/GraphPage/NodePropertiesSidebar.js";import K from"../components/RadioButton.js";import Ce from"../components/RadioGroup.js";import be from"../components/GraphPage/Search.js";import je from"../components/Title.js";import xe from"../components/GraphPage/Uploader.js";import m from"../../web_modules/styled-components.js";import _e from"../hooks/useRequest.js";import{useTranslation as ye}from"../../web_modules/react-i18next.js";const Q=m(G).withConfig({displayName:"graph__FullWidthButton",componentId:"sc-1v5tw03-0"})(["width:100%;"]),Ne=m(ie).withConfig({displayName:"graph__FullWidthSelect",componentId:"sc-1v5tw03-1"})(["width:100%;"]),De=m.div.withConfig({displayName:"graph__ExportButtonWrapper",componentId:"sc-1v5tw03-2"})(["display:flex;justify-content:space-between;> *{flex:1 1 auto;&:not(:last-child){margin-right:",";}}"],i(20)),Ge=m(c).withConfig({displayName:"graph__SearchSection",componentId:"sc-1v5tw03-3"})(["max-height:calc(100% - ",");display:flex;flex-direction:column;&:not(:last-child){padding-bottom:0;}"],i(40)),Fe=m.div.withConfig({displayName:"graph__Loading",componentId:"sc-1v5tw03-4"})([""," display:flex;flex-direction:column;justify-content:center;align-items:center;overscroll-behavior:none;cursor:progress;font-size:",";line-height:",";"],ue("100%","100%"),i(16),i(60)),Pe=()=>{const{t:o}=ye(["graph","common"]),P=he(),V=ge(pe.graph.model),l=J(null),p=J(null),[S,k]=r(V),d=a(t=>{P(me.graph.setModel(t)),k(t)},[P]),u=a(()=>{p.current&&(p.current.value="",p.current.click())},[]),X=a(t=>{const n=t.target;n&&n.files&&n.files.length&&d(n.files)},[d]),{data:s,loading:C}=_e(S?null:"/graph/graph");O(()=>{s!=null&&s.data.size&&k([new File([s.data],s.filename||"unknown_model")])},[s]);const[b,Y]=r([]),[z,R]=r(""),Z=a(t=>{Y(t.graphs),R(t.selected||"")},[]),M=a(t=>{var n;R(t),(n=l.current)===null||n===void 0||n.changeGraph(t)},[]),[B,j]=r(""),[h,I]=r(!1),[A,$]=r({text:"",result:[]}),W=a(t=>{var n;j(t),(n=l.current)===null||n===void 0||n.search(t)},[]),L=a(t=>{var n;j(t.name),(n=l.current)===null||n===void 0||n.select(t)},[]),[g,ee]=r(!1),[f,te]=r(!0),[v,oe]=r(!1),[x,ne]=r(!1),[re,H]=r(null),[E,T]=r(null),[_,y]=r(null);O(()=>{j(""),$({text:"",result:[]})},[S,g,f,v]);const U=D(()=>h?null:e.createElement(Q,{type:"primary",rounded:!0,onClick:u},o("graph:change-model")),[o,u,h]),[q,le]=r(!1),ae=D(()=>!q||C?null:_?e.createElement(N,{width:i(360)},e.createElement(we,{data:_,onClose:()=>y(null)})):E?e.createElement(N,{width:i(360)},e.createElement(Se,{data:E,onClose:()=>T(null),showNodeDocumentation:()=>{var t;return(t=l.current)===null||t===void 0?void 0:t.showNodeDocumentation(E)}})):e.createElement(N,{bottom:U},e.createElement(Ge,null,e.createElement(be,{text:B,data:A,onChange:W,onSelect:L,onActive:()=>I(!0),onDeactive:()=>I(!1)})),!h&&e.createElement(e.Fragment,null,e.createElement(c,null,e.createElement(Q,{onClick:()=>{var t;return(t=l.current)===null||t===void 0?void 0:t.showModelProperties()}},o("graph:model-properties"))),b.length>1&&e.createElement(c,null,e.createElement(w,{label:o("graph:subgraph")},e.createElement(Ne,{list:b,value:z,onChange:M}))),e.createElement(c,null,e.createElement(w,{label:o("graph:display-data")},e.createElement("div",null,e.createElement(F,{value:g,onChange:ee},o("graph:show-attributes"))),e.createElement("div",null,e.createElement(F,{value:f,onChange:te},o("graph:show-initializers"))),e.createElement("div",null,e.createElement(F,{value:v,onChange:oe},o("graph:show-node-names"))))),e.createElement(c,null,e.createElement(w,{label:o("graph:direction")},e.createElement(Ce,{value:x,onChange:ne},e.createElement(K,{value:!1},o("graph:vertical")),e.createElement(K,{value:!0},o("graph:horizontal"))))),e.createElement(c,null,e.createElement(w,{label:o("graph:export-file")},e.createElement(De,null,e.createElement(G,{onClick:()=>{var t;return(t=l.current)===null||t===void 0?void 0:t.export("png")}},o("graph:export-png")),e.createElement(G,{onClick:()=>{var t;return(t=l.current)===null||t===void 0?void 0:t.export("svg")}},o("graph:export-svg"))))))),[o,U,B,h,A,b,z,M,W,L,g,f,v,x,q,C,E,_]),se=D(()=>e.createElement(xe,{onClickUpload:u,onDropFiles:d}),[u,d]);return e.createElement(e.Fragment,null,e.createElement(je,null,o("common:graph")),e.createElement(Ee,{data:re,onClose:()=>H(null)}),e.createElement(fe,{aside:ae},C?e.createElement(Fe,null,e.createElement(ve,{size:"60px",color:de})):e.createElement(ce,{ref:l,files:S,uploader:se,showAttributes:g,showInitializers:f,showNames:v,horizontal:x,onRendered:()=>le(!0),onOpened:Z,onSearch:t=>$(t),onShowModelProperties:t=>H(t),onShowNodeProperties:t=>{T(t),y(null)},onShowNodeDocumentation:t=>y(t)}),e.createElement("input",{ref:p,type:"file",multiple:!1,onChange:X,style:{display:"none"}})))};export default Pe;
