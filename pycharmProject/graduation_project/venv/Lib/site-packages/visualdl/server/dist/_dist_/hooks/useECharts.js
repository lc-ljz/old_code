import{useCallback as n,useEffect as y,useLayoutEffect as L,useMemo as b,useRef as a,useState as f}from"../../web_modules/react.js";import{position as S,primaryColor as k,size as T}from"../utils/style.js";import{dataURL2Blob as w}from"../utils/image.js";import{saveFile as j}from"../utils/saveFile.js";import A from"../../web_modules/styled-components.js";import{themes as d}from"../utils/theme.js";import g from"./useTheme.js";const F=t=>{const r=a(null),[e,c]=f(null),u=g(),m=a(t.onInit),x=a(t.onDispose),s=n(()=>e==null?void 0:e.dispatchAction({type:"hideTip"}),[e]),C=n(()=>{(async()=>{if(!r.current)return;const{default:l}=await import("../../web_modules/echarts.js");t.gl&&await import("../../web_modules/echarts-gl.js");const o=l.init(r.current);r.current.addEventListener("mouseleave",s),setTimeout(()=>{if(t.zoom&&o.dispatchAction({type:"takeGlobalCursor",key:"dataZoomSelect",dataZoomSelectActive:!0}),o){var i;(i=m.current)===null||i===void 0||i.call(m,o)}},0),c(o)})()},[t.gl,t.zoom,s]),p=n(()=>{if(e){var l,o;(l=x.current)===null||l===void 0||l.call(x,e),e.dispose(),(o=r.current)===null||o===void 0||o.removeEventListener("mouseleave",s),c(null)}},[s,e]);y(()=>(C(),p),[C,p]),y(()=>{t.loading?e==null||e.showLoading("default",{text:"",color:k,textColor:d[u].textColor,maskColor:d[u].maskColor,zlevel:0}):e==null||e.hideLoading()},[t.loading,u,e]);const h=a(null);L(()=>{if(t.autoFit){const l=h.current;if(l){let o=null;const i=new ResizeObserver(()=>{o!=null&&(cancelAnimationFrame(o),o=null),o=requestAnimationFrame(()=>{e==null||e.resize()})});return i.observe(l),()=>i.unobserve(l)}}},[t.autoFit,e]);const v=n(l=>{if(e){const o=w(e.getDataURL({type:"png",pixelRatio:2,backgroundColor:"#FFF"}));j(o,`${l||"chart"}.png`)}},[e]);return{ref:r,echart:e,wrapper:h,saveAsImage:v}};export default F;export const Wrapper=A.div.withConfig({displayName:"useECharts__Wrapper",componentId:"b4c6ck-0"})(["position:relative;display:flex;justify-content:center;align-items:stretch;> .echarts{width:100%;}> .loading{"," "," display:flex;justify-content:center;align-items:center;}"],T("100%"),S("absolute",0,null,null,0)),useChartTheme=t=>{const r=g(),e=b(()=>d[r],[r]);return b(()=>t?{title:{textStyle:{color:e.textColor}},tooltip:{backgroundColor:e.tooltipBackgroundColor,borderColor:e.tooltipBackgroundColor,textStyle:{color:e.tooltipTextColor}},xAxis3D:{nameTextStyle:{color:e.textLighterColor},axisLabel:{color:e.textLighterColor},axisLine:{lineStyle:{color:e.borderColor}},splitLine:{lineStyle:{color:e.borderColor}}},yAxis3D:{nameTextStyle:{color:e.textLighterColor},axisLabel:{color:e.textLighterColor},axisLine:{lineStyle:{color:e.borderColor}},splitLine:{lineStyle:{color:e.borderColor}}},zAxis3D:{nameTextStyle:{color:e.textLighterColor},axisLabel:{color:e.textLighterColor},axisLine:{lineStyle:{color:e.borderColor}},splitLine:{lineStyle:{color:e.borderColor}}}}:{title:{textStyle:{color:e.textColor}},tooltip:{backgroundColor:e.tooltipBackgroundColor,borderColor:e.tooltipBackgroundColor,textStyle:{color:e.tooltipTextColor}},xAxis:{nameTextStyle:{color:e.textLighterColor},axisLabel:{color:e.textLighterColor},axisLine:{lineStyle:{color:e.borderColor}},splitLine:{lineStyle:{color:e.borderColor}}},yAxis:{nameTextStyle:{color:e.textLighterColor},axisLabel:{color:e.textLighterColor},axisLine:{lineStyle:{color:e.borderColor}},splitLine:{lineStyle:{color:e.borderColor}}}},[e,t])};
