import d from"../../web_modules/file-saver.js";import g from"../../web_modules/jszip.js";import{fetcher as w}from"./fetch.js";import r from"../../web_modules/lodash/isString.js";import{toast as l}from"../../web_modules/react-toastify.js";async function h(e){const t=await w(e);return t.data instanceof Blob?t.data:r(t)?t:JSON.stringify(t)}function u(e){return e.replace(/[/\\?%*:|"<>]/g,"_")}export function saveFile(e,t){let i;e instanceof Blob?i=e:i=new Blob([e],{type:"text/plain;charset=utf-8"}),d.saveAs(i,u(t))}export default async function(e,t,i="download.zip"){if(!e)return;let f=e,o=t;r(e)&&(f=[e]),r(t)&&(o=[t]);try{const s=await Promise.all(f.map(h));if(s.length===1)saveFile(s[0],o[0]);else{const c=new g;let a="",p="";if(o.length===1){const n=o[0].split(".");n.length>1&&(p=n.pop()),a=n.join(".")}s.forEach((n,m)=>{c.file(u(a?`${a} - ${m}.${p}`:o[m]),n)});const b=await c.generateAsync({type:"blob"});saveFile(b,i)}}catch(s){l(s.message,{position:l.POSITION.TOP_CENTER,type:l.TYPE.ERROR})}}
