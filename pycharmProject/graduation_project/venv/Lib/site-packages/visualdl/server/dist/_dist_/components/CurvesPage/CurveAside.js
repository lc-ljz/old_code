function x(t,o){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);o&&(s=s.filter(function(b){return Object.getOwnPropertyDescriptor(t,b).enumerable})),r.push.apply(r,s)}return r}function a(t){for(var o=1;o<arguments.length;o++){var r=arguments[o]!=null?arguments[o]:{};o%2?x(Object(r),!0).forEach(function(s){q(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function q(t,o,r){return o in t?Object.defineProperty(t,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[o]=r,t}import u,{useCallback as D,useEffect as f,useMemo as M,useState as w}from"../../../web_modules/react.js";import{rem as E,transitionProps as k}from"../../utils/style.js";import{AsideSection as v}from"../Aside.js";import W from"../Field.js";import K from"../RunAside.js";import L from"./StepSlider.js";import N from"../Loader/curves/StepSlider.js";import z from"../TimeModeSelect.js";import{TimeType as B}from"../../resource/curves/index.js";import{cycleFetcher as G}from"../../utils/fetch.js";import H from"../../../web_modules/query-string.js";import J from"../../../web_modules/styled-components.js";import{useRunningRequest as Q}from"../../hooks/useRequest.js";import U from"../../hooks/useTagFilter.js";import{useTranslation as V}from"../../../web_modules/react-i18next.js";const X=J.div.withConfig({displayName:"CurveAside__StepSliderWrapper",componentId:"sc-9miumj-0"})(["max-height:30vh;overflow:auto;overflow-x:hidden;overflow-y:auto;flex-shrink:0;> ",":last-child{padding-bottom:",";margin-bottom:0;}+ .run-section{border-top:1px solid var(--border-color);margin-top:0;padding-top:",";","}&:empty + .run-section{border-top:none;}"],v,E(20),E(20),k("border-color")),Y=({type:t,onChangeLoading:o,onChangeSteps:r,onToggleRunning:s})=>{const{t:b}=V("curves"),[p,R]=w(!0),{runs:P,tags:O,runsInTags:m,selectedRuns:I,onChangeRuns:C,loading:c}=U(`${t}-curve`,p),{data:l}=Q(m.map(e=>`/${t}-curve/steps?${H.stringify({run:e.label})}`),!!p,(...e)=>G(e)),[T,_]=w({}),A=D((e,n)=>_(i=>a(a({},i),{},{[e]:n})),[]);f(()=>_(e=>m.reduce((n,i)=>(e[i.label]!=null&&(n[i.label]=e[i.label]),n),{})),[m]);const g=M(()=>m.map((e,n)=>{var i,y,j,h,S;return a(a({},e),{},{index:(i=T[e.label])!==null&&i!==void 0?i:((y=l==null?void 0:l[n].length)!==null&&y!==void 0?y:1)-1,steps:(j=l==null?void 0:l[n].map(d=>d[1]))!==null&&j!==void 0?j:[],wallTimes:(h=l==null?void 0:l[n].map(d=>Math.floor(d[0])))!==null&&h!==void 0?h:[],relatives:(S=l==null?void 0:l[n].map(d=>d[0]-l[n][0][0]))!==null&&S!==void 0?S:[]})}),[m,l,T]),[$,F]=w(B.Step);return f(()=>{r(O.map(e=>a(a({},e),{},{runs:e.runs.map(n=>a(a({},n),{},{index:0,steps:[],wallTimes:[],relatives:[]},g.find(i=>i.label===n.label)))})))},[O,g,r]),f(()=>{o(c)},[c,o]),f(()=>{s(p)},[s,p]),u.createElement(K,{runs:P,selectedRuns:I,onChangeRuns:C,running:p,onToggleRunning:R,loading:c},u.createElement(v,null,u.createElement(W,{label:b("curves:time-display-type")},u.createElement(z,{value:$,onChange:F}))),u.createElement(X,null,c?u.createElement(v,null,u.createElement(N,null)):g.map(e=>u.createElement(v,{key:e.label},u.createElement(L,{run:e,type:$,onChange:n=>A(e.label,n)})))))};export default Y;
