var mediapipe=mediapipe||{},protobuf=protobuf||require("./protobuf");mediapipe.ModelFactory=class{match(t){if(t.identifier.split(".").pop().toLowerCase()==="pbtxt"){const n=t.tags("pbtxt"),e=t.text;if(n.has("node")&&(e.indexOf("input_stream:")!==-1||e.indexOf("input_side_packet:")!==-1||e.indexOf("output_stream:")!==-1))return!0}return!1}open(t,n){const e=t.identifier;try{const s=protobuf.TextReader.create(t.text),r=new mediapipe.Object(s);return Promise.resolve(new mediapipe.Model(r))}catch(s){n.exception(s,!1);const r=s&&s.message?s.message:s.toString();return Promise.reject(new mediapipe.Error(r.replace(/\.$/,"")+" in '"+e+"'."))}}},mediapipe.Model=class{constructor(t){this._graphs=[new mediapipe.Graph(t)]}get format(){return"MediaPipe"}get graphs(){return this._graphs}},mediapipe.Graph=class{constructor(t){if(this._inputs=[],this._outputs=[],this._nodes=[],t){if(t.input_stream){const n=Array.isArray(t.input_stream)?t.input_stream:[t.input_stream];for(const e of n){const s=e.split(":"),r=s.length>1?s.shift():"",i=s.shift();this._inputs.push(new mediapipe.Parameter(i,[new mediapipe.Argument(i,r,null)]))}}if(t.output_stream){const n=Array.isArray(t.output_stream)?t.output_stream:[t.output_stream];for(const e of n){const s=e.split(":"),r=s.length>1?s.shift():"",i=s.shift();this._outputs.push(new mediapipe.Parameter(i,[new mediapipe.Argument(i,r,null)]))}}if(t.input_side_packet){const n=Array.isArray(t.input_side_packet)?t.input_side_packet:[t.input_side_packet];for(const e of n){const s=e.split(":"),r=s.length>1?s.shift():"",i=s.shift();this._inputs.push(new mediapipe.Parameter(i,[new mediapipe.Argument(i,r,null)]))}}if(t.output_side_packet){const n=Array.isArray(t.output_side_packet)?t.output_side_packet:[t.output_side_packet];for(const e of n){const s=e.split(":"),r=s.length>1?s.shift():"",i=s.shift();this._outputs.push(new mediapipe.Parameter(e,[new mediapipe.Argument(i,r,null)]))}}if(t.node){const n=Array.isArray(t.node)?t.node:[t.node];for(const e of n)this._nodes.push(new mediapipe.Node(e))}}}get inputs(){return this._inputs}get outputs(){return this._outputs}get nodes(){return this._nodes}},mediapipe.Node=class{constructor(t){if(this._type=t.calculator||"?",this._type=this._type.replace(/Calculator$/,""),this._inputs=[],this._outputs=[],this._attributes=[],t.input_stream){const e=[],s=Array.isArray(t.input_stream)?t.input_stream:[t.input_stream];for(const r of s){const i=r.split(":"),u=i.length>1?i.shift():"",a=i.shift();e.push(new mediapipe.Argument(a,u,null))}this._inputs.push(new mediapipe.Parameter("input_stream",e))}if(t.output_stream){const e=[],s=Array.isArray(t.output_stream)?t.output_stream:[t.output_stream];for(const r of s){const i=r.split(":"),u=i.length>1?i.shift():"",a=i.shift();e.push(new mediapipe.Argument(a,u,null))}this._outputs.push(new mediapipe.Parameter("output_stream",e))}if(t.input_side_packet){const e=[],s=Array.isArray(t.input_side_packet)?t.input_side_packet:[t.input_side_packet];for(const r of s){const i=r.split(":"),u=i.length>1?i.shift():"",a=i.shift();e.push(new mediapipe.Argument(a,u,null))}this._inputs.push(new mediapipe.Parameter("input_side_packet",e))}if(t.output_side_packet){const e=[],s=Array.isArray(t.output_side_packet)?t.output_side_packet:[t.output_side_packet];for(const r of s){const i=r.split(":"),u=i.length>1?i.shift():"",a=i.shift();e.push(new mediapipe.Argument(a,u,null))}this._outputs.push(new mediapipe.Parameter("output_side_packet",e))}const n=t.options||t.node_options||null;if(n)for(const e of Object.keys(n)){if(e==="__type__")continue;const s=n[e];this._attributes.push(new mediapipe.Attribute(e,s))}}get name(){return""}get type(){return this._type}get metadata(){return null}get inputs(){return this._inputs}get outputs(){return this._outputs}get attributes(){return this._attributes}},mediapipe.Attribute=class{constructor(t,n){this._name=t,this._value=n}get name(){return this._name}get value(){return this._value}get visible(){return!0}},mediapipe.Parameter=class{constructor(t,n){this._name=t,this._arguments=n}get name(){return this._name}get visible(){return!0}get arguments(){return this._arguments}},mediapipe.Argument=class{constructor(t,n,e){if(typeof t!="string")throw new mediapipe.Error("Invalid argument identifier '"+JSON.stringify(t)+"'.");this._name=t,this._type=n||null,this._initializer=e||null}get name(){return this._name}get type(){return this._type?this._type:this._initializer?this._initializer.type:null}get initializer(){return this._initializer}},mediapipe.Object=class{constructor(t){t.start();let n=!1;const e=t.peek();e.startsWith("[")&&e.endsWith("]")&&(this.__type__=t.read().substring(0,e.length-1),t.match(":"),t.start(),n=!0);const s=new Set;for(;!t.end();){var r=t.tag(),i=t.peek(),u=null;if(i==="{")u=new mediapipe.Object(t);else if(i.startsWith('"')&&i.endsWith('"'))u=t.read().substring(1,i.length-1);else if(i==="true"||i==="false")u=t.read();else if(t.first())for(u=[];!t.last();){const a=t.read();isNaN(a)||u.push(parseFloat(a))}else u=isNaN(i)?t.read():parseFloat(t.read());!this[r]||Array.isArray(this[r])&&!s.has(r)||(this[r]=[this[r]],s.delete(r)),this[r]?this[r].push(u):(Array.isArray(u)&&s.add(r),this[r]=u)}n&&t.expect("}")}},mediapipe.Error=class extends Error{constructor(t){super(t),this.name="Error loading MediaPipe model."}},typeof module!="undefined"&&typeof module.exports=="object"&&(module.exports.ModelFactory=mediapipe.ModelFactory);
