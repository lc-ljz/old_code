function j(){return j=Object.assign||function(o){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(o[i]=r[i])}return o},j.apply(this,arguments)}function P(o,e){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(o);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(o,n).enumerable})),r.push.apply(r,i)}return r}function v(o){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?P(Object(r),!0).forEach(function(i){G(o,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach(function(i){Object.defineProperty(o,i,Object.getOwnPropertyDescriptor(r,i))})}return o}function G(o,e,r){return e in o?Object.defineProperty(o,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):o[e]=r,o}import H from"../LineChart.js";import a,{useCallback as J,useMemo as O,useRef as Q,useState as U}from"../../../web_modules/react.js";import{options as S,nearestPoint as V}from"../../resource/curves/index.js";import{rem as p,size as T}from"../../utils/style.js";import _ from"../Chart.js";import{Chart as D}from"../Loader/ChartPage.js";import X from"../ChartToolbox.js";import Y from"../TooltipTable.js";import{cycleFetcher as Z}from"../../utils/fetch.js";import{format as I}from"../../../web_modules/d3-format.js";import ee from"../../../web_modules/query-string.js";import{renderToStaticMarkup as te}from"../../../web_modules/react-dom/server.js";import g from"../../../web_modules/styled-components.js";import{useRunningRequest as re}from"../../hooks/useRequest.js";import{useTranslation as oe}from"../../../web_modules/react-i18next.js";import ne from"../../../web_modules/lodash/zip.js";const L=I(".4f"),ie=I(".2f"),ae=g.div.withConfig({displayName:"CurveChart__Wrapper",componentId:"sc-1ymmvrt-0"})([""," display:flex;flex-direction:column;align-items:stretch;justify-content:space-between;"],T("100%","100%")),se=g(H).withConfig({displayName:"CurveChart__StyledLineChart",componentId:"sc-1ymmvrt-1"})(["flex-grow:1;"]),le=g(X).withConfig({displayName:"CurveChart__Toolbox",componentId:"sc-1ymmvrt-2"})(["margin-left:",";margin-right:",";margin-bottom:",";"],p(20),p(20),p(18)),ce=g.div.withConfig({displayName:"CurveChart__Error",componentId:"sc-1ymmvrt-3"})([""," display:flex;justify-content:center;align-items:center;"],T("100%","100%")),m={width:430,height:337},x={width:p(m.width),height:p(m.height)},me=({type:o,runs:e,tag:r,running:i})=>{const{t:n}=oe(["curves","common"]),b=Q(null),{data:f,error:R,loading:$}=re(e.map(t=>`/${o}-curve/list?${ee.stringify({run:t.label,tag:r})}`),!!i,(...t)=>Z(t)),[q,A]=U(!1),h=O(()=>e.map((t,c)=>{var s,u;const[y,w,...l]=(s=f==null||(u=f[c])===null||u===void 0?void 0:u.find(d=>d[1]===t.steps[t.index]))!==null&&s!==void 0?s:[0,0,[],[],[],[],[],[],[]];return[y,w,ne(...l)]}),[f,e]),z=O(()=>h.map((t,c)=>{const s=e[c];return{name:s.label,z:c,itemStyle:{color:s.colors[0]},lineStyle:{color:s.colors[0]},data:t[2],encode:{x:[1],y:[0]}}}),[h,e]),E=J(t=>{const c=Array.isArray(t)?t[0].data:t.data,s=V(h.map(l=>l[2]),c[1]),u=[{label:n("curves:threshold")},{label:n("curves:precision")},{label:n("curves:recall")},{label:n("curves:true-positives")},{label:n("curves:false-positives")},{label:n("curves:true-negatives")},{label:n("curves:false-negatives")}],y=s.reduce((l,d,C)=>(l.push(...new Array(d.length).fill(e[C])),l),[]),w=s.reduce((l,d)=>(l.push(...d.map(([C,N,M,k,W,K,B])=>[ie(B),L(C),L(N),M,k,W,K])),l),[]);return te(a.createElement(Y,{run:n("common:runs"),runs:y,columns:u,data:w}))},[h,e,n]),F=O(()=>v(v({},S),{},{tooltip:v(v({},S.tooltip),{},{formatter:E,hideDelay:300,enterable:!0})}),[E]);return!z&&R?a.createElement(ce,null,n("common:error")):a.createElement(_,j({maximized:q},x),a.createElement(ae,null,a.createElement(se,{ref:b,title:r,options:F,data:z,loading:$,zoom:!0}),a.createElement(le,{items:[{icon:"maximize",activeIcon:"minimize",tooltip:n("curves:maximize"),activeTooltip:n("curves:minimize"),toggle:!0,onClick:()=>A(t=>!t)},{icon:"restore-size",tooltip:n("curves:restore"),onClick:()=>{var t;return(t=b.current)===null||t===void 0?void 0:t.restore()}},{icon:"download",tooltip:n("curves:download-image"),onClick:()=>{var t;return(t=b.current)===null||t===void 0?void 0:t.saveAsImage()}}]})))};export default me;export const Loader=()=>a.createElement(a.Fragment,null,a.createElement(_,x,a.createElement(D,{width:m.width-2,height:m.height-2})),a.createElement(_,x,a.createElement(D,{width:m.width-2,height:m.height-2})));
