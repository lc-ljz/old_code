function _(){return _=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(t[a]=o[a])}return t},_.apply(this,arguments)}function Y(t,r){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(g){return Object.getOwnPropertyDescriptor(t,g).enumerable})),o.push.apply(o,a)}return o}function m(t){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?Y(Object(o),!0).forEach(function(a){pe(t,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):Y(Object(o)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(o,a))})}return t}function pe(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}import ue,{XAxisType as f,YAxisType as v}from"../LineChart.js";import s,{useCallback as O,useMemo as c,useRef as fe,useState as X}from"../../../web_modules/react.js";import{XAxis as he,chartData as ge,options as K,nearestPoint as ye,singlePointRange as U,sortingMethodMap as be,tooltip as ve,xAxisMap as B}from"../../resource/scalar/index.js";import{rem as h,size as G}from"../../utils/style.js";import T from"../Chart.js";import{Chart as H}from"../Loader/ChartPage.js";import we from"../ChartToolbox.js";import je from"../TooltipTable.js";import{cycleFetcher as xe}from"../../utils/fetch.js";import{format as Ce}from"../../../web_modules/d3-format.js";import J from"../../../web_modules/query-string.js";import{renderToStaticMarkup as _e}from"../../../web_modules/react-dom/server.js";import Oe from"../../utils/saveFile.js";import w from"../../../web_modules/styled-components.js";import{useRunningRequest as Te}from"../../hooks/useRequest.js";import{useTranslation as Pe}from"../../../web_modules/react-i18next.js";import P from"../../hooks/useWebAssembly.js";const Q={csv:"csv",tsv:"tsv"},Se=Ce(".8"),Ee=w.div.withConfig({displayName:"ScalarChart__Wrapper",componentId:"sc-1caty5y-0"})([""," display:flex;flex-direction:column;align-items:stretch;justify-content:space-between;"],G("100%","100%")),ze=w(ue).withConfig({displayName:"ScalarChart__StyledLineChart",componentId:"sc-1caty5y-1"})(["flex-grow:1;"]),De=w(we).withConfig({displayName:"ScalarChart__Toolbox",componentId:"sc-1caty5y-2"})(["margin-left:",";margin-right:",";margin-bottom:",";"],h(20),h(20),h(18)),Re=w.div.withConfig({displayName:"ScalarChart__Error",componentId:"sc-1caty5y-3"})([""," display:flex;justify-content:center;align-items:center;"],G("100%","100%")),p={width:430,height:337},S={width:h(p.width),height:h(p.height)},Le=({runs:t,tag:r,smoothing:o,xAxis:a,sortingMethod:g,outlier:E,smoothedOnly:z,showMostValue:D,running:Z})=>{const{t:l,i18n:R}=Pe(["scalar","common"]),j=fe(null),{data:y,error:V,loading:ee}=Te(t.map(e=>`/scalar/list?${J.stringify({run:e.label,tag:r})}`),!!Z,(...e)=>xe(e)),[te,re]=X(!1),u=c(()=>a===he.WallTime?f.time:f.value,[a]),[L,$]=X(v.value),A=O(()=>{$(e=>e===v.log?v.value:v.log)},[$]),ae=c(()=>{var e;return[(e=y==null?void 0:y.map(i=>i!=null?i:[]))!==null&&e!==void 0?e:[],o]},[y,o]),{data:b}=P("scalar_transform",ae),n=c(()=>b!=null?b:[],[b]),oe=c(()=>[n,!!E],[n,E]),{data:I}=P("scalar_axis_range",oe),ne=c(()=>[n],[n]),{data:d}=P("scalar_range",ne),x=c(()=>{let e,i=I;return n.length===1&&n[0].length===1&&([f.value,f.log].includes(u)&&(e=U(n[0][0][B[a]])),i=U(n[0][0][2])),{x:e,y:i}},[n,I,u,a]),k=c(()=>ge({data:n.slice(0,t.length),ranges:D?d!=null?d:[]:[],runs:t,xAxis:a,smoothedOnly:z}),[n,d,t,a,z,D]),M=c(()=>String(Math.max(...n.map(e=>Math.max(...e.map(i=>i[1]))))).length,[n]),F=O(e=>{const i=Array.isArray(e)?e[0].data:e.data,q=B[a],le=ye(n!=null?n:[],t,q,i[q]).map((C,de)=>m(m({},C),d==null?void 0:d[de])),N=be[g](le,i),{columns:ce,data:me}=ve(N,M,R);return _e(s.createElement(je,{run:l("common:runs"),runs:N.map(C=>C.run),columns:ce,data:me}))},[n,d,t,g,a,M,l,R]),ie=c(()=>m(m({},K),{},{tooltip:m(m({},K.tooltip),{},{formatter:F,hideDelay:300,enterable:!0}),xAxis:m(m({type:u},x.x),{},{axisPointer:{label:{formatter:u===f.time?void 0:({value:e})=>Se(e)}}}),yAxis:m({type:L},x.y)}),[F,x,u,L]),W=O(e=>{Oe(t.map(i=>`/scalar/data?${J.stringify({run:i.label,tag:r,type:e})}`),t.map(i=>`visualdl-scalar-${i.label}-${r}.${Q[e]}`),`visualdl-scalar-${r}.zip`)},[t,r]),se=c(()=>[{icon:"maximize",activeIcon:"minimize",tooltip:l("scalar:maximize"),activeTooltip:l("scalar:minimize"),toggle:!0,onClick:()=>re(e=>!e)},{icon:"restore-size",tooltip:l("scalar:restore"),onClick:()=>{var e;return(e=j.current)===null||e===void 0?void 0:e.restore()}},{icon:"log-axis",tooltip:l("scalar:toggle-log-axis"),toggle:!0,onClick:A},{icon:"download",menuList:[{label:l("scalar:download-image"),onClick:()=>{var e;return(e=j.current)===null||e===void 0?void 0:e.saveAsImage()}},{label:l("scalar:download-data"),children:Object.keys(Q).sort((e,i)=>e.localeCompare(i)).map(e=>({label:l("scalar:download-data-format",{format:e}),onClick:()=>W(e)}))}]}],[W,l,A]);return!k&&V?s.createElement(Re,null,l("common:error")):s.createElement(T,_({maximized:te},S),s.createElement(Ee,null,s.createElement(ze,{ref:j,title:r,options:ie,data:k,loading:ee,zoom:!0}),s.createElement(De,{items:se})))};export default Le;export const Loader=()=>s.createElement(s.Fragment,null,s.createElement(T,S,s.createElement(H,{width:p.width-2,height:p.height-2})),s.createElement(T,S,s.createElement(H,{width:p.width-2,height:p.height-2})));
